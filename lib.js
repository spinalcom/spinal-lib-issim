var exports = module.exports = {};
// Generated by CoffeeScript 1.11.1
var BrowserState,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

BrowserState = (function(superClass) {
  extend(BrowserState, superClass);

  BrowserState.inst = [];

  BrowserState.init = false;

  function BrowserState() {
    BrowserState.__super__.constructor.call(this);
    this.add_attr({
      window_size: [0, 0],
      location: {
        hash: "",
        host: "",
        hostname: "",
        href: "",
        pathname: "",
        port: "",
        protocol: "",
        search: ""
      }
    });
    BrowserState.inst.push(this);
    if (!BrowserState.init) {
      BrowserState.init = true;
      window.onresize = BrowserState.onresize;
      window.onhashchange = BrowserState.onhashchange;
    }
    window.onresize();
    window.onhashchange();
  }

  BrowserState.onresize = function() {
    var i, inst, len, ref, results;
    ref = BrowserState.inst;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      inst = ref[i];
      results.push(inst.window_size.set([window.innerWidth, window.innerHeight]));
    }
    return results;
  };

  BrowserState.onhashchange = function() {
    var i, inst, len, ref, results;
    ref = BrowserState.inst;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      inst = ref[i];
      inst.location.hash.set(location.hash);
      inst.location.host.set(location.host);
      inst.location.hostname.set(location.hostname);
      inst.location.href.set(location.href);
      inst.location.pathname.set(location.pathname);
      inst.location.port.set(location.port);
      inst.location.protocol.set(location.protocol);
      results.push(inst.location.search.set(location.search));
    }
    return results;
  };

  return BrowserState;

})(Model);
// Generated by CoffeeScript 1.11.1
var LayoutManagerData,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

LayoutManagerData = (function(superClass) {
  extend(LayoutManagerData, superClass);

  LayoutManagerData._used_panel_id = [];

  function LayoutManagerData(data) {
    if (data == null) {
      data = {
        panel_id: "id_0"
      };
    }
    LayoutManagerData.__super__.constructor.call(this);
    this.add_attr({
      root: data
    });
    this._assign_default_values(this.root);
  }

  LayoutManagerData.prototype.make_info = function(p_min, p_max, border_size) {
    var lst, obj;
    lst = [];
    obj = this._make_graph_rec(lst, this.root.get(), border_size);
    this._make_sizes(obj, p_min, p_max);
    return lst;
  };

  LayoutManagerData.prototype.allow_destruction = function(data) {
    if (data.immortal) {
      return false;
    } else {
      return true;
    }
  };

  LayoutManagerData.prototype.find_item_with_panel_id = function(id, data) {
    var c, j, len, r, ref, ref1;
    if (data == null) {
      data = this.root;
    }
    if ((ref = data.panel_id) != null ? ref.equals(id) : void 0) {
      return data;
    }
    if (data.children != null) {
      ref1 = data.children;
      for (j = 0, len = ref1.length; j < len; j++) {
        c = ref1[j];
        r = this.find_item_with_panel_id(id, c);
        if (r != null) {
          return r;
        }
      }
    }
  };

  LayoutManagerData.prototype.find_parent_of_panel_id = function(id, data) {
    var c, j, len, r, ref, ref1;
    if (data == null) {
      data = this.root;
    }
    if (data.children != null) {
      ref = data.children;
      for (j = 0, len = ref.length; j < len; j++) {
        c = ref[j];
        if ((ref1 = c.panel_id) != null ? ref1.equals(id) : void 0) {
          return data;
        }
        r = this.find_parent_of_panel_id(id, c);
        if (r != null) {
          return r;
        }
      }
    }
  };

  LayoutManagerData.prototype.mk_split = function(d, s, id, c, new_panel_id) {
    var ch, lc, nc, od, os;
    if (new_panel_id == null) {
      new_panel_id = this._find_new_panel_id([]);
    }
    ch = this.find_item_with_panel_id(id);
    od = ch.get();
    os = od.strength || 1;
    nc = {
      panel_id: new_panel_id
    };
    lc = [od, nc];
    if (!s) {
      lc.reverse();
    }
    lc[0].strength = 0 + c;
    lc[1].strength = 1 - c;
    ch.set({
      sep_norm: d,
      strength: os,
      children: lc,
      panel_id: this._find_new_panel_id([new_panel_id])
    });
    return new_panel_id;
  };

  LayoutManagerData.prototype.rm_panel = function(id) {
    var ch, ci, nn, pa;
    if (!this.allow_destruction(id)) {
      return false;
    }
    ch = this.find_item_with_panel_id(id);
    pa = this.find_parent_of_panel_id(id);
    if (pa.children.length === 2) {
      nn = 1 * (pa.children[0] === ch);
      ci = pa.children[nn].get();
      ci.strength = pa.strength.get();
      pa.set(ci);
    } else {
      console.log("TODO");
    }
    return true;
  };

  LayoutManagerData.prototype.panel_id_of_term_panels = function() {
    var res;
    res = [];
    this._get_panel_id_of_term_panels(res, this.root);
    return res;
  };

  LayoutManagerData.prototype.panel_ids = function() {
    var res;
    res = [];
    this._get_panel_ids(res, this.root);
    return res;
  };

  LayoutManagerData.prototype._make_graph_rec = function(lst, data, border_size, orig) {
    var ch, j, k, n, num_ci, ref, ref1, ref2, repr;
    if (orig == null) {
      orig = data;
    }
    repr = {
      data: data,
      pan_mana: this,
      sep_norm: data.sep_norm || 0,
      border_s: data.border_s != null ? data.border_s : border_size,
      min_size: data.min_size || [0, 0],
      max_size: data.max_size || [1e5, 1e5],
      selected: data.selected,
      immortal: data.immortal,
      strength: data.strength || 1,
      panel_id: data.panel_id,
      children: [],
      parent: void 0,
      num_in_p: void 0,
      p_min: void 0,
      p_max: void 0,
      d_border: void 0,
      min_by: function(d) {
        var c, j, l, len, ref;
        l = this.min_size[d];
        ref = this.children;
        for (j = 0, len = ref.length; j < len; j++) {
          c = ref[j];
          l = Math.max(l, c.min_by(d));
        }
        return l;
      },
      max_by: function(d) {
        var c, j, l, len, ref;
        l = this.max_size[d];
        ref = this.children;
        for (j = 0, len = ref.length; j < len; j++) {
          c = ref[j];
          l = Math.min(l, c.max_by(d));
        }
        return l;
      },
      contains: function(p) {
        return (p != null) && p[0] >= this.p_min[0] && p[0] < this.p_max[0] && p[1] >= this.p_min[1] && p[1] < this.p_max[1];
      },
      can_be_destroyed: function() {
        var c, j, len, ref;
        if (this.immortal) {
          return false;
        }
        ref = this.children;
        for (j = 0, len = ref.length; j < len; j++) {
          c = ref[j];
          if (!c.can_be_destroyed()) {
            return false;
          }
        }
        if (!this.pan_mana.allow_destruction(data)) {
          return false;
        }
        return true;
      }
    };
    if ((ref = data.children) != null ? ref.length : void 0) {
      for (num_ci = j = 0, ref1 = data.children.length; 0 <= ref1 ? j < ref1 : j > ref1; num_ci = 0 <= ref1 ? ++j : --j) {
        ch = this._make_graph_rec(lst, data.children[num_ci], border_size, orig);
        repr.children.push(ch);
        ch.parent = repr;
        ch.num_in_p = num_ci;
      }
      if (repr.children.length) {
        for (n = k = 0, ref2 = repr.children.length - 1; 0 <= ref2 ? k < ref2 : k > ref2; n = 0 <= ref2 ? ++k : --k) {
          repr.children[n].d_border = repr.sep_norm;
        }
      }
    }
    lst.push(repr);
    return repr;
  };

  LayoutManagerData.prototype._make_sizes = function(repr, p_min, p_max) {
    var c, child, con, d, end, i, j, k, len, m, n, n_max, n_min, num_ci, o, pos, q, ref, ref1, ref2, ref3, results, s, sep, sum, tot;
    repr.p_min = p_min;
    repr.p_max = p_max;
    if (repr.children.length) {
      tot = p_max[repr.sep_norm] - p_min[repr.sep_norm];
      for (num_ci = j = 0, ref = repr.children.length - 1; 0 <= ref ? j < ref : j > ref; num_ci = 0 <= ref ? ++j : --j) {
        tot -= repr.children[num_ci].border_s;
      }
      sum = 0;
      ref1 = repr.children;
      for (k = 0, len = ref1.length; k < len; k++) {
        c = ref1[k];
        sum += c.strength;
      }
      con = (function() {
        var len1, o, ref2, results;
        ref2 = repr.children;
        results = [];
        for (o = 0, len1 = ref2.length; o < len1; o++) {
          i = ref2[o];
          results.push(0);
        }
        return results;
      })();
      sep = (function() {
        var len1, o, ref2, results;
        ref2 = repr.children;
        results = [];
        for (o = 0, len1 = ref2.length; o < len1; o++) {
          i = ref2[o];
          results.push(0);
        }
        return results;
      })();
      while (true) {
        end = true;
        for (n = o = 0, ref2 = repr.children.length; 0 <= ref2 ? o < ref2 : o > ref2; n = 0 <= ref2 ? ++o : --o) {
          if (con[n]) {
            continue;
          }
          child = repr.children[n];
          s = child.strength;
          if (repr.sep_norm == null) {
            alert("sep_norm is not defined");
          }
          d = Math.round(tot * s / sum);
          m = child.min_by(repr.sep_norm);
          if (d < m) {
            d = m;
            tot -= m;
            end = false;
            con[n] = 1;
            sum -= s;
          }
          m = child.max_by(repr.sep_norm);
          if (d > m) {
            d = m;
            tot -= m;
            end = false;
            con[n] = 1;
            sum -= s;
          }
          sep[n] = d;
        }
        if (end) {
          break;
        }
      }
      pos = p_min[repr.sep_norm];
      results = [];
      for (num_ci = q = 0, ref3 = repr.children.length; 0 <= ref3 ? q < ref3 : q > ref3; num_ci = 0 <= ref3 ? ++q : --q) {
        n_min = [p_min[0], p_min[1]];
        n_max = [p_max[0], p_max[1]];
        n_min[repr.sep_norm] = pos;
        n_max[repr.sep_norm] = pos + sep[num_ci];
        this._make_sizes(repr.children[num_ci], n_min, n_max);
        results.push(pos += sep[num_ci] + repr.children[num_ci].border_s);
      }
      return results;
    }
  };

  LayoutManagerData.prototype._id_in_data_rec = function(cur, id) {
    var chi, j, len, ref, ref1;
    if ((ref = cur.panel_id) != null ? ref.equals(id) : void 0) {
      return true;
    }
    if (cur.children != null) {
      ref1 = cur.children;
      for (j = 0, len = ref1.length; j < len; j++) {
        chi = ref1[j];
        if (this._id_in_data_rec(chi, id)) {
          return true;
        }
      }
    }
    return false;
  };

  LayoutManagerData.prototype._find_new_panel_id = function(lst) {
    var trial, txt;
    if (lst == null) {
      lst = [];
    }
    trial = 0;
    while (true) {
      txt = "id_" + trial;
      if (lst.indexOf(txt) < 0 && LayoutManagerData._used_panel_id.indexOf(txt) < 0 && !this._id_in_data_rec(this.root, txt)) {
        LayoutManagerData._used_panel_id.push(txt);
        return txt;
      }
      trial += 1;
    }
  };

  LayoutManagerData.prototype._assign_default_values = function(cur) {
    var chi, j, len, ref, results;
    if (cur.panel_id == null) {
      cur.add_attr({
        panel_id: new Str(this._find_new_panel_id([]))
      });
    }
    if (cur.strength == null) {
      cur.add_attr({
        strength: 1
      });
    }
    if (cur.children != null) {
      ref = cur.children;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        chi = ref[j];
        results.push(this._assign_default_values(chi));
      }
      return results;
    }
  };

  LayoutManagerData.prototype._get_panel_id_of_term_panels = function(res, data) {
    var c, j, len, ref, ref1, results;
    if ((ref = data.children) != null ? ref.length : void 0) {
      ref1 = data.children;
      results = [];
      for (j = 0, len = ref1.length; j < len; j++) {
        c = ref1[j];
        results.push(this._get_panel_id_of_term_panels(res, c));
      }
      return results;
    } else {
      return res.push(data.panel_id.get());
    }
  };

  LayoutManagerData.prototype._get_panel_ids = function(res, data) {
    var c, j, len, ref, ref1, results;
    res.push(data.panel_id.get());
    if ((ref = data.children) != null ? ref.length : void 0) {
      ref1 = data.children;
      results = [];
      for (j = 0, len = ref1.length; j < len; j++) {
        c = ref1[j];
        results.push(this._get_panel_ids(res, c));
      }
      return results;
    }
  };

  return LayoutManagerData;

})(Model);
// Generated by CoffeeScript 1.11.1
var MoveButtons,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

MoveButtons = (function(superClass) {
  extend(MoveButtons, superClass);

  function MoveButtons() {
    MoveButtons.__super__.constructor.call(this);
    this.add_attr({
      step: new Val,
      _up: new Bool,
      _down: new Bool,
      val: new Val
    });
  }

  return MoveButtons;

})(Model);
// Generated by CoffeeScript 1.11.1
var Gradient,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Gradient = (function(superClass) {
  extend(Gradient, superClass);

  function Gradient(predef) {
    Gradient.__super__.constructor.call(this);
    this.add_attr({
      color_stop: []
    });
    if (predef === "b2w") {
      this.add_color([255, 0, 0, 255], 0);
      this.add_color([0, 255, 0, 255], 0);
      this.add_color([0, 0, 255, 255], 1);
    }
  }

  Gradient.prototype.add_color = function(color, position) {
    if (color == null) {
      color = [0, 0, 0, 255];
    }
    if (position == null) {
      position = 0;
    }
    return this.color_stop.push({
      color: new Color(color[0], color[1], color[2], color[3]),
      position: position
    });
  };

  Gradient.prototype.remove_color = function(position) {
    return this.color_stop.splice(position, 1);
  };

  Gradient.prototype.get_fragment_shader = function(v, m, n) {
    var col, dc, fs, j, ref;
    if (m == null) {
      m = "";
    }
    if (n == null) {
      n = "";
    }
    dc = (function() {
      var j, len, ref, results;
      ref = this.color_stop;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        col = ref[j];
        results.push([col.position.get(), col.color.r.get() / 255.0, col.color.g.get() / 255.0, col.color.b.get() / 255.0, col.color.a.get() / 255.0]);
      }
      return results;
    }).call(this);
    dc.sort(function(a, b) {
      return a[0] - b[0];
    });
    fs = "precision mediump float;";
    fs += "varying float " + v + ";";
    if (n.length) {
      fs += "varying vec3 " + n + ";";
    }
    if (m.length) {
      fs += "uniform vec4 " + m + ";";
    }
    fs += "void main( void ) {";
    if (n.length) {
      fs += "    float cm = abs( " + n + "[ 2 ] );";
    } else {
      fs += "    float cm = 1.0;";
    }
    for (col = j = 1, ref = dc.length; 1 <= ref ? j < ref : j > ref; col = 1 <= ref ? ++j : --j) {
      if (m.length) {
        fs += "if ( " + v + " <= float( " + dc[col - 0][0] + " ) ) {\n vec4 c1 = vec4( " + m + ".r * float( " + dc[col - 0][1] + " ), " + m + ".g * float( " + dc[col - 0][2] + " ), " + m + ".b * float( " + dc[col - 0][3] + " ), " + m + ".a * float( " + dc[col - 0][4] + " ) );\n vec4 c0 = vec4( " + m + ".r * float( " + dc[col - 1][1] + " ), " + m + ".g * float( " + dc[col - 1][2] + " ), " + m + ".b * float( " + dc[col - 1][3] + " ), " + m + ".a * float( " + dc[col - 1][4] + " ) );\n gl_FragColor = c0 + ( c1 - c0 ) * ( " + v + " - float( " + dc[col - 1][0] + " ) ) / ( float( " + dc[col - 0][0] + " ) - float( " + dc[col - 1][0] + " ) );\n gl_FragColor.r *= cm; gl_FragColor.g *= cm; gl_FragColor.b *= cm;\n return;\n }\n";
      } else {
        fs += "if ( " + v + " <= float( " + dc[col - 0][0] + " ) ) {\n vec4 c0 = vec4( " + dc[col - 1][1] + ", " + dc[col - 1][2] + ", " + dc[col - 1][3] + ", " + dc[col - 1][4] + " );\n vec4 c1 = vec4( " + dc[col - 0][1] + ", " + dc[col - 0][2] + ", " + dc[col - 0][3] + ", " + dc[col - 0][4] + " );\n gl_FragColor = c0 + ( c1 - c0 ) * ( " + v + " - float( " + dc[col - 1][0] + " ) ) / ( float( " + dc[col - 0][0] + " ) - float( " + dc[col - 1][0] + " ) );\n gl_FragColor.r *= cm; gl_FragColor.g *= cm; gl_FragColor.b *= cm;\n return;\n }\n";
      }
    }
    return fs + "gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n }\n";
  };

  Gradient.prototype.get_color_from_pos = function(position) {
    var c, col_a, col_b, col_g, col_r, factor, i, ind_color_stop, j, last_ind, len, ref, size_of_interval, size_of_new_interval;
    ind_color_stop = [];
    ref = this.color_stop;
    for (i = j = 0, len = ref.length; j < len; i = ++j) {
      c = ref[i];
      if (c.position.get() >= position) {
        if (i === 0) {
          return [this.color_stop[0].color.r.get(), this.color_stop[0].color.g.get(), this.color_stop[0].color.b.get(), this.color_stop[0].color.a.get()];
        } else {
          ind_color_stop.push(i - 1);
          ind_color_stop.push(i);
        }
        break;
      }
    }
    if (ind_color_stop.length === 0) {
      last_ind = this.color_stop.length - 1;
      return [this.color_stop[last_ind].color.r.get(), this.color_stop[last_ind].color.g.get(), this.color_stop[last_ind].color.b.get(), this.color_stop[last_ind].color.a.get()];
    }
    size_of_interval = Math.abs(this.color_stop[ind_color_stop[1]].position.get() - this.color_stop[ind_color_stop[0]].position.get());
    size_of_new_interval = Math.abs(this.color_stop[ind_color_stop[0]].position.get() - position);
    factor = size_of_interval / size_of_new_interval;
    col_r = this.color_stop[ind_color_stop[0]].color.r.get() - Math.round((Math.abs(this.color_stop[ind_color_stop[1]].color.r.get() - this.color_stop[ind_color_stop[0]].color.r.get())) / factor);
    col_g = this.color_stop[ind_color_stop[0]].color.g.get() - Math.round((Math.abs(this.color_stop[ind_color_stop[1]].color.g.get() - this.color_stop[ind_color_stop[0]].color.g.get())) / factor);
    col_b = this.color_stop[ind_color_stop[0]].color.b.get() - Math.round((Math.abs(this.color_stop[ind_color_stop[1]].color.b.get() - this.color_stop[ind_color_stop[0]].color.b.get())) / factor);
    col_a = this.color_stop[ind_color_stop[0]].color.a.get() - Math.round((Math.abs(this.color_stop[ind_color_stop[1]].color.a.get() - this.color_stop[ind_color_stop[0]].color.a.get())) / factor);
    return [col_r, col_g, col_b, col_a];
  };

  return Gradient;

})(Model);
// Generated by CoffeeScript 1.11.1
var Color,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Color = (function(superClass) {
  extend(Color, superClass);

  function Color(r, g, b, a) {
    if (r == null) {
      r = 0;
    }
    if (g == null) {
      g = 0;
    }
    if (b == null) {
      b = 0;
    }
    if (a == null) {
      a = 255;
    }
    Color.__super__.constructor.call(this);
    this.add_attr({
      r: new ConstrainedVal(r, {
        min: 0,
        max: 255,
        div: 255
      }),
      g: new ConstrainedVal(g, {
        min: 0,
        max: 255,
        div: 255
      }),
      b: new ConstrainedVal(b, {
        min: 0,
        max: 255,
        div: 255
      }),
      a: new ConstrainedVal(a, {
        min: 0,
        max: 255,
        div: 255
      })
    });
  }

  Color.prototype.to_hex = function() {
    return "#" + Color._ts(this.r) + Color._ts(this.g) + Color._ts(this.b);
  };

  Color.prototype.to_rgba = function() {
    return "rgba(" + (this.r.get()) + ", " + (this.g.get()) + ", " + (this.b.get()) + ", " + (this.a.get()) + ")";
  };

  Color.prototype.to_hsv = function() {
    return Color.rgb_to_hsv(this.r.get(), this.g.get(), this.b.get());
  };

  Color.prototype._set = function(val) {
    if (val instanceof Color) {
      this.r.set(val.r);
      this.g.set(val.g);
      this.b.set(val.b);
      return this.a.set(val.a);
    } else if (typeof val === 'string' && val[0] === "#") {
      if (val.length === 4) {
        this.r.set("0x" + val.slice(1, 2) + val.slice(1, 2));
        this.g.set("0x" + val.slice(2, 3) + val.slice(2, 3));
        this.b.set("0x" + val.slice(3, 4) + val.slice(3, 4));
        return this.a.set(255);
      } else if (val.length === 7) {
        this.r.set("0x" + val.slice(1, 3));
        this.g.set("0x" + val.slice(3, 5));
        this.b.set("0x" + val.slice(5, 7));
        return this.a.set(255);
      } else {
        return console.error("get color " + val);
      }
    } else {
      return console.error("get color " + val);
    }
  };

  Color.rgb_to_hsv = function(r, g, b) {
    var del, h, max, min, s;
    r /= 255.0;
    g /= 255.0;
    b /= 255.0;
    min = Math.min(r, g, b);
    max = Math.max(r, g, b);
    del = max - min;
    if (max) {
      s = del / max;
    } else {
      return [0, 0, 0];
    }
    del += !del;
    if (r === max) {
      h = (g - b) / del;
    } else if (g === max) {
      h = 2 + (b - r) / del;
    } else {
      h = 4 + (r - g) / del;
    }
    h *= 60.0 / 360.0;
    if (h < 0) {
      h += 1;
    }
    return [h, s, max];
  };

  Color.hsv_to_rgb = function(h, s, v) {
    var f, i, m, n;
    h *= 6;
    i = Math.floor(h);
    f = h - i;
    if (!(i & 1)) {
      f = 1 - f;
    }
    m = Math.round(255 * v * (1 - s));
    n = Math.round(255 * v * (1 - s * f));
    v = Math.round(255 * v);
    switch (i) {
      case 1:
        return [n, v, m];
      case 2:
        return [m, v, n];
      case 3:
        return [m, n, v];
      case 4:
        return [n, m, v];
      case 5:
        return [v, m, n];
      default:
        return [v, n, m];
    }
  };

  Color._ts = function(v) {
    var r;
    r = v.get().toString(16);
    if (r.length === 1) {
      r = "0" + r;
    }
    return r;
  };

  return Color;

})(Model);
// Generated by CoffeeScript 1.11.1
var StrLanguage,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

StrLanguage = (function(superClass) {
  extend(StrLanguage, superClass);

  function StrLanguage(value, language, callback) {
    if (value == null) {
      value = "";
    }
    if (language == null) {
      language = "text";
    }
    if (callback == null) {
      callback = void 0;
    }
    StrLanguage.__super__.constructor.call(this);
    this.add_attr({
      value: new Str(value),
      language: language,
      callback: callback
    });
  }

  StrLanguage.prototype.get = function() {
    return this.value.get();
  };

  StrLanguage.prototype.set = function(val) {
    return this.value.set(val);
  };

  StrLanguage.prototype.get_language = function() {
    return this.language.get();
  };

  return StrLanguage;

})(Model);
// Generated by CoffeeScript 1.11.1
var root,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

root = typeof global !== "undefined" && global !== null ? global : this;

root.Button = (function(superClass) {
  extend(Button, superClass);

  function Button(label_off, label_on, state, disabled) {
    if (label_off == null) {
      label_off = "Submit";
    }
    if (label_on == null) {
      label_on = label_off;
    }
    if (state == null) {
      state = false;
    }
    if (disabled == null) {
      disabled = false;
    }
    Button.__super__.constructor.call(this);
    this.add_attr({
      disabled: disabled,
      state: state,
      label: [label_off, label_on]
    });
  }

  Button.prototype.get = function() {
    return this.state.get();
  };

  Button.prototype.txt = function() {
    return this.label[this.state.get() * 1];
  };

  Button.prototype.equals = function(a) {
    return this.state.equals(a);
  };

  Button.prototype._set = function(state) {
    if (this.change_allowed(state)) {
      return this.state.set(state);
    }
  };

  Button.prototype.toggle = function() {
    return this.set(!this.get());
  };

  Button.prototype.change_allowed = function(state) {
    return 1;
  };

  return Button;

})(Model);
// Generated by CoffeeScript 1.11.1
var Vec_3,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Vec_3 = (function(superClass) {
  extend(Vec_3, superClass);

  function Vec_3() {
    return Vec_3.__super__.constructor.apply(this, arguments);
  }

  Vec_3.prototype.static_length = function() {
    return 3;
  };

  Vec_3.sub = function(a, b) {
    return [a[0] - b[0], a[1] - b[1], a[2] - b[2]];
  };

  Vec_3.add = function(a, b) {
    return [a[0] + b[0], a[1] + b[1], a[2] + b[2]];
  };

  Vec_3.mul = function(a, b) {
    return [a[0] * b[0], a[1] * b[1], a[2] * b[2]];
  };

  Vec_3.div = function(a, b) {
    return [a[0] / b[0], a[1] / b[1], a[2] / b[2]];
  };

  Vec_3.mus = function(a, b) {
    return [a * b[0], a * b[1], a * b[2]];
  };

  Vec_3.dis = function(a, b) {
    return [a[0] / b, a[1] / b, a[2] / b];
  };

  Vec_3.ads = function(a, b) {
    return [a + b[0], a + b[1], a + b[2]];
  };

  Vec_3.dot = function(a, b) {
    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];
  };

  Vec_3.cro = function(a, b) {
    return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]];
  };

  Vec_3.min = function(a) {
    return [-a[0], -a[1], -a[2]];
  };

  Vec_3.len = function(a) {
    return Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);
  };

  Vec_3.nor = function(a) {
    var l;
    l = Vec_3.len(a) + 1e-40;
    return [a[0] / l, a[1] / l, a[2] / l];
  };

  Vec_3.dist = function(a, b) {
    return Math.sqrt((Math.pow(a[0] - b[0], 2)) + (Math.pow(a[1] - b[1], 2)) + (Math.pow(a[2] - b[2], 2)));
  };

  Vec_3.equ = function(a, b) {
    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];
  };

  Vec_3.rot = function(V, R) {
    var a, c, s, x, y, z;
    a = Vec_3.len(R) + 1e-40;
    x = R[0] / a;
    y = R[1] / a;
    z = R[2] / a;
    c = Math.cos(a);
    s = Math.sin(a);
    return [(x * x + (1 - x * x) * c) * V[0] + (x * y * (1 - c) - z * s) * V[1] + (x * z * (1 - c) + y * s) * V[2], (y * x * (1 - c) + z * s) * V[0] + (y * y + (1 - y * y) * c) * V[1] + (y * z * (1 - c) - x * s) * V[2], (z * x * (1 - c) - y * s) * V[0] + (z * y * (1 - c) + x * s) * V[1] + (z * z + (1 - z * z) * c) * V[2]];
  };

  Vec_3.sm = function(x, t) {
    return [x[0] * t, x[1] * t, x[2] * t];
  };

  Vec_3.determinant = function(a) {
    var d, i, j, j1, k, m, n, ref;
    n = a.length;
    if (n === 1) {
      return a[0][0];
    } else if (n === 2) {
      return a[0][0] * a[1][1] - a[1][0] * a[0][1];
    } else {
      d = 0;
      for (j1 = k = 0, ref = n; 0 <= ref ? k < ref : k > ref; j1 = 0 <= ref ? ++k : --k) {
        m = (function() {
          var o, ref1, results;
          results = [];
          for (i = o = 1, ref1 = n; 1 <= ref1 ? o < ref1 : o > ref1; i = 1 <= ref1 ? ++o : --o) {
            results.push((function() {
              var p, ref2, results1;
              results1 = [];
              for (j = p = 0, ref2 = n; 0 <= ref2 ? p < ref2 : p > ref2; j = 0 <= ref2 ? ++p : --p) {
                if (j !== j1) {
                  results1.push(a[i][j]);
                }
              }
              return results1;
            })());
          }
          return results;
        })();
        d += Math.pow(-1.0, j1) * a[0][j1] * Vec_3.determinant(m);
      }
      return d;
    }
  };

  Vec_3.solve = function(M, B) {
    var c, d, i, j, k, m, n, o, p, r, ref, ref1, ref2, results;
    n = B.length;
    if (M[0].length != null) {
      d = Vec_3.determinant(M);
      if (M[0].length !== n) {
        console.log("pb with solve args");
      }
      m = (function() {
        var k, ref, results;
        results = [];
        for (i = k = 0, ref = n; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
          results.push((function() {
            var o, ref1, results1;
            results1 = [];
            for (j = o = 0, ref1 = n; 0 <= ref1 ? o < ref1 : o > ref1; j = 0 <= ref1 ? ++o : --o) {
              results1.push(0.0);
            }
            return results1;
          })());
        }
        return results;
      })();
      results = [];
      for (i = k = 0, ref = n; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
        for (r = o = 0, ref1 = n; 0 <= ref1 ? o < ref1 : o > ref1; r = 0 <= ref1 ? ++o : --o) {
          for (c = p = 0, ref2 = n; 0 <= ref2 ? p < ref2 : p > ref2; c = 0 <= ref2 ? ++p : --p) {
            if (c === i) {
              m[r][c] = B[r];
            } else {
              m[r][c] = M[r][c];
            }
          }
        }
        results.push(Vec_3.determinant(m) / d);
      }
      return results;
    } else {
      m = (function() {
        var q, ref3, results1;
        results1 = [];
        for (i = q = 0, ref3 = n; 0 <= ref3 ? q < ref3 : q > ref3; i = 0 <= ref3 ? ++q : --q) {
          results1.push((function() {
            var ref4, results2, u;
            results2 = [];
            for (j = u = 0, ref4 = n; 0 <= ref4 ? u < ref4 : u > ref4; j = 0 <= ref4 ? ++u : --u) {
              results2.push(M[n * j + i]);
            }
            return results2;
          })());
        }
        return results1;
      })();
      return Vec_3.solve(m, B);
    }
  };

  Vec_3.outprod = function(a, b) {
    var R, i, j, k, o;
    R = new Mat_3;
    for (i = k = 0; k <= 2; i = ++k) {
      for (j = o = 0; o <= 2; j = ++o) {
        R[i][j] = a[i] * b[j];
      }
    }
    return R;
  };

  Vec_3.sum = function(a) {
    return a[0] + a[1] + a[2];
  };

  return Vec_3;

})(Vec);
// Generated by CoffeeScript 1.11.1
var Mat_3,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Mat_3 = (function(superClass) {
  extend(Mat_3, superClass);

  function Mat_3() {
    this[0] = new Vec_3;
    this[1] = new Vec_3;
    this[2] = new Vec_3;
    this[0] = [0, 0, 0];
    this[1] = [0, 0, 0];
    this[2] = [0, 0, 0];
  }

  Mat_3.sub = function(A, B) {
    return [[A[0][0] - B[0][0], A[0][1] - B[0][1], A[0][2] - B[0][2]], [A[1][0] - B[1][0], A[1][1] - B[1][1], A[1][2] - B[1][2]], [A[2][0] - B[2][0], A[2][1] - B[2][1], A[2][2] - B[2][2]]];
  };

  Mat_3.add = function(A, B) {
    return [[A[0][0] + B[0][0], A[0][1] + B[0][1], A[0][2] + B[0][2]], [A[1][0] + B[1][0], A[1][1] + B[1][1], A[1][2] + B[1][2]], [A[2][0] + B[2][0], A[2][1] + B[2][1], A[2][2] + B[2][2]]];
  };

  Mat_3.mul = function(A, B) {
    return [[A[0][0] * B[0][0], A[0][1] * B[0][1], A[0][2] * B[0][2]], [A[1][0] * B[1][0], A[1][1] * B[1][1], A[1][2] * B[1][2]], [A[2][0] * B[2][0], A[2][1] * B[2][1], A[2][2] * B[2][2]]];
  };

  Mat_3.dot = function(A, B) {
    if (B[0].length === 3) {
      return [[A[0][0] * B[0][0] + A[0][1] * B[1][0] + A[0][2] * B[2][0], A[0][0] * B[0][1] + A[0][1] * B[1][1] + A[0][2] * B[2][1], A[0][0] * B[0][2] + A[0][1] * B[1][2] + A[0][2] * B[2][2]], [A[1][0] * B[0][0] + A[1][1] * B[1][0] + A[1][2] * B[2][0], A[1][0] * B[0][1] + A[1][1] * B[1][1] + A[1][2] * B[2][1], A[1][0] * B[0][2] + A[1][1] * B[1][2] + A[1][2] * B[2][2]], [A[2][0] * B[0][0] + A[2][1] * B[1][0] + A[2][2] * B[2][0], A[2][0] * B[0][1] + A[2][1] * B[1][1] + A[2][2] * B[2][1], A[2][0] * B[0][2] + A[2][1] * B[1][2] + A[2][2] * B[2][2]]];
    } else {
      return [A[0][0] * B[0] + A[0][1] * B[1] + A[0][2] * B[2], A[1][0] * B[0] + A[1][1] * B[1] + A[1][2] * B[2], A[2][0] * B[0] + A[2][1] * B[1] + A[2][2] * B[2]];
    }
  };

  Mat_3.tra = function(A) {
    return [[A[0][0], A[1][0], A[2][0]], [A[0][1], A[1][1], A[2][1]], [A[0][2], A[1][2], A[2][2]]];
  };

  Mat_3.mus = function(s, A) {
    return [[s * A[0][0], s * A[0][1], s * A[0][2]], [s * A[1][0], s * A[1][1], s * A[1][2]], [s * A[2][0], s * A[2][1], s * A[2][2]]];
  };

  return Mat_3;

})(Vec_3);
// Generated by CoffeeScript 1.11.1
var UndoManager;

UndoManager = (function() {
  function UndoManager(model) {
    this.model = model;
    this.max_patchs = 3;
    this.patch_undo = [];
    this.patch_redo = [];
    this.snapshotok = true;
  }

  UndoManager.prototype.snapshot = function(force) {
    var date, dma, i, j, l, len, len1, lst_0, lst_1, map, mid, mid_0, mid_1, n_data, s;
    if (force == null) {
      force = false;
    }
    if (this.snapshotok || force) {
      this.snapshotok = false;
      date = this._date_last_snapshot();
      if (this.model._date_last_modification > date) {
        this.patch_redo = [];
        this.patch_undo.push({
          date: ModelProcessManager._counter,
          data: this.model.get_state(date)
        });
      }
      if (this.patch_undo.length > this.max_patchs) {
        lst_0 = this.patch_undo[0].data.split("\n");
        lst_1 = this.patch_undo[1].data.split("\n");
        mid_0 = lst_0.shift();
        mid_1 = lst_1.shift();
        if (mid_0 !== mid_1) {
          console.log("weird");
        }
        map = {};
        for (i = 0, len = lst_0.length; i < len; i++) {
          l = lst_0[i];
          if (!l.length) {
            continue;
          }
          s = l.split(" ");
          map[s[0]] = {
            type: s[1],
            data: s[2]
          };
        }
        n_data = "";
        for (j = 0, len1 = lst_1.length; j < len1; j++) {
          l = lst_1[j];
          if (!l.length) {
            continue;
          }
          s = l.split(" ");
          delete map[s[0]];
        }
        for (mid in map) {
          dma = map[mid];
          this.patch_undo[1].data += "\n" + mid + " " + dma.type + " " + dma.data;
        }
        this.patch_undo.shift();
      }
    }
    if (this._timer_snap != null) {
      clearTimeout(this._timer_snap);
    }
    return this._timer_snap = setTimeout(((function(_this) {
      return function() {
        return _this.snapshotok = true;
      };
    })(this)), 250);
  };

  UndoManager.prototype.undo = function(num) {
    var i, n, ref;
    if (num == null) {
      num = 1;
    }
    this.snapshot(true);
    num = Math.min(num, this.patch_undo.length - 1);
    if (num > 0) {
      for (n = i = 0, ref = num; 0 <= ref ? i < ref : i > ref; n = 0 <= ref ? ++i : --i) {
        this.patch_redo.push(this.patch_undo.pop());
      }
      return this._set_state_undo_list();
    }
  };

  UndoManager.prototype.redo = function(num) {
    var date, i, n, ref;
    if (num == null) {
      num = 1;
    }
    date = this._date_last_snapshot();
    if (this.model._date_last_modification > date) {
      this.patch_redo = [];
    }
    num = Math.min(num, this.patch_redo.length);
    if (num > 0) {
      for (n = i = 0, ref = num; 0 <= ref ? i < ref : i > ref; n = 0 <= ref ? ++i : --i) {
        this.patch_undo.push(this.patch_redo.pop());
      }
      return this._set_state_undo_list();
    }
  };

  UndoManager.prototype._set_state_undo_list = function() {
    var i, j, l, len, len1, lst, map, p, ref, s;
    map = {};
    ref = this.patch_undo;
    for (i = 0, len = ref.length; i < len; i++) {
      p = ref[i];
      lst = p.data.split("\n");
      lst.shift();
      for (j = 0, len1 = lst.length; j < len1; j++) {
        l = lst[j];
        if (!l.length) {
          continue;
        }
        s = l.split(" ");
        map[s[0]] = {
          type: s[1],
          data: s[2],
          buff: void 0
        };
      }
    }
    this.model._set_state(map[this.model.model_id].data, map);
    if (this.patch_undo.length) {
      return this.patch_undo[this.patch_undo.length - 1].date = ModelProcessManager._counter + 2;
    }
  };

  UndoManager.prototype._date_last_snapshot = function() {
    if (this.patch_undo.length) {
      return this.patch_undo[this.patch_undo.length - 1].date;
    }
    return -1;
  };

  return UndoManager;

})();
// Generated by CoffeeScript 1.11.1
var SurfaceTheme,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

SurfaceTheme = (function(superClass) {
  extend(SurfaceTheme, superClass);

  function SurfaceTheme(color) {
    if (color == null) {
      color = new Color(200, 200, 200, 255);
    }
    SurfaceTheme.__super__.constructor.call(this);
    this.add_attr({
      color: color
    });
  }

  SurfaceTheme.prototype.beg_ctx = function(info) {
    if (info.ctx_type === "2d") {
      info.ctx.fillStyle = this.color.to_rgba();
      return info.ctx.strokeStyle = this.color.to_rgba();
    }
  };

  SurfaceTheme.prototype.end_ctx = function(info) {};

  SurfaceTheme.prototype.draw = function(info, func) {
    info.ctx.beginPath();
    func(info);
    info.ctx.fill();
    return info.ctx.stroke();
  };

  SurfaceTheme.prototype.draw_triangle = function(info, p0, p1, p2, col) {
    var array, fs, gl, pcol, points, pos, ps, vs;
    if (col == null) {
      col = [0.9, 0.9, 0.9];
    }
    vs = "precision mediump float;\n attribute vec3 pos;\n void main( void ) {\n gl_Position = vec4( pos, 1.0 );\n }\n";
    fs = "precision mediump float;\n '           uniform vec4 col;\n void main( void ) {\n gl_FragColor = col;\n }";
    ps = info.cm.gl_prog(vs, fs);
    gl = info.ctx;
    points = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, points);
    array = new Float32Array([2.0 * p0[0] / info.w - 1.0, 1.0 - 2.0 * p0[1] / info.h, p0[2], 2.0 * p1[0] / info.w - 1.0, 1.0 - 2.0 * p1[1] / info.h, p1[2], 2.0 * p2[0] / info.w - 1.0, 1.0 - 2.0 * p2[1] / info.h, p2[2]]);
    gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);
    gl.useProgram(ps);
    pos = gl.getAttribLocation(ps, "pos");
    gl.enableVertexAttribArray(pos);
    pcol = gl.getUniformLocation(ps, "col");
    gl.uniform4f(pcol, col[0], col[1], col[2], 1.0);
    gl.bindBuffer(gl.ARRAY_BUFFER, points);
    gl.vertexAttribPointer(pos, 3, gl.FLOAT, false, 0, 0);
    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 3);
    gl.deleteBuffer(points);
    gl.bindBuffer(gl.ARRAY_BUFFER, null);
    return gl.disableVertexAttribArray(pos);
  };

  return SurfaceTheme;

})(Model);
// Generated by CoffeeScript 1.11.1
var Theme,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Theme = (function(superClass) {
  extend(Theme, superClass);

  function Theme() {
    Theme.__super__.constructor.call(this);
    this.add_attr({
      lines: new LineTheme(new Color(255, 255, 255, 255), 1),
      selected_lines: new LineTheme(new Color(200, 200, 100, 255), 1.5),
      points: new PointTheme(new Color(255, 255, 255, 255), 4, new Color(255, 255, 255, 255), 1),
      editable_points: new PointTheme(new Color(0, 255, 0, 255), 4, new Color(255, 255, 255, 255), 1),
      surfaces: new SurfaceTheme(new Color(150, 150, 150, 255)),
      selected_points: new PointTheme(new Color(255, 0, 0, 255), 4, new Color(255, 255, 255, 255), 1),
      highlighted_points: new PointTheme(new Color(0, 0, 0, 0), 5, new Color(255, 255, 0, 255), 1),
      selected_elements: new LineTheme(new Color(255, 0, 0, 255), 1),
      highlighted_elements: new LineTheme(new Color(255, 255, 0, 255), 1.5),
      constrain_boundary_displacement: new LineTheme(new Color(122, 0, 0, 255), 2),
      constrain_boundary_displacement_hover: new LineTheme(new Color(122, 0, 0, 255), 3),
      constrain_boundary_strain: new LineTheme(new Color(200, 100, 100, 255), 2),
      constrain_boundary_strain_hover: new LineTheme(new Color(200, 100, 100, 255), 3),
      constrain_boundary_pressure: new LineTheme(new Color(50, 0, 0, 255), 2),
      constrain_boundary_pressure_hover: new LineTheme(new Color(50, 0, 0, 255), 3),
      free_boundary: new LineTheme(new Color(0, 122, 0, 255), 2),
      free_boundary_hover: new LineTheme(new Color(0, 122, 0, 255), 3),
      gradient_legend: new Gradient,
      anim_delay: 300,
      zoom_factor: 5
    });
    this.gradient_legend.add_color([255, 255, 255, 255], 0);
    this.gradient_legend.add_color([0, 0, 0, 255], 1);
  }

  return Theme;

})(Model);
// Generated by CoffeeScript 1.11.1
var LineTheme,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

LineTheme = (function(superClass) {
  extend(LineTheme, superClass);

  function LineTheme(color, width) {
    if (color == null) {
      color = new Color(255, 255, 255, 255);
    }
    if (width == null) {
      width = 2;
    }
    LineTheme.__super__.constructor.call(this);
    this.add_attr({
      color: color,
      width: width
    });
  }

  LineTheme.prototype.beg_ctx = function(info) {
    var fs, gl, vs;
    if (info.ctx_type === "2d") {
      info.ctx.lineWidth = this.width.get();
      return info.ctx.strokeStyle = this.color.to_rgba();
    } else {
      vs = "precision mediump float;\n attribute vec3 a_position;\n uniform vec4 u_color;\n uniform float w;\n uniform float h;\n void main( void ) {\n gl_Position = vec4( \n 2.0 * a_position[ 0 ] / w - 1.0,\n 1.0 - 2.0 * a_position[ 1 ] / h,\n a_position[ 2 ] - 1e-5,\n 1.0 );\n }\n";
      fs = "precision mediump float;\n uniform vec4 u_color;\n void main( void ) {\n gl_FragColor = u_color;\n }\n";
      gl = info.ctx;
      this.ps = info.cm.gl_prog(vs, fs);
      gl.useProgram(this.ps);
      this.ps.aposAttrib = gl.getAttribLocation(this.ps, "a_position");
      gl.enableVertexAttribArray(this.ps.aposAttrib);
      this.ps.colorUniform = gl.getUniformLocation(this.ps, "u_color");
      this.ps.wUniform = gl.getUniformLocation(this.ps, "w");
      return this.ps.hUniform = gl.getUniformLocation(this.ps, "h");
    }
  };

  LineTheme.prototype.end_ctx = function(info) {};

  LineTheme.prototype.draw_straight_proj = function(info, p0, p1) {
    var gl, ibuf, idx, initBuffer, vbuf, vtx;
    if (info.ctx_type === "2d") {
      info.ctx.beginPath();
      this.contour_straight_proj(info, p0, p1);
      return info.ctx.stroke();
    } else {
      gl = info.ctx;
      vtx = new Float32Array([p0[0], p0[1], p0[2], p1[0], p1[1], p1[2]]);
      idx = new Uint16Array([0, 1]);
      initBuffer = function(glELEMENT_ARRAY_BUFFER, data) {
        var buf;
        buf = gl.createBuffer();
        gl.bindBuffer(glELEMENT_ARRAY_BUFFER, buf);
        gl.bufferData(glELEMENT_ARRAY_BUFFER, data, gl.STATIC_DRAW);
        return buf;
      };
      vbuf = initBuffer(gl.ARRAY_BUFFER, vtx);
      ibuf = initBuffer(gl.ELEMENT_ARRAY_BUFFER, idx);
      gl.vertexAttribPointer(this.ps.aposAttrib, 3, gl.FLOAT, false, 0, 0);
      gl.lineWidth(this.width.get());
      gl.uniform4f(this.ps.colorUniform, this.color.r.get() / 255, this.color.g.get() / 255, this.color.b.get() / 255, this.color.a.get() / 255);
      gl.uniform1f(this.ps.wUniform, info.w);
      gl.uniform1f(this.ps.hUniform, info.h);
      gl.drawElements(gl.LINES, 2, gl.UNSIGNED_SHORT, 0);
      gl.bindBuffer(gl.ARRAY_BUFFER, null);
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);
      gl.deleteBuffer(vbuf);
      return gl.deleteBuffer(ibuf);
    }
  };

  LineTheme.prototype.contour_straight_proj = function(info, p0, p1, beg) {
    if (beg == null) {
      beg = true;
    }
    if (beg) {
      info.ctx.moveTo(p0[0], p0[1]);
    }
    return info.ctx.lineTo(p1[0], p1[1]);
  };

  LineTheme.prototype.draw_arc = function(info, P0, P1, P2) {
    if (info.ctx_type === "2d") {
      info.ctx.beginPath();
      this.contour_arc(info, P0, P1, P2);
      return info.ctx.stroke();
    } else {
      return this.contour_arc(info, P0, P1, P2);
    }
  };

  LineTheme.prototype.contour_arc = function(info, P0, P1, P2, beg) {
    var a, ai, cr, gl, ibuf, idx, initBuffer, j, ls, n, p, pt, rca, ref, ref1, rsa, vbuf, vtx;
    if (beg == null) {
      beg = true;
    }
    cr = this._get_center_radius(P0, P1, P2);
    n = Math.ceil(Math.abs(cr.a[2] - cr.a[0]) / 0.1);
    pt = [];
    ls = [];
    for (ai = j = ref = 1 - beg, ref1 = n; ref <= ref1 ? j <= ref1 : j >= ref1; ai = ref <= ref1 ? ++j : --j) {
      a = cr.a[0] + (cr.a[2] - cr.a[0]) * ai / n;
      rca = cr.R * Math.cos(a);
      rsa = cr.R * Math.sin(a);
      p = info.re_2_sc.proj([cr.C[0] + rca * cr.P01[0] + rsa * cr.P02[0], cr.C[1] + rca * cr.P01[1] + rsa * cr.P02[1], cr.C[2] + rca * cr.P01[2] + rsa * cr.P02[2]]);
      if (info.ctx_type === "2d") {
        if (ai) {
          info.ctx.lineTo(p[0], p[1]);
        } else {
          info.ctx.moveTo(p[0], p[1]);
        }
      } else {
        pt.push(p[0]);
        pt.push(p[1]);
        pt.push(p[2]);
        if (ai) {
          ls.push(ai - 1);
          ls.push(ai - 0);
        }
      }
    }
    if (info.ctx_type !== "2d") {
      gl = info.ctx;
      vtx = new Float32Array(pt);
      idx = new Uint16Array(ls);
      initBuffer = function(glELEMENT_ARRAY_BUFFER, data) {
        var buf;
        buf = gl.createBuffer();
        gl.bindBuffer(glELEMENT_ARRAY_BUFFER, buf);
        gl.bufferData(glELEMENT_ARRAY_BUFFER, data, gl.STATIC_DRAW);
        return buf;
      };
      vbuf = initBuffer(gl.ARRAY_BUFFER, vtx);
      ibuf = initBuffer(gl.ELEMENT_ARRAY_BUFFER, idx);
      gl.vertexAttribPointer(this.ps.aposAttrib, 3, gl.FLOAT, false, 0, 0);
      gl.lineWidth(this.width.get());
      gl.uniform4f(this.ps.colorUniform, this.color.r.get() / 255, this.color.g.get() / 255, this.color.b.get() / 255, this.color.a.get() / 255);
      gl.uniform1f(this.ps.wUniform, info.w);
      gl.uniform1f(this.ps.hUniform, info.h);
      gl.drawElements(gl.LINES, ls.length, gl.UNSIGNED_SHORT, 0);
      gl.bindBuffer(gl.ARRAY_BUFFER, null);
      return gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);
    }
  };

  LineTheme.prototype.draw_interpolated_arcs = function(info, points) {
    if (points.length === 3) {
      return this.draw_arc(info, points[0], points[1], points[2]);
    }
    info.ctx.beginPath();
    this.contour_interpolated_arcs(info, points);
    return info.ctx.stroke();
  };

  LineTheme.prototype.contour_interpolated_arcs = function(info, points, beg) {
    var a0, a1, alpha, ar, i, j, k, l, m, n, nr, p, p0, p1, pr, ref, res, results;
    if (beg == null) {
      beg = true;
    }
    if (points.length === 3) {
      return this.contour_arc(info, points[0], points[1], points[2]);
    }
    res = (function() {
      var j, ref, results;
      results = [];
      for (i = j = 0, ref = points.length - 2; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
        results.push(this._get_center_radius(points[i], points[i + 1], points[i + 2]));
      }
      return results;
    }).call(this);
    p = info.re_2_sc.proj(points[0]);
    if (beg) {
      info.ctx.moveTo(p[0], p[1]);
    }
    for (n = j = 1; j <= 30; n = ++j) {
      alpha = n / 30.0;
      ar = res[0].a[0] + (res[0].a[1] - res[0].a[0]) * alpha;
      pr = this._get_proj_arc(info, res[0], ar);
      info.ctx.lineTo(pr[0], pr[1]);
    }
    for (i = k = 0, ref = points.length - 3; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
      for (n = l = 0; l < 30; n = ++l) {
        alpha = n / 30.0;
        a0 = res[i + 0].a[1] + (res[i + 0].a[2] - res[i + 0].a[1]) * alpha;
        a1 = res[i + 1].a[0] + (res[i + 1].a[1] - res[i + 1].a[0]) * alpha;
        p0 = this._get_proj_arc(info, res[i + 0], a0);
        p1 = this._get_proj_arc(info, res[i + 1], a1);
        pr = Vec_3.add(Vec_3.mus(1 - alpha, p0), Vec_3.mus(alpha, p1));
        info.ctx.lineTo(pr[0], pr[1]);
      }
    }
    nr = res.length - 1;
    results = [];
    for (n = m = 0; m <= 30; n = ++m) {
      alpha = n / 30.0;
      ar = res[nr].a[1] + (res[nr].a[2] - res[nr].a[1]) * alpha;
      pr = this._get_proj_arc(info, res[nr], ar);
      results.push(info.ctx.lineTo(pr[0], pr[1]));
    }
    return results;
  };

  LineTheme.prototype._get_center_radius = function(P0, P1, P2) {
    var C, P01, P02, R, a0, a1, a2, ma, res, x1, x2, xc, y2, yc;
    P01 = Vec_3.sub(P1, P0);
    P02 = Vec_3.sub(P2, P0);
    x1 = Vec_3.len(P01);
    P01 = Vec_3.mus(1 / x1, P01);
    x2 = Vec_3.dot(P02, P01);
    P02 = Vec_3.sub(P02, Vec_3.mus(x2, P01));
    y2 = Vec_3.len(P02);
    P02 = Vec_3.mus(1 / y2, P02);
    xc = x1 * 0.5;
    yc = (x2 * x2 + y2 * y2 - x2 * x1) / (2.0 * y2);
    C = Vec_3.add(Vec_3.add(P0, Vec_3.mus(xc, P01)), Vec_3.mus(yc, P02));
    R = Vec_3.len(Vec_3.sub(P0, C));
    a0 = Math.atan2(0 - yc, 0 - xc);
    a1 = Math.atan2(0 - yc, x1 - xc);
    a2 = Math.atan2(y2 - yc, x2 - xc);
    ma = 0.5 * (a0 + a2);
    if (Math.abs(a1 - ma) > Math.abs(a0 - ma)) {
      if (a2 < a0) {
        a2 += 2 * Math.PI;
      } else {
        a0 += 2 * Math.PI;
      }
    }
    ma = 0.5 * (a0 + a2);
    if (Math.abs(a1 - ma) > Math.abs(a0 - ma)) {
      a1 += 2 * Math.PI;
    }
    res = {
      xc: xc,
      yx: yc,
      C: C,
      R: R,
      a: [a0, a1, a2],
      P01: P01,
      P02: P02
    };
    return res;
  };

  LineTheme.prototype._get_proj_arc = function(info, arc_info, a) {
    var rca, rsa;
    rca = arc_info.R * Math.cos(a);
    rsa = arc_info.R * Math.sin(a);
    return info.re_2_sc.proj([arc_info.C[0] + rca * arc_info.P01[0] + rsa * arc_info.P02[0], arc_info.C[1] + rca * arc_info.P01[1] + rsa * arc_info.P02[1], arc_info.C[2] + rca * arc_info.P01[2] + rsa * arc_info.P02[2]]);
  };

  return LineTheme;

})(Model);
// Generated by CoffeeScript 1.11.1
var PointTheme,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

PointTheme = (function(superClass) {
  extend(PointTheme, superClass);

  function PointTheme(color, width, line_color, line_width) {
    if (color == null) {
      color = new Color(255, 255, 255, 255);
    }
    if (width == null) {
      width = 5;
    }
    if (line_color == null) {
      line_color = new Color(200, 200, 200, 255);
    }
    if (line_width == null) {
      line_width = 1;
    }
    PointTheme.__super__.constructor.call(this);
    this.add_attr({
      color: color,
      width: width,
      line_color: line_color,
      line_width: line_width
    });
  }

  PointTheme.prototype.beg_ctx = function(info) {
    var ctx;
    ctx = info.ctx_2d();
    ctx.fillStyle = this.color.to_rgba();
    ctx.lineWidth = this.line_width.get();
    return ctx.strokeStyle = this.line_color.to_rgba();
  };

  PointTheme.prototype.end_ctx = function(info) {};

  PointTheme.prototype.draw_proj = function(info, proj) {
    var ctx;
    ctx = info.ctx_2d();
    ctx.beginPath();
    ctx.arc(proj[0], proj[1], this.width.get(), 0, Math.PI * 2, true);
    ctx.fill();
    return ctx.stroke();
  };

  return PointTheme;

})(Model);
// Generated by CoffeeScript 1.11.1
var Drawable,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Drawable = (function(superClass) {
  extend(Drawable, superClass);

  function Drawable() {
    return Drawable.__super__.constructor.apply(this, arguments);
  }

  Drawable.prototype.draw = function(info) {};

  Drawable.prototype.update_min_max = function(x_min, x_max) {};

  Drawable.prototype.get_movable_entities = function(res, info, phase) {};

  Drawable.prototype.z_index = function() {
    return 0;
  };

  Drawable.prototype.sub_canvas_items = function() {
    return [];
  };

  return Drawable;

})(Model);
// Generated by CoffeeScript 1.11.1
var Element,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Element = (function(superClass) {
  extend(Element, superClass);

  function Element() {
    return Element.__super__.constructor.apply(this, arguments);
  }

  return Element;

})(Model);
// Generated by CoffeeScript 1.11.1
var ParametrizedDrawable,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ParametrizedDrawable = (function(superClass) {
  extend(ParametrizedDrawable, superClass);

  function ParametrizedDrawable(data) {
    ParametrizedDrawable.__super__.constructor.call(this);
    this.add_attr({
      data: data
    });
  }

  ParametrizedDrawable.prototype.get_sub_field = function(info) {
    return this.data.get_sub_field(info);
  };

  ParametrizedDrawable.prototype.draw = function(info, additionnal_parameters) {
    this._udpate_parameters_if_necessary();
    return this.data.draw(info, this.drawing_parameters, additionnal_parameters);
  };

  ParametrizedDrawable.prototype.update_min_max = function(x_min, x_max) {
    return this.data.update_min_max(x_min, x_max);
  };

  ParametrizedDrawable.prototype.disp_only_in_model_editor = function() {
    return this.drawing_parameters;
  };

  ParametrizedDrawable.prototype.z_index = function() {
    return this.data.z_index();
  };

  ParametrizedDrawable.prototype._udpate_parameters_if_necessary = function() {
    if (this.drawing_parameters == null) {
      return this.data.get_drawing_parameters(this);
    }
  };

  return ParametrizedDrawable;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var Element_WithIndices,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Element_WithIndices = (function(superClass) {
  extend(Element_WithIndices, superClass);

  function Element_WithIndices(indices) {
    if (indices == null) {
      indices = [];
    }
    Element_WithIndices.__super__.constructor.call(this);
    this.add_attr({
      indices: indices
    });
  }

  Element_WithIndices.prototype.points_inside = function(tab_ind) {
    var a, i, j, k, len, len1, ref;
    for (j = 0, len = tab_ind.length; j < len; j++) {
      i = tab_ind[j];
      ref = this.indices;
      for (k = 0, len1 = ref.length; k < len1; k++) {
        a = ref[k];
        if (a.equals(i)) {
          return true;
        }
      }
    }
    return false;
  };

  Element_WithIndices.prototype.get_point_numbers = function() {
    return this.indices.get();
  };

  Element_WithIndices.prototype.update_indices = function(done, n_array) {
    var j, len, ref, results, v;
    if (done[this.model_id] == null) {
      done[this.model_id] = true;
      ref = this.indices;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        v = ref[j];
        results.push(v.set(n_array[v.get()]));
      }
      return results;
    }
  };

  return Element_WithIndices;

})(Element);
// Generated by CoffeeScript 1.11.1
var Lst_Point,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Lst_Point = (function(superClass) {
  extend(Lst_Point, superClass);

  function Lst_Point() {
    return Lst_Point.__super__.constructor.apply(this, arguments);
  }

  Lst_Point.prototype.base_type = function() {
    return Point;
  };

  Lst_Point.prototype.dim = function() {
    return 2;
  };

  Lst_Point.prototype._underlying_fs_type = function() {
    return "Lst";
  };

  return Lst_Point;

})(Lst);
// Generated by CoffeeScript 1.11.1
var ServerAssistedVisualization,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ServerAssistedVisualization = (function(superClass) {
  extend(ServerAssistedVisualization, superClass);

  function ServerAssistedVisualization(app, bs) {
    var ds;
    ServerAssistedVisualization.__super__.constructor.call(this);
    this.add_attr({
      data: app.data,
      layout: {}
    });
    ds = app.data.selected_display_settings();
    bind([bs, ds._layout], (function(_this) {
      return function() {
        var d, i, lay, len, lid, lm, mid, ref, ref1, ref2, results, used_lid;
        used_lid = {};
        ref = app.layouts;
        for (mid in ref) {
          lm = ref[mid];
          ref1 = lm._pan_vs_id;
          for (lid in ref1) {
            lay = ref1[lid];
            if (!(lay.cm != null)) {
              continue;
            }
            if (_this.layout[lid] == null) {
              _this.layout.add_attr(lid, {
                width: 0,
                height: 0
              });
            }
            _this.layout[lid].width.set(lay.cm.canvas.width);
            _this.layout[lid].height.set(lay.cm.canvas.height);
            used_lid[lid] = true;
          }
        }
        ref2 = (function() {
          var j, len, ref2, results1;
          ref2 = this.layout._attribute_names;
          results1 = [];
          for (j = 0, len = ref2.length; j < len; j++) {
            lid = ref2[j];
            if (used_lid[lid] == null) {
              results1.push(lid);
            }
          }
          return results1;
        }).call(_this);
        results = [];
        for (i = 0, len = ref2.length; i < len; i++) {
          d = ref2[i];
          results.push(_this.layout.rem_attr(d));
        }
        return results;
      };
    })(this));
  }

  return ServerAssistedVisualization;

})(Model);
// Generated by CoffeeScript 1.11.1
var Choice_RestrictedByDim,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Choice_RestrictedByDim = (function(superClass) {
  extend(Choice_RestrictedByDim, superClass);

  function Choice_RestrictedByDim(data, initial_list) {
    if (initial_list == null) {
      initial_list = [];
    }
    Choice_RestrictedByDim.__super__.constructor.call(this, data, initial_list);
    this.add_attr({
      wanted_dim: [2, 3]
    });
  }

  Choice_RestrictedByDim.prototype.filter = function(obj) {
    return this.wanted_dim.contains(obj.dim());
  };

  return Choice_RestrictedByDim;

})(Choice);
// Generated by CoffeeScript 1.11.1
var Cam,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Cam = (function(superClass) {
  var TransBuf, TransEye;

  extend(Cam, superClass);

  function Cam(want_aspect_ratio) {
    if (want_aspect_ratio == null) {
      want_aspect_ratio = false;
    }
    Cam.__super__.constructor.call(this);
    this.add_attr({
      threeD: true,
      O: [0, 0, 0],
      X: [1, 0, 0],
      Y: [0, 1, 0],
      C: [0, 0, 0],
      d: 1,
      _O: [0, 0, 0],
      _d: 1,
      a: new ConstrainedVal(20, {
        min: 0,
        max: 80
      })
    });
    if (want_aspect_ratio) {
      this.add_attr({
        r: 1
      });
    }
  }

  Cam.prototype.gl_mat = function(w, h) {
    var O, O_w, X, Y, Z, cx, cy, d_w, f, g, i, p, z_max, z_min;
    X = Vec_3.nor(this.X.get());
    Y = Vec_3.nor(Vec_3.sub(this.Y.get(), Vec_3.mus(Vec_3.dot(X, this.Y.get()), X)));
    Z = Vec_3.nor(Vec_3.cro(Y, X));
    O = [Vec_3.dot(this.O.get(), X), Vec_3.dot(this.O.get(), Y), Vec_3.dot(this.O.get(), Z)];
    f = 2 / this.d.get();
    g = -f;
    cx = Math.min(w, h) / w;
    cy = Math.min(w, h) / h;
    O_w = this._O.get();
    d_w = this._d.get();
    p = Math.tan(this.a.get() * 3.14158 / 360) * 2 / d_w;
    z_max = Vec_3.dot(O_w, Z) + d_w / 2;
    z_min = Vec_3.dot(O_w, Z) - d_w / 2;
    h = 1.0 / (z_max - z_min);
    i = 0.5 * (z_min + z_max) / (z_max - z_min);
    return [cx * f * X[0], cy * f * Y[0], h * Z[0], p * Z[0], cx * f * X[1], cy * f * Y[1], h * Z[1], p * Z[1], cx * f * X[2], cy * f * Y[2], h * Z[2], p * Z[2], cx * g * O[0], cy * g * O[1], -i, 1 - p * O[2]];
  };

  Cam.prototype.gl_attr = function(info, prefix) {
    return "uniform mat4 " + prefix + "_mat;";
  };

  Cam.prototype.gl_attr_vec = function(info, prefix) {
    return "uniform mat3 " + prefix + "_mat;";
  };

  Cam.prototype.gl_main = function(info, prefix) {
    return "gl_Position = " + prefix + "_mat * gl_Position;";
  };

  Cam.prototype.gl_main_vec = function(info, prefix, norm_val, norm_var) {
    return norm_var + " = " + prefix + "_mat * " + norm_val + ";";
  };

  Cam.prototype.gl_exec = function(info, prefix, prog) {
    var gl, mat, proj_mat;
    mat = this.gl_mat(info.w, info.h);
    gl = info.ctx;
    proj_mat = gl.getUniformLocation(prog, prefix + "_mat");
    return gl.uniformMatrix4fv(proj_mat, false, new Float32Array(mat));
  };

  Cam.prototype.gl_exec_vec = function(info, prefix, prog) {
    var X, Y, Z, gl, mat, proj_mat;
    X = Vec_3.nor(this.X.get());
    Y = Vec_3.nor(Vec_3.sub(this.Y.get(), Vec_3.mus(Vec_3.dot(X, this.Y.get()), X)));
    Z = Vec_3.nor(Vec_3.cro(X, Y));
    mat = [X[0], Y[0], Z[0], X[1], Y[1], Z[1], X[2], Y[2], Z[2]];
    gl = info.ctx;
    proj_mat = gl.getUniformLocation(prog, prefix + "_mat");
    return gl.uniformMatrix3fv(proj_mat, false, new Float32Array(mat));
  };

  Cam.prototype.focal_point = function() {
    var ap, nZ;
    nZ = Vec_3.nor(Vec_3.cro(this.X.get(), this.Y.get()));
    ap = Math.tan(this.a.get() / 2 * 3.14159265358979323846 / 180);
    return [this.O[0].get() - 0.5 * this.d.get() / ap * nZ[0], this.O[1].get() - 0.5 * this.d.get() / ap * nZ[1], this.O[2].get() - 0.5 * this.d.get() / ap * nZ[2]];
  };

  Cam.prototype.pan = function(x, y, w, h, ctrl_key) {
    var c, d, j, r, results;
    if (ctrl_key == null) {
      ctrl_key = false;
    }
    if (ctrl_key) {
      x /= 10;
      y /= 10;
    }
    c = this.d.get() / Math.min(w, h);
    r = this.r || 1;
    x *= c * r;
    y *= c;
    results = [];
    for (d = j = 0; j <= 2; d = ++j) {
      results.push(this.O[d].set(this.O[d].get() - x * this.X[d].get() + y * this.Y[d].get()));
    }
    return results;
  };

  Cam.prototype.zoom = function(x, y, c, w, h) {
    var n_re_2_sc, o, o_sc_2_rw, p;
    if (typeof c === "number") {
      return zoom(x, y, [c, c], w, h);
    } else {
      o_sc_2_rw = this.sc_2_rw(w, h);
      o = o_sc_2_rw.pos(x, y);
      this.d.set(this.d.get() / c[1]);
      if (this.r != null) {
        this.r.set(this.r.get() * c[1] / c[0]);
      }
      n_re_2_sc = this.re_2_sc(w, h);
      p = n_re_2_sc.proj(o);
      return this.pan(x - p[0], y - p[1], w, h);
    }
  };

  Cam.prototype.rotate = function(x, y, z) {
    var R;
    if (this.threeD.get()) {
      R = this.s_to_w_vec([-x, -y, z]);
      this.X.set(Vec_3.rot(this.X.get(), R));
      this.Y.set(Vec_3.rot(this.Y.get(), R));
      return this.O.set(Vec_3.add(this.C.get(), Vec_3.rot(Vec_3.sub(this.O.get(), this.C.get()), R)));
    }
  };

  Cam.prototype.re_2_sc = function(w, h) {
    return new TransBuf(this.gl_mat(w, h), w, h);
  };

  Cam.prototype.sc_2_rw = function(w, h) {
    return new TransEye(this.gl_mat(w, h), w, h);
  };

  Cam.prototype.equal = function(l) {
    var ap_3;
    ap_3 = function(a, b, e) {
      if (e == null) {
        e = 1e-3;
      }
      return Math.abs(a[0] - b[0]) < e && Math.abs(a[1] - b[1]) < e && Math.abs(a[2] - b[2]) < e;
    };
    if ((this.r != null) && (l.r != null) && l.r.get() !== this.r.get()) {
      return false;
    }
    return l.w === this.w && l.h === this.h && ap_3(l.O, this.O) && ap_3(l.X, this.X) && ap_3(l.Y, this.Y) && Math.abs(l.a - this.a) < 1e-3 && Math.abs(l.d - this.d) / this.d < 1e-3;
  };

  Cam.prototype.s_to_w_vec = function(V) {
    var X, Y, Z;
    X = Vec_3.nor(this.X.get());
    Y = Vec_3.nor(this.Y.get());
    Z = Vec_3.nor(Vec_3.cro(X, Y));
    return [V[0] * this.X[0] + V[1] * this.Y[0] + V[2] * Z[0], V[0] * this.X[1] + V[1] * this.Y[1] + V[2] * Z[1], V[0] * this.X[2] + V[1] * this.Y[2] + V[2] * Z[2]];
  };

  Cam.prototype.get_X = function() {
    return Vec_3.nor(this.X.get());
  };

  Cam.prototype.get_Y = function() {
    return Vec_3.nor(this.Y.get());
  };

  Cam.prototype.get_Z = function() {
    return Vec_3.nor(Vec_3.cro(this.X.get(), this.Y.get()));
  };

  Cam.prototype.get_a = function() {
    return this.a.get();
  };

  Cam.prototype.get_screen_coord = function(coord) {
    var Cx, Cy, Cz, O, X, Y, Z, d, x, y, z;
    x = coord[0];
    y = coord[1];
    z = coord[2] || 0;
    O = this.O.get();
    X = this.X.get();
    Y = this.Y.get();
    Z = this.get_Z();
    d = this.d;
    Cx = Vec_3.mus(d * x, X);
    Cy = Vec_3.mus(d * y, Y);
    Cz = Vec_3.mus(d * z, Z);
    return Vec_3.add(O, Vec_3.add(Cx, Vec_3.add(Cy, Cz)));
  };

  TransEye = (function() {
    function TransEye(mat1, w1, h1) {
      this.mat = mat1;
      this.w = w1;
      this.h = h1;
    }

    TransEye.prototype.dir = function(x, y) {
      return Vec_3.nor(Vec_3.sub(Vec_3.solve(this.mat, [x, y, 0.5, 1]), Vec_3.solve(this.mat, [x, y, -0.5, 1])));
    };

    TransEye.prototype.pos = function(x, y, z) {
      var R;
      if (z == null) {
        z = 0;
      }
      R = Vec_3.solve(this.mat, [2 * x / this.w - 1, 1 - 2 * y / this.h, z, 1]);
      return [R[0] / R[3], R[1] / R[3], R[2] / R[3]];
    };

    return TransEye;

  })();

  TransBuf = (function() {
    function TransBuf(mat1, w1, h1) {
      this.mat = mat1;
      this.w = w1;
      this.h = h1;
    }

    TransBuf.prototype.proj = function(P) {
      var R;
      R = [this.mat[0 + 4 * 0] * P[0] + this.mat[0 + 4 * 1] * P[1] + this.mat[0 + 4 * 2] * P[2] + this.mat[0 + 4 * 3], this.mat[1 + 4 * 0] * P[0] + this.mat[1 + 4 * 1] * P[1] + this.mat[1 + 4 * 2] * P[2] + this.mat[1 + 4 * 3], this.mat[2 + 4 * 0] * P[0] + this.mat[2 + 4 * 1] * P[1] + this.mat[2 + 4 * 2] * P[2] + this.mat[2 + 4 * 3], this.mat[3 + 4 * 0] * P[0] + this.mat[3 + 4 * 1] * P[1] + this.mat[3 + 4 * 2] * P[2] + this.mat[3 + 4 * 3]];
      return [0.5 * this.w * (1 + R[0] / R[3]), 0.5 * this.h * (1 - R[1] / R[3]), R[2] / R[3]];
    };

    return TransBuf;

  })();

  return Cam;

})(Model);
// Generated by CoffeeScript 1.11.1
var MoveScheme_2D,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

MoveScheme_2D = (function(superClass) {
  extend(MoveScheme_2D, superClass);

  function MoveScheme_2D() {
    MoveScheme_2D.__super__.constructor.call(this);
    this.add_attr({
      _O: new Vec_3([0, 0, 0]),
      _N: new Vec_3([0, 0, 1])
    });
  }

  MoveScheme_2D.prototype.beg_click = function(pos) {};

  MoveScheme_2D.prototype.move = function(selected_entities, pos, P, D) {
    var I, bot, dec, i, len, m, results, top;
    top = Vec_3.dot(Vec_3.sub(this._O, P), this._N);
    bot = Vec_3.dot(D, this._N);
    I = Vec_3.add(P, Vec_3.mus(top / bot, D));
    dec = Vec_3.sub(I, pos);
    results = [];
    for (i = 0, len = selected_entities.length; i < len; i++) {
      m = selected_entities[i];
      if (m instanceof Point) {
        results.push(m.pos.set(Vec_3.add(m.pos.get(), dec)));
      }
    }
    return results;
  };

  return MoveScheme_2D;

})(Model);
// Generated by CoffeeScript 1.11.1
var MoveScheme_3D,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

MoveScheme_3D = (function(superClass) {
  extend(MoveScheme_3D, superClass);

  function MoveScheme_3D() {
    MoveScheme_3D.__super__.constructor.call(this);
    this.add_attr({
      _req_pos: new Vec_3,
      _req_dir: new Vec_3,
      _old_pos: new Vec_3,
      _old_dir: new Vec_3
    });
    this.cos_for_move_req_old_dir = 0.7;
    this._beg_click = false;
  }

  MoveScheme_3D.prototype.beg_click = function(pos) {
    return this._beg_click = true;
  };

  MoveScheme_3D.prototype.move = function(selected_entities, pos, p_0, d_0) {
    var c_00, c_01, c_11, d, d_1, del, dete, dok, i, j, l_0, len, m, p_1, ve_0, ve_1;
    if (this._beg_click) {
      this._beg_click = false;
      d_1 = this._old_dir.get();
      dok = d_1[0] || d_1[1] || d_1[2];
      if (dok && Math.abs(Vec_3.dot(d_0, d_1)) < this.cos_for_move_req_old_dir) {
        this._req_pos.set(this._old_pos);
        this._req_dir.set(this._old_dir);
      }
    }
    l_0 = Vec_3.dot(Vec_3.sub(pos.get(), p_0), d_0);
    p_1 = this._req_pos.get();
    d_1 = this._req_dir.get();
    if (d_1[0] || d_1[1] || d_1[2]) {
      c_00 = d_0[0] * d_0[0] + d_0[1] * d_0[1] + d_0[2] * d_0[2];
      c_01 = d_0[0] * d_1[0] + d_0[1] * d_1[1] + d_0[2] * d_1[2];
      c_11 = d_1[0] * d_1[0] + d_1[1] * d_1[1] + d_1[2] * d_1[2];
      dete = c_00 * c_11 - c_01 * c_01;
      ve_0 = d_0[0] * (p_0[0] - p_1[0]) + d_0[1] * (p_0[1] - p_1[1]) + d_0[2] * (p_0[2] - p_1[2]);
      ve_1 = d_1[0] * (p_0[0] - p_1[0]) + d_1[1] * (p_0[1] - p_1[1]) + d_1[2] * (p_0[2] - p_1[2]);
      l_0 = (c_01 * ve_1 - c_11 * ve_0) / dete;
    }
    del = (function() {
      var i, results;
      results = [];
      for (d = i = 0; i <= 2; d = ++i) {
        results.push(p_0[d] + d_0[d] * l_0 - pos[d].get());
      }
      return results;
    })();
    for (i = 0, len = selected_entities.length; i < len; i++) {
      m = selected_entities[i];
      if (m instanceof Point) {
        for (d = j = 0; j <= 2; d = ++j) {
          m.pos[d].set(m.pos[d].get() + del[d]);
        }
      }
    }
    this._old_pos.set(p_0);
    return this._old_dir.set(d_0);
  };

  return MoveScheme_3D;

})(Model);
// Generated by CoffeeScript 1.11.1
var NamedParametrizedDrawable,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

NamedParametrizedDrawable = (function(superClass) {
  extend(NamedParametrizedDrawable, superClass);

  function NamedParametrizedDrawable(name, data) {
    NamedParametrizedDrawable.__super__.constructor.call(this, data);
    this.add_attr({
      name: name
    });
  }

  NamedParametrizedDrawable.prototype.toString = function() {
    return this.name.get();
  };

  return NamedParametrizedDrawable;

})(ParametrizedDrawable);
// Generated by CoffeeScript 1.11.1
var Sketch,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Sketch = (function(superClass) {
  extend(Sketch, superClass);

  function Sketch(params) {
    if (params == null) {
      params = {};
    }
    Sketch.__super__.constructor.call(this);
    this.add_attr({
      _theme: new Theme,
      _color_selection: params.color_selection ? true : void 0
    });
    this.add_attr({
      visualization: {
        display_style: new Choice(3, ["Points", "Wireframe", "Surface", "Surface with Edges"]),
        point_edition: (!params.not_editable ? true : void 0),
        element_color: this._theme.surfaces.color,
        line_color: this._theme.lines.color
      },
      points: new Lst,
      _elements: [],
      _selected_points: [],
      _pelected_points: [],
      _selected_elements: [],
      _pelected_elements: []
    });
    this.move_scheme = MoveScheme_3D;
    this._sub_elements = [];
    this._sub_date = -1;
    this.delete_selected_points_callback = [];
  }

  Sketch.prototype.add_point = function(pos) {
    var res;
    if (pos == null) {
      pos = [0, 0, 0];
    }
    res = new Point(pos, new this.move_scheme);
    this.points.push(res);
    return res;
  };

  Sketch.prototype.set_point = function(indice, pos) {
    if (pos == null) {
      pos = [0, 0, 0];
    }
    this.points[indice].pos[0].set(pos[0]);
    this.points[indice].pos[1].set(pos[1]);
    return this.points[indice].pos[2].set(pos[2]);
  };

  Sketch.prototype.get_point = function(indice) {
    return this.points[indice].pos.get();
  };

  Sketch.prototype.add_element = function(element) {
    return this._elements.push(element);
  };

  Sketch.prototype.bounding_coordinates = function() {
    var bc, i, k, len, o, p, p0, point, ref;
    ref = this.points;
    for (k = 0, len = ref.length; k < len; k++) {
      point = ref[k];
      if (point instanceof Point) {
        if (!bc) {
          p0 = point.pos.get();
          bc = [[p0[0], p0[0]], [p0[1], p0[1]], [p0[2], p0[2]]];
        } else {
          p = point.pos;
          for (i = o = 0; o <= 2; i = ++o) {
            if (p[i].get() > bc[i][0]) {
              bc[i][0] = p[i].get();
            } else if (p[i].get() < bc[i][1]) {
              bc[i][1] = p[i].get();
            }
          }
        }
      }
    }
    return bc;
  };

  Sketch.prototype.nb_points = function() {
    return this.points.length;
  };

  Sketch.prototype.nb_elements = function() {
    var el, k, len, ref, res;
    res = 0;
    ref = this._elements;
    for (k = 0, len = ref.length; k < len; k++) {
      el = ref[k];
      if (typeof el.indices.size(1) === "number") {
        res += el.indices.size(1);
      }
    }
    return res;
  };

  Sketch.prototype.real_change = function() {
    var a, k, len, ref;
    ref = [this.points, this._elements];
    for (k = 0, len = ref.length; k < len; k++) {
      a = ref[k];
      if (a.real_change()) {
        return true;
      }
    }
    return false;
  };

  Sketch.prototype.z_index = function() {
    return 1000;
  };

  Sketch.prototype.clear = function() {
    this.points.clear();
    return this._elements.clear();
  };

  Sketch.prototype.add_theme_if_undef = function() {
    if (this._theme == null) {
      return this.add_attr({
        _theme: new Theme
      });
    }
  };

  Sketch.prototype.draw_selected = function(info) {
    this._theme.lines.color.r.set(0);
    this._theme.lines.color.b.set(0);
    return this.draw(info);
  };

  Sketch.prototype.draw_unselected = function(info) {
    this._theme = new Theme;
    return this.draw(info);
  };

  Sketch.prototype.draw = function(info) {
    var draw_points, el, i, i1, j1, k, k1, l1, len, len1, len10, len11, len12, len13, len14, len15, len2, len3, len4, len5, len6, len7, len8, len9, n, o, p, proj, q, r, ref, ref1, ref10, ref11, ref12, ref13, ref14, ref2, ref3, ref4, ref5, ref6, ref7, ref8, ref9, results, s, t, u, v, w, x, y, z;
    this.add_theme_if_undef();
    if (info.ctx_type === 'gl') {
      ref = this._elements;
      for (k = 0, len = ref.length; k < len; k++) {
        el = ref[k];
        el.draw_gl(info, this, this.points);
      }
      draw_points = false;
      proj = (function() {
        var len1, o, ref1, results;
        ref1 = this.points;
        results = [];
        for (i = o = 0, len1 = ref1.length; o < len1; i = ++o) {
          p = ref1[i];
          if (p instanceof Point) {
            results.push(info.re_2_sc.proj(p.pos.get()));
          }
        }
        return results;
      }).call(this);
      if (((ref1 = this.visualization.point_edition) != null ? ref1.get() : void 0) && (info.sel_item[this.model_id] != null)) {
        this._theme.editable_points.beg_ctx(info);
        for (o = 0, len1 = proj.length; o < len1; o++) {
          p = proj[o];
          this._theme.points.draw_proj(info, p);
        }
        this._theme.editable_points.end_ctx(info);
        if (this._selected_points.length) {
          this._theme.selected_points.beg_ctx(info);
          ref2 = this._selected_points;
          for (q = 0, len2 = ref2.length; q < len2; q++) {
            p = ref2[q];
            if (!(p instanceof Point)) {
              continue;
            }
            n = info.re_2_sc.proj(p.pos.get());
            this._theme.selected_points.draw_proj(info, n);
          }
          this._theme.selected_points.end_ctx(info);
        }
        if (this._pelected_points.length) {
          this._theme.highlighted_points.beg_ctx(info);
          ref3 = this._pelected_points;
          for (r = 0, len3 = ref3.length; r < len3; r++) {
            p = ref3[r];
            if (!(p instanceof Point)) {
              continue;
            }
            n = info.re_2_sc.proj(p.pos.get());
            this._theme.highlighted_points.draw_proj(info, n);
          }
          this._theme.highlighted_points.end_ctx(info);
        }
      } else if (this.visualization.display_style.equals("Points")) {
        this._theme.points.beg_ctx(info);
        for (s = 0, len4 = proj.length; s < len4; s++) {
          p = proj[s];
          this._theme.points.draw_proj(info, p);
        }
        this._theme.points.end_ctx(info);
      }
      this._update_sub_elements();
      ref4 = this._sub_elements;
      for (t = 0, len5 = ref4.length; t < len5; t++) {
        el = ref4[t];
        el.draw_gl(info, this, this.points, true);
      }
      if (this._selected_elements.length) {
        ref5 = this._pelected_points;
        for (u = 0, len6 = ref5.length; u < len6; u++) {
          el = ref5[u];
          el.draw_gl(info, this, this.points, true, this._theme.selected_elements);
        }
      }
      if (this._pelected_elements.length) {
        ref6 = this._pelected_elements;
        for (v = 0, len7 = ref6.length; v < len7; v++) {
          el = ref6[v];
          el.draw_gl(info, this, this.points, true, this._theme.highlighted_elements);
        }
      }
      return true;
    }
    if ((ref7 = this.points) != null ? ref7.length : void 0) {
      proj = (function() {
        var len8, ref8, results, w;
        ref8 = this.points;
        results = [];
        for (i = w = 0, len8 = ref8.length; w < len8; i = ++w) {
          p = ref8[i];
          results.push(info.re_2_sc.proj(p.pos.get()));
        }
        return results;
      }).call(this);
      ref8 = this._elements;
      for (w = 0, len8 = ref8.length; w < len8; w++) {
        el = ref8[w];
        el.draw(info, this, proj);
      }
      draw_points = false;
      if (((ref9 = this.visualization.point_edition) != null ? ref9.get() : void 0) && (info.sel_item[this.model_id] != null)) {
        this._theme.editable_points.beg_ctx(info);
        for (x = 0, len9 = proj.length; x < len9; x++) {
          p = proj[x];
          this._theme.points.draw_proj(info, p);
        }
        this._theme.editable_points.end_ctx(info);
        if (this._selected_points.length) {
          this._theme.selected_points.beg_ctx(info);
          ref10 = this._selected_points;
          for (y = 0, len10 = ref10.length; y < len10; y++) {
            p = ref10[y];
            n = info.re_2_sc.proj(p.pos.get());
            this._theme.selected_points.draw_proj(info, n);
          }
          this._theme.selected_points.end_ctx(info);
        }
        if (this._pelected_points.length) {
          this._theme.highlighted_points.beg_ctx(info);
          ref11 = this._pelected_points;
          for (z = 0, len11 = ref11.length; z < len11; z++) {
            p = ref11[z];
            n = info.re_2_sc.proj(p.pos.get());
            this._theme.highlighted_points.draw_proj(info, n);
          }
          this._theme.highlighted_points.end_ctx(info);
        }
      } else if (this.visualization.display_style.equals("Points")) {
        this._theme.points.beg_ctx(info);
        for (i1 = 0, len12 = proj.length; i1 < len12; i1++) {
          p = proj[i1];
          this._theme.points.draw_proj(info, p);
        }
        this._theme.points.end_ctx(info);
      }
      this._update_sub_elements();
      ref12 = this._sub_elements;
      for (j1 = 0, len13 = ref12.length; j1 < len13; j1++) {
        el = ref12[j1];
        el.draw(info, this, proj, true);
      }
      if (this._selected_elements.length) {
        ref13 = this._pelected_points;
        for (k1 = 0, len14 = ref13.length; k1 < len14; k1++) {
          el = ref13[k1];
          el.draw(info, this, proj, true, this._theme.selected_elements);
        }
      }
      if (this._pelected_elements.length) {
        ref14 = this._pelected_elements;
        results = [];
        for (l1 = 0, len15 = ref14.length; l1 < len15; l1++) {
          el = ref14[l1];
          results.push(el.draw(info, this, proj, true, this._theme.highlighted_elements));
        }
        return results;
      }
    }
  };

  Sketch.prototype.on_mouse_down = function(cm, evt, pos, b, old, points_allowed) {
    var best, divisions, el, ip, k, len, len1, len2, len3, nl, np, o, p, proj, q, r, ref, ref1, ref2, ref3, ref4, res;
    if (points_allowed == null) {
      points_allowed = true;
    }
    delete this._moving_point;
    if ((ref = this.visualization.point_edition) != null ? ref.get() : void 0) {
      if (b === "LEFT" || b === "RIGHT") {
        if (points_allowed) {
          proj = (function() {
            var k, len, ref1, results;
            ref1 = this.points;
            results = [];
            for (k = 0, len = ref1.length; k < len; k++) {
              p = ref1[k];
              results.push(cm.cam_info.re_2_sc.proj(p.pos.get()));
            }
            return results;
          }).call(this);
          best = this._closest_point_closer_than(proj, pos, 10);
          if (best >= 0) {
            if (evt.ctrlKey) {
              this._ctrlKey = true;
              if (this._selected_points.toggle_ref(this.points[best])) {
                this._moving_point = this.points[best];
                this._moving_point.beg_click(pos);
              }
            } else {
              this._ctrlKey = false;
              if (!this._selected_points.contains_ref(this.points[best])) {
                this._selected_points.clear();
                this._selected_points.set([this.points[best]]);
              }
              this._moving_point = this.points[best];
              this._moving_point.beg_click(pos);
            }
            if (b === "RIGHT") {
              return false;
            }
            return true;
          } else {
            this._selected_points.clear();
            this._pelected_points.clear();
          }
          best = {
            dist: 4
          };
          ref1 = this._elements;
          for (k = 0, len = ref1.length; k < len; k++) {
            el = ref1[k];
            if (typeof el.closest_point_closer_than === "function") {
              el.closest_point_closer_than(best, this, proj, cm.cam_info, pos);
            }
          }
          ref2 = this._sub_elements;
          for (o = 0, len1 = ref2.length; o < len1; o++) {
            el = ref2[o];
            if (typeof el.closest_point_closer_than === "function") {
              el.closest_point_closer_than(best, this, proj, cm.cam_info, pos);
            }
          }
          if (best.disp != null) {
            np = this.points.length;
            ip = this.add_point(best.disp);
            this._selected_points.clear();
            this._selected_points.set([ip]);
            this._moving_point = ip;
            this._moving_point.beg_click(pos);
            res = [];
            divisions = {};
            ref3 = this._elements;
            for (q = 0, len2 = ref3.length; q < len2; q++) {
              el = ref3[q];
              if (typeof el.cut_with_point === "function") {
                el.cut_with_point(divisions, best, this, np, ip);
              }
              if (divisions[el.model_id] != null) {
                ref4 = divisions[el.model_id];
                for (r = 0, len3 = ref4.length; r < len3; r++) {
                  nl = ref4[r];
                  res.push(nl);
                }
              } else {
                res.push(el);
              }
            }
            this._elements.clear();
            this._elements.set(res);
          }
        }
      }
    }
    return false;
  };

  Sketch.prototype.on_mouse_up_wo_move = function(cm, evt, pos, b, points_allowed) {
    var p;
    if (points_allowed == null) {
      points_allowed = true;
    }
    if ((this._moving_point != null) && !this._ctrlKey && this._selected_points.length > 1) {
      p = this._selected_points.back();
      this._selected_points.clear();
      this._selected_points.set([p]);
      return true;
    }
  };

  Sketch.prototype.on_mouse_move = function(cm, evt, pos, b, old) {
    var best, d_0, el, k, len, len1, o, p, p_0, proj, ref, ref1, ref2, ref3;
    if ((ref = this.visualization.point_edition) != null ? ref.get() : void 0) {
      if ((this._moving_point != null) && b === "LEFT") {
        if ((ref1 = cm.undo_manager) != null) {
          ref1.snapshot();
        }
        p_0 = cm.cam_info.sc_2_rw.pos(pos[0], pos[1]);
        d_0 = cm.cam_info.sc_2_rw.dir(pos[0], pos[1]);
        this._moving_point.move(this._selected_points, this._moving_point.pos, p_0, d_0);
        return true;
      }
      proj = (function() {
        var k, len, ref2, results;
        ref2 = this.points;
        results = [];
        for (k = 0, len = ref2.length; k < len; k++) {
          p = ref2[k];
          results.push(cm.cam_info.re_2_sc.proj(p.pos.get()));
        }
        return results;
      }).call(this);
      best = this._closest_point_closer_than(proj, pos, 10);
      if (best >= 0) {
        this._pelected_points.clear();
        this._pelected_points.set([this.points[best]]);
        return true;
      }
      best = {
        dist: 4
      };
      ref2 = this._elements;
      for (k = 0, len = ref2.length; k < len; k++) {
        el = ref2[k];
        if (typeof el.closest_point_closer_than === "function") {
          el.closest_point_closer_than(best, this, proj, cm.cam_info, pos);
        }
      }
      ref3 = this._sub_elements;
      for (o = 0, len1 = ref3.length; o < len1; o++) {
        el = ref3[o];
        if (typeof el.closest_point_closer_than === "function") {
          el.closest_point_closer_than(best, this, proj, cm.cam_info, pos);
        }
      }
      if (best.disp != null) {
        this._pelected_points.clear();
        this._pelected_points.set([new Point(best.disp)]);
        return true;
      }
    }
    this._pelected_points.clear();
    return false;
  };

  Sketch.prototype.update_min_max = function(x_min, x_max) {
    var d, k, len, m, p, ref, results;
    ref = this.points;
    results = [];
    for (k = 0, len = ref.length; k < len; k++) {
      m = ref[k];
      if (!(m instanceof Point)) {
        continue;
      }
      p = m.pos.get();
      results.push((function() {
        var o, results1;
        results1 = [];
        for (d = o = 0; o < 3; d = ++o) {
          x_min[d] = Math.min(x_min[d], p[d]);
          results1.push(x_max[d] = Math.max(x_max[d], p[d]));
        }
        return results1;
      })());
    }
    return results;
  };

  Sketch.prototype.make_curve_line_from_selected = function() {
    var el, index_selected_points, k, len, results, sel_point;
    index_selected_points = this._get_indices_of_selected_points();
    if (index_selected_points.length) {
      results = [];
      for (k = 0, len = index_selected_points.length; k < len; k++) {
        sel_point = index_selected_points[k];
        results.push((function() {
          var len1, o, ref, results1;
          ref = this._elements;
          results1 = [];
          for (o = 0, len1 = ref.length; o < len1; o++) {
            el = ref[o];
            results1.push(el.make_curve_line_from_selected(sel_point));
          }
          return results1;
        }).call(this));
      }
      return results;
    }
  };

  Sketch.prototype.break_line_from_selected = function() {
    var el, index_selected_points, k, len, results, sel_point;
    index_selected_points = this._get_indices_of_selected_points();
    if (index_selected_points.length) {
      results = [];
      for (k = 0, len = index_selected_points.length; k < len; k++) {
        sel_point = index_selected_points[k];
        results.push((function() {
          var len1, o, ref, results1;
          ref = this._elements;
          results1 = [];
          for (o = 0, len1 = ref.length; o < len1; o++) {
            el = ref[o];
            results1.push(el.break_line_from_selected(sel_point));
          }
          return results1;
        }).call(this));
      }
      return results;
    }
  };

  Sketch.prototype.delete_selected_point = function() {
    var done, el, fun, i, ind, index_selected_points, j, k, len, len1, n_array, o, p, q, r, ref, ref1, ref2, ref3, ref4, results, sel_point;
    index_selected_points = this._get_indices_of_selected_points();
    if (index_selected_points.length > 0) {
      results = [];
      for (ind = k = ref = index_selected_points.length - 1; ref <= 0 ? k <= 0 : k >= 0; ind = ref <= 0 ? ++k : --k) {
        sel_point = index_selected_points[ind];
        p = this.points[sel_point];
        n_array = (function() {
          var o, ref1, results1;
          results1 = [];
          for (i = o = 0, ref1 = this.points.length; 0 <= ref1 ? o < ref1 : o > ref1; i = 0 <= ref1 ? ++o : --o) {
            results1.push(i);
          }
          return results1;
        }).call(this);
        n_array[sel_point] = -1;
        for (j = o = ref1 = sel_point + 1, ref2 = this.points.length; ref1 <= ref2 ? o < ref2 : o > ref2; j = ref1 <= ref2 ? ++o : --o) {
          n_array[j] -= 1;
        }
        ref3 = this._elements;
        for (q = 0, len = ref3.length; q < len; q++) {
          el = ref3[q];
          if (typeof el.rem_sub_element === "function") {
            el.rem_sub_element(sel_point);
          }
        }
        this._selected_points.remove_ref(p);
        this._pelected_points.remove_ref(p);
        this.points.splice(sel_point, 1);
        ref4 = this.delete_selected_points_callback;
        for (r = 0, len1 = ref4.length; r < len1; r++) {
          fun = ref4[r];
          fun(this, index_selected_points);
        }
        done = {};
        results.push((function() {
          var len2, ref5, results1, s;
          ref5 = this._elements;
          results1 = [];
          for (s = 0, len2 = ref5.length; s < len2; s++) {
            el = ref5[s];
            results1.push(typeof el.update_indices === "function" ? el.update_indices(done, n_array) : void 0);
          }
          return results1;
        }).call(this));
      }
      return results;
    }
  };

  Sketch.prototype._actualise_indices = function(array, val, index) {
    var ind, k, len, ref, results;
    if (index == null) {
      index = 0;
    }
    if (array.length && val !== 0 && index >= 0 && index <= array.length - 1) {
      ref = array.slice(index, array.length);
      results = [];
      for (k = 0, len = ref.length; k < len; k++) {
        ind = ref[k];
        results.push(array[ind].set(array[ind].get() + val));
      }
      return results;
    }
  };

  Sketch.prototype._get_indices_of_selected_points = function() {
    var index_selected_points, j, k, len, len1, o, point, ref, ref1, sel_point;
    index_selected_points = [];
    ref = this.points;
    for (j = k = 0, len = ref.length; k < len; j = ++k) {
      point = ref[j];
      ref1 = this._selected_points;
      for (o = 0, len1 = ref1.length; o < len1; o++) {
        sel_point = ref1[o];
        if (point === sel_point) {
          index_selected_points.push(j);
        }
      }
    }
    return index_selected_points;
  };

  Sketch.prototype._update_sub_elements = function() {
    var base, e, l, n, oi, results;
    if (this._sub_date < this._elements._date_last_modification) {
      this._sub_date = this._elements._date_last_modification;
      l = (function() {
        var k, len, ref, results;
        ref = this._elements;
        results = [];
        for (k = 0, len = ref.length; k < len; k++) {
          e = ref[k];
          results.push(e);
        }
        return results;
      }).call(this);
      this._sub_elements = [];
      results = [];
      while (l.length) {
        oi = this._sub_elements.length;
        if (typeof (base = l.pop()).add_sub_element === "function") {
          base.add_sub_element(this._sub_elements);
        }
        results.push((function() {
          var k, len, ref, results1;
          ref = this._sub_elements.slice(oi);
          results1 = [];
          for (k = 0, len = ref.length; k < len; k++) {
            n = ref[k];
            results1.push(l.push(n));
          }
          return results1;
        }).call(this));
      }
      return results;
    }
  };

  Sketch.prototype._closest_point_closer_than = function(proj, pos, dist) {
    var best, d, k, len, n, p;
    best = -1;
    for (n = k = 0, len = proj.length; k < len; n = ++k) {
      p = proj[n];
      d = Math.sqrt(Math.pow(pos[0] - p[0], 2) + Math.pow(pos[1] - p[1], 2));
      if (dist > d) {
        dist = d;
        best = n;
      }
    }
    return best;
  };

  return Sketch;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var Img,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Img = (function(superClass) {
  extend(Img, superClass);

  function Img(src, app, need_fit) {
    var onload;
    if (src == null) {
      src = "";
    }
    if (app == null) {
      app = void 0;
    }
    if (need_fit == null) {
      need_fit = true;
    }
    Img.__super__.constructor.call(this);
    this.add_attr({
      src: src,
      pos: [0, 0, 0],
      _histo: new Vec
    });
    this.data = {
      zmin: 0,
      zmax: 0,
      buff: void 0,
      rgba: void 0,
      begl: true
    };
    onload = (function(_this) {
      return function() {
        _this._signal_change();
        _this.loaded = true;
        _this.data.rgba = _this.data.buff;
        _this.data.buff = new Image;
        _this.data.buff.onload = onload;
        if (_this._histo.length === 0) {
          _this.fill_histogram();
        }
        if (need_fit && (app != null)) {
          need_fit = false;
          return app.fit(0);
        }
      };
    })(this);
    this.loaded = false;
    this.data.buff = new Image;
    this.data.buff.onload = onload;
    this._get_src_data();
    this.tex = {};
    this._date_tex = {};
  }

  Img.prototype.z_index = function() {
    return 1;
  };

  Img.prototype.draw = function(info) {
    var P, Xc, Z, ajusted, dX, dY, dc, h, ref, sc_2_rw, w, x_max, x_min;
    if (this.src.has_been_modified() || ((ref = this._repr) != null ? ref.has_been_modified() : void 0) || this.data.begl) {
      this.data.begl = false;
      this._get_src_data();
    }
    if (this.data.rgba == null) {
      return false;
    }
    this.X = [1, 0, 0];
    this.Y = [0, 1, 0];
    this.Z = [0, 0, 1];
    this.O = [this.pos[0].get(), this.pos[1].get(), this.pos[2].get()];
    if (info.shoot_cam != null) {
      w = this.data.rgba.width;
      h = this.data.rgba.height;
      sc_2_rw = info.shoot_cam.sc_2_rw(w, h);
      Z = sc_2_rw.dir(0.5 * w, 0.5 * h);
      x_min = info.get_x_min();
      x_max = info.get_x_max();
      Xc = [0.5 * (x_min[0] + x_max[0]), 0.5 * (x_min[1] + x_max[1]), 0.5 * (x_min[2] + x_max[2])];
      dc = Math.max(x_max[0] - x_min[0], x_max[1] - x_min[1], x_max[2] - x_min[2]);
      P = [Xc[0] + dc * Z[0], Xc[1] + dc * Z[1], Xc[2] + dc * Z[2]];
      ajusted = function(pos, dir, Z, P) {
        var pp, pq;
        pp = Vec_3.dot(Vec_3.sub(P, pos), Z);
        pq = pp / Vec_3.dot(Z, dir);
        return [pos[0] + dir[0] * pq, pos[1] + dir[1] * pq, pos[2] + dir[2] * pq];
      };
      this.O = ajusted(sc_2_rw.pos(0, h), sc_2_rw.dir(0, h), Z, P);
      dX = ajusted(sc_2_rw.pos(w, h), sc_2_rw.dir(w, h), Z, P);
      dY = ajusted(sc_2_rw.pos(0, 0), sc_2_rw.dir(0, 0), Z, P);
      this.X = Vec_3.mus(1 / w, Vec_3.sub(dX, this.O));
      this.Y = Vec_3.mus(1 / h, Vec_3.sub(dY, this.O));
      this.Z = Vec_3.nor(Vec_3.cro(this.X, this.Y));
    }
    if (this.data.zmin === this.data.zmax) {
      if ((this.loaded == null) || this.loaded !== true) {
        console.log(Img, this.src.get());
        console.log(this.loaded);
      }
      return Img._draw_persp_rec(info, this.data.rgba, this.data.zmin, this.data.zmax, this.O, this.X, this.Y, this.Z, this._date_tex, this.tex, this.src);
    }
  };

  Img.prototype.update_min_max = function(x_min, x_max) {
    if (this.data.rgba != null) {
      x_min[0] = Math.min(x_min[0], this.pos[0].get());
      x_min[1] = Math.min(x_min[1], this.pos[1].get());
      x_min[2] = Math.min(x_min[2], this.pos[2].get());
      x_max[0] = Math.max(x_max[0], this.data.rgba.width + this.pos[0].get());
      x_max[1] = Math.max(x_max[1], this.data.rgba.height + this.pos[1].get());
      return x_max[2] = Math.max(x_max[2], this.pos[2].get());
    }
  };

  Img.prototype.fill_histogram = function() {};

  Img.prototype.information = function(div) {
    var d, ref;
    if (((ref = this.data.rgba) != null ? ref.height : void 0) != null) {
      if (this.cm == null) {
        this.txt = new_dom_element({
          parentNode: div
        });
        d = new_dom_element({
          parentNode: div
        });
      }
      return this.txt.innerHTML = this.src + " <br> Height : " + this.data.rgba.height + "px <br> Width  : " + this.data.rgba.width + "px <br>";
    }
  };

  Img.prototype._get_src_data = function() {
    var s;
    s = this._repr != null ? this._repr : this.src;
    if ((typeof Path !== "undefined" && Path !== null) && (s instanceof Path)) {
      return this.data.buff.src = "/sceen/_?u=" + s._server_id;
    } else if (s.get().length) {
      return this.data.buff.src = s.get();
    }
  };

  Img._draw_persp_rec = function(info, rgba, zmin, zmax, O, X, Y, Z, _date_tex, tex, src, xmin, ymin, xmax, ymax, rec) {
    var a, b, c, ca, cb, d, dx, dy, fs, gl, h, ibuf, idx, initBuffer, ps, r, sx, sy, tbuf, txc, vbuf, vs, vtx, w, x, xm_0, xm_1, y, ym_0, ym_1;
    if (xmin == null) {
      xmin = 0;
    }
    if (ymin == null) {
      ymin = 0;
    }
    if (xmax == null) {
      xmax = 1;
    }
    if (ymax == null) {
      ymax = 1;
    }
    if (rec == null) {
      rec = 0;
    }
    w = rgba.width;
    h = rgba.height;
    if (info.ctx_type === "gl") {
      vs = "attribute vec3 pos;\n attribute vec2 textureCoords;\n varying vec2 texcoords;\n " + (info.cam.gl_attr(info, "cam")) + "\n void main( void ) {\n texcoords = textureCoords;\n gl_Position = vec4( pos, 1.0 );\n " + (info.cam.gl_main(info, "cam")) + "\n gl_Position.z += 1e-5;\n }\n";
      fs = "precision mediump float;\n varying vec2 texcoords;\n uniform sampler2D uSampler;\n void main( void ) {\n gl_FragColor = texture2D( uSampler, texcoords );\n }\n";
      gl = info.ctx;
      ps = info.cm.gl_prog(vs, fs);
      gl.useProgram(ps);
      ps.aposAttrib = gl.getAttribLocation(ps, "pos");
      gl.enableVertexAttribArray(ps.aposAttrib);
      ps.atexAttrib = gl.getAttribLocation(ps, "textureCoords");
      gl.enableVertexAttribArray(ps.atexAttrib);
      if (_date_tex[gl.ctx_id] == null) {
        _date_tex[gl.ctx_id] = -1;
      }
      if (_date_tex[gl.ctx_id] < src._date_last_modification) {
        _date_tex[gl.ctx_id] = src._date_last_modification;
        if (tex[gl.ctx_id] != null) {
          gl.deleteTexture(tex[gl.ctx_id]);
        }
        tex[gl.ctx_id] = gl.createTexture();
        gl.activeTexture(gl.TEXTURE0);
        gl.bindTexture(gl.TEXTURE_2D, tex[gl.ctx_id]);
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, rgba);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
      }
      gl.bindTexture(gl.TEXTURE_2D, tex[gl.ctx_id]);
      ps.samplerUniform = gl.getUniformLocation(ps, "uSampler");
      gl.uniform1i(ps.samplerUniform, 0);
      a = Vec_3.add(O, Vec_3.add(Vec_3.add(Vec_3.mus(w * xmin, X), Vec_3.mus(h * ymin, Y)), Vec_3.mus(zmin, Z)));
      b = Vec_3.add(O, Vec_3.add(Vec_3.add(Vec_3.mus(w * xmax, X), Vec_3.mus(h * ymax, Y)), Vec_3.mus(zmin, Z)));
      c = Vec_3.add(O, Vec_3.add(Vec_3.add(Vec_3.mus(w * xmax, X), Vec_3.mus(h * ymin, Y)), Vec_3.mus(zmin, Z)));
      d = Vec_3.add(O, Vec_3.add(Vec_3.add(Vec_3.mus(w * xmin, X), Vec_3.mus(h * ymax, Y)), Vec_3.mus(zmin, Z)));
      vtx = new Float32Array([a[0], a[1], a[2], b[0], b[1], b[2], c[0], c[1], c[2], d[0], d[1], d[2]]);
      txc = new Float32Array([0, 0, 1, 1, 1, 0, 0, 1]);
      idx = new Uint16Array([0, 2, 3, 1]);
      initBuffer = function(glELEMENT_ARRAY_BUFFER, data) {
        var buf;
        buf = gl.createBuffer();
        gl.bindBuffer(glELEMENT_ARRAY_BUFFER, buf);
        gl.bufferData(glELEMENT_ARRAY_BUFFER, data, gl.STATIC_DRAW);
        return buf;
      };
      vbuf = initBuffer(gl.ARRAY_BUFFER, vtx);
      ibuf = initBuffer(gl.ELEMENT_ARRAY_BUFFER, idx);
      gl.vertexAttribPointer(ps.aposAttrib, 3, gl.FLOAT, false, 0, 0);
      tbuf = initBuffer(gl.ARRAY_BUFFER, txc);
      gl.vertexAttribPointer(ps.atexAttrib, 2, gl.FLOAT, false, 0, 0);
      gl.enableVertexAttribArray(ps.atexAttrib);
      info.cam.gl_exec(info, "cam", ps);
      gl.drawElements(gl.TRIANGLE_STRIP, 4, gl.UNSIGNED_SHORT, 0);
      gl.disableVertexAttribArray(ps.aposAttrib);
      gl.disableVertexAttribArray(ps.atexAttrib);
      gl.bindBuffer(gl.ARRAY_BUFFER, null);
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);
      gl.bindTexture(gl.TEXTURE_2D, null);
      gl.deleteBuffer(tbuf);
      gl.deleteBuffer(ibuf);
      return gl.deleteBuffer(vbuf);
    } else {
      a = info.re_2_sc.proj(Vec_3.add(O, Vec_3.add(Vec_3.add(Vec_3.mus(w * xmin, X), Vec_3.mus(h * ymin, Y)), Vec_3.mus(zmin, Z))));
      b = info.re_2_sc.proj(Vec_3.add(O, Vec_3.add(Vec_3.add(Vec_3.mus(w * xmax, X), Vec_3.mus(h * ymax, Y)), Vec_3.mus(zmin, Z))));
      c = info.re_2_sc.proj(Vec_3.add(O, Vec_3.add(Vec_3.add(Vec_3.mus(w * xmax, X), Vec_3.mus(h * ymin, Y)), Vec_3.mus(zmin, Z))));
      d = info.re_2_sc.proj(Vec_3.add(O, Vec_3.add(Vec_3.add(Vec_3.mus(w * xmin, X), Vec_3.mus(h * ymax, Y)), Vec_3.mus(zmin, Z))));
      if (a[0] >= info.w && b[0] >= info.w && c[0] >= info.w && d[0] >= info.w) {
        return true;
      }
      if (a[0] < 0 && b[0] < 0 && c[0] < 0 && d[0] < 0) {
        return true;
      }
      if (a[1] >= info.h && b[1] >= info.h && c[1] >= info.h && d[1] >= info.h) {
        return true;
      }
      if (a[1] < 0 && b[1] < 0 && c[1] < 0 && d[1] < 0) {
        return true;
      }
      r = [c[0] + d[0] - a[0], c[1] + d[1] - a[1]];
      if (rec < 6 && Math.pow(r[0] - b[0], 2) + Math.pow(r[1] - b[1], 2) > 1) {
        ca = 0.5 + 1e-2;
        cb = 1 - ca;
        xm_0 = cb * xmin + ca * xmax;
        ym_0 = cb * ymin + ca * ymax;
        xm_1 = ca * xmin + cb * xmax;
        ym_1 = ca * ymin + cb * ymax;
        Img._draw_persp_rec(info, rgba, zmin, zmax, O, X, Y, Z, _date_tex, tex, src, xmin, ymin, xm_0, ym_0, rec + 1);
        Img._draw_persp_rec(info, rgba, zmin, zmax, O, X, Y, Z, _date_tex, tex, src, xm_1, ymin, xmax, ym_0, rec + 1);
        Img._draw_persp_rec(info, rgba, zmin, zmax, O, X, Y, Z, _date_tex, tex, src, xmin, ym_1, xm_0, ymax, rec + 1);
        Img._draw_persp_rec(info, rgba, zmin, zmax, O, X, Y, Z, _date_tex, tex, src, xm_1, ym_1, xmax, ymax, rec + 1);
        return true;
      }
      sx = Math.ceil(w * xmin);
      sy = Math.ceil(h * (1 - ymax));
      dx = Math.ceil(w * (xmax - xmin));
      dy = Math.ceil(h * (ymax - ymin));
      dx = Math.min(dx, w - sx);
      dy = Math.min(dy, h - sy);
      x = [(c[0] - a[0]) / dx, (c[1] - a[1]) / dx];
      y = [(d[0] - a[0]) / dy, (d[1] - a[1]) / dy];
      info.ctx.save();
      info.ctx.setTransform(x[0], x[1], y[0], y[1], d[0], d[1]);
      info.ctx.transform(1, 0, 0, -1, 0, 0);
      info.ctx.drawImage(rgba, sx, sy, dx, dy, 0, 0, dx, dy);
      return info.ctx.restore();
    }
  };

  return Img;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var Graph_old,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

Graph_old = (function(superClass) {
  extend(Graph_old, superClass);

  function Graph_old(params) {
    var key, ref, val;
    if (params == null) {
      params = {};
    }
    Graph_old.__super__.constructor.call(this);
    this.add_attr({
      show_line: true,
      line_color: new Color(0, 0, 0),
      line_width: new ConstrainedVal(1, {
        min: 0,
        max: 20
      }),
      shadow: true,
      show_marker: true,
      marker: new Choice(0, ["dot", "square", "cross", "diamond", "bar"]),
      marker_size: new ConstrainedVal(5, {
        min: 0,
        max: 40
      }),
      marker_color: new Color(0, 0, 0),
      font_color: new Color(0, 0, 0),
      font_size: new ConstrainedVal(12, {
        min: 2,
        max: 72
      }),
      show_grid: true,
      grid_color: new Color(200, 200, 200),
      x_axis: '',
      y_axis: '',
      legend_x_division: 5,
      legend_y_division: 3,
      sel_item_color: new Color(255, 255, 0),
      movable_hl_infos: true,
      points: new Lst_Point,
      legend: new Lst,
      _pre_sele: new Lst
    });
    for (key in params) {
      val = params[key];
      if ((ref = this[key]) != null) {
        if (typeof ref.set === "function") {
          ref.set(val);
        }
      }
    }
    this.axis_width = 1;
    this.origin = [0, 0];
    this.O_point = [0, 0];
    this.X_point = [0, 0];
    this.Y_point = [0, 0];
  }

  Graph_old.prototype.z_index = function() {
    return 100;
  };

  Graph_old.prototype.build_w2b_legend = function() {
    var color, i, j, results;
    results = [];
    for (i = j = 0; j <= 255; i = ++j) {
      color = (i < 16 ? '0' : '') + i.toString(16);
      results.push(this.legend[i] = "#" + color + color + color);
    }
    return results;
  };

  Graph_old.prototype.draw = function(info) {
    var orig, p, proj;
    this.O_point = [info.padding / 2, info.h - info.padding];
    this.X_point = [info.w - info.padding / 2, info.h - info.padding];
    this.Y_point = [info.padding / 2, -info.h + info.padding];
    info.ctx.lineCap = "round";
    info.ctx.lineJoin = "round";
    info.ctx.shadowOffsetX = 0;
    info.ctx.shadowOffsetY = 0;
    info.ctx.shadowBlur = 0;
    info.ctx.shadowColor = "transparent black";
    if (this.points.length) {
      orig = info.re_2_sc.proj([0, 0, 0]);
      proj = (function() {
        var j, len, ref, results;
        ref = this.points;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          p = ref[j];
          results.push(info.re_2_sc.proj(p.pos.get()));
        }
        return results;
      }).call(this);
      if (this.show_grid.get() === true) {
        this.draw_grid(info);
      }
      if (this.shadow.get() === true) {
        this.add_shadow(info);
      } else {
        this.remove_shadow(info);
      }
      if (this.show_line.get() === true) {
        this.draw_line(info, orig, proj);
      }
      if (this.show_marker.get() === true) {
        if (this.marker.get() === 'bar') {
          this.draw_marker_bar(info, orig, proj);
        } else if (this.marker.get() === 'cross') {
          this.draw_marker_cross(info, orig, proj);
        } else if (this.marker.get() === 'square') {
          this.draw_marker_square(info, orig, proj);
        } else if (this.marker.get() === 'diamond') {
          this.draw_marker_diamond(info, orig, proj);
        } else if (this.marker.get() === 'dot') {
          this.draw_marker_dot(info, orig, proj);
        }
      }
      this.remove_shadow(info);
      if (this.show_marker.get() === true) {
        if (this.movable_hl_infos.get() === true) {
          this.draw_movable_highlight_values(info);
        } else {
          this.draw_highlight_values(info);
        }
      }
    }
    this.hide_outside_values(info);
    this.draw_axis(info);
    return this.draw_legend(info);
  };

  Graph_old.prototype.add_shadow = function(info) {
    info.ctx.shadowOffsetX = this.line_width.get();
    info.ctx.shadowOffsetY = this.line_width.get();
    info.ctx.shadowBlur = this.line_width.get();
    return info.ctx.shadowColor = "#3a3a3a";
  };

  Graph_old.prototype.remove_shadow = function(info) {
    info.ctx.shadowOffsetX = 0;
    info.ctx.shadowOffsetY = 0;
    info.ctx.shadowBlur = 0;
    return info.ctx.shadowColor = "transparent black";
  };

  Graph_old.prototype.hide_outside_values = function(info) {
    info.ctx.fillStyle = "rgba( 255, 255, 255, 0.9 )";
    info.ctx.clearRect(0, 0, info.padding * 0.5, info.h);
    return info.ctx.clearRect(info.padding * 0.5, info.h - info.padding / 2, info.w, info.padding * 0.5);
  };

  Graph_old.prototype.draw_movable_highlight_values = function(info) {
    var decal_left, decal_top, height_box, highlighted_point, i, j, len, p, padding_left, padding_top, pos, ref, ref1, results, text, width_box;
    padding_left = 10;
    padding_top = -8;
    decal_left = 10;
    decal_top = -12;
    ref = this.points;
    results = [];
    for (i = j = 0, len = ref.length; j < len; i = ++j) {
      p = ref[i];
      if (ref1 = this.points[i], indexOf.call(this._pre_sele, ref1) >= 0) {
        highlighted_point = p.pos.get();
        info.ctx.beginPath();
        pos = info.re_2_sc.proj(highlighted_point);
        text = highlighted_point[0] + ", " + highlighted_point[1];
        info.ctx.font = this.font_size.get() * 2 + "px Arial";
        width_box = info.ctx.measureText(text).width + padding_left * 2;
        height_box = this.font_size.get() * 3;
        info.ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
        info.ctx.fillRect(pos[0] + decal_left, pos[1] + decal_top - height_box * 0.8, width_box, height_box);
        info.ctx.lineWidth = 1;
        info.ctx.strokeStyle = "rgba(0, 0, 0, 0.8)";
        info.ctx.strokeRect(pos[0] + decal_left, pos[1] + decal_top - height_box * 0.8, width_box, height_box);
        info.ctx.textAlign = "left";
        info.ctx.fillStyle = this.font_color.to_rgba();
        results.push(info.ctx.fillText(text, pos[0] + padding_left + decal_left, pos[1] + padding_top + decal_top));
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  Graph_old.prototype.draw_highlight_values = function(info) {
    var highlighted_point, i, j, len, p, padding, ref, ref1, results;
    padding = 10;
    ref = this.points;
    results = [];
    for (i = j = 0, len = ref.length; j < len; i = ++j) {
      p = ref[i];
      if (ref1 = this.points[i], indexOf.call(this._pre_sele, ref1) >= 0) {
        highlighted_point = p.pos.get();
        info.ctx.beginPath();
        info.ctx.fillStyle = this.font_color.to_rgba();
        info.ctx.textAlign = "right";
        info.ctx.font = this.font_size.get() * 2 + "px Arial";
        results.push(info.ctx.fillText(highlighted_point[0] + ", " + highlighted_point[1], info.w - padding, 20));
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  Graph_old.prototype.draw_line = function(info, orig, proj) {
    var i, j, len, p;
    info.ctx.beginPath();
    info.ctx.strokeStyle = this.line_color.to_rgba();
    if (this.line_width.get() <= 1) {
      info.ctx.lineWidth = 1.000001;
    } else {
      info.ctx.lineWidth = this.line_width.get();
    }
    for (i = j = 0, len = proj.length; j < len; i = ++j) {
      p = proj[i];
      info.ctx.lineTo(p[0], p[1]);
    }
    info.ctx.stroke();
    return info.ctx.closePath();
  };

  Graph_old.prototype.draw_marker_dot = function(info, orig, proj) {
    var i, j, len, p, ref;
    for (i = j = 0, len = proj.length; j < len; i = ++j) {
      p = proj[i];
      if (ref = this.points[i], indexOf.call(this._pre_sele, ref) >= 0) {
        info.ctx.fillStyle = this.sel_item_color.to_rgba();
      } else {
        info.ctx.fillStyle = this.legend[i] || this.marker_color.to_rgba();
      }
      info.ctx.beginPath();
      info.ctx.arc(p[0], p[1], this.marker_size.get() * 0.5, 0, Math.PI * 2, true);
      info.ctx.fill();
    }
    return info.ctx.closePath();
  };

  Graph_old.prototype.draw_marker_cross = function(info, orig, proj) {
    var i, j, len, p, ref;
    for (i = j = 0, len = proj.length; j < len; i = ++j) {
      p = proj[i];
      if (ref = this.points[i], indexOf.call(this._pre_sele, ref) >= 0) {
        info.ctx.strokeStyle = this.sel_item_color.to_rgba();
      } else {
        info.ctx.strokeStyle = this.legend[i] || this.marker_color.to_rgba();
      }
      info.ctx.beginPath();
      info.ctx.moveTo(p[0] - this.marker_size.get() * 0.5, p[1] + this.marker_size.get() * 0.5);
      info.ctx.lineTo(p[0] + this.marker_size.get() * 0.5, p[1] - this.marker_size.get() * 0.5);
      info.ctx.moveTo(p[0] + this.marker_size.get() * 0.5, p[1] + this.marker_size.get() * 0.5);
      info.ctx.lineTo(p[0] - this.marker_size.get() * 0.5, p[1] - this.marker_size.get() * 0.5);
      info.ctx.stroke();
    }
    return info.ctx.closePath();
  };

  Graph_old.prototype.draw_marker_square = function(info, orig, proj) {
    var i, j, len, p, ref;
    for (i = j = 0, len = proj.length; j < len; i = ++j) {
      p = proj[i];
      if (ref = this.points[i], indexOf.call(this._pre_sele, ref) >= 0) {
        info.ctx.fillStyle = this.sel_item_color.to_rgba();
      } else {
        info.ctx.fillStyle = this.legend[i] || this.marker_color.to_rgba();
      }
      info.ctx.beginPath();
      info.ctx.fillRect(p[0] - this.marker_size.get() * 0.5, p[1] - this.marker_size.get() * 0.5, this.marker_size.get(), this.marker_size.get());
    }
    return info.ctx.closePath();
  };

  Graph_old.prototype.draw_marker_diamond = function(info, orig, proj) {
    var i, j, len, p, ref;
    for (i = j = 0, len = proj.length; j < len; i = ++j) {
      p = proj[i];
      if (ref = this.points[i], indexOf.call(this._pre_sele, ref) >= 0) {
        info.ctx.fillStyle = this.sel_item_color.to_rgba();
      } else {
        info.ctx.fillStyle = this.legend[i] || this.marker_color.to_rgba();
      }
      info.ctx.beginPath();
      info.ctx.moveTo(p[0], p[1] - this.marker_size.get());
      info.ctx.lineTo(p[0] + this.marker_size.get() * 0.5, p[1]);
      info.ctx.lineTo(p[0], p[1] + this.marker_size.get());
      info.ctx.lineTo(p[0] - +this.marker_size.get() * 0.5, p[1]);
      info.ctx.fill();
    }
    return info.ctx.closePath();
  };

  Graph_old.prototype.draw_marker_bar = function(info, orig, proj) {
    var height, i, j, len, p, ref;
    for (i = j = 0, len = proj.length; j < len; i = ++j) {
      p = proj[i];
      if (ref = this.points[i], indexOf.call(this._pre_sele, ref) >= 0) {
        info.ctx.fillStyle = this.sel_item_color.to_rgba();
      } else {
        info.ctx.fillStyle = this.legend[i] || this.marker_color.to_rgba();
      }
      height = orig[1] - p[1];
      info.ctx.beginPath();
      info.ctx.fillRect(p[0], p[1], this.marker_size.get(), height);
    }
    return info.ctx.closePath();
  };

  Graph_old.prototype.draw_axis = function(info) {
    var decal_txt, height_axis, orig, width_axis;
    orig = [info.padding * 0.5, info.h - info.padding / 2, 0];
    width_axis = info.w - info.padding;
    height_axis = -info.h + orig[1] + info.padding;
    info.ctx.beginPath();
    info.ctx.lineWidth = this.axis_width;
    info.ctx.strokeStyle = this.font_color.to_rgba();
    info.ctx.fillStyle = this.font_color.to_rgba();
    info.ctx.font = this.font_size.get() + "px Arial";
    decal_txt = 10;
    if (this.x_axis.get() !== "") {
      info.ctx.textAlign = "left";
      info.ctx.fillText(this.x_axis.get(), orig[0] + width_axis + decal_txt, orig[1] + 2);
    }
    info.ctx.moveTo(orig[0], orig[1]);
    info.ctx.lineTo(orig[0] + width_axis, orig[1]);
    if (this.y_axis.get() !== "") {
      info.ctx.textBaseline = "bottom";
      info.ctx.textAlign = "center";
      info.ctx.fillText(this.y_axis.get(), orig[0] - 2, height_axis - decal_txt);
    }
    info.ctx.moveTo(orig[0], orig[1]);
    info.ctx.lineTo(orig[0], height_axis);
    info.ctx.stroke();
    info.ctx.closePath();
    return info.ctx.textBaseline = "middle";
  };

  Graph_old.prototype.draw_legend = function(info) {
    var decal_txt_X, decal_txt_Y, height_axis, i, j, k, l, max, min, n, nice_val, orig, pos, posit, ref, ref1, ref2, ref3, ref4, ref5, val, val_from_screen, value, vve, width_axis, x_padding_txt, y_padding_txt;
    x_padding_txt = 10;
    y_padding_txt = 2;
    decal_txt_X = 3;
    decal_txt_Y = 1;
    orig = [0 + info.padding * 0.5, info.h - info.padding / 2, 0];
    width_axis = info.w - info.padding / 2;
    height_axis = -info.h + orig[1] + info.padding;
    info.ctx.beginPath();
    info.ctx.fillStyle = this.font_color.to_rgba();
    info.ctx.font = this.font_size.get() * 0.8 + "px Arial";
    info.ctx.textAlign = 'center';
    info.ctx.textBaseline = 'top';
    value = [];
    posit = [];
    for (i = j = 0, ref = this.legend_x_division.get(); 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {
      pos = orig[0] + ((width_axis - decal_txt_X - (orig[0] - decal_txt_X)) / this.legend_x_division.get()) * i;
      vve = info.sc_2_rw.pos(pos, 0);
      val = vve[0];
      value.push(val);
      posit.push(pos);
    }
    ref1 = this.get_min_max_of_array(value), min = ref1[0], max = ref1[1];
    for (i = k = 0, ref2 = this.legend_x_division.get(); 0 <= ref2 ? k <= ref2 : k >= ref2; i = 0 <= ref2 ? ++k : --k) {
      nice_val = this.get_significative_number(value[i], [min, max]);
      info.ctx.fillText(nice_val, posit[i], orig[1] + x_padding_txt);
    }
    info.ctx.textBaseline = 'middle';
    info.ctx.textAlign = 'right';
    value = [];
    posit = [];
    for (i = l = 0, ref3 = this.legend_y_division.get(); 0 <= ref3 ? l <= ref3 : l >= ref3; i = 0 <= ref3 ? ++l : --l) {
      pos = orig[1] + ((height_axis + decal_txt_Y - (orig[1] + decal_txt_Y)) / this.legend_y_division.get()) * i;
      val_from_screen = info.sc_2_rw.pos(0, pos);
      val = val_from_screen[1];
      value.push(val);
      posit.push(pos);
    }
    ref4 = this.get_min_max_of_array(value), min = ref4[0], max = ref4[1];
    for (i = n = 0, ref5 = this.legend_y_division.get(); 0 <= ref5 ? n <= ref5 : n >= ref5; i = 0 <= ref5 ? ++n : --n) {
      nice_val = this.get_significative_number(value[i], [min, max]);
      info.ctx.fillText(nice_val, orig[0] - y_padding_txt, posit[i] + decal_txt_Y);
    }
    info.ctx.fill();
    return info.ctx.closePath();
  };

  Graph_old.prototype.get_min_max_of_array = function(array) {
    var el, j, k, len, len1, max, min;
    min = array[0];
    for (j = 0, len = array.length; j < len; j++) {
      el = array[j];
      if (el < min) {
        min = el;
      }
    }
    max = array[0];
    for (k = 0, len1 = array.length; k < len1; k++) {
      el = array[k];
      if (el > max) {
        max = el;
      }
    }
    return [min, max];
  };

  Graph_old.prototype.get_significative_number = function(val, arg) {
    var c, i, j, len, max, min, num, number, ref, res, size;
    min = arg[0], max = arg[1];
    size = Math.abs(max - min);
    if (size > 1) {
      res = Math.round(val);
      if (res.toString().length > 4) {
        res = res.toExponential();
      }
    } else {
      num = Math.round(val).toString().length;
      if (num <= 4) {
        res = val.toPrecision(num + 2);
        ref = val.toString();
        for (i = j = 0, len = ref.length; j < len; i = ++j) {
          c = ref[i];
          if (c !== "0" && c !== "." && c !== "-") {
            number = i;
            break;
          }
        }
        if (number > 3) {
          res = parseFloat(res).toExponential();
        }
      } else {
        res = val.toFixed(2);
      }
    }
    return res;
  };

  Graph_old.prototype.draw_grid = function(info) {
    var height_axis, i, j, k, orig, pos, ref, ref1, width_axis;
    orig = [0 + info.padding * 0.5, info.h - info.padding / 2, 0];
    width_axis = info.w - info.padding / 2;
    height_axis = -info.h + orig[1] + info.padding;
    info.ctx.beginPath();
    info.ctx.strokeStyle = this.grid_color.to_rgba();
    for (i = j = 1, ref = this.legend_x_division.get(); 1 <= ref ? j < ref : j > ref; i = 1 <= ref ? ++j : --j) {
      pos = orig[0] + ((width_axis - orig[0]) / this.legend_x_division.get()) * i;
      info.ctx.moveTo(pos, orig[1]);
      info.ctx.lineTo(pos, height_axis);
      info.ctx.stroke();
    }
    for (i = k = 1, ref1 = this.legend_y_division.get(); 1 <= ref1 ? k < ref1 : k > ref1; i = 1 <= ref1 ? ++k : --k) {
      pos = orig[1] + ((height_axis - orig[1]) / this.legend_y_division.get()) * i;
      info.ctx.moveTo(orig[0], pos);
      info.ctx.lineTo(orig[0] + info.w - info.padding, pos);
    }
    info.ctx.stroke();
    return info.ctx.closePath();
  };

  Graph_old.prototype.update_min_max = function(x_min, x_max) {
    var d, j, len, m, p, ref, results;
    ref = this.points;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      m = ref[j];
      p = m.pos.get();
      results.push((function() {
        var k, results1;
        results1 = [];
        for (d = k = 0; k < 3; d = ++k) {
          x_min[d] = Math.min(x_min[d], p[d]);
          results1.push(x_max[d] = Math.max(x_max[d], p[d]));
        }
        return results1;
      })());
    }
    return results;
  };

  Graph_old.prototype.on_mouse_move = function(cm, evt, pos, b, old) {
    var d, dx, dy, i, j, len, p, proj, ref, res, x, y;
    res = [];
    x = pos[0];
    y = pos[1];
    if (this.points.length) {
      ref = this.points;
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        p = ref[i];
        proj = cm.cam_info.re_2_sc.proj(p.pos.get());
        dx = x - proj[0];
        dy = y - proj[1];
        d = Math.sqrt(dx * dx + dy * dy);
        if (d <= this.marker_size.get() * 2) {
          res.push({
            item: p,
            dist: d
          });
        }
      }
    }
    if (res.length) {
      res.sort(function(a, b) {
        return b.dist - a.dist;
      });
      if (this._pre_sele.length !== 1 || this._pre_sele[0] !== res[0].item) {
        this._pre_sele.clear();
        this._pre_sele.push(res[0].item);
      }
    } else if (this._pre_sele.length) {
      this._pre_sele.clear();
    }
    return false;
  };

  return Graph_old;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var Transform,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Transform = (function(superClass) {
  extend(Transform, superClass);

  function Transform() {
    Transform.__super__.constructor.call(this);
    this.add_attr({
      cur_points: new Lst_Point,
      old_points: new Lst_Point,
      lock: true,
      _selected: new Lst,
      _pre_sele: new Lst
    });
  }

  Transform.prototype.z_index = function() {
    return 1000;
  };

  Transform.prototype.draw = function(info) {
    var _pre_sele, draw_point, item, j, k, l, len, len1, n, p, proj, ref, ref1, ref2, results, selected;
    draw_point = info.sel_item[this.model_id];
    if (this.cur_points.length && draw_point) {
      selected = {};
      ref = this._selected;
      for (j = 0, len = ref.length; j < len; j++) {
        item = ref[j];
        selected[item.model_id] = true;
      }
      _pre_sele = {};
      ref1 = this._pre_sele;
      for (k = 0, len1 = ref1.length; k < len1; k++) {
        item = ref1[k];
        _pre_sele[item.model_id] = true;
      }
      proj = (function() {
        var l, len2, ref2, results;
        ref2 = this.cur_points;
        results = [];
        for (l = 0, len2 = ref2.length; l < len2; l++) {
          p = ref2[l];
          results.push(info.re_2_sc.proj(p.pos.get()));
        }
        return results;
      }).call(this);
      results = [];
      for (n = l = 0, ref2 = proj.length; 0 <= ref2 ? l < ref2 : l > ref2; n = 0 <= ref2 ? ++l : --l) {
        info.ctx.lineWidth = 1;
        info.ctx.strokeStyle = "#333311";
        info.ctx.fillStyle = "#333311";
        p = proj[n];
        if (selected[this.cur_points[n].model_id] != null) {
          info.ctx.strokeStyle = "#FF0000";
        } else {
          info.ctx.strokeStyle = "#FFFF00";
        }
        info.ctx.beginPath();
        info.ctx.arc(p[0], p[1], 4, 0, Math.PI * 2, true);
        info.ctx.closePath();
        info.ctx.fill();
        info.ctx.stroke();
        if (_pre_sele[this.cur_points[n].model_id] != null) {
          info.ctx.fillStyle = "#FFFF22";
          info.ctx.beginPath();
          info.ctx.lineWidth = 0.8;
          info.ctx.arc(p[0], p[1], 3, 0, Math.PI * 2, true);
          info.ctx.fill();
          results.push(info.ctx.closePath());
        } else {
          results.push(void 0);
        }
      }
      return results;
    }
  };

  Transform.prototype.get_movable_entities = function(res, info, pos, phase) {
    var d, draw_point, dx, dy, i, j, len, p, proj, ref, ref1, results, x, y;
    draw_point = info.sel_item[this.model_id];
    if (this.cur_points.length && draw_point) {
      x = pos[0];
      y = pos[1];
      if (phase === 0) {
        ref = this.cur_points;
        results = [];
        for (i = j = 0, len = ref.length; j < len; i = ++j) {
          p = ref[i];
          proj = info.re_2_sc.proj(p.pos.get());
          dx = x - proj[0];
          dy = y - proj[1];
          d = Math.sqrt(dx * dx + dy * dy);
          if (d <= 10) {
            res.push({
              item: p,
              dist: d,
              type: "Transform"
            });
            if (((ref1 = this.lock) != null ? ref1.get() : void 0) === false) {
              results.push(res.push({
                item: this.old_points[i],
                dist: d,
                type: "Transform"
              }));
            } else {
              results.push(void 0);
            }
          } else {
            results.push(void 0);
          }
        }
        return results;
      }
    }
  };

  Transform.prototype.on_mouse_down = function(cm, evt, pos, b) {
    var j, phase, res;
    delete this._movable_entity;
    if (b === "LEFT" || b === "RIGHT") {
      for (phase = j = 0; j < 3; phase = ++j) {
        res = [];
        this.get_movable_entities(res, cm.cam_info, pos, phase);
        if (res.length) {
          res.sort(function(a, b) {
            return b.dist - a.dist;
          });
          this._movable_entity = res[0].item;
          if (evt.ctrlKey) {
            this._selected.toggle_ref(this._movable_entity);
            if (!this._selected.contains_ref(this._movable_entity)) {
              delete this._movable_entity;
            }
          } else {
            this._selected.clear();
            this._selected.push(this._movable_entity);
            this._movable_entity.beg_click(pos);
          }
          if (b === "RIGHT") {
            return false;
          }
          return true;
        }
      }
    }
    return false;
  };

  Transform.prototype.on_mouse_move = function(cm, evt, pos, b, old) {
    var d, d_0, dx, dy, i, j, len, p, p_0, proj, ref, ref1, res, x, y;
    if (b === "LEFT" && (this._movable_entity != null)) {
      if ((ref = cm.undo_manager) != null) {
        ref.snapshot();
      }
      p_0 = cm.cam_info.sc_2_rw.pos(pos[0], pos[1]);
      d_0 = cm.cam_info.sc_2_rw.dir(pos[0], pos[1]);
      this._movable_entity.move(this._selected, this._movable_entity.pos, p_0, d_0);
      return true;
    }
    res = [];
    x = pos[0];
    y = pos[1];
    if (this.cur_points.length) {
      ref1 = this.cur_points;
      for (i = j = 0, len = ref1.length; j < len; i = ++j) {
        p = ref1[i];
        proj = cm.cam_info.re_2_sc.proj(p.pos.get());
        dx = x - proj[0];
        dy = y - proj[1];
        d = Math.sqrt(dx * dx + dy * dy);
        if (d <= 10) {
          res.push({
            item: p,
            dist: d
          });
        }
      }
    }
    if (res.length) {
      res.sort(function(a, b) {
        return b.dist - a.dist;
      });
      if (this._pre_sele.length !== 1 || this._pre_sele[0] !== res[0].item) {
        this._pre_sele.clear();
        this._pre_sele.push(res[0].item);
      }
    } else if (this._pre_sele.length) {
      this._pre_sele.clear();
    }
    return false;
  };

  return Transform;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var Graph,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

Graph = (function(superClass) {
  extend(Graph, superClass);

  function Graph(params) {
    var key, ref, val;
    if (params == null) {
      params = {};
    }
    Graph.__super__.constructor.call(this);
    this.add_attr({
      show_line: true,
      line_color: new Color(0, 0, 0),
      line_width: new ConstrainedVal(1, {
        min: 0,
        max: 20
      }),
      shadow: true,
      show_marker: true,
      marker: new Choice(0, ["dot", "square", "cross", "diamond", "bar"]),
      marker_size: new ConstrainedVal(5, {
        min: 0,
        max: 40
      }),
      marker_color: new Color(0, 0, 0),
      font_color: new Color(0, 0, 0),
      font_size: new ConstrainedVal(12, {
        min: 2,
        max: 72
      }),
      show_grid: true,
      grid_color: new Color(200, 200, 200),
      x_axis: '',
      y_axis: '',
      legend_x_division: 5,
      legend_y_division: 3,
      sel_item_color: new Color(255, 255, 0),
      movable_hl_infos: true,
      points: new Lst_Point,
      legend: new Lst,
      _pre_sele: new Lst
    });
    for (key in params) {
      val = params[key];
      if ((ref = this[key]) != null) {
        if (typeof ref.set === "function") {
          ref.set(val);
        }
      }
    }
    this.axis_width = 1;
    this.origin = [0, 0];
    this.O_point = [0, 0];
    this.X_point = [0, 0];
    this.Y_point = [0, 0];
  }

  Graph.prototype.z_index = function() {
    return 100;
  };

  Graph.prototype.build_w2b_legend = function() {
    var color, i, j, results;
    results = [];
    for (i = j = 0; j <= 255; i = ++j) {
      color = (i < 16 ? '0' : '') + i.toString(16);
      results.push(this.legend[i] = "#" + color + color + color);
    }
    return results;
  };

  Graph.prototype.draw = function(info) {
    var orig, p, proj;
    this.O_point = [info.padding / 2, info.h - info.padding];
    this.X_point = [info.w - info.padding / 2, info.h - info.padding];
    this.Y_point = [info.padding / 2, -info.h + info.padding];
    info.ctx_2d().lineCap = "round";
    info.ctx_2d().lineJoin = "round";
    info.ctx_2d().shadowOffsetX = 0;
    info.ctx_2d().shadowOffsetY = 0;
    info.ctx_2d().shadowBlur = 0;
    info.ctx_2d().shadowColor = "transparent black";
    if (this.points.length) {
      orig = info.re_2_sc.proj([0, 0, 0]);
      proj = (function() {
        var j, len, ref, results;
        ref = this.points;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          p = ref[j];
          results.push(info.re_2_sc.proj(p.pos.get()));
        }
        return results;
      }).call(this);
      if (this.show_grid.get() === true) {
        this.draw_grid(info);
      }
      if (this.shadow.get() === true) {
        this.add_shadow(info);
      } else {
        this.remove_shadow(info);
      }
      if (this.show_line.get() === true) {
        this.draw_line(info, orig, proj);
      }
      if (this.show_marker.get() === true) {
        if (this.marker.get() === 'bar') {
          this.draw_marker_bar(info, orig, proj);
        } else if (this.marker.get() === 'cross') {
          this.draw_marker_cross(info, orig, proj);
        } else if (this.marker.get() === 'square') {
          this.draw_marker_square(info, orig, proj);
        } else if (this.marker.get() === 'diamond') {
          this.draw_marker_diamond(info, orig, proj);
        } else if (this.marker.get() === 'dot') {
          this.draw_marker_dot(info, orig, proj);
        }
      }
      this.remove_shadow(info);
      if (this.show_marker.get() === true) {
        if (this.movable_hl_infos.get() === true) {
          this.draw_movable_highlight_values(info);
        } else {
          this.draw_highlight_values(info);
        }
      }
    }
    this.hide_outside_values(info);
    this.draw_axis(info);
    return this.draw_legend(info);
  };

  Graph.prototype.add_shadow = function(info) {
    info.ctx_2d().shadowOffsetX = this.line_width.get();
    info.ctx_2d().shadowOffsetY = this.line_width.get();
    info.ctx_2d().shadowBlur = this.line_width.get();
    return info.ctx_2d().shadowColor = "#3a3a3a";
  };

  Graph.prototype.remove_shadow = function(info) {
    info.ctx_2d().shadowOffsetX = 0;
    info.ctx_2d().shadowOffsetY = 0;
    info.ctx_2d().shadowBlur = 0;
    return info.ctx_2d().shadowColor = "transparent black";
  };

  Graph.prototype.hide_outside_values = function(info) {
    info.ctx_2d().fillStyle = "rgba( 255, 255, 255, 0.9 )";
    info.ctx_2d().clearRect(0, 0, info.padding * 0.5, info.h);
    return info.ctx_2d().clearRect(info.padding * 0.5, info.h - info.padding / 2, info.w, info.padding * 0.5);
  };

  Graph.prototype.draw_movable_highlight_values = function(info) {
    var decal_left, decal_top, height_box, highlighted_point, i, j, len, p, padding_left, padding_top, pos, ref, ref1, results, text, width_box;
    padding_left = 10;
    padding_top = -8;
    decal_left = 10;
    decal_top = -12;
    ref = this.points;
    results = [];
    for (i = j = 0, len = ref.length; j < len; i = ++j) {
      p = ref[i];
      if (ref1 = this.points[i], indexOf.call(this._pre_sele, ref1) >= 0) {
        highlighted_point = p.pos.get();
        info.ctx_2d().beginPath();
        pos = info.re_2_sc.proj(highlighted_point);
        text = highlighted_point[0] + ", " + highlighted_point[1];
        info.ctx_2d().font = this.font_size.get() * 2 + "px Arial";
        width_box = info.ctx_2d().measureText(text).width + padding_left * 2;
        height_box = this.font_size.get() * 3;
        info.ctx_2d().fillStyle = "rgba(255, 255, 255, 0.8)";
        info.ctx_2d().fillRect(pos[0] + decal_left, pos[1] + decal_top - height_box * 0.8, width_box, height_box);
        info.ctx_2d().lineWidth = 1;
        info.ctx_2d().strokeStyle = "rgba(0, 0, 0, 0.8)";
        info.ctx_2d().strokeRect(pos[0] + decal_left, pos[1] + decal_top - height_box * 0.8, width_box, height_box);
        info.ctx_2d().textAlign = "left";
        info.ctx_2d().fillStyle = this.font_color.to_rgba();
        results.push(info.ctx_2d().fillText(text, pos[0] + padding_left + decal_left, pos[1] + padding_top + decal_top));
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  Graph.prototype.draw_highlight_values = function(info) {
    var highlighted_point, i, j, len, p, padding, ref, ref1, results;
    padding = 10;
    ref = this.points;
    results = [];
    for (i = j = 0, len = ref.length; j < len; i = ++j) {
      p = ref[i];
      if (ref1 = this.points[i], indexOf.call(this._pre_sele, ref1) >= 0) {
        highlighted_point = p.pos.get();
        info.ctx_2d().beginPath();
        info.ctx_2d().fillStyle = this.font_color.to_rgba();
        info.ctx_2d().textAlign = "right";
        info.ctx_2d().font = this.font_size.get() * 2 + "px Arial";
        results.push(info.ctx_2d().fillText(highlighted_point[0] + ", " + highlighted_point[1], info.w - padding, 20));
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  Graph.prototype.draw_line = function(info, orig, proj) {
    var i, j, len, p;
    info.ctx_2d().beginPath();
    info.ctx_2d().strokeStyle = this.line_color.to_rgba();
    if (this.line_width.get() <= 1) {
      info.ctx_2d().lineWidth = 1.000001;
    } else {
      info.ctx_2d().lineWidth = this.line_width.get();
    }
    for (i = j = 0, len = proj.length; j < len; i = ++j) {
      p = proj[i];
      info.ctx_2d().lineTo(p[0], p[1]);
    }
    info.ctx_2d().stroke();
    return info.ctx_2d().closePath();
  };

  Graph.prototype.draw_marker_dot = function(info, orig, proj) {
    var i, j, len, p, ref;
    for (i = j = 0, len = proj.length; j < len; i = ++j) {
      p = proj[i];
      if (ref = this.points[i], indexOf.call(this._pre_sele, ref) >= 0) {
        info.ctx_2d().fillStyle = this.sel_item_color.to_rgba();
      } else {
        info.ctx_2d().fillStyle = this.legend[i] || this.marker_color.to_rgba();
      }
      info.ctx_2d().beginPath();
      info.ctx_2d().arc(p[0], p[1], this.marker_size.get() * 0.5, 0, Math.PI * 2, true);
      info.ctx_2d().fill();
    }
    return info.ctx_2d().closePath();
  };

  Graph.prototype.draw_marker_cross = function(info, orig, proj) {
    var i, j, len, p, ref;
    for (i = j = 0, len = proj.length; j < len; i = ++j) {
      p = proj[i];
      if (ref = this.points[i], indexOf.call(this._pre_sele, ref) >= 0) {
        info.ctx_2d().strokeStyle = this.sel_item_color.to_rgba();
      } else {
        info.ctx_2d().strokeStyle = this.legend[i] || this.marker_color.to_rgba();
      }
      info.ctx_2d().beginPath();
      info.ctx_2d().moveTo(p[0] - this.marker_size.get() * 0.5, p[1] + this.marker_size.get() * 0.5);
      info.ctx_2d().lineTo(p[0] + this.marker_size.get() * 0.5, p[1] - this.marker_size.get() * 0.5);
      info.ctx_2d().moveTo(p[0] + this.marker_size.get() * 0.5, p[1] + this.marker_size.get() * 0.5);
      info.ctx_2d().lineTo(p[0] - this.marker_size.get() * 0.5, p[1] - this.marker_size.get() * 0.5);
      info.ctx_2d().stroke();
    }
    return info.ctx_2d().closePath();
  };

  Graph.prototype.draw_marker_square = function(info, orig, proj) {
    var i, j, len, p, ref;
    for (i = j = 0, len = proj.length; j < len; i = ++j) {
      p = proj[i];
      if (ref = this.points[i], indexOf.call(this._pre_sele, ref) >= 0) {
        info.ctx_2d().fillStyle = this.sel_item_color.to_rgba();
      } else {
        info.ctx_2d().fillStyle = this.legend[i] || this.marker_color.to_rgba();
      }
      info.ctx_2d().beginPath();
      info.ctx_2d().fillRect(p[0] - this.marker_size.get() * 0.5, p[1] - this.marker_size.get() * 0.5, this.marker_size.get(), this.marker_size.get());
    }
    return info.ctx_2d().closePath();
  };

  Graph.prototype.draw_marker_diamond = function(info, orig, proj) {
    var i, j, len, p, ref;
    for (i = j = 0, len = proj.length; j < len; i = ++j) {
      p = proj[i];
      if (ref = this.points[i], indexOf.call(this._pre_sele, ref) >= 0) {
        info.ctx_2d().fillStyle = this.sel_item_color.to_rgba();
      } else {
        info.ctx_2d().fillStyle = this.legend[i] || this.marker_color.to_rgba();
      }
      info.ctx_2d().beginPath();
      info.ctx_2d().moveTo(p[0], p[1] - this.marker_size.get());
      info.ctx_2d().lineTo(p[0] + this.marker_size.get() * 0.5, p[1]);
      info.ctx_2d().lineTo(p[0], p[1] + this.marker_size.get());
      info.ctx_2d().lineTo(p[0] - +this.marker_size.get() * 0.5, p[1]);
      info.ctx_2d().fill();
    }
    return info.ctx_2d().closePath();
  };

  Graph.prototype.draw_marker_bar = function(info, orig, proj) {
    var height, i, j, len, p, ref;
    for (i = j = 0, len = proj.length; j < len; i = ++j) {
      p = proj[i];
      if (ref = this.points[i], indexOf.call(this._pre_sele, ref) >= 0) {
        info.ctx_2d().fillStyle = this.sel_item_color.to_rgba();
      } else {
        info.ctx_2d().fillStyle = this.legend[i] || this.marker_color.to_rgba();
      }
      height = orig[1] - p[1];
      info.ctx_2d().beginPath();
      info.ctx_2d().fillRect(p[0], p[1], this.marker_size.get(), height);
    }
    return info.ctx_2d().closePath();
  };

  Graph.prototype.draw_axis = function(info) {
    var decal_txt, height_axis, orig, width_axis;
    orig = [info.padding * 0.5, info.h - info.padding / 2, 0];
    width_axis = info.w - info.padding;
    height_axis = -info.h + orig[1] + info.padding;
    info.ctx_2d().beginPath();
    info.ctx_2d().lineWidth = this.axis_width;
    info.ctx_2d().strokeStyle = this.font_color.to_rgba();
    info.ctx_2d().fillStyle = this.font_color.to_rgba();
    info.ctx_2d().font = this.font_size.get() + "px Arial";
    decal_txt = 10;
    if (this.x_axis.get() !== "") {
      info.ctx_2d().textAlign = "left";
      info.ctx_2d().fillText(this.x_axis.get(), orig[0] + width_axis + decal_txt, orig[1] + 2);
    }
    info.ctx_2d().moveTo(orig[0], orig[1]);
    info.ctx_2d().lineTo(orig[0] + width_axis, orig[1]);
    if (this.y_axis.get() !== "") {
      info.ctx_2d().textBaseline = "bottom";
      info.ctx_2d().textAlign = "center";
      info.ctx_2d().fillText(this.y_axis.get(), orig[0] - 2, height_axis - decal_txt);
    }
    info.ctx_2d().moveTo(orig[0], orig[1]);
    info.ctx_2d().lineTo(orig[0], height_axis);
    info.ctx_2d().stroke();
    info.ctx_2d().closePath();
    return info.ctx_2d().textBaseline = "middle";
  };

  Graph.prototype.draw_legend = function(info) {
    var decal_txt_X, decal_txt_Y, height_axis, i, j, k, l, max, min, n, nice_val, orig, pos, posit, ref, ref1, ref2, ref3, ref4, ref5, val, val_from_screen, value, vve, width_axis, x_padding_txt, y_padding_txt;
    x_padding_txt = 10;
    y_padding_txt = 2;
    decal_txt_X = 3;
    decal_txt_Y = 1;
    orig = [0 + info.padding * 0.5, info.h - info.padding / 2, 0];
    width_axis = info.w - info.padding / 2;
    height_axis = -info.h + orig[1] + info.padding;
    info.ctx_2d().beginPath();
    info.ctx_2d().fillStyle = this.font_color.to_rgba();
    info.ctx_2d().font = this.font_size.get() * 0.8 + "px Arial";
    info.ctx_2d().textAlign = 'center';
    info.ctx_2d().textBaseline = 'top';
    value = [];
    posit = [];
    for (i = j = 0, ref = this.legend_x_division.get(); 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {
      pos = orig[0] + ((width_axis - decal_txt_X - (orig[0] - decal_txt_X)) / this.legend_x_division.get()) * i;
      vve = info.sc_2_rw.pos(pos, 0);
      val = vve[0];
      value.push(val);
      posit.push(pos);
    }
    ref1 = this.get_min_max_of_array(value), min = ref1[0], max = ref1[1];
    for (i = k = 0, ref2 = this.legend_x_division.get(); 0 <= ref2 ? k <= ref2 : k >= ref2; i = 0 <= ref2 ? ++k : --k) {
      nice_val = this.get_significative_number(value[i], [min, max]);
      info.ctx_2d().fillText(nice_val, posit[i], orig[1] + x_padding_txt);
    }
    info.ctx_2d().textBaseline = 'middle';
    info.ctx_2d().textAlign = 'right';
    value = [];
    posit = [];
    for (i = l = 0, ref3 = this.legend_y_division.get(); 0 <= ref3 ? l <= ref3 : l >= ref3; i = 0 <= ref3 ? ++l : --l) {
      pos = orig[1] + ((height_axis + decal_txt_Y - (orig[1] + decal_txt_Y)) / this.legend_y_division.get()) * i;
      val_from_screen = info.sc_2_rw.pos(0, pos);
      val = val_from_screen[1];
      value.push(val);
      posit.push(pos);
    }
    ref4 = this.get_min_max_of_array(value), min = ref4[0], max = ref4[1];
    for (i = n = 0, ref5 = this.legend_y_division.get(); 0 <= ref5 ? n <= ref5 : n >= ref5; i = 0 <= ref5 ? ++n : --n) {
      nice_val = this.get_significative_number(value[i], [min, max]);
      info.ctx_2d().fillText(nice_val, orig[0] - y_padding_txt, posit[i] + decal_txt_Y);
    }
    info.ctx_2d().fill();
    return info.ctx_2d().closePath();
  };

  Graph.prototype.get_min_max_of_array = function(array) {
    var el, j, k, len, len1, max, min;
    min = array[0];
    for (j = 0, len = array.length; j < len; j++) {
      el = array[j];
      if (el < min) {
        min = el;
      }
    }
    max = array[0];
    for (k = 0, len1 = array.length; k < len1; k++) {
      el = array[k];
      if (el > max) {
        max = el;
      }
    }
    return [min, max];
  };

  Graph.prototype.get_significative_number = function(val, arg) {
    var c, i, j, len, max, min, num, number, ref, res, size;
    min = arg[0], max = arg[1];
    size = Math.abs(max - min);
    if (size > 1) {
      res = Math.round(val);
      if (res.toString().length > 4) {
        res = res.toExponential();
      }
    } else {
      num = Math.round(val).toString().length;
      if (num <= 4) {
        res = val.toPrecision(num + 2);
        ref = val.toString();
        for (i = j = 0, len = ref.length; j < len; i = ++j) {
          c = ref[i];
          if (c !== "0" && c !== "." && c !== "-") {
            number = i;
            break;
          }
        }
        if (number > 3) {
          res = parseFloat(res).toExponential();
        }
      } else {
        res = val.toFixed(2);
      }
    }
    return res;
  };

  Graph.prototype.draw_grid = function(info) {
    var height_axis, i, j, k, orig, pos, ref, ref1, width_axis;
    orig = [0 + info.padding * 0.5, info.h - info.padding / 2, 0];
    width_axis = info.w - info.padding / 2;
    height_axis = -info.h + orig[1] + info.padding;
    info.ctx_2d().beginPath();
    info.ctx_2d().strokeStyle = this.grid_color.to_rgba();
    for (i = j = 1, ref = this.legend_x_division.get(); 1 <= ref ? j < ref : j > ref; i = 1 <= ref ? ++j : --j) {
      pos = orig[0] + ((width_axis - orig[0]) / this.legend_x_division.get()) * i;
      info.ctx_2d().moveTo(pos, orig[1]);
      info.ctx_2d().lineTo(pos, height_axis);
      info.ctx_2d().stroke();
    }
    for (i = k = 1, ref1 = this.legend_y_division.get(); 1 <= ref1 ? k < ref1 : k > ref1; i = 1 <= ref1 ? ++k : --k) {
      pos = orig[1] + ((height_axis - orig[1]) / this.legend_y_division.get()) * i;
      info.ctx_2d().moveTo(orig[0], pos);
      info.ctx_2d().lineTo(orig[0] + info.w - info.padding, pos);
    }
    info.ctx_2d().stroke();
    return info.ctx_2d().closePath();
  };

  Graph.prototype.update_min_max = function(x_min, x_max) {
    var d, j, len, m, p, ref, results;
    ref = this.points;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      m = ref[j];
      p = m.pos.get();
      results.push((function() {
        var k, results1;
        results1 = [];
        for (d = k = 0; k < 3; d = ++k) {
          x_min[d] = Math.min(x_min[d], p[d]);
          results1.push(x_max[d] = Math.max(x_max[d], p[d]));
        }
        return results1;
      })());
    }
    return results;
  };

  Graph.prototype.on_mouse_move = function(cm, evt, pos, b, old) {
    var d, dx, dy, i, j, len, p, proj, ref, res, x, y;
    res = [];
    x = pos[0];
    y = pos[1];
    if (this.points.length) {
      ref = this.points;
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        p = ref[i];
        proj = cm.cam_info.re_2_sc.proj(p.pos.get());
        dx = x - proj[0];
        dy = y - proj[1];
        d = Math.sqrt(dx * dx + dy * dy);
        if (d <= this.marker_size.get() * 2) {
          res.push({
            item: p,
            dist: d
          });
        }
      }
    }
    if (res.length) {
      res.sort(function(a, b) {
        return b.dist - a.dist;
      });
      if (this._pre_sele.length !== 1 || this._pre_sele[0] !== res[0].item) {
        this._pre_sele.clear();
        this._pre_sele.push(res[0].item);
      }
    } else if (this._pre_sele.length) {
      this._pre_sele.clear();
    }
    return false;
  };

  return Graph;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var CanvasPoint,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

CanvasPoint = (function(superClass) {
  extend(CanvasPoint, superClass);

  function CanvasPoint(pos, params) {
    if (pos == null) {
      pos = [0, 0, 0];
    }
    if (params == null) {
      params = {};
    }
    CanvasPoint.__super__.constructor.call(this);
    this.add_attr({
      name: "Point",
      point: new Point(pos),
      radius: new ConstrainedVal(6, {
        min: 1,
        max: 20
      }),
      color: params.color != null ? params.color : new Color(255, 255, 255, 255),
      _edge_color: params.edge_color != null ? params.edge_color : new Color(0, 0, 0, 255)
    });
    if (params.radius != null) {
      this.radius.set(params.radius);
    }
  }

  CanvasPoint.prototype.z_index = function() {
    return 1000;
  };

  CanvasPoint.prototype.draw = function(info) {
    var points, proj;
    if (info.ctx_type === 'gl') {
      points = new PointTheme(this.color, this.radius.get(), this._edge_color, 1);
      proj = info.re_2_sc.proj(this.point.pos.get());
      points.beg_ctx(info);
      points.draw_proj(info, proj);
      return points.end_ctx(info);
    } else {
      proj = info.re_2_sc.proj(this.point.pos.get());
      info.ctx.lineWidth = 1;
      info.ctx.strokeStyle = "#993311";
      info.ctx.fillStyle = "#553311";
      info.ctx.strokeStyle = "#FF0000";
      info.ctx.strokeStyle = "#FFFF00";
      info.ctx.beginPath();
      info.ctx.arc(proj[0], proj[1], this.radius.get(), 0, Math.PI * 2, true);
      info.ctx.closePath();
      info.ctx.fill();
      return info.ctx.stroke();
    }
  };

  return CanvasPoint;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var ZoomArea,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ZoomArea = (function(superClass) {
  extend(ZoomArea, superClass);

  function ZoomArea(canvas_manager, params) {
    var key, ref, val;
    this.canvas_manager = canvas_manager;
    if (params == null) {
      params = {};
    }
    ZoomArea.__super__.constructor.call(this);
    this.add_attr({
      zoom_factor: [5, 5, 1],
      zoom_pos: [-1, -1, 0]
    });
    for (key in params) {
      val = params[key];
      if ((ref = this[key]) != null) {
        if (typeof ref.set === "function") {
          ref.set(val);
        }
      }
    }
  }

  ZoomArea.prototype.z_index = function() {
    return 1000;
  };

  ZoomArea.prototype.always_active = function() {
    return true;
  };

  ZoomArea.prototype.on_mouse_move = function(cm, evt, pos, b) {
    this.zoom_pos[0].set(pos[0]);
    this.zoom_pos[1].set(pos[1]);
    return false;
  };

  ZoomArea.prototype.on_mouse_wheel = function(cm, evt, pos, b, delta) {
    var n;
    n = Math.pow(1.2, delta);
    this.zoom_factor[0].set(this.zoom_factor[0] * n);
    this.zoom_factor[1].set(this.zoom_factor[1] * n);
    return true;
  };

  ZoomArea.prototype.draw = function(info) {
    var clientX, clientY, i, it, key, len, n_info, ref, val, zx, zy;
    clientX = this.zoom_pos[0].get();
    clientY = this.zoom_pos[1].get();
    zx = this.zoom_factor[0].get();
    zy = this.zoom_factor[1].get();
    n_info = {};
    for (key in info) {
      val = info[key];
      n_info[key] = val;
    }
    n_info.re_2_sc = {
      proj: function(p) {
        var np;
        np = info.re_2_sc.proj(p);
        return [zx * (np[0] - clientX) + clientX, zy * (np[1] - clientY) + clientY, p[2]];
      }
    };
    info.ctx.save();
    info.ctx.beginPath();
    info.ctx.strokeStyle = 'rgba(170,170,200,0.8)';
    info.ctx.shadowBlur = 5;
    info.ctx.shadowColor = "lightBlue";
    info.ctx.lineWidth = 4;
    info.ctx.arc(clientX, clientY, 100, 0, Math.PI * 2, true);
    info.ctx.stroke();
    info.ctx.shadowBlur = 0;
    info.ctx.shadowColor = "transparent black";
    info.ctx.fillStyle = "lightBlue";
    info.ctx.font = "10px Arial";
    info.ctx.textBaseline = 'bottom';
    info.ctx.textAlign = 'left';
    info.ctx.fillText("X " + this.zoom_factor[0].get().toFixed(1), clientX + 75, clientY - 75);
    info.ctx.closePath();
    info.ctx.clip();
    ref = this.canvas_manager._flat;
    for (i = 0, len = ref.length; i < len; i++) {
      it = ref[i];
      if (it !== this && !(it instanceof Axes)) {
        it.draw(n_info);
      }
    }
    return info.ctx.restore();
  };

  return ZoomArea;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var Mesh,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Mesh = (function(superClass) {
  extend(Mesh, superClass);

  function Mesh(params) {
    if (params == null) {
      params = {};
    }
    Mesh.__super__.constructor.call(this);
    this.add_attr({
      _theme: new Theme,
      _color_selection: params.color_selection ? true : void 0
    });
    this.add_attr({
      visualization: {
        display_style: new Choice(3, ["Points", "Wireframe", "Surface", "Surface with Edges"]),
        point_edition: (!params.not_editable ? true : void 0),
        element_color: this._theme.surfaces.color,
        line_color: this._theme.lines.color
      },
      points: [],
      _elements: [],
      _selected_points: [],
      _pelected_points: [],
      _selected_elements: [],
      _pelected_elements: [],
      original_index: []
    });
    this.move_scheme = MoveScheme_3D;
    this._sub_elements = [];
    this._sub_date = -1;
    this.delete_selected_points_callback = [];
  }

  Mesh.prototype.add_point = function(pos) {
    var ind;
    if (pos == null) {
      pos = [0, 0, 0];
    }
    if (!this.points[0]) {
      this.points.push(new TypedArray_Float64([3, 0]));
    }
    ind = this.points[0].size(1) + 1;
    this.points[0].resize([3, ind]);
    this.points[0].set_val([0, ind - 1], pos[0]);
    this.points[0].set_val([1, ind - 1], pos[1]);
    return this.points[0].set_val([2, ind - 1], pos[2]);
  };

  Mesh.prototype.set_point = function(indice, pos) {
    if (pos == null) {
      pos = [0, 0, 0];
    }
    this.points[0].set_val([0, indice], pos[0]);
    this.points[0].set_val([1, indice], pos[1]);
    return this.points[0].set_val([2, indice], pos[2]);
  };

  Mesh.prototype.get_point = function(indice) {
    return [this.points[0].get([0, indice]), this.points[0].get([1, indice]), this.points[0].get([2, indice])];
  };

  Mesh.prototype.add_element = function(element) {
    return this._elements.push(element);
  };

  Mesh.prototype.bounding_coordinates = function() {
    var bc, i, k, m, p, p0, ref;
    for (i = k = 0, ref = this.points[0].size(1); 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
      if (!bc) {
        p0 = this.get_point(i);
        bc = [[p0[0], p0[0]], [p0[1], p0[1]], [p0[2], p0[2]]];
      } else {
        p = this.get_point(i);
        for (i = m = 0; m <= 2; i = ++m) {
          if (p[i] > bc[i][0]) {
            bc[i][0] = p[i];
          } else if (p[i] < bc[i][1]) {
            bc[i][1] = p[i];
          }
        }
      }
    }
    return bc;
  };

  Mesh.prototype.nb_points = function() {
    var ref;
    return (ref = this.points[0]) != null ? ref.size(1) : void 0;
  };

  Mesh.prototype.nb_elements = function() {
    var el, k, len, ref, res;
    res = 0;
    ref = this._elements;
    for (k = 0, len = ref.length; k < len; k++) {
      el = ref[k];
      if (typeof el.indices.size(1) === "number") {
        res += el.indices.size(1);
      }
    }
    return res;
  };

  Mesh.prototype.real_change = function() {
    var a, k, len, ref;
    ref = [this.points, this._elements];
    for (k = 0, len = ref.length; k < len; k++) {
      a = ref[k];
      if (a.real_change()) {
        return true;
      }
    }
    return false;
  };

  Mesh.prototype.z_index = function() {
    return 1000;
  };

  Mesh.prototype.clear = function() {
    this.points.clear();
    return this._elements.clear();
  };

  Mesh.prototype.add_theme_if_undef = function() {
    if (this._theme == null) {
      return this.add_attr({
        _theme: new Theme
      });
    }
  };

  Mesh.prototype.draw_selected = function(info) {
    this._theme.lines.color.r.set(0);
    this._theme.lines.color.b.set(0);
    return this.draw(info);
  };

  Mesh.prototype.draw_unselected = function(info) {
    this._theme = new Theme;
    return this.draw(info);
  };

  Mesh.prototype.draw = function(info) {
    var draw_points, el, i, i1, j1, k, k1, len, len1, len10, len11, len12, len13, len14, len15, len2, len3, len4, len5, len6, len7, len8, len9, m, n, o, p, proj, q, r, ref, ref1, ref10, ref11, ref12, ref13, ref14, ref2, ref3, ref4, ref5, ref6, ref7, ref8, ref9, results, s, t, u, v, w, x, y, z;
    this.add_theme_if_undef();
    if (info.ctx_type === 'gl') {
      ref = this._elements;
      for (k = 0, len = ref.length; k < len; k++) {
        el = ref[k];
        el.draw_gl(info, this, this.points);
      }
      draw_points = false;
      proj = (function() {
        var m, ref1, ref2, results;
        results = [];
        for (i = m = 0, ref1 = (ref2 = this.points[0]) != null ? ref2.size(1) : void 0; 0 <= ref1 ? m < ref1 : m > ref1; i = 0 <= ref1 ? ++m : --m) {
          results.push(info.re_2_sc.proj(this.get_point(i)));
        }
        return results;
      }).call(this);
      if (((ref1 = this.visualization.point_edition) != null ? ref1.get() : void 0) && (info.sel_item[this.model_id] != null)) {
        this._theme.editable_points.beg_ctx(info);
        for (m = 0, len1 = proj.length; m < len1; m++) {
          p = proj[m];
          this._theme.points.draw_proj(info, p);
        }
        this._theme.editable_points.end_ctx(info);
        if (this._selected_points.length) {
          this._theme.selected_points.beg_ctx(info);
          ref2 = this._selected_points;
          for (o = 0, len2 = ref2.length; o < len2; o++) {
            p = ref2[o];
            if (!(p instanceof Point)) {
              continue;
            }
            n = info.re_2_sc.proj(p.pos.get());
            this._theme.selected_points.draw_proj(info, n);
          }
          this._theme.selected_points.end_ctx(info);
        }
        if (this._pelected_points.length) {
          this._theme.highlighted_points.beg_ctx(info);
          ref3 = this._pelected_points;
          for (q = 0, len3 = ref3.length; q < len3; q++) {
            p = ref3[q];
            if (!(p instanceof Point)) {
              continue;
            }
            n = info.re_2_sc.proj(p.pos.get());
            this._theme.highlighted_points.draw_proj(info, n);
          }
          this._theme.highlighted_points.end_ctx(info);
        }
      } else if (this.visualization.display_style.equals("Points")) {
        this._theme.points.beg_ctx(info);
        for (r = 0, len4 = proj.length; r < len4; r++) {
          p = proj[r];
          this._theme.points.draw_proj(info, p);
        }
        this._theme.points.end_ctx(info);
      }
      this._update_sub_elements();
      ref4 = this._sub_elements;
      for (s = 0, len5 = ref4.length; s < len5; s++) {
        el = ref4[s];
        el.draw_gl(info, this, this.points, true);
      }
      if (this._selected_elements.length) {
        ref5 = this._pelected_points;
        for (t = 0, len6 = ref5.length; t < len6; t++) {
          el = ref5[t];
          el.draw_gl(info, this, this.points, true, this._theme.selected_elements);
        }
      }
      if (this._pelected_elements.length) {
        ref6 = this._pelected_elements;
        for (u = 0, len7 = ref6.length; u < len7; u++) {
          el = ref6[u];
          el.draw_gl(info, this, this.points, true, this._theme.highlighted_elements);
        }
      }
      return true;
    } else if ((ref7 = this.points) != null ? ref7.length : void 0) {
      proj = (function() {
        var len8, ref8, results, v;
        ref8 = this.points;
        results = [];
        for (i = v = 0, len8 = ref8.length; v < len8; i = ++v) {
          p = ref8[i];
          results.push(info.re_2_sc.proj(p.pos.get()));
        }
        return results;
      }).call(this);
      ref8 = this._elements;
      for (v = 0, len8 = ref8.length; v < len8; v++) {
        el = ref8[v];
        el.draw(info, this, proj);
      }
      draw_points = false;
      if (((ref9 = this.visualization.point_edition) != null ? ref9.get() : void 0) && (info.sel_item[this.model_id] != null)) {
        this._theme.editable_points.beg_ctx(info);
        for (w = 0, len9 = proj.length; w < len9; w++) {
          p = proj[w];
          this._theme.points.draw_proj(info, p);
        }
        this._theme.editable_points.end_ctx(info);
        if (this._selected_points.length) {
          this._theme.selected_points.beg_ctx(info);
          ref10 = this._selected_points;
          for (x = 0, len10 = ref10.length; x < len10; x++) {
            p = ref10[x];
            n = info.re_2_sc.proj(p.pos.get());
            this._theme.selected_points.draw_proj(info, n);
          }
          this._theme.selected_points.end_ctx(info);
        }
        if (this._pelected_points.length) {
          this._theme.highlighted_points.beg_ctx(info);
          ref11 = this._pelected_points;
          for (y = 0, len11 = ref11.length; y < len11; y++) {
            p = ref11[y];
            n = info.re_2_sc.proj(p.pos.get());
            this._theme.highlighted_points.draw_proj(info, n);
          }
          this._theme.highlighted_points.end_ctx(info);
        }
      } else if (this.visualization.display_style.equals("Points")) {
        this._theme.points.beg_ctx(info);
        for (z = 0, len12 = proj.length; z < len12; z++) {
          p = proj[z];
          this._theme.points.draw_proj(info, p);
        }
        this._theme.points.end_ctx(info);
      }
      this._update_sub_elements();
      ref12 = this._sub_elements;
      for (i1 = 0, len13 = ref12.length; i1 < len13; i1++) {
        el = ref12[i1];
        el.draw(info, this, proj, true);
      }
      if (this._selected_elements.length) {
        ref13 = this._pelected_points;
        for (j1 = 0, len14 = ref13.length; j1 < len14; j1++) {
          el = ref13[j1];
          el.draw(info, this, proj, true, this._theme.selected_elements);
        }
      }
      if (this._pelected_elements.length) {
        ref14 = this._pelected_elements;
        results = [];
        for (k1 = 0, len15 = ref14.length; k1 < len15; k1++) {
          el = ref14[k1];
          results.push(el.draw(info, this, proj, true, this._theme.highlighted_elements));
        }
        return results;
      }
    }
  };

  Mesh.prototype.on_mouse_down = function(cm, evt, pos, b, old, points_allowed) {
    var best, divisions, el, ip, k, len, len1, len2, len3, m, nl, np, o, p, proj, q, ref, ref1, ref2, ref3, ref4, res;
    if (points_allowed == null) {
      points_allowed = true;
    }
    delete this._moving_point;
    if ((ref = this.visualization.point_edition) != null ? ref.get() : void 0) {
      if (b === "LEFT" || b === "RIGHT") {
        if (points_allowed) {
          proj = (function() {
            var k, len, ref1, results;
            ref1 = this.points;
            results = [];
            for (k = 0, len = ref1.length; k < len; k++) {
              p = ref1[k];
              results.push(cm.cam_info.re_2_sc.proj(p.pos.get()));
            }
            return results;
          }).call(this);
          best = this._closest_point_closer_than(proj, pos, 10);
          if (best >= 0) {
            if (evt.ctrlKey) {
              this._ctrlKey = true;
              if (this._selected_points.toggle_ref(this.points[best])) {
                this._moving_point = this.points[best];
                this._moving_point.beg_click(pos);
              }
            } else {
              this._ctrlKey = false;
              if (!this._selected_points.contains_ref(this.points[best])) {
                this._selected_points.clear();
                this._selected_points.set([this.points[best]]);
              }
              this._moving_point = this.points[best];
              this._moving_point.beg_click(pos);
            }
            if (b === "RIGHT") {
              return false;
            }
            return true;
          } else {
            this._selected_points.clear();
            this._pelected_points.clear();
          }
          best = {
            dist: 4
          };
          ref1 = this._elements;
          for (k = 0, len = ref1.length; k < len; k++) {
            el = ref1[k];
            if (typeof el.closest_point_closer_than === "function") {
              el.closest_point_closer_than(best, this, proj, cm.cam_info, pos);
            }
          }
          ref2 = this._sub_elements;
          for (m = 0, len1 = ref2.length; m < len1; m++) {
            el = ref2[m];
            if (typeof el.closest_point_closer_than === "function") {
              el.closest_point_closer_than(best, this, proj, cm.cam_info, pos);
            }
          }
          if (best.disp != null) {
            np = this.points.length;
            ip = this.add_point(best.disp);
            this._selected_points.clear();
            this._selected_points.set([ip]);
            this._moving_point = ip;
            this._moving_point.beg_click(pos);
            res = [];
            divisions = {};
            ref3 = this._elements;
            for (o = 0, len2 = ref3.length; o < len2; o++) {
              el = ref3[o];
              if (typeof el.cut_with_point === "function") {
                el.cut_with_point(divisions, best, this, np, ip);
              }
              if (divisions[el.model_id] != null) {
                ref4 = divisions[el.model_id];
                for (q = 0, len3 = ref4.length; q < len3; q++) {
                  nl = ref4[q];
                  res.push(nl);
                }
              } else {
                res.push(el);
              }
            }
            this._elements.clear();
            this._elements.set(res);
          }
        }
      }
    }
    return false;
  };

  Mesh.prototype.on_mouse_up_wo_move = function(cm, evt, pos, b, points_allowed) {
    var p;
    if (points_allowed == null) {
      points_allowed = true;
    }
    if ((this._moving_point != null) && !this._ctrlKey && this._selected_points.length > 1) {
      p = this._selected_points.back();
      this._selected_points.clear();
      this._selected_points.set([p]);
      return true;
    }
  };

  Mesh.prototype.on_mouse_move = function(cm, evt, pos, b, old) {
    var best, d_0, el, k, len, len1, m, p, p_0, proj, ref, ref1, ref2, ref3;
    if ((ref = this.visualization.point_edition) != null ? ref.get() : void 0) {
      if ((this._moving_point != null) && b === "LEFT") {
        if ((ref1 = cm.undo_manager) != null) {
          ref1.snapshot();
        }
        p_0 = cm.cam_info.sc_2_rw.pos(pos[0], pos[1]);
        d_0 = cm.cam_info.sc_2_rw.dir(pos[0], pos[1]);
        this._moving_point.move(this._selected_points, this._moving_point.pos, p_0, d_0);
        return true;
      }
      proj = (function() {
        var k, len, ref2, results;
        ref2 = this.points;
        results = [];
        for (k = 0, len = ref2.length; k < len; k++) {
          p = ref2[k];
          results.push(cm.cam_info.re_2_sc.proj(p.pos.get()));
        }
        return results;
      }).call(this);
      best = this._closest_point_closer_than(proj, pos, 10);
      if (best >= 0) {
        this._pelected_points.clear();
        this._pelected_points.set([this.points[best]]);
        return true;
      }
      best = {
        dist: 4
      };
      ref2 = this._elements;
      for (k = 0, len = ref2.length; k < len; k++) {
        el = ref2[k];
        if (typeof el.closest_point_closer_than === "function") {
          el.closest_point_closer_than(best, this, proj, cm.cam_info, pos);
        }
      }
      ref3 = this._sub_elements;
      for (m = 0, len1 = ref3.length; m < len1; m++) {
        el = ref3[m];
        if (typeof el.closest_point_closer_than === "function") {
          el.closest_point_closer_than(best, this, proj, cm.cam_info, pos);
        }
      }
      if (best.disp != null) {
        this._pelected_points.clear();
        this._pelected_points.set([new Point(best.disp)]);
        return true;
      }
    }
    this._pelected_points.clear();
    return false;
  };

  Mesh.prototype.update_min_max = function(x_min, x_max) {
    var d, i, k, p, ref, ref1, results;
    results = [];
    for (i = k = 0, ref = (ref1 = this.points[0]) != null ? ref1.size(1) : void 0; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
      p = [this.points[0].get([0, i]), this.points[0].get([1, i]), this.points[0].get([2, i])];
      results.push((function() {
        var m, results1;
        results1 = [];
        for (d = m = 0; m < 3; d = ++m) {
          x_min[d] = Math.min(x_min[d], p[d]);
          results1.push(x_max[d] = Math.max(x_max[d], p[d]));
        }
        return results1;
      })());
    }
    return results;
  };

  Mesh.prototype.make_curve_line_from_selected = function() {
    var el, index_selected_points, k, len, results, sel_point;
    index_selected_points = this._get_indices_of_selected_points();
    if (index_selected_points.length) {
      results = [];
      for (k = 0, len = index_selected_points.length; k < len; k++) {
        sel_point = index_selected_points[k];
        results.push((function() {
          var len1, m, ref, results1;
          ref = this._elements;
          results1 = [];
          for (m = 0, len1 = ref.length; m < len1; m++) {
            el = ref[m];
            results1.push(el.make_curve_line_from_selected(sel_point));
          }
          return results1;
        }).call(this));
      }
      return results;
    }
  };

  Mesh.prototype.break_line_from_selected = function() {
    var el, index_selected_points, k, len, results, sel_point;
    index_selected_points = this._get_indices_of_selected_points();
    if (index_selected_points.length) {
      results = [];
      for (k = 0, len = index_selected_points.length; k < len; k++) {
        sel_point = index_selected_points[k];
        results.push((function() {
          var len1, m, ref, results1;
          ref = this._elements;
          results1 = [];
          for (m = 0, len1 = ref.length; m < len1; m++) {
            el = ref[m];
            results1.push(el.break_line_from_selected(sel_point));
          }
          return results1;
        }).call(this));
      }
      return results;
    }
  };

  Mesh.prototype.delete_selected_point = function() {
    var done, el, fun, i, ind, index_selected_points, j, k, len, len1, m, n_array, o, p, q, ref, ref1, ref2, ref3, ref4, results, sel_point;
    index_selected_points = this._get_indices_of_selected_points();
    if (index_selected_points.length > 0) {
      results = [];
      for (ind = k = ref = index_selected_points.length - 1; ref <= 0 ? k <= 0 : k >= 0; ind = ref <= 0 ? ++k : --k) {
        sel_point = index_selected_points[ind];
        p = this.points[sel_point];
        n_array = (function() {
          var m, ref1, results1;
          results1 = [];
          for (i = m = 0, ref1 = this.points.length; 0 <= ref1 ? m < ref1 : m > ref1; i = 0 <= ref1 ? ++m : --m) {
            results1.push(i);
          }
          return results1;
        }).call(this);
        n_array[sel_point] = -1;
        for (j = m = ref1 = sel_point + 1, ref2 = this.points.length; ref1 <= ref2 ? m < ref2 : m > ref2; j = ref1 <= ref2 ? ++m : --m) {
          n_array[j] -= 1;
        }
        ref3 = this._elements;
        for (o = 0, len = ref3.length; o < len; o++) {
          el = ref3[o];
          if (typeof el.rem_sub_element === "function") {
            el.rem_sub_element(sel_point);
          }
        }
        this._selected_points.remove_ref(p);
        this._pelected_points.remove_ref(p);
        this.points.splice(sel_point, 1);
        ref4 = this.delete_selected_points_callback;
        for (q = 0, len1 = ref4.length; q < len1; q++) {
          fun = ref4[q];
          fun(this, index_selected_points);
        }
        done = {};
        results.push((function() {
          var len2, r, ref5, results1;
          ref5 = this._elements;
          results1 = [];
          for (r = 0, len2 = ref5.length; r < len2; r++) {
            el = ref5[r];
            results1.push(typeof el.update_indices === "function" ? el.update_indices(done, n_array) : void 0);
          }
          return results1;
        }).call(this));
      }
      return results;
    }
  };

  Mesh.prototype._actualise_indices = function(array, val, index) {
    var ind, k, len, ref, results;
    if (index == null) {
      index = 0;
    }
    if (array.length && val !== 0 && index >= 0 && index <= array.length - 1) {
      ref = array.slice(index, array.length);
      results = [];
      for (k = 0, len = ref.length; k < len; k++) {
        ind = ref[k];
        results.push(array[ind].set(array[ind].get() + val));
      }
      return results;
    }
  };

  Mesh.prototype._get_indices_of_selected_points = function() {
    var index_selected_points, j, k, len, len1, m, point, ref, ref1, sel_point;
    index_selected_points = [];
    ref = this.points;
    for (j = k = 0, len = ref.length; k < len; j = ++k) {
      point = ref[j];
      ref1 = this._selected_points;
      for (m = 0, len1 = ref1.length; m < len1; m++) {
        sel_point = ref1[m];
        if (point === sel_point) {
          index_selected_points.push(j);
        }
      }
    }
    return index_selected_points;
  };

  Mesh.prototype._update_sub_elements = function() {
    var base, e, l, n, oi, results;
    if (this._sub_date < this._elements._date_last_modification) {
      this._sub_date = this._elements._date_last_modification;
      l = (function() {
        var k, len, ref, results;
        ref = this._elements;
        results = [];
        for (k = 0, len = ref.length; k < len; k++) {
          e = ref[k];
          results.push(e);
        }
        return results;
      }).call(this);
      this._sub_elements = [];
      results = [];
      while (l.length) {
        oi = this._sub_elements.length;
        if (typeof (base = l.pop()).add_sub_element === "function") {
          base.add_sub_element(this._sub_elements);
        }
        results.push((function() {
          var k, len, ref, results1;
          ref = this._sub_elements.slice(oi);
          results1 = [];
          for (k = 0, len = ref.length; k < len; k++) {
            n = ref[k];
            results1.push(l.push(n));
          }
          return results1;
        }).call(this));
      }
      return results;
    }
  };

  Mesh.prototype._closest_point_closer_than = function(proj, pos, dist) {
    var best, d, k, len, n, p;
    best = -1;
    for (n = k = 0, len = proj.length; k < len; n = ++k) {
      p = proj[n];
      d = Math.sqrt(Math.pow(pos[0] - p[0], 2) + Math.pow(pos[1] - p[1], 2));
      if (dist > d) {
        dist = d;
        best = n;
      }
    }
    return best;
  };

  return Mesh;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var Axes,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Axes = (function(superClass) {
  extend(Axes, superClass);

  function Axes() {
    Axes.__super__.constructor.call(this);
    this.add_attr({
      p: new Choice(0, ["lb", "lt", "rb", "rt", "mm"]),
      r: new ConstrainedVal(0.05, {
        min: 0,
        max: 1
      }),
      d: 1,
      l: new ConstrainedVal(2, {
        min: 0,
        max: 10,
        div: 10
      })
    });
    this.red = new Color(255, 0, 0);
    this.green = new Color(0, 255, 0);
    this.blue = new Color(0, 0, 255);
    this.theme_x = new LineTheme(this.red);
    this.theme_y = new LineTheme(this.green);
    this.theme_z = new LineTheme(this.blue);
  }

  Axes.prototype.z_index = function() {
    return 10000;
  };

  Axes.prototype.draw = function(info) {
    var o, ref, vz, x, y, z;
    ref = this._coords(info), o = ref[0], x = ref[1], y = ref[2], z = ref[3];
    vz = -1 + 1e-5;
    o[2] = vz;
    x[2] = vz;
    y[2] = vz;
    z[2] = vz;
    this.theme_x.beg_ctx(info);
    this.theme_x.draw_straight_proj(info, o, x);
    this.theme_x.end_ctx(info);
    this.theme_y.beg_ctx(info);
    this.theme_y.draw_straight_proj(info, o, y);
    this.theme_y.end_ctx(info);
    this.theme_z.beg_ctx(info);
    this.theme_z.draw_straight_proj(info, o, z);
    this.theme_z.end_ctx(info);
    info.cm.fillText("X", x[0] + 0.5 * (x[0] - o[0]), x[1] + 0.5 * (x[1] - o[1]), "14px monospace", "center", this.red.to_rgba());
    info.cm.fillText("Y", y[0] + 0.5 * (y[0] - o[0]), y[1] + 0.5 * (y[1] - o[1]), "14px monospace", "center", this.green.to_rgba());
    return info.cm.fillText("Z", z[0] + 0.5 * (z[0] - o[0]), z[1] + 0.5 * (z[1] - o[1]), "14px monospace", "center", this.blue.to_rgba());
  };

  Axes.prototype._coords = function(info) {
    var c, d, dec, l, ma_x, ma_y, mi_x, mi_y, o, p, s, x, y, z;
    d = this.d.get();
    if (d < 0 || !this.p.equals("mm")) {
      d = info.cam.d.get() / 10;
    }
    l = this.r.get() * (this._fixed() ? d : info.cam.d.get());
    s = 1.0 * info.mwh * this.r.get();
    c = info.cam.O.get();
    o = info.re_2_sc.proj(Vec_3.add(c, [0, 0, 0]));
    x = info.re_2_sc.proj(Vec_3.add(c, [l, 0, 0]));
    y = info.re_2_sc.proj(Vec_3.add(c, [0, l, 0]));
    z = info.re_2_sc.proj(Vec_3.add(c, [0, 0, l]));
    mi_x = Math.min(o[0], x[0], y[0], z[0]);
    ma_x = Math.max(o[0], x[0], y[0], z[0]);
    mi_y = Math.min(o[1], x[1], y[1], z[1]);
    ma_y = Math.max(o[1], x[1], y[1], z[1]);
    p = this.p.get();
    if (p[0] === "l" || p[0] === "r") {
      dec = p[0] === "r" ? info.w - ma_x - s : s - mi_x;
      x[0] += dec;
      y[0] += dec;
      z[0] += dec;
      o[0] += dec;
    }
    if (p[1] === "b" || p[1] === "t") {
      dec = p[1] === "b" ? info.h - ma_y - s : s - mi_y;
      x[1] += dec;
      y[1] += dec;
      z[1] += dec;
      o[1] += dec;
    }
    return [o, x, y, z];
  };

  Axes.prototype._fixed = function() {
    return this.p.equals("mm");
  };

  return Axes;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var Point,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Point = (function(superClass) {
  extend(Point, superClass);

  function Point(pos, move_scheme) {
    if (move_scheme == null) {
      move_scheme = new MoveScheme_3D;
    }
    Point.__super__.constructor.call(this);
    this.add_attr({
      pos: new Vec_3(pos)
    });
    this._mv = move_scheme;
  }

  Point.prototype.disp_only_in_model_editor = function() {
    return this.pos;
  };

  Point.prototype.beg_click = function(pos) {
    return this._mv.beg_click(pos);
  };

  Point.prototype.move = function(selected_entities, pos, p_0, d_0) {
    return this._mv.move(selected_entities, pos, p_0, d_0);
  };

  Point.prototype.z_index = function() {
    return 100;
  };

  Point.prototype.size = function(for_display) {
    if (for_display == null) {
      for_display = false;
    }
    return [3];
  };

  return Point;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var Background,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Background = (function(superClass) {
  extend(Background, superClass);

  function Background() {
    Background.__super__.constructor.call(this);
    this.add_attr({
      gradient: new Gradient
    });
    this.gradient.add_color([48, 48, 48, 255], 0);
    this.gradient.add_color([48, 48, 48, 255], 1);
  }

  Background.prototype.z_index = function() {
    return 0;
  };

  Background.prototype.draws_a_background = function() {
    return true;
  };

  Background.prototype.draw = function(info) {
    var array, col, fs, gl, i, len, lineargradient, pos, ps, ref, vs, z;
    if (info.ctx_type === "2d") {
      lineargradient = info.ctx.createLinearGradient(0, 0, 0, info.h);
      ref = this.gradient.color_stop;
      for (i = 0, len = ref.length; i < len; i++) {
        col = ref[i];
        lineargradient.addColorStop(col.position.get(), col.color.to_rgba());
      }
      info.ctx.fillStyle = lineargradient;
      return info.ctx.fillRect(0, 0, info.w, info.h);
    } else {
      vs = "precision mediump float;\n varying float y;\n attribute vec3 pos;\n void main( void ) {\n y = 0.5 * ( pos.y + 1.0 );\n gl_Position = vec4( pos, 1.0 );\n }\n";
      fs = this.gradient.get_fragment_shader("y");
      ps = info.cm.gl_prog(vs, fs);
      gl = info.ctx;
      if (this._points == null) {
        z = 1.0 - 1e-6;
        array = new Float32Array([1.0, 1.0, z, -1.0, 1.0, z, 1.0, -1.0, z, -1.0, -1.0, z]);
        this._points = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this._points);
        gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);
      }
      gl.useProgram(ps);
      pos = gl.getAttribLocation(ps, "pos");
      gl.enableVertexAttribArray(pos);
      gl.bindBuffer(gl.ARRAY_BUFFER, this._points);
      gl.vertexAttribPointer(pos, 3, gl.FLOAT, false, 0, 0);
      return gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
    }
  };

  return Background;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var CamRepresentation,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

CamRepresentation = (function(superClass) {
  extend(CamRepresentation, superClass);

  function CamRepresentation(cam, params) {
    var key, ref, val;
    if (params == null) {
      params = {};
    }
    CamRepresentation.__super__.constructor.call(this);
    this.add_attr({
      cam: cam
    });
    for (key in params) {
      val = params[key];
      if ((ref = this[key]) != null) {
        if (typeof ref.set === "function") {
          ref.set(val);
        }
      }
    }
  }

  CamRepresentation.prototype.z_index = function() {
    return 10;
  };

  CamRepresentation.prototype.draw = function(info) {
    var F, P, X, Y, Z, d, e, lb, lt, rb, rt, size_elem;
    d = this.cam.d.get();
    e = d * Math.tan(this.cam.get_a() * 0.017453292519943295 / 2);
    X = Vec_3.mus(e, this.cam.get_X());
    Y = Vec_3.mus(e, this.cam.get_Y());
    Z = Vec_3.mus(d, this.cam.get_Z());
    F = this.cam.focal_point();
    P = info.re_2_sc.proj(F);
    lt = info.re_2_sc.proj([F[0] + Z[0] - X[0] + Y[0], F[1] + Z[1] - X[1] + Y[1], F[2] + Z[2] - X[2] + Y[2]]);
    rt = info.re_2_sc.proj([F[0] + Z[0] + X[0] + Y[0], F[1] + Z[1] + X[1] + Y[1], F[2] + Z[2] + X[2] + Y[2]]);
    rb = info.re_2_sc.proj([F[0] + Z[0] + X[0] - Y[0], F[1] + Z[1] + X[1] - Y[1], F[2] + Z[2] + X[2] - Y[2]]);
    lb = info.re_2_sc.proj([F[0] + Z[0] - X[0] - Y[0], F[1] + Z[1] - X[1] - Y[1], F[2] + Z[2] - X[2] - Y[2]]);
    info.ctx.lineWidth = 2;
    info.ctx.beginPath();
    info.ctx.strokeStyle = "lightBlue";
    info.ctx.moveTo(P[0], P[1]);
    info.ctx.lineTo(lt[0], lt[1]);
    info.ctx.moveTo(P[0], P[1]);
    info.ctx.lineTo(rt[0], rt[1]);
    info.ctx.moveTo(P[0], P[1]);
    info.ctx.lineTo(rb[0], rb[1]);
    info.ctx.moveTo(P[0], P[1]);
    info.ctx.lineTo(lb[0], lb[1]);
    info.ctx.moveTo(lt[0], lt[1]);
    info.ctx.lineTo(rt[0], rt[1]);
    info.ctx.lineTo(rb[0], rb[1]);
    info.ctx.lineTo(lb[0], lb[1]);
    info.ctx.lineTo(lt[0], lt[1]);
    info.ctx.stroke();
    info.ctx.closePath();
    size_elem = 10;
    info.ctx.beginPath();
    info.ctx.fillStyle = "navy";
    info.ctx.arc(P[0], P[1], size_elem * 0.5, 0, Math.PI * 2, true);
    info.ctx.fill();
    if ((this.cam != null) && (this.cam.model_id != null)) {
      info.ctx.fillStyle = "white";
      info.ctx.font = "10px Arial";
      info.ctx.fillText("Cam " + this.cam.model_id, P[0] + 10, P[1] - 10);
    }
    return info.ctx.closePath();
  };

  return CamRepresentation;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var Legend,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Legend = (function(superClass) {
  extend(Legend, superClass);

  function Legend(title, show_legend, auto_fit) {
    if (title == null) {
      title = "Big title";
    }
    if (show_legend == null) {
      show_legend = true;
    }
    if (auto_fit == null) {
      auto_fit = true;
    }
    Legend.__super__.constructor.call(this);
    this.add_attr({
      show_legend: show_legend,
      color_map: new Gradient,
      auto_fit: auto_fit,
      legend_size: new ConstrainedVal(0.5, {
        min: 0.1,
        max: 1,
        div: 0
      }),
      _title: title,
      _width: 12,
      _height: 100,
      _min_val: 0,
      _max_val: -1
    });
    this.add_attr({
      max_val: new ConstOrNotModel(this.auto_fit, this._max_val, false),
      min_val: new ConstOrNotModel(this.auto_fit, this._min_val, false)
    });
    this.color_map.add_color([0, 0, 0, 255], 0);
    this.color_map.add_color([255, 0, 0, 255], 0.33);
    this.color_map.add_color([255, 255, 0, 255], 0.66);
    this.color_map.add_color([255, 255, 255, 255], 1);
  }

  Legend.prototype.z_index = function() {
    return 1000;
  };

  Legend.prototype.is_correct = function() {
    return this.max_val.get() >= this.min_val.get();
  };

  Legend.prototype.get_ratio = function(info) {
    return info.h / (this._height.get() * 2) * this.legend_size.get();
  };

  Legend.prototype._draw_text_legend = function(info) {
    var c_s, font_size, height, i, len, pos, pos_x, pos_y, ratio, ref, results, val, width;
    ratio = this.get_ratio(info);
    height = this._height.get() * ratio;
    width = this._width.get() * ratio;
    pos_y = info.h * 0.5 - height * 0.5;
    pos_x = info.w - 2.0 * width;
    font_size = 10 * ratio;
    ref = this.color_map.color_stop;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      c_s = ref[i];
      pos = c_s.position.get();
      val = (this.max_val.get() - this.min_val.get()) * (1 - c_s.position.get()) + this.min_val.get();
      results.push(info.cm.fillText(val.toFixed(4), pos_x - 8, pos_y + 7 + pos * height, font_size + "pt Arial", "right", "White"));
    }
    return results;
  };

  Legend.prototype._draw_gradient = function(info, pos_x, pos_y, width, height) {
    var _points, array, col, fs, gl, i, len, lineargradient, pos, ps, ref, vs, x_max, x_min, y_max, y_min, z;
    if (info.ctx_type === "2d") {
      lineargradient = info.ctx.createLinearGradient(0, pos_y, 0, pos_y + height);
      ref = this.color_map.color_stop;
      for (i = 0, len = ref.length; i < len; i++) {
        col = ref[i];
        lineargradient.addColorStop(col.position.get(), "rgba(" + (col.color.r.get()) + ", " + (col.color.g.get()) + ", " + (col.color.b.get()) + ", " + (col.color.a.get()) + ")");
      }
      info.ctx.fillStyle = lineargradient;
      return info.ctx.fillRect(pos_x, pos_y, width, height);
    } else {
      gl = info.ctx;
      vs = "precision mediump float;\n varying float y;\n uniform float my;\n attribute vec3 pos;\n void main( void ) {\n y = 0.5 * ( my * pos.y + 1.0 );\n gl_Position = vec4( pos, 1.0 );\n }\n";
      fs = this.color_map.get_fragment_shader("y");
      ps = info.cm.gl_prog(vs, fs);
      ps.myUniform = gl.getUniformLocation(ps, "my");
      _points = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, _points);
      z = -1.0;
      x_min = 2.0 * pos_x / info.w - 1.0;
      y_min = 1.0 - 2.0 * pos_y / info.h;
      x_max = 2.0 * (pos_x + width) / info.w - 1.0;
      y_max = 1.0 - 2.0 * (pos_y + height) / info.h;
      array = new Float32Array([x_min, y_min, z, x_max, y_min, z, x_min, y_max, z, x_max, y_max, z]);
      gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);
      gl.useProgram(ps);
      gl.uniform1f(ps.myUniform, info.h * 1.0 / height);
      pos = gl.getAttribLocation(ps, "pos");
      gl.enableVertexAttribArray(pos);
      gl.bindBuffer(gl.ARRAY_BUFFER, _points);
      gl.vertexAttribPointer(pos, 3, gl.FLOAT, false, 0, 0);
      gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
      gl.deleteBuffer(_points);
      gl.disableVertexAttribArray(pos);
      return gl.bindBuffer(gl.ARRAY_BUFFER, null);
    }
  };

  Legend.prototype.draw = function(info) {
    var height, pos_x, pos_y, ratio, ref, t, th, width;
    if (this.show_legend.get() === true) {
      ratio = this.get_ratio(info);
      height = this._height.get() * ratio;
      width = this._width.get() * ratio;
      pos_y = info.h * 0.5 - height * 0.5;
      pos_x = info.w - 2.0 * width;
      this._draw_gradient(info, pos_x, pos_y, width, height);
      this._draw_text_legend(info);
      t = (ref = this._title) != null ? ref.toString() : void 0;
      if (t != null) {
        th = 10 * ratio;
        return info.cm.fillText(t, pos_x + 0.5 * width, pos_y + height + th * 1.6, th + "pt Arial", "center-limited", "White");
      }
    }
  };

  return Legend;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var CuttingPlan,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

CuttingPlan = (function(superClass) {
  extend(CuttingPlan, superClass);

  function CuttingPlan(pos, dir) {
    if (pos == null) {
      pos = [0, 0, 0];
    }
    if (dir == null) {
      dir = [0, 0, -0.2];
    }
    CuttingPlan.__super__.constructor.call(this);
    this.add_attr({
      pos: new Point(pos),
      dir: new Point(dir),
      opacity: new ConstrainedVal(50, {
        min: 0,
        max: 100,
        div: 100
      }),
      _selected: new Lst,
      _pre_sele: new Lst
    });
    this.b = [];
  }

  CuttingPlan.prototype.z_index = function() {
    return 1;
  };

  CuttingPlan.prototype.bounding_box = function() {
    var get_min_max, i, item, len, ref, x_max, x_min;
    if (this._bounding_box != null) {
      return this._bounding_box;
    }
    get_min_max = function(item, x_min, x_max) {
      var i, len, ref, results, sub_item;
      if (item.update_min_max != null) {
        return item.update_min_max(x_min, x_max);
      } else if (item.sub_canvas_items != null) {
        ref = item.sub_canvas_items();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          sub_item = ref[i];
          results.push(get_min_max(sub_item, x_min, x_max));
        }
        return results;
      }
    };
    x_min = [+1e40, +1e40, +1e40];
    x_max = [-1e40, -1e40, -1e40];
    ref = this._parents[0]._children;
    for (i = 0, len = ref.length; i < len; i++) {
      item = ref[i];
      get_min_max(item, x_min, x_max);
    }
    if (x_min[0] === +1e40) {
      return [[-1, -1, -1], [1, 1, 1]];
    }
    this._bounding_box = [x_min, x_max];
    return this._bounding_box;
  };

  CuttingPlan.prototype.draw = function(info) {
    var half_height, half_width, height, lb, lt, proj_dir, proj_pos, rb, ref, ref1, ref2, ref3, rt, width;
    proj_pos = info.re_2_sc.proj(this.pos.pos.get());
    proj_dir = info.re_2_sc.proj(this.dir.pos.get());
    this.b = this.bounding_box();
    width = this.b[1][0] - this.b[0][0];
    height = this.b[1][1] - this.b[0][1];
    half_width = width / 2;
    half_height = height / 2;
    lt = info.re_2_sc.proj([this.pos.pos[0].get() - half_width, this.pos.pos[1].get() + half_height, this.pos.pos[2].get()]);
    rt = info.re_2_sc.proj([this.pos.pos[0].get() + half_width, this.pos.pos[1].get() + half_height, this.pos.pos[2].get()]);
    rb = info.re_2_sc.proj([this.pos.pos[0].get() + half_width, this.pos.pos[1].get() - half_height, this.pos.pos[2].get()]);
    lb = info.re_2_sc.proj([this.pos.pos[0].get() - half_width, this.pos.pos[1].get() - half_height, this.pos.pos[2].get()]);
    info.ctx.lineWidth = 2;
    info.ctx.lineCap = "square";
    info.ctx.beginPath();
    info.ctx.strokeStyle = "rgb( 70, 70, 70)";
    info.ctx.fillStyle = "rgba( 200, 200, 200, 200)";
    info.ctx.moveTo(lt[0], lt[1]);
    info.ctx.lineTo(rt[0], rt[1]);
    info.ctx.lineTo(rb[0], rb[1]);
    info.ctx.lineTo(lb[0], lb[1]);
    info.ctx.lineTo(lt[0], lt[1]);
    info.ctx.fill();
    info.ctx.stroke();
    info.ctx.closePath();
    info.ctx.beginPath();
    info.ctx.strokeStyle = "orange";
    info.ctx.moveTo(proj_pos[0], proj_pos[1]);
    info.ctx.lineTo(proj_dir[0], proj_dir[1]);
    info.ctx.fill();
    info.ctx.stroke();
    info.ctx.lineWidth = 1;
    info.ctx.beginPath();
    if (ref = this.pos, indexOf.call(this._pre_sele, ref) >= 0) {
      info.ctx.strokeStyle = "yellow";
    } else {
      info.ctx.strokeStyle = "#333311";
    }
    if (ref1 = this.pos, indexOf.call(this._selected, ref1) >= 0) {
      info.ctx.fillStyle = "red";
    } else {
      info.ctx.fillStyle = "#333311";
    }
    info.ctx.arc(proj_pos[0], proj_pos[1], 4, 0, Math.PI * 2, true);
    info.ctx.fill();
    info.ctx.stroke();
    info.ctx.closePath();
    info.ctx.beginPath();
    if (ref2 = this.dir, indexOf.call(this._pre_sele, ref2) >= 0) {
      info.ctx.strokeStyle = "yellow";
    } else {
      info.ctx.strokeStyle = "#333311";
    }
    if (ref3 = this.dir, indexOf.call(this._selected, ref3) >= 0) {
      info.ctx.fillStyle = "red";
    } else {
      info.ctx.fillStyle = "#333311";
    }
    info.ctx.arc(proj_dir[0], proj_dir[1], 4, 0, Math.PI * 2, true);
    info.ctx.fill();
    info.ctx.stroke();
    return info.ctx.closePath();
  };

  CuttingPlan.prototype.get_movable_entities = function(res, info, pos, phase) {
    var d, dx, dy, proj, x, y;
    x = pos[0];
    y = pos[1];
    if (phase === 0) {
      proj = info.re_2_sc.proj(this.pos.pos.get());
      dx = x - proj[0];
      dy = y - proj[1];
      d = Math.sqrt(dx * dx + dy * dy);
      if (d <= 10) {
        res.push({
          item: this.pos,
          dist: d,
          type: "CuttingPlan"
        });
      }
      proj = info.re_2_sc.proj(this.dir.pos.get());
      dx = x - proj[0];
      dy = y - proj[1];
      d = Math.sqrt(dx * dx + dy * dy);
      if (d <= 10) {
        return res.push({
          item: this.dir,
          dist: d,
          type: "CuttingPlan"
        });
      }
    }
  };

  CuttingPlan.prototype.on_mouse_down = function(cm, evt, pos, b) {
    var i, phase, res;
    delete this._movable_entity;
    if (b === "LEFT") {
      for (phase = i = 0; i < 3; phase = ++i) {
        res = [];
        this.get_movable_entities(res, cm.cam_info, pos, phase);
        if (res.length) {
          res.sort(function(a, b) {
            return b.dist - a.dist;
          });
          this._movable_entity = res[0].item;
          this._may_need_snapshot = true;
          if (evt.ctrlKey) {
            this._selected.toggle_ref(this._movable_entity);
            if (!this._selected.contains_ref(this._movable_entity)) {
              delete this._movable_entity;
            }
          } else {
            this._selected.clear();
            this._selected.push(this._movable_entity);
            this._movable_entity.beg_click(pos);
          }
          return true;
        }
      }
    }
    return false;
  };

  CuttingPlan.prototype.on_mouse_move = function(cm, evt, pos, b, old) {
    var d, d_0, dx, dy, p_0, proj, ref, res, x, y;
    if (b === "LEFT" && (this._movable_entity != null)) {
      if (this._may_need_snapshot) {
        if ((ref = cm.undo_manager) != null) {
          ref.snapshot();
        }
        delete this._may_need_snapshot;
      }
      p_0 = cm.cam_info.sc_2_rw.pos(pos[0], pos[1]);
      d_0 = cm.cam_info.sc_2_rw.dir(pos[0], pos[1]);
      this._movable_entity.move(this._selected, this._movable_entity.pos, p_0, d_0);
      return true;
    }
    res = [];
    x = pos[0];
    y = pos[1];
    if (this.dir != null) {
      proj = cm.cam_info.re_2_sc.proj(this.dir.pos.get());
      dx = x - proj[0];
      dy = y - proj[1];
      d = Math.sqrt(dx * dx + dy * dy);
      if (d <= 10) {
        res.push({
          item: this.dir,
          dist: d
        });
      }
    }
    if (this.pos != null) {
      proj = cm.cam_info.re_2_sc.proj(this.pos.pos.get());
      dx = x - proj[0];
      dy = y - proj[1];
      d = Math.sqrt(dx * dx + dy * dy);
      if (d <= 10) {
        res.push({
          item: this.pos,
          dist: d
        });
      }
    }
    if (res.length) {
      res.sort(function(a, b) {
        return b.dist - a.dist;
      });
      if (this._pre_sele.length !== 1 || this._pre_sele[0] !== res[0].item) {
        this._pre_sele.clear();
        this._pre_sele.push(res[0].item);
      }
    } else if (this._pre_sele.length) {
      this._pre_sele.clear();
    }
    return false;
  };

  return CuttingPlan;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var PointMesher,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

PointMesher = (function(superClass) {
  extend(PointMesher, superClass);

  function PointMesher(pos, density, radius) {
    if (pos == null) {
      pos = [0, 0, 0];
    }
    if (density == null) {
      density = 2;
    }
    if (radius == null) {
      radius = 6;
    }
    PointMesher.__super__.constructor.call(this);
    this.add_attr({
      point: new Point(pos),
      density: density,
      radius: radius,
      _selected: new Lst,
      _pre_sele: new Lst
    });
  }

  PointMesher.prototype.z_index = function() {
    return 1000;
  };

  PointMesher.prototype.draw = function(info) {
    var _pre_sele, editable_points, highlighted_points, i, item, j, k, l, len, len1, len2, len3, n, points, proj, ref, ref1, ref2, ref3, selected, selected_points;
    if (info.ctx_type === 'gl') {
      selected = {};
      ref = this._selected;
      for (i = 0, len = ref.length; i < len; i++) {
        item = ref[i];
        selected[item.model_id] = true;
      }
      _pre_sele = {};
      ref1 = this._pre_sele;
      for (j = 0, len1 = ref1.length; j < len1; j++) {
        item = ref1[j];
        _pre_sele[item.model_id] = true;
      }
      points = new PointTheme(new Color(255, 255, 255, 255), this.radius.get(), new Color(255, 255, 255, 255), 1);
      editable_points = new PointTheme(new Color(0, 255, 0, 255), this.radius.get(), new Color(255, 255, 255, 255), 1);
      selected_points = new PointTheme(new Color(255, 0, 0, 255), this.radius.get(), new Color(255, 255, 255, 255), 1);
      highlighted_points = new PointTheme(new Color(0, 0, 0, 0), this.radius.get(), new Color(255, 0, 0, 255), 1);
      proj = info.re_2_sc.proj(this.point.pos.get());
      editable_points.beg_ctx(info);
      points.draw_proj(info, proj);
      editable_points.end_ctx(info);
      if (selected[this.point.model_id] != null) {
        selected_points.beg_ctx(info);
        n = info.re_2_sc.proj(this.point.pos.get());
        selected_points.draw_proj(info, n);
        selected_points.end_ctx(info);
      }
      if (_pre_sele[this.model_id] != null) {
        highlighted_points.beg_ctx(info);
        n = info.re_2_sc.proj(this.point.pos.get());
        highlighted_points.draw_proj(info, n);
        return highlighted_points.end_ctx(info);
      }
    } else {
      selected = {};
      ref2 = this._selected;
      for (k = 0, len2 = ref2.length; k < len2; k++) {
        item = ref2[k];
        selected[item.model_id] = true;
      }
      _pre_sele = {};
      ref3 = this._pre_sele;
      for (l = 0, len3 = ref3.length; l < len3; l++) {
        item = ref3[l];
        _pre_sele[item.model_id] = true;
      }
      proj = info.re_2_sc.proj(this.point.pos.get());
      info.ctx.lineWidth = 1;
      info.ctx.strokeStyle = "#993311";
      info.ctx.fillStyle = "#553311";
      if (selected[this.point.model_id] != null) {
        info.ctx.strokeStyle = "#FF0000";
      } else {
        info.ctx.strokeStyle = "#FFFF00";
      }
      info.ctx.beginPath();
      info.ctx.arc(proj[0], proj[1], this.radius.get(), 0, Math.PI * 2, true);
      info.ctx.closePath();
      info.ctx.fill();
      info.ctx.stroke();
      if (_pre_sele[this.model_id] != null) {
        info.ctx.fillStyle = "#FFDD22";
        info.ctx.beginPath();
        info.ctx.lineWidth = 0.8;
        info.ctx.arc(proj[0], proj[1], this.radius.get() * 0.5, 0, Math.PI * 2, true);
        info.ctx.fill();
        return info.ctx.closePath();
      }
    }
  };

  PointMesher.prototype.get_movable_entities = function(res, info, pos, phase) {
    var d, dx, dy, proj, x, y;
    x = pos[0];
    y = pos[1];
    if (phase === 0) {
      proj = info.re_2_sc.proj(this.point.pos.get());
      dx = x - proj[0];
      dy = y - proj[1];
      d = Math.sqrt(dx * dx + dy * dy);
      if (d <= 10) {
        return res.push({
          item: this.point,
          dist: d,
          type: "PointMesher"
        });
      }
    }
  };

  PointMesher.prototype.on_mouse_down = function(cm, evt, pos, b) {
    var i, phase, res;
    delete this._movable_entity;
    if (b === "LEFT" || b === "RIGHT") {
      for (phase = i = 0; i < 3; phase = ++i) {
        res = [];
        this.get_movable_entities(res, cm.cam_info, pos, phase);
        if (res.length) {
          res.sort(function(a, b) {
            return b.dist - a.dist;
          });
          this._movable_entity = res[0].item;
          if (evt.ctrlKey) {
            this._selected.toggle_ref(this._movable_entity);
            if (!this._selected.contains_ref(this._movable_entity)) {
              delete this._movable_entity;
            }
          } else {
            this._selected.clear();
            this._selected.push(this._movable_entity);
            this._movable_entity.beg_click(pos);
          }
          if (b === "RIGHT") {
            return false;
          }
          return true;
        } else {
          this._selected.clear();
        }
      }
    }
    return false;
  };

  PointMesher.prototype.on_mouse_move = function(cm, evt, pos, b, old) {
    var d, d_0, dx, dy, p_0, proj, ref, res, x, y;
    if (b === "LEFT" && (this._movable_entity != null)) {
      if ((ref = cm.undo_manager) != null) {
        ref.snapshot();
      }
      p_0 = cm.cam_info.sc_2_rw.pos(pos[0], pos[1]);
      d_0 = cm.cam_info.sc_2_rw.dir(pos[0], pos[1]);
      this._movable_entity.move(this._selected, this._movable_entity.pos, p_0, d_0);
      return true;
    }
    res = [];
    x = pos[0];
    y = pos[1];
    proj = cm.cam_info.re_2_sc.proj(this.point.pos.get());
    dx = x - proj[0];
    dy = y - proj[1];
    d = Math.sqrt(dx * dx + dy * dy);
    if (d <= 10) {
      res.push({
        item: this,
        dist: d
      });
    }
    if (res.length) {
      res.sort(function(a, b) {
        return b.dist - a.dist;
      });
      if (this._pre_sele.length !== 1 || this._pre_sele[0] !== res[0].item) {
        this._pre_sele.clear();
        this._pre_sele.push(res[0].item);
      }
    } else if (this._pre_sele.length) {
      this._pre_sele.clear();
    }
    return false;
  };

  return PointMesher;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var NodalField,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

NodalField = (function(superClass) {
  extend(NodalField, superClass);

  function NodalField(mesh) {
    NodalField.__super__.constructor.call(this);
    this.add_attr({
      _mesh: mesh,
      _data: new TypedArray_Float64(mesh != null ? typeof mesh.nb_points === "function" ? mesh.nb_points() : void 0 : void 0)
    });
    this._date_bufs = {};
    this._data_buffer = {};
  }

  NodalField.prototype.size = function() {
    return this._data._data.length;
  };

  NodalField.prototype.get_drawing_parameters = function(model) {
    model.add_attr({
      drawing_parameters: {
        _legend: new Legend(model.name)
      }
    });
    return model.drawing_parameters.add_attr({
      display_style: new Choice(1, ["Wireframe", "Surface", "Surface with Edges"]),
      legend: model.drawing_parameters._legend
    });
  };

  NodalField.prototype.get_sub_field = function(info) {
    return this;
  };

  NodalField.prototype.update_min_max = function(x_min, x_max) {
    return this._mesh.update_min_max(x_min, x_max);
  };

  NodalField.prototype.toString = function() {
    return this.name.get();
  };

  NodalField.prototype.draw = function(info, parameters, additionnal_parameters) {
    var el, i, j, k, len, len1, ni, nn, p, proj, ref, ref1, w;
    if (parameters != null) {
      this.actualise_value_legend(parameters._legend);
      if (info.ctx_type === "gl") {
        nn = -1;
        ref = this._mesh._elements;
        for (j = 0, len = ref.length; j < len; j++) {
          el = ref[j];
          if (!(el.indices._data != null)) {
            continue;
          }
          this._update_gl_bufs(info, (nn += 1), el);
          ni = nn + "_" + info.ctx.ctx_id;
          w = ((additionnal_parameters != null ? additionnal_parameters.warp_by : void 0) != null) && (additionnal_parameters != null ? additionnal_parameters.warp_factor : void 0) ? additionnal_parameters.warp_by : void 0;
          if (typeof el.draw_nodal_field_gl === "function") {
            el.draw_nodal_field_gl(info, this._mesh, this._mesh.points, this._data_buffer[ni], parameters.display_style.get(), parameters._legend, w, additionnal_parameters.warp_factor, ni);
          }
        }
      } else {
        proj = (function() {
          var k, len1, len2, m, ref1, ref2, ref3, ref4, ref5, ref6, results, results1;
          if (((additionnal_parameters != null ? additionnal_parameters.warp_by : void 0) != null) && this._mesh.points.length === ((ref1 = additionnal_parameters.warp_by._vector[0]) != null ? (ref2 = ref1._data[0]) != null ? (ref3 = ref2.field) != null ? (ref4 = ref3._data.size()) != null ? ref4[0] : void 0 : void 0 : void 0 : void 0)) {
            ref5 = this._mesh.points;
            results = [];
            for (i = k = 0, len1 = ref5.length; k < len1; i = ++k) {
              p = ref5[i];
              results.push(info.re_2_sc.proj(Vec_3.add(p.pos.get(), Vec_3.mus(additionnal_parameters.warp_factor, additionnal_parameters.warp_by.get_val(info, i, 3)))));
            }
            return results;
          } else {
            ref6 = this._mesh.points;
            results1 = [];
            for (i = m = 0, len2 = ref6.length; m < len2; i = ++m) {
              p = ref6[i];
              results1.push(info.re_2_sc.proj(p.pos.get()));
            }
            return results1;
          }
        }).call(this);
        ref1 = this._mesh._elements;
        for (k = 0, len1 = ref1.length; k < len1; k++) {
          el = ref1[k];
          if (typeof el.draw_nodal_field === "function") {
            el.draw_nodal_field(info, proj, this._data, parameters.display_style.get(), parameters._legend);
          }
        }
      }
      return parameters._legend.draw(info);
    }
  };

  NodalField.prototype.sub_canvas_items = function() {
    if (this.drawing_parameters != null) {
      return [this.drawing_parameters._legend];
    } else {
      return [];
    }
  };

  NodalField.prototype.z_index = function() {
    return 150;
  };

  NodalField.prototype.get_val = function(info, i) {
    return this._data.get(i);
  };

  NodalField.prototype.actualise_value_legend = function(legend) {
    var max, min;
    if (this._data.has_been_modified() || !legend.is_correct()) {
      min = this.get_min_data();
      legend.min_val.set(min);
      max = this.get_max_data();
      return legend.max_val.set(max);
    }
  };

  NodalField.prototype.get_min_data = function() {
    return this._get_min(this._data.get());
  };

  NodalField.prototype.get_max_data = function() {
    return this._get_max(this._data.get());
  };

  NodalField.prototype._update_gl_bufs = function(info, nn, el) {
    var gl, i, j, ne, ni, ref, val;
    gl = info.ctx;
    ni = nn + "_" + gl.ctx_id;
    if (this._date_bufs[ni] == null) {
      this._date_bufs[ni] = -1;
    }
    if (this._date_bufs[ni] < this._data._date_last_modification || this._date_bufs[ni] < this._mesh._date_last_modification) {
      this._date_bufs[ni] = Model._counter;
      if (this._data_buffer[ni] != null) {
        gl.deleteBuffer(this._data_buffer[ni]);
      }
      this._data_buffer[ni] = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, this._data_buffer[ni]);
      ne = el._get_indices()._data.length;
      val = new Float32Array(ne);
      for (i = j = 0, ref = ne; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
        val[i] = this._data._data[el._get_indices().get(i)];
      }
      return gl.bufferData(gl.ARRAY_BUFFER, val, gl.STATIC_DRAW);
    }
  };

  NodalField.prototype._get_max = function(l) {
    var i, j, max, ref, val;
    if (l.length > 0) {
      max = l[0];
    }
    for (i = j = 1, ref = l.length; 1 <= ref ? j < ref : j > ref; i = 1 <= ref ? ++j : --j) {
      val = l[i];
      if (val > max) {
        max = val;
      }
    }
    return max;
  };

  NodalField.prototype._get_min = function(l) {
    var i, j, min, ref, val;
    if (l.length > 0) {
      min = l[0];
    }
    for (i = j = 1, ref = l.length; 1 <= ref ? j < ref : j > ref; i = 1 <= ref ? ++j : --j) {
      val = l[i];
      if (val < min) {
        min = val;
      }
    }
    return min;
  };

  return NodalField;

})(Model);
// Generated by CoffeeScript 1.11.1
var InterpolatedField,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

InterpolatedField = (function(superClass) {
  extend(InterpolatedField, superClass);

  function InterpolatedField(name) {
    InterpolatedField.__super__.constructor.call(this);
    this.add_attr({
      _data: []
    });
  }

  InterpolatedField.prototype.get_drawing_parameters = function(model) {
    if (this._data.length) {
      return this._data[0].field.get_drawing_parameters(model);
    }
  };

  InterpolatedField.prototype.get_sub_field = function(info) {
    var j, len, n, ref, t;
    ref = this._data;
    for (n = j = 0, len = ref.length; j < len; n = ++j) {
      t = ref[n];
      if (t.pos[0].axe_name.equals("time")) {
        if (t.pos[0].axe_value.get() >= info.time) {
          return t.field;
        }
      }
    }
    if (this._data.length) {
      return this._data[this._data.length - 1].field;
    }
  };

  InterpolatedField.prototype.get_val = function(info, i) {
    var f;
    f = this.get_sub_field(info);
    if (f != null) {
      return f.get_val(info, i);
    }
  };

  InterpolatedField.prototype.draw = function(info, parameters, additionnal_parameters) {
    var f, ref, ref1;
    if (parameters != null ? (ref = parameters._legend) != null ? (ref1 = ref.auto_fit) != null ? ref1.get() : void 0 : void 0 : void 0) {
      this.actualise_value_legend_all_fields(parameters._legend);
    }
    f = this.get_sub_field(info);
    if (f != null) {
      return f.draw(info, parameters, additionnal_parameters);
    }
  };

  InterpolatedField.prototype.sub_canvas_items = function(additionnal_parameters) {
    if (this._data.length) {
      return this._data[0].field.sub_canvas_items(additionnal_parameters);
    } else {
      return [];
    }
  };

  InterpolatedField.prototype.z_index = function() {
    if (this._data.length) {
      return this._data[0].field.z_index();
    } else {
      return 0;
    }
  };

  InterpolatedField.prototype.warp_gl_buff = function(info, el, buff_id) {
    var f;
    f = this.get_sub_field(info);
    return f.warp_gl_buff(info, el, buff_id);
  };

  InterpolatedField.prototype.actualise_value_legend_all_fields = function(legend) {
    var field, interpo_field, j, len, max, maxus, min, minus, ref;
    max = -2e308;
    min = 2e308;
    ref = this._data;
    for (j = 0, len = ref.length; j < len; j++) {
      interpo_field = ref[j];
      field = interpo_field.field;
      maxus = field.get_max_data();
      minus = field.get_min_data();
      if (minus < min) {
        min = minus;
      }
      if (maxus > max) {
        max = maxus;
      }
    }
    legend.min_val.set(min);
    return legend.max_val.set(max);
  };

  return InterpolatedField;

})(Model);
// Generated by CoffeeScript 1.11.1
var ImageField,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ImageField = (function(superClass) {
  extend(ImageField, superClass);

  function ImageField(name, path) {
    ImageField.__super__.constructor.call(this);
    this.add_attr({
      name: name,
      src: ""
    });
    this.rgba = new Image;
    this.rgba.onload = (function(_this) {
      return function() {
        return _this._signal_change();
      };
    })(this);
    this.src.bind((function(_this) {
      return function() {
        if (_this.src.length) {
          return _this.rgba.src = _this.src.get();
        }
      };
    })(this));
    this._date_tex = {};
    this.tex = {};
  }

  ImageField.prototype.get_drawing_parameters = function(model) {
    model.add_attr({
      drawing_parameters: {
        _legend: new Legend("todo")
      }
    });
    return model.drawing_parameters.add_attr({
      color_map: model.drawing_parameters._legend.color_map
    });
  };

  ImageField.prototype.get_min_data = function() {
    return 0;
  };

  ImageField.prototype.get_max_data = function() {
    return 255;
  };

  ImageField.prototype.toString = function() {
    return this.name.get();
  };

  ImageField.prototype.draw = function(info) {
    if (this.rgba.height) {
      return Img._draw_persp_rec(info, this.rgba, 0, 0, [0, this.rgba.height, 0.01], [1, 0, 0], [0, -1, 0], [0, 0, 1], this._date_tex, this.tex, this.src);
    }
  };

  ImageField.prototype.z_index = function() {
    return 20000;
  };

  return ImageField;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var VectorialField,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

VectorialField = (function(superClass) {
  extend(VectorialField, superClass);

  function VectorialField(name, vector, params) {
    if (name == null) {
      name = "";
    }
    if (vector == null) {
      vector = new Lst;
    }
    if (params == null) {
      params = {};
    }
    VectorialField.__super__.constructor.call(this);
    this.add_attr({
      _vector: vector
    });
    this._date_pts = {};
    this._pts_buffer = {};
  }

  VectorialField.prototype.get_drawing_parameters = function(model) {
    if (this._vector.length) {
      model.add_attr({
        drawing_parameters: {
          _legend: new Legend(model.name)
        }
      });
      return model.drawing_parameters.add_attr({
        display_style: new Choice(2, ["Points", "Wireframe", "Surface", "Surface with Edges", "Arrow"]),
        legend: model.drawing_parameters._legend
      });
    }
  };

  VectorialField.prototype.get = function(a, b) {
    if (a != null) {
      if (b != null) {
        return this._vector[a].get(b);
      } else {
        return this._vector[a].get();
      }
    } else {
      return this._vector.get();
    }
  };

  VectorialField.prototype.get_val = function(info, i, n) {
    var j, k, ref, results;
    if (n == null) {
      n = 3;
    }
    results = [];
    for (j = k = 0, ref = n; 0 <= ref ? k < ref : k > ref; j = 0 <= ref ? ++k : --k) {
      if (j < this._vector.length) {
        results.push(this._vector[j].get_val(info, i));
      } else {
        results.push(0);
      }
    }
    return results;
  };

  VectorialField.prototype.dim = function() {
    if (this._vector) {
      return this._vector.length;
    }
    return 0;
  };

  VectorialField.prototype.field_length = function(info) {
    var f;
    if (this._vector[0] != null) {
      f = this._vector[0].get_sub_field(info);
      return f._data.size();
    }
  };

  VectorialField.prototype.add_child = function(child) {
    return this._vector.push(child);
  };

  VectorialField.prototype.rem_child = function(child) {
    var ind;
    ind = this._vector.indexOf(child);
    if (ind > 0) {
      return this._vector.splice(ind, 1);
    }
  };

  VectorialField.prototype.get_norm_value_at_index = function(info, index) {
    var value, vector_value;
    vector_value = this.get_val(info, index);
    return value = Math.sqrt(vector_value[0] * vector_value[0] + vector_value[1] * vector_value[1]);
  };

  VectorialField.prototype.actualise_value_legend = function(info, legend, norm) {
    var i, k, len, max, min, normalized_val, ref;
    if (norm == null) {
      norm = true;
    }
    if (norm) {
      normalized_val = [];
      len = this.field_length(info);
      for (i = k = 0, ref = len; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
        normalized_val[i] = this.get_norm_value_at_index(info, i);
      }
      max = this._get_max(normalized_val);
      min = this._get_min(normalized_val);
      legend.min_val.set(min);
      return legend.max_val.set(max);
    } else {
      return this._vector[0].actualise_value_legend_all_fields(legend);
    }
  };

  VectorialField.prototype.z_index = function() {
    return 175;
  };

  VectorialField.prototype.draw = function(info, parameters, additionnal_parameters) {
    var ref, ref1, sub_field, warp_factor;
    if (parameters != null) {
      this.actualise_value_legend(info, parameters._legend, true);

      /*if info.ctx_type == "gl"
          nn = -1
          for el in @_mesh._elements when el.indices._data?
              @_update_gl_bufs info, ( nn += 1 ), el
              ni = nn + "_" + info.ctx.ctx_id
              w = if additionnal_parameters?.warp_by? and additionnal_parameters?.warp_factor
                  additionnal_parameters.warp_by
              el.draw_nodal_field_gl? info, @_mesh, @_mesh.points, @_data_buffer[ ni ], parameters.display_style.get(), parameters._legend, w, additionnal_parameters.warp_factor, ni
              
      else
       */
      if (this.dim() >= 2) {
        warp_factor = 0;
        if ((additionnal_parameters != null ? additionnal_parameters.warp_by : void 0) != null) {
          warp_factor = additionnal_parameters.warp_factor;
        }
        sub_field = this._vector[0].get_sub_field(info);
        if ((((ref = sub_field._mesh) != null ? ref.points : void 0) != null) && (((ref1 = sub_field._data) != null ? ref1._data : void 0) != null)) {
          this.draw_vectorial_field(info, parameters.display_style.get(), sub_field._mesh.points, sub_field._data._data, parameters._legend, warp_factor);
        }
      }
      return parameters._legend.draw(info);
    }
  };

  VectorialField.prototype._update_gl_bufs = function(info, nn, el) {
    var gl, i, k, ne, ni, ref, val;
    gl = info.ctx;
    ni = nn + "_" + gl.ctx_id;
    if (this._date_bufs[ni] == null) {
      this._date_bufs[ni] = -1;
    }
    if (this._date_bufs[ni] < this._data._date_last_modification || this._date_bufs[ni] < this._mesh._date_last_modification) {
      this._date_bufs[ni] = Model._counter;
      if (this._data_buffer[ni] != null) {
        gl.deleteBuffer(this._data_buffer[ni]);
      }
      this._data_buffer[ni] = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, this._data_buffer[ni]);
      ne = el._get_indices()._data.length;
      val = new Float32Array(ne);
      for (i = k = 0, ref = ne; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
        val[i] = this._data._data[el._get_indices().get(i)];
      }
      return gl.bufferData(gl.ARRAY_BUFFER, val, gl.STATIC_DRAW);
    }
  };

  VectorialField.prototype.draw_vectorial_field = function(info, display_style, points, values, legend, warp_factor, norm) {
    var arrow_p0, arrow_p1, arrow_reduce, arrow_width_factor, color, data, element, i, ind, int_field, k, len1, len2, len3, m, max_legend, min_legend, norm_values, o, orthogo, p, position, proj_p0, proj_p1, ref, results, val;
    if (warp_factor == null) {
      warp_factor = 1;
    }
    if (norm == null) {
      norm = true;
    }
    if (display_style === "Arrow") {
      color = "white";
      arrow_reduce = 0.3;
      arrow_width_factor = 0.1;
      results = [];
      for (ind = k = 0, len1 = points.length; k < len1; ind = ++k) {
        p = points[ind];
        element = new Lst;
        ref = this._vector;
        for (i = m = 0, len2 = ref.length; m < len2; i = ++m) {
          int_field = ref[i];
          data = int_field.get_sub_field(info)._data._data;
          element.push(data[ind] * warp_factor);
        }
        if (element.length === 2) {
          element.push(0);
        }
        proj_p0 = info.re_2_sc.proj(p.pos.get());
        proj_p1 = info.re_2_sc.proj(Vec_3.add(p.pos.get(), element.get()));
        orthogo = [proj_p0[1] - proj_p1[1], proj_p1[0] - proj_p0[0]];
        arrow_p0 = [(1 - arrow_reduce) * proj_p1[0] + arrow_reduce * proj_p0[0] + arrow_width_factor * orthogo[0], (1 - arrow_reduce) * proj_p1[1] + arrow_reduce * proj_p0[1] + arrow_width_factor * orthogo[1]];
        arrow_p1 = [(1 - arrow_reduce) * proj_p1[0] + arrow_reduce * proj_p0[0] - arrow_width_factor * orthogo[0], (1 - arrow_reduce) * proj_p1[1] + arrow_reduce * proj_p0[1] - arrow_width_factor * orthogo[1]];
        max_legend = legend.max_val.get();
        min_legend = legend.min_val.get();
        if (norm) {
          norm_values = [];
          for (i = o = 0, len3 = values.length; o < len3; i = ++o) {
            val = values[i];
            norm_values[i] = this.get_norm_value_at_index(info, i);
          }
          position = (max_legend - norm_values[ind]) / (max_legend - min_legend);
        } else {
          position = (max_legend - values[ind]) / (max_legend - min_legend);
        }
        color = legend.color_map.get_color_from_pos(position);
        results.push(this._draw_arrow_colored(info, proj_p0, proj_p1, arrow_p0, arrow_p1, color));
      }
      return results;
    }
  };

  VectorialField.prototype.warp_gl_buff = function(info, el, buff_id) {
    var cpp, dim, gl, i, k, m, ni, nn, pts, ref, ref1;
    gl = info.ctx;
    if (this._date_pts[buff_id] == null) {
      this._date_pts[buff_id] = -1;
    }
    if (this._date_pts[buff_id] < this._vector._date_last_modification) {
      this._date_pts[buff_id] = this._vector._date_last_modification;
      dim = 3;
      cpp = -1;
      pts = new Float32Array(el._get_indices().size(0) * dim * el._get_indices().size(1));
      for (i = k = 0, ref = el._get_indices().size(1); 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
        for (nn = m = 0, ref1 = el._get_indices().size(0); 0 <= ref1 ? m < ref1 : m > ref1; nn = 0 <= ref1 ? ++m : --m) {
          ni = el._get_indices().get([nn, i]);
          pts[cpp += 1] = this._vector[0] != null ? this._vector[0].get_sub_field(info).get_val(info, ni) : 0;
          pts[cpp += 1] = this._vector[1] != null ? this._vector[1].get_sub_field(info).get_val(info, ni) : 0;
          pts[cpp += 1] = this._vector[2] != null ? this._vector[2].get_sub_field(info).get_val(info, ni) : 0;
        }
      }
      if (this._pts_buffer[buff_id] != null) {
        gl.deleteBuffer(this._pts_buffer[buff_id]);
      }
      this._pts_buffer[buff_id] = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, this._pts_buffer[buff_id]);
      gl.bufferData(gl.ARRAY_BUFFER, pts, gl.STATIC_DRAW);
    }
    return this._pts_buffer[buff_id];
  };

  VectorialField.prototype._draw_arrow_colored = function(info, p0, p1, arrow_p0, arrow_p1, color) {
    info.ctx.beginPath();
    info.ctx.lineWidth = 1;
    info.ctx.strokeStyle = "rgba( " + color[0] + ", " + color[1] + ", " + color[2] + ", " + color[3] + " ) ";
    info.ctx.moveTo(p0[0], p0[1]);
    info.ctx.lineTo(p1[0], p1[1]);
    info.ctx.stroke();
    info.ctx.fillStyle = "rgba( " + color[0] + ", " + color[1] + ", " + color[2] + ", " + color[3] + " ) ";
    info.ctx.lineWidth = 0.8;
    info.ctx.moveTo(p1[0], p1[1]);
    info.ctx.lineTo(arrow_p0[0], arrow_p0[1]);
    info.ctx.lineTo(arrow_p1[0], arrow_p1[1]);
    info.ctx.lineTo(p1[0], p1[1]);
    info.ctx.fill();
    info.ctx.stroke();
    return info.ctx.closePath();
  };

  VectorialField.prototype._get_max = function(l) {
    var i, k, max, ref, val;
    if (l.length > 0) {
      max = l[0];
    }
    for (i = k = 1, ref = l.length; 1 <= ref ? k < ref : k > ref; i = 1 <= ref ? ++k : --k) {
      val = l[i];
      if (val > max) {
        max = val;
      }
    }
    return max;
  };

  VectorialField.prototype._get_min = function(l) {
    var i, k, min, ref, val;
    if (l.length > 0) {
      min = l[0];
    }
    for (i = k = 1, ref = l.length; 1 <= ref ? k < ref : k > ref; i = 1 <= ref ? ++k : --k) {
      val = l[i];
      if (val < min) {
        min = val;
      }
    }
    return min;
  };

  return VectorialField;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var FieldSet,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

FieldSet = (function(superClass) {
  extend(FieldSet, superClass);

  function FieldSet() {
    FieldSet.__super__.constructor.call(this);
    this.add_attr({
      color_by: new Choice,
      warp_by: new Choice,
      warp_factor: 0
    });
  }

  FieldSet.prototype.update_min_max = function(x_min, x_max) {
    var ref, ref1, ref2, ref3, ref4, ref5;
    if ((ref = this.color_by.lst[0]) != null) {
      if ((ref1 = ref.data._mesh) != null) {
        ref1.update_min_max(x_min, x_max);
      }
    }
    return (ref2 = this.color_by.lst[0]) != null ? (ref3 = ref2.data._data[0]) != null ? (ref4 = ref3.field) != null ? (ref5 = ref4._mesh) != null ? ref5.update_min_max(x_min, x_max) : void 0 : void 0 : void 0 : void 0;
  };

  FieldSet.prototype.get_model_editor_parameters = function(res) {
    return res.model_editor["color_by"] = ModelEditorItem_ChoiceWithEditableItems;
  };

  FieldSet.prototype.draw = function(info) {
    var f;
    f = this.color_by.item();
    if (f != null) {
      return f.draw(info, {
        warp_by: this.warp_by.item() != null ? this.warp_by.item().data : void 0,
        warp_factor: this.warp_factor.get()
      });
    }
  };

  FieldSet.prototype.sub_canvas_items = function(additionnal_parameters) {
    var f;
    f = this.color_by.item();
    if (f != null) {
      return f.sub_canvas_items(additionnal_parameters);
    } else {
      return [];
    }
  };

  FieldSet.prototype.z_index = function() {
    return 150;
  };

  return FieldSet;

})(Drawable);
// Generated by CoffeeScript 1.11.1
var ElementaryField,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ElementaryField = (function(superClass) {
  extend(ElementaryField, superClass);

  function ElementaryField(mesh) {
    ElementaryField.__super__.constructor.call(this);
    this.add_attr({
      _mesh: mesh,
      _data: new TypedArray_Float64(mesh != null ? mesh.nb_elements() : void 0)
    });
    this._date_bufs = {};
    this._data_buffer = {};
  }

  ElementaryField.prototype.get_drawing_parameters = function(model) {
    model.add_attr({
      drawing_parameters: {
        _legend: new Legend(model.name)
      }
    });
    return model.drawing_parameters.add_attr({
      display_style: new Choice(1, ["Wireframe", "Surface", "Surface with Edges"]),
      legend: model.drawing_parameters._legend
    });
  };

  ElementaryField.prototype.get_sub_field = function(info) {
    return this;
  };

  ElementaryField.prototype.update_min_max = function(x_min, x_max) {
    return this._mesh.update_min_max(x_min, x_max);
  };

  ElementaryField.prototype.toString = function() {
    return this.name.get();
  };

  ElementaryField.prototype.get = function() {
    return this._data.get();
  };

  ElementaryField.prototype.sub_canvas_items = function() {
    if (this.drawing_parameters != null) {
      return [this.drawing_parameters._legend];
    } else {
      return [];
    }
  };

  ElementaryField.prototype.z_index = function() {
    return 140;
  };

  ElementaryField.prototype.get_val = function(info, i) {
    return this._data.get(i);
  };

  ElementaryField.prototype.draw = function(info, parameters, additionnal_parameters) {
    var el, i, k, len, len1, m, ni, nn, offset_el, p, proj, ref, ref1, w;
    if (parameters != null) {
      this.actualise_value_legend(parameters._legend);
      if (info.ctx_type === "gl") {
        nn = -1;
        offset_el = 0;
        ref = this._mesh._elements;
        for (k = 0, len = ref.length; k < len; k++) {
          el = ref[k];
          if (!(el.indices._data != null)) {
            continue;
          }
          this._update_gl_bufs(info, (nn += 1), el, offset_el);
          ni = nn + "_" + info.ctx.ctx_id;
          w = ((additionnal_parameters != null ? additionnal_parameters.warp_by : void 0) != null) && (additionnal_parameters != null ? additionnal_parameters.warp_factor : void 0) ? additionnal_parameters.warp_by : void 0;
          if (typeof el.draw_nodal_field_gl === "function") {
            el.draw_nodal_field_gl(info, this._mesh, this._mesh.points, this._data_buffer[ni], parameters.display_style.get(), parameters._legend, w, additionnal_parameters.warp_factor, ni);
          }
          offset_el += el.indices.size(1);
        }
      } else {
        proj = (function() {
          var len1, len2, m, n, ref1, ref2, ref3, ref4, ref5, ref6, results, results1;
          if (((additionnal_parameters != null ? additionnal_parameters.warp_by : void 0) != null) && this._mesh.points.length === ((ref1 = additionnal_parameters.warp_by._vector[0]) != null ? (ref2 = ref1._data[0]) != null ? (ref3 = ref2.field) != null ? (ref4 = ref3._data.size()) != null ? ref4[0] : void 0 : void 0 : void 0 : void 0)) {
            ref5 = this._mesh.points;
            results = [];
            for (i = m = 0, len1 = ref5.length; m < len1; i = ++m) {
              p = ref5[i];
              results.push(info.re_2_sc.proj(Vec_3.add(p.pos.get(), Vec_3.mus(additionnal_parameters.warp_factor, additionnal_parameters.warp_by.get_val(info, i, 3)))));
            }
            return results;
          } else {
            ref6 = this._mesh.points;
            results1 = [];
            for (i = n = 0, len2 = ref6.length; n < len2; i = ++n) {
              p = ref6[i];
              results1.push(info.re_2_sc.proj(p.pos.get()));
            }
            return results1;
          }
        }).call(this);
        ref1 = this._mesh._elements;
        for (m = 0, len1 = ref1.length; m < len1; m++) {
          el = ref1[m];
          if (typeof el.draw_elementary_triangle === "function") {
            el.draw_elementary_triangle(info, proj, this._data, parameters.display_style.get(), parameters._legend);
          }
        }
      }
      return parameters._legend.draw(info);
    }
  };

  ElementaryField.prototype.actualise_value_legend = function(legend) {
    var max, min;
    if (this._data.has_been_modified() || !legend.is_correct()) {
      min = this.get_min_data();
      legend.min_val.set(min);
      max = this.get_max_data();
      return legend.max_val.set(max);
    }
  };

  ElementaryField.prototype.get_min_data = function() {
    return this._get_min(this._data.get());
  };

  ElementaryField.prototype.get_max_data = function() {
    return this._get_max(this._data.get());
  };

  ElementaryField.prototype._update_gl_bufs = function(info, nn, el, offset_el) {
    var cpe, gl, i, j, k, m, ne, ni, ref, ref1, val;
    gl = info.ctx;
    ni = nn + "_" + gl.ctx_id;
    if (this._date_bufs[ni] == null) {
      this._date_bufs[ni] = -1;
    }
    if (this._date_bufs[ni] < this._data._date_last_modification || this._date_bufs[ni] < this._mesh._date_last_modification) {
      this._date_bufs[ni] = Model._counter;
      if (this._data_buffer[ni] != null) {
        gl.deleteBuffer(this._data_buffer[ni]);
      }
      this._data_buffer[ni] = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, this._data_buffer[ni]);
      cpe = -1;
      ne = el.indices._data.length;
      val = new Float32Array(ne);
      for (i = k = 0, ref = el.indices.size(1); 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
        for (j = m = 0, ref1 = el.indices.size(0); 0 <= ref1 ? m < ref1 : m > ref1; j = 0 <= ref1 ? ++m : --m) {
          val[cpe += 1] = this._data._data[i + offset_el];
        }
      }
      return gl.bufferData(gl.ARRAY_BUFFER, val, gl.STATIC_DRAW);
    }
  };

  ElementaryField.prototype._get_max = function(l) {
    var i, k, max, ref, val;
    if (l.length > 0) {
      max = l[0];
    }
    for (i = k = 1, ref = l.length; 1 <= ref ? k < ref : k > ref; i = 1 <= ref ? ++k : --k) {
      val = l[i];
      if (val > max) {
        max = val;
      }
    }
    return max;
  };

  ElementaryField.prototype._get_min = function(l) {
    var i, k, min, ref, val;
    if (l.length > 0) {
      min = l[0];
    }
    for (i = k = 1, ref = l.length; 1 <= ref ? k < ref : k > ref; i = 1 <= ref ? ++k : --k) {
      val = l[i];
      if (val < min) {
        min = val;
      }
    }
    return min;
  };

  return ElementaryField;

})(Model);
// Generated by CoffeeScript 1.11.1
var Element_Line,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Element_Line = (function(superClass) {
  extend(Element_Line, superClass);

  function Element_Line(indices) {
    if (indices == null) {
      indices = [];
    }
    Element_Line.__super__.constructor.call(this, indices);
    this.cut_with_point_callback = [];
  }

  Element_Line.prototype.draw_gl = function(info, mesh, points, is_a_sub, theme) {
    var i, p, proj;
    if (theme == null) {
      theme = info.theme.lines;
    }
    proj = (function() {
      var j, len, results;
      results = [];
      for (i = j = 0, len = points.length; j < len; i = ++j) {
        p = points[i];
        results.push(info.re_2_sc.proj(p.pos.get()));
      }
      return results;
    })();
    return this.draw(info, mesh, proj, is_a_sub);
  };

  Element_Line.prototype.draw = function(info, mesh, proj, is_a_sub, theme) {
    var i, j, ref, ref1, wf;
    if (theme == null) {
      theme = info.theme.lines;
    }
    wf = (ref = mesh.visualization.display_style.get()) === "Wireframe" || ref === "Surface with Edges";
    theme = mesh._theme.lines;
    if (wf || !is_a_sub) {
      theme.beg_ctx(info);
      if (this.indices.length) {
        for (i = j = 0, ref1 = this.indices.length - 1; 0 <= ref1 ? j < ref1 : j > ref1; i = 0 <= ref1 ? ++j : --j) {
          theme.draw_straight_proj(info, proj[this.indices[i].get()], proj[this.indices[i + 1].get()]);
        }
      }
      return theme.end_ctx(info);
    }
  };

  Element_Line.prototype.contour = function(info, mesh, proj, beg, inversion) {
    var i, j, k, ref, ref1, results, results1;
    if (this.indices.length >= 2) {
      if (inversion) {
        results = [];
        for (i = j = ref = this.indices.length - 2; ref <= 0 ? j <= 0 : j >= 0; i = ref <= 0 ? ++j : --j) {
          results.push(mesh._theme.lines.contour_straight_proj(info, proj[this.indices[i + 1].get()], proj[this.indices[i].get()], beg && i === 0));
        }
        return results;
      } else {
        results1 = [];
        for (i = k = 0, ref1 = this.indices.length - 1; 0 <= ref1 ? k < ref1 : k > ref1; i = 0 <= ref1 ? ++k : --k) {
          results1.push(mesh._theme.lines.contour_straight_proj(info, proj[this.indices[i].get()], proj[this.indices[i + 1].get()], beg && i === 0));
        }
        return results1;
      }
    }
  };

  Element_Line.prototype.closest_point_closer_than = function(best, mesh, proj, info, pos) {
    var P0, P1, a, b, d, dist, dx, dy, dz, i, j, l, p0, p1, px, py, pz, r, ref, results;
    if (this.indices.length) {
      results = [];
      for (i = j = 0, ref = this.indices.length - 1; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
        p0 = this.indices[i + 0].get();
        p1 = this.indices[i + 1].get();
        a = proj[p0];
        b = proj[p1];
        if (a[0] !== b[0] || a[1] !== b[1]) {
          dx = b[0] - a[0];
          dy = b[1] - a[1];
          dz = b[2] - a[2];
          px = pos[0] - a[0];
          py = pos[1] - a[1];
          l = dx * dx + dy * dy;
          d = px * dx + py * dy;
          if (l && d >= 0 && d <= l) {
            r = d / l;
            px = a[0] + dx * r;
            py = a[1] + dy * r;
            pz = a[2] + dz * r;
            dist = Math.sqrt(Math.pow(px - pos[0], 2) + Math.pow(py - pos[1], 2));
            if (best.dist >= dist) {
              P0 = mesh.points[p0].pos.get();
              P1 = mesh.points[p1].pos.get();
              best.dist = dist;
              best.inst = this;
              best.indi = i;
              best.curv = r;
              results.push(best.disp = [P0[0] * (1 - r) + P1[0] * r, P0[1] * (1 - r) + P1[1] * r, P0[2] * (1 - r) + P1[2] * r]);
            } else {
              results.push(void 0);
            }
          } else {
            results.push(void 0);
          }
        } else {
          results.push(void 0);
        }
      }
      return results;
    }
  };

  Element_Line.prototype.cut_with_point = function(divisions, data, mesh, np, ip) {
    var fun, j, len, ref, results;
    if (data.inst === this) {
      if (divisions[this.model_id] == null) {
        divisions[this.model_id] = [new Element_Line([this.indices[0].get(), np]), new Element_Line([np, this.indices[1].get()])];
      }
      ref = this.cut_with_point_callback;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        fun = ref[j];
        results.push(fun(mesh, this.indices, np));
      }
      return results;
    }
  };

  return Element_Line;

})(Element_WithIndices);
// Generated by CoffeeScript 1.11.1
var Element_Arc,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Element_Arc = (function(superClass) {
  extend(Element_Arc, superClass);

  function Element_Arc(indices) {
    Element_Arc.__super__.constructor.call(this, indices);
  }

  Element_Arc.prototype.draw_gl = function(info, mesh, points, is_a_sub, theme) {
    if (theme == null) {
      theme = info.theme.lines;
    }
    return this.draw(info, mesh, points, is_a_sub, theme);
  };

  Element_Arc.prototype.draw = function(info, mesh, proj, is_a_sub, theme) {
    var p, points, ref, wf;
    if (theme == null) {
      theme = info.theme.lines;
    }
    wf = (ref = mesh.visualization.display_style.get()) === "Wireframe" || ref === "Surface with Edges";
    if (wf || !is_a_sub) {
      theme.beg_ctx(info);
      points = (function() {
        var j, len, ref1, results;
        ref1 = this.indices;
        results = [];
        for (j = 0, len = ref1.length; j < len; j++) {
          p = ref1[j];
          results.push(mesh.points[p.get()].pos.get());
        }
        return results;
      }).call(this);
      info.theme.lines.draw_interpolated_arcs(info, points);
      return theme.end_ctx(info);
    }
  };

  Element_Arc.prototype.contour = function(info, mesh, proj, beg, inversion) {
    var p, points;
    points = (function() {
      var j, k, len, ref, ref1, results, results1;
      if (inversion) {
        results = [];
        for (p = j = ref = this.indices.length - 1; ref <= 0 ? j <= 0 : j >= 0; p = ref <= 0 ? ++j : --j) {
          results.push(mesh.points[this.indices[p].get()].pos.get());
        }
        return results;
      } else {
        ref1 = this.indices;
        results1 = [];
        for (k = 0, len = ref1.length; k < len; k++) {
          p = ref1[k];
          results1.push(mesh.points[p.get()].pos.get());
        }
        return results1;
      }
    }).call(this);
    return info.theme.lines.contour_interpolated_arcs(info, points, beg);
  };

  Element_Arc.prototype.closest_point_closer_than = function(best, mesh, proj, info, pos) {
    var P0, P1, a, b, d, dist, dx, dy, dz, i, j, l, p0, p1, px, py, pz, r, ref, results;
    if (this.indices.length) {
      results = [];
      for (i = j = 0, ref = this.indices.length - 1; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
        p0 = this.indices[i + 0].get();
        p1 = this.indices[i + 1].get();
        a = proj[p0];
        b = proj[p1];
        if (a[0] !== b[0] || a[1] !== b[1]) {
          dx = b[0] - a[0];
          dy = b[1] - a[1];
          dz = b[2] - a[2];
          px = pos[0] - a[0];
          py = pos[1] - a[1];
          l = dx * dx + dy * dy;
          d = px * dx + py * dy;
          if (l && d >= 0 && d <= l) {
            r = d / l;
            px = a[0] + dx * r;
            py = a[1] + dy * r;
            pz = a[2] + dz * r;
            dist = Math.sqrt(Math.pow(px - pos[0], 2) + Math.pow(py - pos[1], 2));
            if (best.dist >= dist) {
              P0 = mesh.points[p0].pos.get();
              P1 = mesh.points[p1].pos.get();
              best.dist = dist;
              best.inst = this;
              best.indi = i;
              best.curv = r;
              results.push(best.disp = [P0[0] * (1 - r) + P1[0] * r, P0[1] * (1 - r) + P1[1] * r, P0[2] * (1 - r) + P1[2] * r]);
            } else {
              results.push(void 0);
            }
          } else {
            results.push(void 0);
          }
        } else {
          results.push(void 0);
        }
      }
      return results;
    }
  };

  return Element_Arc;

})(Element_WithIndices);
// Generated by CoffeeScript 1.11.1
var Element_TriangleList,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Element_TriangleList = (function(superClass) {
  extend(Element_TriangleList, superClass);

  function Element_TriangleList() {
    Element_TriangleList.__super__.constructor.call(this);
    this.add_attr({
      indices: new TypedArray_Int32([3, 0])
    });
    this._date_pts = {};
    this._pts_buffer = {};
    this._nor_buffer = {};
    this._lns_buffer = {};
  }

  Element_TriangleList.prototype.draw_gl = function(info, mesh, points, is_a_sub) {
    var col, fs, gl, mesh_color, nor, pos, ps, ref, ref1, ref2, ref3, vs;
    if (this._get_indices() && mesh.get_point(0)) {
      this._update_bufs(info, mesh, points);
      gl = info.ctx;
      if ((ref = mesh.visualization.display_style.get()) === "Points" || ref === "Wireframe" || ref === "Surface" || ref === "Surface with Edges") {
        vs = "precision mediump float;\n attribute vec3 pos;\n attribute vec3 nor;\n varying vec3 norin;\n " + (info.cam.gl_attr_vec(info, "can")) + "\n " + (info.cam.gl_attr(info, "cam")) + "\n void main( void ) {\n gl_Position = vec4( pos, 1.0 );\n " + (info.cam.gl_main_vec(info, "can", "nor", "norin")) + "\n " + (info.cam.gl_main(info, "cam")) + "\n }\n";
        fs = "precision mediump float;\n uniform vec4 col;\n varying vec3 norin;\n void main( void ) {\n float g = abs( norin[ 2 ] );\n gl_FragColor = vec4( g * col[ 0 ], g * col[ 1 ], g * col[ 2 ], col[ 3 ] );\n }\n";
        ps = info.cm.gl_prog(vs, fs);
        gl.useProgram(ps);
        pos = gl.getAttribLocation(ps, "pos");
        gl.enableVertexAttribArray(pos);
        gl.bindBuffer(gl.ARRAY_BUFFER, this._pts_buffer[gl.ctx_id]);
        gl.vertexAttribPointer(pos, 3, gl.FLOAT, false, 0, 0);
        nor = gl.getAttribLocation(ps, "nor");
        gl.enableVertexAttribArray(nor);
        gl.bindBuffer(gl.ARRAY_BUFFER, this._nor_buffer[gl.ctx_id]);
        gl.vertexAttribPointer(nor, 3, gl.FLOAT, false, 0, 0);
        col = gl.getUniformLocation(ps, "col");
        mesh_color = mesh._theme.surfaces.color;
        this.line_color = mesh._theme.lines.color;
        gl.uniform4f(col, mesh_color.r.get() / 255, mesh_color.g.get() / 255, mesh_color.b.get() / 255, mesh_color.a.get() / 255);
        info.cam.gl_exec(info, "cam", ps);
        info.cam.gl_exec_vec(info, "can", ps);
        if ((ref1 = mesh.visualization.display_style.get()) === "Surface" || ref1 === "Surface with Edges") {
          gl.drawArrays(gl.TRIANGLES, 0, 3 * this.indices.size(1));
        }
      }
      if ((ref2 = mesh.visualization.display_style.get()) === "Wireframe" || ref2 === "Surface with Edges") {
        this._draw_lines(info);
      }
      if ((ref3 = mesh.visualization.display_style.get()) === "Points") {
        return this._draw_points(info);
      }
    }
  };

  Element_TriangleList.prototype.draw = function(info, mesh, proj, is_a_sub) {
    var i, j, k, l, len, lt, p, pl, ref, ref1, ref2;
    if (this._get_indices()) {
      if ((ref = mesh.visualization.display_style.get()) === "Surface" || ref === "Surface with Edges") {
        lt = (function() {
          var k, ref1, results;
          results = [];
          for (i = k = 0, ref1 = this.indices.size(1); 0 <= ref1 ? k < ref1 : k > ref1; i = 0 <= ref1 ? ++k : --k) {
            results.push([proj[this.indices.get([0, i])], proj[this.indices.get([1, i])], proj[this.indices.get([2, i])]]);
          }
          return results;
        }).call(this);
        lt.sort(function(a, b) {
          return (b[0][2] + b[1][2] + b[2][2]) - (a[0][2] + a[1][2] + a[2][2]);
        });
        info.theme.surfaces.beg_ctx(info);
        for (k = 0, len = lt.length; k < len; k++) {
          pl = lt[k];
          info.theme.surfaces.draw(info, (function(_this) {
            return function() {
              info.ctx.moveTo(pl[0][0], pl[0][1]);
              info.ctx.lineTo(pl[1][0], pl[1][1]);
              info.ctx.lineTo(pl[2][0], pl[2][1]);
              return info.ctx.lineTo(pl[0][0], pl[0][1]);
            };
          })(this));
        }
        info.theme.surfaces.end_ctx(info);
      }
      if ((ref1 = mesh.visualization.display_style.get()) === "Wireframe" || ref1 === "Surface with Edges") {
        info.theme.lines.beg_ctx(info);
        for (i = l = 0, ref2 = this.indices.size(1); 0 <= ref2 ? l < ref2 : l > ref2; i = 0 <= ref2 ? ++l : --l) {
          p = (function() {
            var m, results;
            results = [];
            for (j = m = 0; m < 3; j = ++m) {
              results.push(proj[this.indices.get([j, i])]);
            }
            return results;
          }).call(this);
          info.theme.lines.draw_straight_proj(info, p[0], p[1]);
          info.theme.lines.draw_straight_proj(info, p[1], p[2]);
          info.theme.lines.draw_straight_proj(info, p[2], p[0]);
        }
        return info.theme.lines.end_ctx(info);
      }
    }
  };

  Element_TriangleList.prototype.draw_nodal_field_gl = function(info, mesh, points, data, display_style, legend, warp_by, warp_factor, buff_id) {
    var col, fs, gl, nor, pos, ps, tex, vs, wab, warp_buff;
    if (warp_factor == null) {
      warp_factor = 1;
    }
    if (this._get_indices()) {
      warp_buff = warp_by != null ? warp_by.warp_gl_buff(info, this, buff_id) : void 0;
      this._update_bufs(info, mesh, points);
      gl = info.ctx;
      if (display_style === "Surface" || display_style === "Surface with Edges") {
        vs = "precision mediump float;\n varying float y;\n varying vec3 norin;\n uniform float mit;\n uniform float mat;\n uniform float waf;\n attribute vec3 pos;\n attribute vec3 nor;\n attribute vec3 wab;\n attribute float tex;\n " + (info.cam.gl_attr_vec(info, "can")) + "\n " + (info.cam.gl_attr(info, "cam")) + "\n void main( void ) {\n y = ( tex - mit ) / ( mat - mit );\n gl_Position = vec4( pos + waf * wab, 1.0 );\n " + (info.cam.gl_main_vec(info, "can", "nor", "norin")) + "\n " + (info.cam.gl_main(info, "cam")) + "\n }\n";
        fs = legend.color_map.get_fragment_shader("y", "col", "norin");
        ps = info.cm.gl_prog(vs, fs);
        gl.useProgram(ps);
        pos = gl.getAttribLocation(ps, "pos");
        gl.enableVertexAttribArray(pos);
        gl.bindBuffer(gl.ARRAY_BUFFER, this._pts_buffer[gl.ctx_id]);
        gl.vertexAttribPointer(pos, 3, gl.FLOAT, false, 0, 0);
        nor = gl.getAttribLocation(ps, "nor");
        gl.enableVertexAttribArray(nor);
        gl.bindBuffer(gl.ARRAY_BUFFER, this._nor_buffer[gl.ctx_id]);
        gl.vertexAttribPointer(nor, 3, gl.FLOAT, false, 0, 0);
        wab = gl.getAttribLocation(ps, "wab");
        gl.enableVertexAttribArray(wab);
        if (warp_buff != null) {
          gl.bindBuffer(gl.ARRAY_BUFFER, warp_buff);
        } else {
          gl.bindBuffer(gl.ARRAY_BUFFER, this._nor_buffer[gl.ctx_id]);
        }
        gl.vertexAttribPointer(wab, 3, gl.FLOAT, false, 0, 0);
        tex = gl.getAttribLocation(ps, "tex");
        if (tex >= 0) {
          gl.enableVertexAttribArray(tex);
          gl.bindBuffer(gl.ARRAY_BUFFER, data);
          gl.vertexAttribPointer(tex, 1, gl.FLOAT, false, 0, 0);
        }
        col = gl.getUniformLocation(ps, "col");
        gl.uniform4f(col, 0.7, 0.7, 0.7, 1.0);
        gl.uniform1f(gl.getUniformLocation(ps, "mit"), legend._min_val.get());
        gl.uniform1f(gl.getUniformLocation(ps, "mat"), legend._max_val.get());
        gl.uniform1f(gl.getUniformLocation(ps, "waf"), warp_factor);
        info.cam.gl_exec(info, "cam", ps);
        info.cam.gl_exec_vec(info, "can", ps);
        gl.drawArrays(gl.TRIANGLES, 0, 3 * this.indices.size(1));
        gl.disableVertexAttribArray(pos);
        gl.disableVertexAttribArray(nor);
        gl.disableVertexAttribArray(wab);
        gl.disableVertexAttribArray(tex);
      }
      if (display_style === "Wireframe" || display_style === "Surface with Edges") {
        return this._draw_lines(info);
      }
    }
  };

  Element_TriangleList.prototype.draw_vectorial_field_gl = function(info, mesh, points, data, display_style, legend, warp_by, warp_factor, buff_id) {
    var col, cpp, dim, fs, gl, i, k, nor, pos, ps, pts, ref, tex, vs, wab, warp_buff;
    if (warp_factor == null) {
      warp_factor = 1;
    }
    if (this._get_indices()) {
      warp_buff = warp_by != null ? warp_by.warp_gl_buff(info, this, buff_id) : void 0;
      gl = info.ctx;
      if (this._date_pts[gl.ctx_id] == null) {
        this._date_pts[gl.ctx_id] = -1;
      }
      if (this._date_pts[gl.ctx_id] < mesh._date_last_modification) {
        this._date_pts[gl.ctx_id] = mesh._date_last_modification;
        dim = 3;
        cpp = -1;
        pts = new Float32Array(2 * dim * points.length);
        for (i = k = 0, ref = points.length; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
          pts[cpp += 1] = points[i].pos[0].get();
          pts[cpp += 1] = points[i].pos[1].get();
          pts[cpp += 1] = points[i].pos[2].get();
          pts[cpp += 1] = points[i].pos[0].get();
          pts[cpp += 1] = points[i].pos[1].get();
          pts[cpp += 1] = points[i].pos[2].get();
        }
        if (this._pts_buffer[gl.ctx_id] != null) {
          gl.deleteBuffer(this._pts_buffer[gl.ctx_id]);
          gl.deleteBuffer(this._nor_buffer[gl.ctx_id]);
          gl.deleteBuffer(this._lns_buffer[gl.ctx_id]);
        }
        this._pts_buffer[gl.ctx_id] = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this._pts_buffer[gl.ctx_id]);
        gl.bufferData(gl.ARRAY_BUFFER, pts, gl.STATIC_DRAW);
        this._nor_buffer[gl.ctx_id] = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this._nor_buffer[gl.ctx_id]);
        gl.bufferData(gl.ARRAY_BUFFER, nor, gl.STATIC_DRAW);
        this._lns_buffer[gl.ctx_id] = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this._lns_buffer[gl.ctx_id]);
        gl.bufferData(gl.ARRAY_BUFFER, lns, gl.STATIC_DRAW);
      }
      if (display_style === "Surface" || display_style === "Surface with Edges") {
        vs = "precision mediump float;\n varying float y;\n varying vec3 norin;\n uniform float mit;\n uniform float mat;\n uniform float waf;\n attribute vec3 pos;\n attribute vec3 nor;\n attribute vec3 wab;\n attribute float tex;\n " + (info.cam.gl_attr_vec(info, "can")) + "\n " + (info.cam.gl_attr(info, "cam")) + "\n void main( void ) {\n y = ( tex - mit ) / ( mat - mit );\n gl_Position = vec4( pos + waf * wab, 1.0 );\n " + (info.cam.gl_main_vec(info, "can", "nor", "norin")) + "\n " + (info.cam.gl_main(info, "cam")) + "\n }\n";
        fs = legend.color_map.get_fragment_shader("y", "col", "norin");
        ps = info.cm.gl_prog(vs, fs);
        gl.useProgram(ps);
        pos = gl.getAttribLocation(ps, "pos");
        gl.enableVertexAttribArray(pos);
        gl.bindBuffer(gl.ARRAY_BUFFER, this._pts_buffer[gl.ctx_id]);
        gl.vertexAttribPointer(pos, 3, gl.FLOAT, false, 0, 0);
        nor = gl.getAttribLocation(ps, "nor");
        gl.enableVertexAttribArray(nor);
        gl.bindBuffer(gl.ARRAY_BUFFER, this._nor_buffer[gl.ctx_id]);
        gl.vertexAttribPointer(nor, 3, gl.FLOAT, false, 0, 0);
        wab = gl.getAttribLocation(ps, "wab");
        gl.enableVertexAttribArray(wab);
        if (warp_buff != null) {
          gl.bindBuffer(gl.ARRAY_BUFFER, warp_buff);
        } else {
          gl.bindBuffer(gl.ARRAY_BUFFER, this._nor_buffer[gl.ctx_id]);
        }
        gl.vertexAttribPointer(wab, 3, gl.FLOAT, false, 0, 0);
        tex = gl.getAttribLocation(ps, "tex");
        if (tex >= 0) {
          gl.enableVertexAttribArray(tex);
          gl.bindBuffer(gl.ARRAY_BUFFER, data);
          gl.vertexAttribPointer(tex, 1, gl.FLOAT, false, 0, 0);
        }
        col = gl.getUniformLocation(ps, "col");
        gl.uniform4f(col, 0.7, 0.7, 0.7, 1.0);
        gl.uniform1f(gl.getUniformLocation(ps, "mit"), legend._min_val.get());
        gl.uniform1f(gl.getUniformLocation(ps, "mat"), legend._max_val.get());
        gl.uniform1f(gl.getUniformLocation(ps, "waf"), warp_factor);
        info.cam.gl_exec(info, "cam", ps);
        info.cam.gl_exec_vec(info, "can", ps);
        gl.drawArrays(gl.TRIANGLES, 0, 3 * this.indices.size(1));
        gl.disableVertexAttribArray(pos);
        gl.disableVertexAttribArray(nor);
        gl.disableVertexAttribArray(wab);
        gl.disableVertexAttribArray(tex);
      }
      if (display_style === "Wireframe" || display_style === "Surface with Edges") {
        return this._draw_lines(info);
      }
    }
  };

  Element_TriangleList.prototype.draw_nodal_field = function(info, proj, data, display_style, legend) {
    var a, alpha, b, c, det, det_a, det_b, det_c, div_legend, i, indices, k, l, len, len1, mat_a, mat_b, mat_c, mat_pos, max_legend, min_legend, num_triangle, p0, p0x0, p0y0, p1, p1ieqz, posit, results, tri, val, vals, x0, x1, x2, y0, y1, y2;
    if (this._get_indices()) {
      max_legend = legend.max_val.get();
      min_legend = legend.min_val.get();
      div_legend = max_legend - min_legend;
      div_legend = 1 / (div_legend + (div_legend === 0));
      indices = (function() {
        var k, ref, results;
        results = [];
        for (num_triangle = k = 0, ref = this.indices.size(1); 0 <= ref ? k < ref : k > ref; num_triangle = 0 <= ref ? ++k : --k) {
          results.push([this.indices.get([0, num_triangle]), this.indices.get([1, num_triangle]), this.indices.get([2, num_triangle])]);
        }
        return results;
      }).call(this);
      indices.sort(function(a, b) {
        return (proj[b[0]][2] + proj[b[1]][2] + proj[b[2]][2]) - (proj[a[0]][2] + proj[a[1]][2] + proj[a[2]][2]);
      });
      results = [];
      for (k = 0, len = indices.length; k < len; k++) {
        tri = indices[k];
        vals = [data.get(tri[0]), data.get(tri[1]), data.get(tri[2])];
        for (i = l = 0, len1 = vals.length; l < len1; i = ++l) {
          val = vals[i];
          vals[i] = (max_legend - val) * div_legend;
        }
        posit = (function() {
          var m, results1;
          results1 = [];
          for (i = m = 0; m < 3; i = ++m) {
            results1.push(proj[tri[i]]);
          }
          return results1;
        })();
        x0 = posit[0][0];
        y0 = posit[0][1];
        x1 = posit[1][0];
        y1 = posit[1][1];
        x2 = posit[2][0];
        y2 = posit[2][1];
        mat_pos = [[1, x0, y0], [1, x1, y1], [1, x2, y2]];
        det = Vec_3.determinant(mat_pos);
        det += det === 0;
        mat_a = [[vals[0], x0, y0], [vals[1], x1, y1], [vals[2], x2, y2]];
        det_a = Vec_3.determinant(mat_a);
        a = det_a / det;
        mat_b = [[1, vals[0], y0], [1, vals[1], y1], [1, vals[2], y2]];
        det_b = Vec_3.determinant(mat_b);
        b = det_b / det;
        mat_c = [[1, x0, vals[0]], [1, x1, vals[1]], [1, x2, vals[2]]];
        det_c = Vec_3.determinant(mat_c);
        c = det_c / det;
        if (b || c) {
          if (Math.abs(b) > Math.abs(c)) {
            p0x0 = -a / b;
            p0y0 = 0;
          } else {
            p0x0 = 0;
            p0y0 = -a / c;
          }
        } else {
          p0x0 = 0;
          p0y0 = 0;
        }
        p0 = [p0x0, p0y0, 0];
        p1ieqz = function(x) {
          return x + (Math.abs(x) < 1e-16);
        };
        alpha = 1 / p1ieqz(b * b + c * c);
        p1 = Vec_3.add(p0, Vec_3.mus(alpha, [b, c, 0]));
        if (display_style === "Surface" || display_style === "Surface with Edges") {
          this._draw_gradient_fill_triangle(info, p0, p1, posit, legend);
        }
        if (display_style === "Surface with Edges" || display_style === "Edges") {
          this._draw_edge_triangle(info, posit);
        }
        if (display_style === "Wireframe") {
          results.push(this._draw_gradient_stroke_triangle(info, p0, p1, posit, legend));
        } else {
          results.push(void 0);
        }
      }
      return results;
    }
  };

  Element_TriangleList.prototype._draw_lines = function(info) {
    var col, fs, gl, pos, ps, vs;
    vs = "precision mediump float;\n attribute vec3 pos;\n " + (info.cam.gl_attr(info, "cam")) + "\n void main( void ) {\n gl_Position = vec4( pos, 1.0 );\n " + (info.cam.gl_main(info, "cam")) + "\n gl_Position -= 1e-5;\n }\n";
    fs = "precision mediump float;\n uniform vec4 col;\n void main( void ) {\n gl_FragColor = col;\n }\n";
    ps = info.cm.gl_prog(vs, fs);
    gl = info.ctx;
    gl.useProgram(ps);
    pos = gl.getAttribLocation(ps, "pos");
    gl.enableVertexAttribArray(pos);
    gl.bindBuffer(gl.ARRAY_BUFFER, this._lns_buffer[gl.ctx_id]);
    gl.vertexAttribPointer(pos, 3, gl.FLOAT, false, 0, 0);
    col = gl.getUniformLocation(ps, "col");
    if (this.line_color != null) {
      gl.uniform4f(col, this.line_color.r.get() / 255, this.line_color.g.get() / 255, this.line_color.b.get() / 255, this.line_color.a.get() / 255);
    } else {
      gl.uniform4f(col, 1.0, 1.0, 1.0, 1.0);
    }
    info.cam.gl_exec(info, "cam", ps);
    gl.lineWidth(2);
    return gl.drawArrays(gl.LINES, 0, 6 * this.indices.size(1));
  };

  Element_TriangleList.prototype._draw_points = function(info) {
    var col, fs, gl, pos, ps, vs;
    vs = "precision mediump float;\n attribute vec3 pos;\n " + (info.cam.gl_attr(info, "cam")) + "\n void main( void ) {\n gl_Position = vec4( pos, 1.0 );\n " + (info.cam.gl_main(info, "cam")) + "\n gl_Position -= 1e-5;\n }\n";
    fs = "precision mediump float;\n uniform vec4 col;\n void main( void ) {\n gl_FragColor = col;\n }\n";
    ps = info.cm.gl_prog(vs, fs);
    gl = info.ctx;
    gl.useProgram(ps);
    pos = gl.getAttribLocation(ps, "pos");
    gl.enableVertexAttribArray(pos);
    gl.bindBuffer(gl.ARRAY_BUFFER, this._lns_buffer[0]);
    gl.vertexAttribPointer(pos, 3, gl.FLOAT, false, 0, 0);
    col = gl.getUniformLocation(ps, "col");
    gl.uniform4f(col, 1.0, 1.0, 1.0, 1.0);
    info.cam.gl_exec(info, "cam", ps);
    gl.lineWidth(2);
    return gl.drawArrays(gl.POINTS, 0, 6 * this.indices.size(1));
  };

  Element_TriangleList.prototype._update_bufs = function(info, mesh, points) {
    var cpl, cpn, cpp, dim, gl, i, k, l, len, len1, len10, len11, len2, len3, len4, len5, len6, len7, len8, len9, lns, m, n, nn, nor, o, p0, p1, p2, pts, q, r, ref, s, t, u, v, w, y, z;
    if (this._get_indices()) {
      gl = info.ctx;
      if (this._date_pts[gl.ctx_id] == null) {
        this._date_pts[gl.ctx_id] = -1;
      }
      if (this._date_pts[gl.ctx_id] < mesh._date_last_modification) {
        this._date_pts[gl.ctx_id] = mesh._date_last_modification;
        dim = 3;
        cpp = -1;
        cpn = -1;
        cpl = -1;
        pts = new Float32Array(3 * dim * this.indices.size(1));
        nor = new Float32Array(3 * dim * this.indices.size(1));
        lns = new Float32Array(6 * dim * this.indices.size(1));
        for (i = k = 0, ref = this.indices.size(1); 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
          p0 = mesh.get_point(this.indices.get([0, i]));
          p1 = mesh.get_point(this.indices.get([1, i]));
          p2 = mesh.get_point(this.indices.get([2, i]));
          if (!p0 || !p1 || !p2) {
            continue;
          }
          nn = Vec_3.nor(Vec_3.cro(Vec_3.sub(p1, p0), Vec_3.sub(p2, p0)));
          for (l = 0, len = p0.length; l < len; l++) {
            v = p0[l];
            pts[cpp += 1] = v;
          }
          for (m = 0, len1 = p1.length; m < len1; m++) {
            v = p1[m];
            pts[cpp += 1] = v;
          }
          for (n = 0, len2 = p2.length; n < len2; n++) {
            v = p2[n];
            pts[cpp += 1] = v;
          }
          for (o = 0, len3 = nn.length; o < len3; o++) {
            v = nn[o];
            nor[cpn += 1] = v;
          }
          for (q = 0, len4 = nn.length; q < len4; q++) {
            v = nn[q];
            nor[cpn += 1] = v;
          }
          for (r = 0, len5 = nn.length; r < len5; r++) {
            v = nn[r];
            nor[cpn += 1] = v;
          }
          for (s = 0, len6 = p0.length; s < len6; s++) {
            v = p0[s];
            lns[cpl += 1] = v;
          }
          for (t = 0, len7 = p1.length; t < len7; t++) {
            v = p1[t];
            lns[cpl += 1] = v;
          }
          for (u = 0, len8 = p1.length; u < len8; u++) {
            v = p1[u];
            lns[cpl += 1] = v;
          }
          for (w = 0, len9 = p2.length; w < len9; w++) {
            v = p2[w];
            lns[cpl += 1] = v;
          }
          for (y = 0, len10 = p2.length; y < len10; y++) {
            v = p2[y];
            lns[cpl += 1] = v;
          }
          for (z = 0, len11 = p0.length; z < len11; z++) {
            v = p0[z];
            lns[cpl += 1] = v;
          }
        }
        if (this._pts_buffer[gl.ctx_id] != null) {
          gl.deleteBuffer(this._pts_buffer[gl.ctx_id]);
          gl.deleteBuffer(this._nor_buffer[gl.ctx_id]);
          gl.deleteBuffer(this._lns_buffer[gl.ctx_id]);
        }
        this._pts_buffer[gl.ctx_id] = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this._pts_buffer[gl.ctx_id]);
        gl.bufferData(gl.ARRAY_BUFFER, pts, gl.STATIC_DRAW);
        this._nor_buffer[gl.ctx_id] = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this._nor_buffer[gl.ctx_id]);
        gl.bufferData(gl.ARRAY_BUFFER, nor, gl.STATIC_DRAW);
        this._lns_buffer[gl.ctx_id] = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this._lns_buffer[gl.ctx_id]);
        return gl.bufferData(gl.ARRAY_BUFFER, lns, gl.STATIC_DRAW);
      }
    }
  };

  Element_TriangleList.prototype._draw_gradient_stroke_triangle = function(info, p0, p1, posit, legend) {
    var col, k, len, lineargradient, ref;
    info.ctx.beginPath();
    lineargradient = info.ctx.createLinearGradient(p0[0], p0[1], p1[0], p1[1]);
    ref = legend.color_map.color_stop;
    for (k = 0, len = ref.length; k < len; k++) {
      col = ref[k];
      lineargradient.addColorStop(col.position.get(), col.color.to_rgba());
    }
    info.ctx.strokeStyle = lineargradient;
    info.ctx.moveTo(posit[0][0], posit[0][1]);
    info.ctx.lineTo(posit[1][0], posit[1][1]);
    info.ctx.lineTo(posit[2][0], posit[2][1]);
    info.ctx.lineTo(posit[0][0], posit[0][1]);
    return info.ctx.stroke();
  };

  Element_TriangleList.prototype._draw_gradient_fill_triangle = function(info, p0, p1, posit, legend) {
    var col, k, len, lineargradient, ref;
    info.ctx.beginPath();
    if (isNaN(p0[0]) || isNaN(p0[1]) || isNaN(p1[0]) || isNaN(p1[1])) {
      return;
    }
    if (Math.abs(p0[0]) > 1e40 || Math.abs(p0[1]) > 1e40 || Math.abs(p1[0]) > 1e40 || Math.abs(p1[1]) > 1e40) {
      return;
    }
    lineargradient = info.ctx.createLinearGradient(p0[0], p0[1], p1[0], p1[1]);
    ref = legend.color_map.color_stop;
    for (k = 0, len = ref.length; k < len; k++) {
      col = ref[k];
      lineargradient.addColorStop(col.position.get(), col.color.to_rgba());
    }
    info.ctx.strokeStyle = lineargradient;
    info.ctx.fillStyle = lineargradient;
    info.ctx.moveTo(posit[0][0], posit[0][1]);
    info.ctx.lineTo(posit[1][0], posit[1][1]);
    info.ctx.lineTo(posit[2][0], posit[2][1]);
    info.ctx.lineTo(posit[0][0], posit[0][1]);
    info.ctx.fill();
    return info.ctx.stroke();
  };

  Element_TriangleList.prototype.draw_elementary_triangle = function(info, proj, data, display_style, legend) {
    var c, col, div_legend, gv, i, k, max_legend, min_legend, nor, num_triangle, p0, p1, p2, pos, position, ref, results, tri, value, x;
    max_legend = legend.max_val.get();
    min_legend = legend.min_val.get();
    div_legend = max_legend - min_legend;
    div_legend = 1 / (div_legend + (div_legend === 0));
    results = [];
    for (num_triangle = k = 0, ref = this.indices.size(1); 0 <= ref ? k < ref : k > ref; num_triangle = 0 <= ref ? ++k : --k) {
      tri = [this.indices.get([0, num_triangle]), this.indices.get([1, num_triangle]), this.indices.get([2, num_triangle])];
      value = data.get(num_triangle);
      position = (function() {
        var l, results1;
        results1 = [];
        for (i = l = 0; l < 3; i = ++l) {
          results1.push(proj[tri[i]]);
        }
        return results1;
      })();
      pos = (max_legend - value) / (max_legend - min_legend);
      col = legend.color_map.get_color_from_pos(pos);
      if (info.ctx_type === "2d") {
        if (display_style === "Wireframe") {
          this._draw_elementary_stroke_triangle(info, position, col);
        }
        if (display_style === "Surface" || display_style === "Surface with Edges") {
          this._draw_elementary_fill_triangle(info, position, col);
        }
        if (display_style === "Surface with Edges" || display_style === "Edges") {
          results.push(this._draw_edge_triangle(info, position));
        } else {
          results.push(void 0);
        }
      } else {
        if (this._sf == null) {
          this._sf = new SurfaceTheme;
        }
        p0 = (function() {
          var l, len, ref1, results1;
          ref1 = position[0];
          results1 = [];
          for (l = 0, len = ref1.length; l < len; l++) {
            x = ref1[l];
            results1.push(x);
          }
          return results1;
        })();
        p1 = (function() {
          var l, len, ref1, results1;
          ref1 = position[1];
          results1 = [];
          for (l = 0, len = ref1.length; l < len; l++) {
            x = ref1[l];
            results1.push(x);
          }
          return results1;
        })();
        p2 = (function() {
          var l, len, ref1, results1;
          ref1 = position[2];
          results1 = [];
          for (l = 0, len = ref1.length; l < len; l++) {
            x = ref1[l];
            results1.push(x);
          }
          return results1;
        })();
        p0[2] *= Math.max(info.w, info.h);
        p1[2] *= Math.max(info.w, info.h);
        p2[2] *= Math.max(info.w, info.h);
        nor = Vec_3.nor(Vec_3.cro(Vec_3.sub(p1, p0), Vec_3.sub(p2, p0)));
        gv = 0.5 + 0.4 * Math.abs(nor[2]);
        results.push(this._sf.draw_triangle(info, position[0], position[1], position[2], (function() {
          var l, len, results1;
          results1 = [];
          for (l = 0, len = col.length; l < len; l++) {
            c = col[l];
            results1.push(gv * c / 255.0);
          }
          return results1;
        })()));
      }
    }
    return results;
  };

  Element_TriangleList.prototype._draw_elementary_stroke_triangle = function(info, position, col) {
    info.ctx.beginPath();
    info.ctx.strokeStyle = "rgba( " + col[0] + ", " + col[1] + ", " + col[2] + ", " + col[3] + " ) ";
    info.ctx.moveTo(position[0][0], position[0][1]);
    info.ctx.lineTo(position[1][0], position[1][1]);
    info.ctx.lineTo(position[2][0], position[2][1]);
    info.ctx.lineTo(position[0][0], position[0][1]);
    info.ctx.stroke();
    return info.ctx.closePath();
  };

  Element_TriangleList.prototype._draw_elementary_fill_triangle = function(info, position, col) {
    info.ctx.beginPath();
    info.ctx.fillStyle = "rgba( " + col[0] + ", " + col[1] + ", " + col[2] + ", " + col[3] + " ) ";
    info.ctx.strokeStyle = "rgba( " + col[0] + ", " + col[1] + ", " + col[2] + ", " + col[3] + " ) ";
    info.ctx.moveTo(position[0][0], position[0][1]);
    info.ctx.lineTo(position[1][0], position[1][1]);
    info.ctx.lineTo(position[2][0], position[2][1]);
    info.ctx.lineTo(position[0][0], position[0][1]);
    info.ctx.fill();
    info.ctx.stroke();
    return info.ctx.closePath();
  };

  Element_TriangleList.prototype._draw_edge_triangle = function(info, posit) {
    info.theme.lines.beg_ctx(info);
    info.theme.lines.draw_straight_proj(info, posit[0], posit[1]);
    info.theme.lines.draw_straight_proj(info, posit[1], posit[2]);
    info.theme.lines.draw_straight_proj(info, posit[2], posit[0]);
    return info.theme.lines.end_ctx(info);
  };

  Element_TriangleList.prototype._get_indices = function() {
    return this.indices;
  };

  return Element_TriangleList;

})(Element);
// Generated by CoffeeScript 1.11.1
var Element_BoundedSurf,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

Element_BoundedSurf = (function(superClass) {
  extend(Element_BoundedSurf, superClass);

  function Element_BoundedSurf(boundaries) {
    if (boundaries == null) {
      boundaries = [];
    }
    Element_BoundedSurf.__super__.constructor.call(this);
    this.add_attr({
      boundaries: boundaries
    });
  }

  Element_BoundedSurf.prototype.draw = function(info, mesh, proj, is_a_sub) {
    var ref;
    if ((ref = mesh.visualization.display_style.get()) === "Surface" || ref === "Surface with Edges") {
      info.theme.surfaces.beg_ctx(info);
      info.theme.surfaces.draw(info, (function(_this) {
        return function() {
          var b, j, len, n, ref1, results;
          ref1 = _this.boundaries;
          results = [];
          for (n = j = 0, len = ref1.length; j < len; n = ++j) {
            b = ref1[n];
            results.push(b.e.contour(info, mesh, proj, n === 0, b.o < 0));
          }
          return results;
        };
      })(this));
      return info.theme.surfaces.end_ctx(info);
    }
  };

  Element_BoundedSurf.prototype.draw_gl = function(info, mesh, points, is_a_sub) {
    var i, p, proj;
    proj = (function() {
      var j, len, results;
      results = [];
      for (i = j = 0, len = points.length; j < len; i = ++j) {
        p = points[i];
        results.push(info.re_2_sc.proj(p.pos.get()));
      }
      return results;
    })();
    return this.draw(info, mesh, proj, is_a_sub);
  };

  Element_BoundedSurf.prototype.update_indices = function(done, n_array) {
    var b, base, j, len, ref, results;
    ref = this.boundaries;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      b = ref[j];
      results.push(typeof (base = b.e).update_indices === "function" ? base.update_indices(done, n_array) : void 0);
    }
    return results;
  };

  Element_BoundedSurf.prototype.closest_point_closer_than = function(best, mesh, proj, info, pos) {
    return void 0;
  };

  Element_BoundedSurf.prototype.cut_with_point = function(divisions, data, mesh, np, ip) {
    var b, base, d, j, k, len, len1, m, n, nl, ref, ref1, ref2, res;
    res = [];
    ref = this.boundaries;
    for (n = j = 0, len = ref.length; j < len; n = ++j) {
      b = ref[n];
      if (typeof (base = b.e).cut_with_point === "function") {
        base.cut_with_point(divisions, data, mesh, np, ip);
      }
      if (divisions[b.e.model_id] != null) {
        if (b.o < 0) {
          d = divisions[b.e.model_id];
          if (d.length) {
            for (nl = k = ref1 = d.length - 1; ref1 <= 0 ? k <= 0 : k >= 0; nl = ref1 <= 0 ? ++k : --k) {
              res.push({
                o: b.o,
                e: d[nl]
              });
            }
          }
        } else {
          ref2 = divisions[b.e.model_id];
          for (m = 0, len1 = ref2.length; m < len1; m++) {
            nl = ref2[m];
            res.push({
              o: b.o,
              e: nl
            });
          }
        }
      } else {
        res.push(b);
      }
    }
    this.boundaries.clear();
    return this.boundaries.set(res);
  };

  Element_BoundedSurf.prototype.add_sub_element = function(res) {
    var b, j, len, ref, ref1, results;
    ref = this.boundaries;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      b = ref[j];
      if (ref1 = b.e, indexOf.call(res, ref1) < 0) {
        results.push(res.push(b.e));
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  Element_BoundedSurf.prototype.rem_sub_element = function(sel_point) {
    var aft, b, bef, i, j, len, new_res, pos, ref, res, unlinked_points, waiting_points;
    if (this.boundaries != null) {
      res = [];
      unlinked_points = [];
      ref = this.boundaries;
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        b = ref[i];
        waiting_points = [];
        if (indexOf.call(b.e.get_point_numbers(), sel_point) >= 0) {
          waiting_points = b.e.get_point_numbers();
          pos = waiting_points.indexOf(sel_point);
          if (waiting_points.length === 2) {
            unlinked_points.push(b.e.indices[1 - pos]);
            new_res = this._link_elements(unlinked_points);
            if (new_res !== false) {
              res.push(new_res);
              unlinked_points = [];
            }
          } else if (waiting_points.length >= 3) {
            bef = b.e.indices.slice(0, pos);
            aft = b.e.indices.slice(pos + 1, b.e.indices.length);
            if (pos === 0) {
              unlinked_points.push(aft[0].get());
            } else if (pos === b.e.indices.length - 1) {
              unlinked_points.push(bef[bef.length - 1].get());
            }
            new_res = this._link_elements(unlinked_points);
            if (new_res !== false) {
              res.push(new_res);
              unlinked_points = [];
            }
            if ((waiting_points.length - 1) === 2) {
              res.push({
                o: 1,
                e: new Element_Line(bef.get().concat(aft.get()))
              });
            } else if ((waiting_points.length - 1) >= 3) {
              res.push({
                o: 1,
                e: new Element_Arc(bef.get().concat(aft.get()))
              });
            }
          } else {
            res.push(b);
          }
        } else {
          res.push(b);
        }
      }
      this.boundaries.clear();
      return this.boundaries.set(res);
    }
  };

  Element_BoundedSurf.prototype.make_curve_line_from_selected = function(sel_point) {
    var b, i, j, k, len, len1, len2, len3, m, n, np, o, ref, ref1, ref2, ref3, res, tmp_array, waiting_points;
    if ((sel_point != null) && (this.boundaries != null)) {
      res = [];
      waiting_points = [];
      ref = this.boundaries;
      for (j = 0, len = ref.length; j < len; j++) {
        b = ref[j];
        if (indexOf.call(b.e.get_point_numbers(), sel_point) >= 0) {
          np = b.e.get_point_numbers();
          if (b.o < 0) {
            if (np.length) {
              ref1 = np.slice(np.length - 1, +(waiting_points.length > 0) + 1 || 9e9);
              for (k = 0, len1 = ref1.length; k < len1; k++) {
                n = ref1[k];
                waiting_points.push(n);
              }
            }
          } else {
            if (waiting_points.length && waiting_points[0] === np[np.length - 1]) {
              tmp_array = [];
              ref2 = np.slice(0, np.length - 1);
              for (i = m = 0, len2 = ref2.length; m < len2; i = ++m) {
                n = ref2[i];
                tmp_array.push(n);
              }
              waiting_points = tmp_array.concat(waiting_points);
            } else {
              ref3 = np.slice(waiting_points.length > 0);
              for (o = 0, len3 = ref3.length; o < len3; o++) {
                n = ref3[o];
                waiting_points.push(n);
              }
            }
          }
        } else {
          if (waiting_points.length >= 3) {
            res.push({
              o: 1,
              e: new Element_Arc(waiting_points)
            });
            waiting_points = [];
          }
          res.push(b);
        }
      }
      if (waiting_points.length >= 3) {
        res.push({
          o: 1,
          e: new Element_Arc(waiting_points)
        });
        waiting_points = [];
      }
      this.boundaries.clear();
      return this.boundaries.set(res);
    }
  };

  Element_BoundedSurf.prototype.break_line_from_selected = function(sel_point) {
    var after, b, j, l, len, pos, ref, res, waiting_points;
    if ((sel_point != null) && (this.boundaries != null)) {
      waiting_points = [];
      res = [];
      ref = this.boundaries;
      for (j = 0, len = ref.length; j < len; j++) {
        b = ref[j];
        if (indexOf.call(b.e.get_point_numbers(), sel_point) >= 0) {
          waiting_points = b.e.get_point_numbers();
          if (waiting_points.length >= 3) {
            pos = waiting_points.indexOf(sel_point);
            if (pos !== -1) {
              if (pos === 1) {
                res.push({
                  o: 1,
                  e: new Element_Line(waiting_points.slice(0, pos + 1))
                });
              }
              if (pos >= 2) {
                res.push({
                  o: 1,
                  e: new Element_Arc(waiting_points.slice(0, pos + 1))
                });
              }
              l = waiting_points.length - 1;
              after = l - pos;
              if (after === 1) {
                res.push({
                  o: 1,
                  e: new Element_Line(waiting_points.slice(pos, l + 1))
                });
              }
              if (after >= 2) {
                res.push({
                  o: 1,
                  e: new Element_Arc(waiting_points.slice(pos, l + 1))
                });
              }
            }
          } else {
            res.push(b);
          }
        } else {
          res.push(b);
        }
      }
      this.boundaries.clear();
      return this.boundaries.set(res);
    }
  };

  Element_BoundedSurf.prototype._link_elements = function(unlinked_points) {
    var res;
    if (unlinked_points.length === 2) {
      res = {
        o: 1,
        e: new Element_Line(unlinked_points)
      };
      return res;
    }
    return false;
  };

  return Element_BoundedSurf;

})(Element);
// Generated by CoffeeScript 1.11.1
var Element_Q4List,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Element_Q4List = (function(superClass) {
  extend(Element_Q4List, superClass);

  function Element_Q4List() {
    Element_Q4List.__super__.constructor.call(this);
    this.add_attr({
      indices: new TypedArray_Int32([4, 0])
    });
    this._date_pts = {};
    this._pts_buffer = {};
    this._nor_buffer = {};
    this._lns_buffer = {};
    this.bind((function(_this) {
      return function() {
        if (_this.indices.has_been_modified()) {
          return _this.indices_tri = _this._convert_quad_to_tri(_this.indices);
        }
      };
    })(this));
  }

  Element_Q4List.prototype._convert_quad_to_tri = function(indices) {
    var i, indice_q1, indice_q2, indice_q3, indice_q4, indices_tri, j, ref;
    indices_tri = new TypedArray_Int32([3, 2 * indices._size[1]]);
    for (i = j = 0, ref = (indices._data.length / 4) - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {
      indice_q1 = indices._data[4 * i];
      indice_q2 = indices._data[4 * i + 1];
      indice_q3 = indices._data[4 * i + 2];
      indice_q4 = indices._data[4 * i + 3];
      indices_tri._data[6 * i] = indice_q1;
      indices_tri._data[6 * i + 1] = indice_q2;
      indices_tri._data[6 * i + 2] = indice_q3;
      indices_tri._data[6 * i + 3] = indice_q1;
      indices_tri._data[6 * i + 4] = indice_q3;
      indices_tri._data[6 * i + 5] = indice_q4;
    }
    return indices_tri;
  };

  Element_Q4List.prototype._get_indices = function() {
    if (!this.indices_tri) {
      this.indices_tri = this._convert_quad_to_tri(this.indices);
    }
    return this.indices_tri;
  };

  Element_Q4List.prototype.draw_gl = function(info, mesh, points, is_a_sub) {
    var col, fs, gl, mesh_color, nor, pos, ps, ref, ref1, ref2, ref3, vs;
    if (this._get_indices()) {
      this._update_bufs(info, mesh, points);
      gl = info.ctx;
      if ((ref = mesh.visualization.display_style.get()) === "Points" || ref === "Wireframe" || ref === "Surface" || ref === "Surface with Edges") {
        vs = "precision mediump float;\n attribute vec3 pos;\n attribute vec3 nor;\n varying vec3 norin;\n " + (info.cam.gl_attr_vec(info, "can")) + "\n " + (info.cam.gl_attr(info, "cam")) + "\n void main( void ) {\n gl_Position = vec4( pos, 1.0 );\n " + (info.cam.gl_main_vec(info, "can", "nor", "norin")) + "\n " + (info.cam.gl_main(info, "cam")) + "\n }\n";
        fs = "precision mediump float;\n uniform vec4 col;\n varying vec3 norin;\n void main( void ) {\n float g = abs( norin[ 2 ] );\n gl_FragColor = vec4( g * col[ 0 ], g * col[ 1 ], g * col[ 2 ], col[ 3 ] );\n }\n";
        ps = info.cm.gl_prog(vs, fs);
        gl.useProgram(ps);
        pos = gl.getAttribLocation(ps, "pos");
        gl.enableVertexAttribArray(pos);
        gl.bindBuffer(gl.ARRAY_BUFFER, this._pts_buffer[gl.ctx_id]);
        gl.vertexAttribPointer(pos, 3, gl.FLOAT, false, 0, 0);
        nor = gl.getAttribLocation(ps, "nor");
        gl.enableVertexAttribArray(nor);
        gl.bindBuffer(gl.ARRAY_BUFFER, this._nor_buffer[gl.ctx_id]);
        gl.vertexAttribPointer(nor, 3, gl.FLOAT, false, 0, 0);
        col = gl.getUniformLocation(ps, "col");
        mesh_color = mesh._theme.surfaces.color;
        this.line_color = mesh._theme.lines.color;
        gl.uniform4f(col, mesh_color.r.get() / 255, mesh_color.g.get() / 255, mesh_color.b.get() / 255, mesh_color.a.get() / 255);
        info.cam.gl_exec(info, "cam", ps);
        info.cam.gl_exec_vec(info, "can", ps);
        if ((ref1 = mesh.visualization.display_style.get()) === "Surface" || ref1 === "Surface with Edges") {
          gl.drawArrays(gl.TRIANGLES, 0, 3 * this._get_indices().size(1));
        }
      }
      if ((ref2 = mesh.visualization.display_style.get()) === "Wireframe" || ref2 === "Surface with Edges") {
        this._update_bufs_lines(info, mesh, points);
        gl = info.ctx;
        this._draw_lines(info);
      }
      if ((ref3 = mesh.visualization.display_style.get()) === "Points") {
        return this._draw_points(info);
      }
    }
  };

  Element_Q4List.prototype.draw_nodal_field_gl = function(info, mesh, points, data, display_style, legend, warp_by, warp_factor, buff_id) {
    var col, fs, gl, nor, pos, ps, tex, vs, wab, warp_buff;
    if (warp_factor == null) {
      warp_factor = 1;
    }
    if (this._get_indices()) {
      warp_buff = warp_by != null ? warp_by.warp_gl_buff(info, this, buff_id) : void 0;
      this._update_bufs(info, mesh, points);
      gl = info.ctx;
      if (display_style === "Surface" || display_style === "Surface with Edges") {
        vs = "precision mediump float;\n varying float y;\n varying vec3 norin;\n uniform float mit;\n uniform float mat;\n uniform float waf;\n attribute vec3 pos;\n attribute vec3 nor;\n attribute vec3 wab;\n attribute float tex;\n " + (info.cam.gl_attr_vec(info, "can")) + "\n " + (info.cam.gl_attr(info, "cam")) + "\n void main( void ) {\n y = ( tex - mit ) / ( mat - mit );\n gl_Position = vec4( pos + waf * wab, 1.0 );\n " + (info.cam.gl_main_vec(info, "can", "nor", "norin")) + "\n " + (info.cam.gl_main(info, "cam")) + "\n }\n";
        fs = legend.color_map.get_fragment_shader("y", "col", "norin");
        ps = info.cm.gl_prog(vs, fs);
        gl.useProgram(ps);
        pos = gl.getAttribLocation(ps, "pos");
        gl.enableVertexAttribArray(pos);
        gl.bindBuffer(gl.ARRAY_BUFFER, this._pts_buffer[gl.ctx_id]);
        gl.vertexAttribPointer(pos, 3, gl.FLOAT, false, 0, 0);
        nor = gl.getAttribLocation(ps, "nor");
        gl.enableVertexAttribArray(nor);
        gl.bindBuffer(gl.ARRAY_BUFFER, this._nor_buffer[gl.ctx_id]);
        gl.vertexAttribPointer(nor, 3, gl.FLOAT, false, 0, 0);
        wab = gl.getAttribLocation(ps, "wab");
        gl.enableVertexAttribArray(wab);
        if (warp_buff != null) {
          gl.bindBuffer(gl.ARRAY_BUFFER, warp_buff);
        } else {
          gl.bindBuffer(gl.ARRAY_BUFFER, this._nor_buffer[gl.ctx_id]);
        }
        gl.vertexAttribPointer(wab, 3, gl.FLOAT, false, 0, 0);
        tex = gl.getAttribLocation(ps, "tex");
        if (tex >= 0) {
          gl.enableVertexAttribArray(tex);
          gl.bindBuffer(gl.ARRAY_BUFFER, data);
          gl.vertexAttribPointer(tex, 1, gl.FLOAT, false, 0, 0);
        }
        col = gl.getUniformLocation(ps, "col");
        gl.uniform4f(col, 0.7, 0.7, 0.7, 1.0);
        gl.uniform1f(gl.getUniformLocation(ps, "mit"), legend._min_val.get());
        gl.uniform1f(gl.getUniformLocation(ps, "mat"), legend._max_val.get());
        gl.uniform1f(gl.getUniformLocation(ps, "waf"), warp_factor);
        info.cam.gl_exec(info, "cam", ps);
        info.cam.gl_exec_vec(info, "can", ps);
        gl.drawArrays(gl.TRIANGLES, 0, 3 * this._get_indices().size(1));
        gl.disableVertexAttribArray(pos);
        gl.disableVertexAttribArray(nor);
        gl.disableVertexAttribArray(wab);
        gl.disableVertexAttribArray(tex);
      }
      if (display_style === "Wireframe" || display_style === "Surface with Edges") {
        this._update_bufs_lines(info, mesh, points);
        gl = info.ctx;
        return this._draw_lines(info);
      }
    }
  };

  Element_Q4List.prototype.draw_vectorial_field_gl = function(info, mesh, points, data, display_style, legend, warp_by, warp_factor, buff_id) {
    var col, cpp, dim, fs, gl, i, j, nor, pos, ps, pts, ref, tex, vs, wab, warp_buff;
    if (warp_factor == null) {
      warp_factor = 1;
    }
    if (this._get_indices()) {
      warp_buff = warp_by != null ? warp_by.warp_gl_buff(info, this, buff_id) : void 0;
      gl = info.ctx;
      if (this._date_pts[gl.ctx_id] == null) {
        this._date_pts[gl.ctx_id] = -1;
      }
      if (this._date_pts[gl.ctx_id] < mesh._date_last_modification) {
        this._date_pts[gl.ctx_id] = mesh._date_last_modification;
        dim = 3;
        cpp = -1;
        pts = new Float32Array(2 * dim * points.length);
        for (i = j = 0, ref = points.length; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
          pts[cpp += 1] = points[i].pos[0].get();
          pts[cpp += 1] = points[i].pos[1].get();
          pts[cpp += 1] = points[i].pos[2].get();
          pts[cpp += 1] = points[i].pos[0].get();
          pts[cpp += 1] = points[i].pos[1].get();
          pts[cpp += 1] = points[i].pos[2].get();
        }
        if (this._pts_buffer[gl.ctx_id] != null) {
          gl.deleteBuffer(this._pts_buffer[gl.ctx_id]);
          gl.deleteBuffer(this._nor_buffer[gl.ctx_id]);
          gl.deleteBuffer(this._lns_buffer[gl.ctx_id]);
        }
        this._pts_buffer[gl.ctx_id] = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this._pts_buffer[gl.ctx_id]);
        gl.bufferData(gl.ARRAY_BUFFER, pts, gl.STATIC_DRAW);
        this._nor_buffer[gl.ctx_id] = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this._nor_buffer[gl.ctx_id]);
        gl.bufferData(gl.ARRAY_BUFFER, nor, gl.STATIC_DRAW);
        this._lns_buffer[gl.ctx_id] = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this._lns_buffer[gl.ctx_id]);
        gl.bufferData(gl.ARRAY_BUFFER, lns, gl.STATIC_DRAW);
      }
      if (display_style === "Surface" || display_style === "Surface with Edges") {
        vs = "precision mediump float;\n varying float y;\n varying vec3 norin;\n uniform float mit;\n uniform float mat;\n uniform float waf;\n attribute vec3 pos;\n attribute vec3 nor;\n attribute vec3 wab;\n attribute float tex;\n " + (info.cam.gl_attr_vec(info, "can")) + "\n " + (info.cam.gl_attr(info, "cam")) + "\n void main( void ) {\n y = ( tex - mit ) / ( mat - mit );\n gl_Position = vec4( pos + waf * wab, 1.0 );\n " + (info.cam.gl_main_vec(info, "can", "nor", "norin")) + "\n " + (info.cam.gl_main(info, "cam")) + "\n }\n";
        fs = legend.color_map.get_fragment_shader("y", "col", "norin");
        ps = info.cm.gl_prog(vs, fs);
        gl.useProgram(ps);
        pos = gl.getAttribLocation(ps, "pos");
        gl.enableVertexAttribArray(pos);
        gl.bindBuffer(gl.ARRAY_BUFFER, this._pts_buffer[gl.ctx_id]);
        gl.vertexAttribPointer(pos, 3, gl.FLOAT, false, 0, 0);
        nor = gl.getAttribLocation(ps, "nor");
        gl.enableVertexAttribArray(nor);
        gl.bindBuffer(gl.ARRAY_BUFFER, this._nor_buffer[gl.ctx_id]);
        gl.vertexAttribPointer(nor, 3, gl.FLOAT, false, 0, 0);
        wab = gl.getAttribLocation(ps, "wab");
        gl.enableVertexAttribArray(wab);
        if (warp_buff != null) {
          gl.bindBuffer(gl.ARRAY_BUFFER, warp_buff);
        } else {
          gl.bindBuffer(gl.ARRAY_BUFFER, this._nor_buffer[gl.ctx_id]);
        }
        gl.vertexAttribPointer(wab, 3, gl.FLOAT, false, 0, 0);
        tex = gl.getAttribLocation(ps, "tex");
        if (tex >= 0) {
          gl.enableVertexAttribArray(tex);
          gl.bindBuffer(gl.ARRAY_BUFFER, data);
          gl.vertexAttribPointer(tex, 1, gl.FLOAT, false, 0, 0);
        }
        col = gl.getUniformLocation(ps, "col");
        gl.uniform4f(col, 0.7, 0.7, 0.7, 1.0);
        gl.uniform1f(gl.getUniformLocation(ps, "mit"), legend._min_val.get());
        gl.uniform1f(gl.getUniformLocation(ps, "mat"), legend._max_val.get());
        gl.uniform1f(gl.getUniformLocation(ps, "waf"), warp_factor);
        info.cam.gl_exec(info, "cam", ps);
        info.cam.gl_exec_vec(info, "can", ps);
        gl.drawArrays(gl.TRIANGLES, 0, 3 * this._get_indices().size(1));
        gl.disableVertexAttribArray(pos);
        gl.disableVertexAttribArray(nor);
        gl.disableVertexAttribArray(wab);
        gl.disableVertexAttribArray(tex);
      }
      if (display_style === "Wireframe" || display_style === "Surface with Edges") {
        this._update_bufs_lines(info, mesh, points);
        gl = info.ctx;
        return this._draw_lines(info);
      }
    }
  };

  Element_Q4List.prototype._draw_lines = function(info) {
    var col, fs, gl, pos, ps, vs;
    vs = "precision mediump float;\n attribute vec3 pos;\n " + (info.cam.gl_attr(info, "cam")) + "\n void main( void ) {\n gl_Position = vec4( pos, 1.0 );\n " + (info.cam.gl_main(info, "cam")) + "\n gl_Position -= 1e-5;\n }\n";
    fs = "precision mediump float;\n uniform vec4 col;\n void main( void ) {\n gl_FragColor = col;\n }\n";
    ps = info.cm.gl_prog(vs, fs);
    gl = info.ctx;
    gl.useProgram(ps);
    pos = gl.getAttribLocation(ps, "pos");
    gl.enableVertexAttribArray(pos);
    gl.bindBuffer(gl.ARRAY_BUFFER, this._lns_buffer[gl.ctx_id]);
    gl.vertexAttribPointer(pos, 3, gl.FLOAT, false, 0, 0);
    col = gl.getUniformLocation(ps, "col");
    if (this.line_color != null) {
      gl.uniform4f(col, this.line_color.r.get() / 255, this.line_color.g.get() / 255, this.line_color.b.get() / 255, this.line_color.a.get() / 255);
    } else {
      gl.uniform4f(col, 1.0, 1.0, 1.0, 1.0);
    }
    info.cam.gl_exec(info, "cam", ps);
    gl.lineWidth(2);
    return gl.drawArrays(gl.LINES, 0, 8 * this.indices.size(1));
  };

  Element_Q4List.prototype._draw_points = function(info) {
    var col, fs, gl, pos, ps, vs;
    vs = "precision mediump float;\n attribute vec3 pos;\n " + (info.cam.gl_attr(info, "cam")) + "\n void main( void ) {\n gl_Position = vec4( pos, 1.0 );\n " + (info.cam.gl_main(info, "cam")) + "\n gl_Position -= 1e-5;\n }\n";
    fs = "precision mediump float;\n uniform vec4 col;\n void main( void ) {\n gl_FragColor = col;\n }\n";
    ps = info.cm.gl_prog(vs, fs);
    gl = info.ctx;
    gl.useProgram(ps);
    pos = gl.getAttribLocation(ps, "pos");
    gl.enableVertexAttribArray(pos);
    gl.bindBuffer(gl.ARRAY_BUFFER, this._lns_buffer[0]);
    gl.vertexAttribPointer(pos, 3, gl.FLOAT, false, 0, 0);
    col = gl.getUniformLocation(ps, "col");
    gl.uniform4f(col, 1.0, 1.0, 1.0, 1.0);
    info.cam.gl_exec(info, "cam", ps);
    gl.lineWidth(2);
    return gl.drawArrays(gl.POINTS, 0, 6 * this._get_indices().size(1));
  };

  Element_Q4List.prototype._update_bufs = function(info, mesh, points) {
    var cpl, cpn, cpp, dim, gl, i, j, k, l, len, len1, len10, len11, len2, len3, len4, len5, len6, len7, len8, len9, lns, m, n, nn, nor, o, p, p0, p1, p2, pts, q, r, ref, s, t, u, v, w;
    if (this._get_indices() != null) {
      gl = info.ctx;
      if (this._date_pts[gl.ctx_id] == null) {
        this._date_pts[gl.ctx_id] = -1;
      }
      if (this._date_pts[gl.ctx_id] < mesh._date_last_modification) {
        this._date_pts[gl.ctx_id] = mesh._date_last_modification;
        dim = 3;
        cpp = -1;
        cpn = -1;
        cpl = -1;
        pts = new Float32Array(3 * dim * this._get_indices().size(1));
        nor = new Float32Array(3 * dim * this._get_indices().size(1));
        lns = new Float32Array(6 * dim * this._get_indices().size(1));
        for (i = j = 0, ref = this._get_indices().size(1); 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
          p0 = mesh.get_point(this._get_indices().get([0, i]));
          p1 = mesh.get_point(this._get_indices().get([1, i]));
          p2 = mesh.get_point(this._get_indices().get([2, i]));
          if (!p0 || !p1 || !p2) {
            continue;
          }
          nn = Vec_3.nor(Vec_3.cro(Vec_3.sub(p1, p0), Vec_3.sub(p2, p0)));
          for (k = 0, len = p0.length; k < len; k++) {
            v = p0[k];
            pts[cpp += 1] = v;
          }
          for (l = 0, len1 = p1.length; l < len1; l++) {
            v = p1[l];
            pts[cpp += 1] = v;
          }
          for (m = 0, len2 = p2.length; m < len2; m++) {
            v = p2[m];
            pts[cpp += 1] = v;
          }
          for (n = 0, len3 = nn.length; n < len3; n++) {
            v = nn[n];
            nor[cpn += 1] = v;
          }
          for (o = 0, len4 = nn.length; o < len4; o++) {
            v = nn[o];
            nor[cpn += 1] = v;
          }
          for (p = 0, len5 = nn.length; p < len5; p++) {
            v = nn[p];
            nor[cpn += 1] = v;
          }
          for (q = 0, len6 = p0.length; q < len6; q++) {
            v = p0[q];
            lns[cpl += 1] = v;
          }
          for (r = 0, len7 = p1.length; r < len7; r++) {
            v = p1[r];
            lns[cpl += 1] = v;
          }
          for (s = 0, len8 = p1.length; s < len8; s++) {
            v = p1[s];
            lns[cpl += 1] = v;
          }
          for (t = 0, len9 = p2.length; t < len9; t++) {
            v = p2[t];
            lns[cpl += 1] = v;
          }
          for (u = 0, len10 = p2.length; u < len10; u++) {
            v = p2[u];
            lns[cpl += 1] = v;
          }
          for (w = 0, len11 = p0.length; w < len11; w++) {
            v = p0[w];
            lns[cpl += 1] = v;
          }
        }
        if (this._pts_buffer[gl.ctx_id] != null) {
          gl.deleteBuffer(this._pts_buffer[gl.ctx_id]);
          gl.deleteBuffer(this._nor_buffer[gl.ctx_id]);
          gl.deleteBuffer(this._lns_buffer[gl.ctx_id]);
        }
        this._pts_buffer[gl.ctx_id] = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this._pts_buffer[gl.ctx_id]);
        gl.bufferData(gl.ARRAY_BUFFER, pts, gl.STATIC_DRAW);
        this._nor_buffer[gl.ctx_id] = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this._nor_buffer[gl.ctx_id]);
        gl.bufferData(gl.ARRAY_BUFFER, nor, gl.STATIC_DRAW);
        this._lns_buffer[gl.ctx_id] = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this._lns_buffer[gl.ctx_id]);
        return gl.bufferData(gl.ARRAY_BUFFER, lns, gl.STATIC_DRAW);
      }
    }
  };

  Element_Q4List.prototype._update_bufs_lines = function(info, mesh, points) {
    var cpl, cpn, cpp, dim, gl, i, j, k, l, len, len1, len10, len11, len12, len13, len14, len2, len3, len4, len5, len6, len7, len8, len9, lns, m, n, nn, nor, o, p, p0, p1, p2, p3, pts, q, r, ref, s, t, u, v, w, x, y, z;
    if (this._get_indices()) {
      gl = info.ctx;
      dim = 3;
      cpp = -1;
      cpn = -1;
      cpl = -1;
      pts = new Float32Array(4 * dim * this.indices.size(1));
      nor = new Float32Array(4 * dim * this.indices.size(1));
      lns = new Float32Array(8 * dim * this.indices.size(1));
      for (i = j = 0, ref = this.indices.size(1); 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
        p0 = mesh.get_point(this.indices.get([0, i]));
        p1 = mesh.get_point(this.indices.get([1, i]));
        p2 = mesh.get_point(this.indices.get([2, i]));
        p3 = mesh.get_point(this.indices.get([3, i]));
        if (!p0 || !p1 || !p2 || !p3) {
          continue;
        }
        nn = Vec_3.nor(Vec_3.cro(Vec_3.sub(p1, p0), Vec_3.sub(p2, p0)));
        for (k = 0, len = p0.length; k < len; k++) {
          v = p0[k];
          pts[cpp += 1] = v;
        }
        for (l = 0, len1 = p1.length; l < len1; l++) {
          v = p1[l];
          pts[cpp += 1] = v;
        }
        for (m = 0, len2 = p2.length; m < len2; m++) {
          v = p2[m];
          pts[cpp += 1] = v;
        }
        for (n = 0, len3 = p3.length; n < len3; n++) {
          v = p3[n];
          pts[cpp += 1] = v;
        }
        for (o = 0, len4 = nn.length; o < len4; o++) {
          v = nn[o];
          nor[cpn += 1] = v;
        }
        for (p = 0, len5 = nn.length; p < len5; p++) {
          v = nn[p];
          nor[cpn += 1] = v;
        }
        for (q = 0, len6 = nn.length; q < len6; q++) {
          v = nn[q];
          nor[cpn += 1] = v;
        }
        for (r = 0, len7 = p0.length; r < len7; r++) {
          v = p0[r];
          lns[cpl += 1] = v;
        }
        for (s = 0, len8 = p1.length; s < len8; s++) {
          v = p1[s];
          lns[cpl += 1] = v;
        }
        for (t = 0, len9 = p1.length; t < len9; t++) {
          v = p1[t];
          lns[cpl += 1] = v;
        }
        for (u = 0, len10 = p2.length; u < len10; u++) {
          v = p2[u];
          lns[cpl += 1] = v;
        }
        for (w = 0, len11 = p2.length; w < len11; w++) {
          v = p2[w];
          lns[cpl += 1] = v;
        }
        for (x = 0, len12 = p3.length; x < len12; x++) {
          v = p3[x];
          lns[cpl += 1] = v;
        }
        for (y = 0, len13 = p3.length; y < len13; y++) {
          v = p3[y];
          lns[cpl += 1] = v;
        }
        for (z = 0, len14 = p0.length; z < len14; z++) {
          v = p0[z];
          lns[cpl += 1] = v;
        }
      }
      gl.deleteBuffer(this._lns_buffer[gl.ctx_id]);
      this._lns_buffer[gl.ctx_id] = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, this._lns_buffer[gl.ctx_id]);
      return gl.bufferData(gl.ARRAY_BUFFER, lns, gl.STATIC_DRAW);
    }
  };

  return Element_Q4List;

})(Element);
// Generated by CoffeeScript 1.11.1
var Element_HexahedraList,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Element_HexahedraList = (function(superClass) {
  extend(Element_HexahedraList, superClass);

  function Element_HexahedraList() {
    Element_HexahedraList.__super__.constructor.call(this);
    this.add_attr({
      indices: new TypedArray_Int32([8, 0])
    });
  }

  Element_HexahedraList.prototype.draw_gl = function(info, mesh, points, is_a_sub) {};

  Element_HexahedraList.prototype.draw = function(info, mesh, proj, is_a_sub) {};

  Element_HexahedraList.prototype.draw_gl = function(info, mesh, points, is_a_sub) {};

  Element_HexahedraList.prototype._get_indices = function() {
    return this.indices;
  };

  return Element_HexahedraList;

})(Element);
// Generated by CoffeeScript 1.11.1
var Element_BoundedVolume,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

Element_BoundedVolume = (function(superClass) {
  extend(Element_BoundedVolume, superClass);

  function Element_BoundedVolume(boundaries) {
    if (boundaries == null) {
      boundaries = [];
    }
    Element_BoundedVolume.__super__.constructor.call(this);
    this.add_attr({
      boundaries: boundaries
    });
  }

  Element_BoundedVolume.prototype.draw = function(info, mesh, proj, is_a_sub) {};

  Element_BoundedVolume.prototype.draw_gl = function(info, mesh, points, is_a_sub) {};

  Element_BoundedVolume.prototype.update_indices = function(done, n_array) {
    var b, base, i, len, ref, results;
    ref = this.boundaries;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      b = ref[i];
      results.push(typeof (base = b.e).update_indices === "function" ? base.update_indices(done, n_array) : void 0);
    }
    return results;
  };

  Element_BoundedVolume.prototype.closest_point_closer_than = function(best, mesh, proj, info, pos) {
    return void 0;
  };

  Element_BoundedVolume.prototype.add_sub_element = function(res) {
    var b, i, len, ref, ref1, results;
    ref = this.boundaries;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      b = ref[i];
      if (ref1 = b.e, indexOf.call(res, ref1) < 0) {
        results.push(res.push(b.e));
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  return Element_BoundedVolume;

})(Element);
// Generated by CoffeeScript 1.11.1
var Element_TetrahedraList,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Element_TetrahedraList = (function(superClass) {
  extend(Element_TetrahedraList, superClass);

  function Element_TetrahedraList() {
    Element_TetrahedraList.__super__.constructor.call(this);
    this.add_attr({
      indices: new TypedArray_Int32([4, 0])
    });
  }

  Element_TetrahedraList.prototype.draw_gl = function(info, mesh, points, is_a_sub) {};

  Element_TetrahedraList.prototype.draw = function(info, mesh, proj, is_a_sub) {};

  Element_TetrahedraList.prototype.draw_gl = function(info, mesh, points, is_a_sub) {};

  Element_TetrahedraList.prototype._get_indices = function() {
    return this.indices;
  };

  return Element_TetrahedraList;

})(Element);
// Generated by CoffeeScript 1.11.1
var TreeAppApplication,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppApplication = (function(superClass) {
  extend(TreeAppApplication, superClass);

  function TreeAppApplication() {
    TreeAppApplication.__super__.constructor.call(this);
    this.name = '';
    this.visible = true;
    this.actions = [];
    this.powered_with = '';
    this.company = '';
    this.publication_link = "";
    this.tutorial_link = "";
    this.group = "";
    this.key_words = [];
  }

  TreeAppApplication.prototype.select_item = function(app_data, item, parent) {
    var path;
    if (!parent) {
      path = [];
      path.push(app_data.selected_session());
    } else {
      path = app_data.get_root_path_in_selected(parent);
    }
    path.push(item);
    this.unselect_all_item(app_data);
    return app_data.selected_tree_items.push(path);
  };

  TreeAppApplication.prototype.unselect_all_item = function(app_data) {
    return app_data.selected_tree_items.clear();
  };

  TreeAppApplication.prototype.watch_item = function(app_data, item) {
    return app_data.watch_item(item);
  };

  TreeAppApplication.prototype.get_animation_module = function(app) {
    var child, j, len, ref;
    ref = app.data.modules;
    for (j = 0, len = ref.length; j < len; j++) {
      child = ref[j];
      if (child instanceof TreeAppModule_Animation) {
        return child;
      }
    }
  };

  TreeAppApplication.prototype.get_display_settings_item = function(app) {
    var child, j, len, ref;
    ref = app.data.tree_items[0]._children;
    for (j = 0, len = ref.length; j < len; j++) {
      child = ref[j];
      if (child instanceof DisplaySettingsItem) {
        return child;
      }
    }
  };

  TreeAppApplication.prototype.add_item_depending_selected_tree = function(app_data, typeItem, callback) {
    var find_object, it, item, items, j, k, len, len1, object, parent, ref, session;
    items = app_data.get_selected_tree_items();
    find_object = false;
    if (find_object === false) {
      for (j = 0, len = items.length; j < len; j++) {
        it = items[j];
        item = new typeItem;
        if (typeof it.accept_child === "function" ? it.accept_child(item) : void 0) {
          if (find_object === false) {
            object = item;
            it.add_child(object);
            this.select_item(app_data, object, it);
            this.watch_item(app_data, object);
            find_object = true;
          }
        }
      }
    }
    if (find_object === false) {
      ref = app_data.selected_tree_items;
      for (k = 0, len1 = ref.length; k < len1; k++) {
        items = ref[k];
        parent = items[items.length - 2];
        item = new typeItem;
        if (parent instanceof typeItem) {
          object = parent;
          find_object = true;
        }
      }
    }
    if (find_object === false) {
      object = new typeItem;
      session = app_data.selected_session();
      session.add_child(object);
      this.select_item(app_data, object);
      this.watch_item(app_data, object);
    }
    if (callback != null) {
      callback(object);
    }
    return object;
  };

  TreeAppApplication.prototype.child_in_selected = function(app, typeItem, sel_item, item) {
    var c, current, i, id, it, j, len, p, results;
    current = new typeItem;
    results = [];
    for (j = 0, len = sel_item.length; j < len; j++) {
      it = sel_item[j];
      if (current.accept_child(it)) {
        app.data.selected_tree_items[0][app.data.selected_tree_items[0].length - 2].rem_child(it);
        item.add_child(it);
        id = it.model_id;
        results.push((function() {
          var k, len1, ref, results1;
          ref = app.data.panel_id_list();
          results1 = [];
          for (k = 0, len1 = ref.length; k < len1; k++) {
            p = ref[k];
            results1.push((function() {
              var l, len2, ref1, results2;
              ref1 = app.data.visible_tree_items[p];
              results2 = [];
              for (i = l = 0, len2 = ref1.length; l < len2; i = ++l) {
                c = ref1[i];
                if (c.model_id === id) {
                  app.data.visible_tree_items[p].splice(i, 1);
                  break;
                } else {
                  results2.push(void 0);
                }
              }
              return results2;
            })());
          }
          return results1;
        })());
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  return TreeAppApplication;

})(Model);
// Generated by CoffeeScript 1.11.1
var UserModel,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

UserModel = (function(superClass) {
  extend(UserModel, superClass);

  function UserModel() {
    UserModel.__super__.constructor.call(this);
    this.add_attr({
      email: Cookies.set("email"),
      firstName: "",
      lastName: "",
      created_at: new Date(),
      modify_at: new Date()
    });
  }

  return UserModel;

})(Model);
// Generated by CoffeeScript 1.11.1
var MessageCollection,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

MessageCollection = (function(superClass) {
  extend(MessageCollection, superClass);

  function MessageCollection(_name) {
    if (_name == null) {
      _name = "";
    }
    MessageCollection.__super__.constructor.call(this);
    this.add_attr({
      name: _name,
      list_messages: new Lst,
      text: "",
      list_users: new Lst
    });
  }

  MessageCollection.prototype.add_message = function() {
    var nm;
    nm = new Message(this.text);
    return this.list_messages.push(nm);
  };

  return MessageCollection;

})(Model);
// Generated by CoffeeScript 1.11.1
var Message,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Message = (function(superClass) {
  extend(Message, superClass);

  function Message(input_text) {
    if (input_text == null) {
      input_text = "";
    }
    Message.__super__.constructor.call(this);
    this.add_attr({
      date: "",
      user: Cookies.set("email"),
      text: ""
    });
    this.date.set((new Date()).toString().split(' ').splice(1, 3).join(' '));
    this.text.set(input_text);
  }

  return Message;

})(Model);
// Generated by CoffeeScript 1.11.1
var Organisation,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Organisation = (function(superClass) {
  extend(Organisation, superClass);

  function Organisation(name, config) {
    if (name == null) {
      name = "";
    }
    Organisation.__super__.constructor.call(this);
    this.add_attr({
      name: name,
      admin_users: new Lst,
      list_users: new Lst,
      list_logs: new Lst,
      list_applications: new Lst,
      created_at: new Date(),
      modify_at: new Date(),
      directory: new Directory
    });
    if (config != null) {
      this.admin_users.push(config.account);
    }
    if (config != null) {
      this.list_users.push(config.account);
    }
  }

  return Organisation;

})(Model);
// Generated by CoffeeScript 1.11.1
var OrganisationData,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

OrganisationData = (function(superClass) {
  extend(OrganisationData, superClass);

  function OrganisationData(config) {
    OrganisationData.__super__.constructor.call(this);
    this.add_attr({
      config: config,
      list_desk_items: new Lst,
      selected_list_desk_items: new Lst
    });
    this.list_desk_items.push(new DeskItem("Files", "OrganisationFiles"));
    this.list_desk_items.push(new DeskItem("Applications", "Applications"));
    this.list_desk_items.push(new DeskItem("Admin", "Admin"));
    this.list_desk_items.push(new DeskItem("Users", "Users"));
    this.list_desk_items.push(new DeskItem("Logs", "Logs"));
    this.selected_list_desk_items.push(this.list_desk_items[0]);
    this.layout = new LayoutManagerData({
      sep_norm: 0,
      children: [
        {
          panel_id: "DeskListView",
          immortal: true
        }, {
          panel_id: "DeskNavigatorView",
          strength: 3
        }
      ]
    });
  }

  return OrganisationData;

})(Model);
// Generated by CoffeeScript 1.11.1
var Animation;

Animation = (function() {
  function Animation() {}

  Animation.period_ms = 2;

  Animation._curan = {};

  Animation._timer = void 0;

  Animation.linear = function(rat) {
    return rat;
  };

  Animation.easing = function(rat) {
    return Math.pow(rat, 0.33);
  };

  Animation.set = function(model, value, delay, curve) {
    var dt, i, j, len, m, ms, results, vs;
    if (delay == null) {
      delay = 300;
    }
    if (curve == null) {
      curve = Animation.linear;
    }
    value = ModelProcessManager.conv(value);
    ms = model.size();
    vs = value.size();
    if (ms.length) {
      if (ms.length === 1 && vs.length === 1 && ms[0] === vs[0]) {
        results = [];
        for (i = j = 0, len = model.length; j < len; i = ++j) {
          m = model[i];
          results.push(Animation.set(m, value[i], delay, curve));
        }
        return results;
      } else {
        return model.set(value);
      }
    } else {
      dt = (new Date).getTime();
      Animation._curan[model.model_id] = {
        mod: model,
        old: model.get(),
        val: value,
        beg: dt,
        end: dt + delay,
        crv: curve
      };
      if (delay <= 0) {
        return Animation._timeout_func();
      } else if (Animation._timer == null) {
        return Animation._timer = setTimeout(Animation._timeout_func, Animation.period_ms);
      }
    }
  };

  Animation._timeout_func = function() {
    var dt, j, key, len, obj, rat, ref, remaining_anim, rm;
    dt = (new Date).getTime();
    rm = [];
    remaining_anim = false;
    ref = Animation._curan;
    for (key in ref) {
      obj = ref[key];
      rat = (dt - obj.beg) / (obj.end - obj.beg);
      if (rat >= 1) {
        obj.mod.set(obj.val);
        rm.push(key);
      } else {
        obj.mod.set(obj.old + (obj.val - obj.old) * obj.crv(rat));
        remaining_anim = true;
      }
    }
    for (j = 0, len = rm.length; j < len; j++) {
      key = rm[j];
      delete Animation._curan[key];
    }
    if (remaining_anim) {
      return Animation._timer = setTimeout(Animation._timeout_func, Animation.period_ms);
    } else {
      return Animation._timer = void 0;
    }
  };

  return Animation;

})();
// Generated by CoffeeScript 1.11.1
var TreeItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeItem = (function(superClass) {
  extend(TreeItem, superClass);

  function TreeItem() {
    TreeItem.__super__.constructor.call(this);
    this.add_attr({
      _ico: "",
      _name: "",
      _children: [],
      _output: [],
      _viewable: 0,
      _allow_vmod: true,
      _name_class: "",
      _context_modules: new Lst,
      _context_actions: new Lst
    });
  }

  TreeItem.prototype.add_context_modules = function(context_module) {
    return this._context_modules.push(context_module);
  };

  TreeItem.prototype.add_context_actions = function(context_action) {
    return this._context_actions.push(context_action);
  };

  TreeItem.prototype.display_suppl_context_actions = function(context_action) {};

  TreeItem.prototype.display_context_actions = function() {
    var contex_action;
    contex_action = new Lst;
    contex_action.push(new TreeAppAction_Save);
    this.display_suppl_context_actions(contex_action);
    return contex_action;
  };

  TreeItem.prototype.add_child = function(child) {
    return this._children.push(child);
  };

  TreeItem.prototype.rem_child = function(child) {
    var j, num_c, ref;
    if (child instanceof TreeItem) {
      for (num_c = j = 0, ref = this._children.length; 0 <= ref ? j < ref : j > ref; num_c = 0 <= ref ? ++j : --j) {
        if (this._children[num_c] === child) {
          this._children.splice(num_c, 1);
          return;
        }
      }
    } else {
      return this._children.splice(child, 1);
    }
  };

  TreeItem.prototype.detect_child = function(f) {
    var i, j, len, ref;
    ref = this._children;
    for (j = 0, len = ref.length; j < len; j++) {
      i = ref[j];
      if (f(i)) {
        return i;
      }
    }
    return void 0;
  };

  TreeItem.prototype.add_output = function(child) {
    return this._output.push(child);
  };

  TreeItem.prototype.rem_output = function(child) {
    var j, num_c, ref;
    if (child instanceof TreeItem) {
      for (num_c = j = 0, ref = this._output.length; 0 <= ref ? j < ref : j > ref; num_c = 0 <= ref ? ++j : --j) {
        if (this._output[num_c] === child) {
          this._output.splice(num_c, 1);
          return;
        }
      }
    } else {
      return this._output.splice(child, 1);
    }
  };

  TreeItem.prototype.draw = function(info) {
    var j, len, ref, results, s;
    if (this.sub_canvas_items != null) {
      ref = this.sub_canvas_items();
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        s = ref[j];
        results.push(s.draw(info));
      }
      return results;
    }
  };

  TreeItem.prototype.anim_min_max = function() {};

  TreeItem.prototype.z_index = function() {
    return 0;
  };

  TreeItem.prototype.to_string = function() {
    return this._name.get();
  };

  return TreeItem;

})(Model);

exports.TreeItem = TreeItem;
// Generated by CoffeeScript 1.11.1
var TreeAppModule,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule = (function(superClass) {
  extend(TreeAppModule, superClass);

  function TreeAppModule() {
    TreeAppModule.__super__.constructor.call(this);
    this.name = '';
    this.visible = true;
    this.actions = [];
  }

  TreeAppModule.prototype.select_item = function(app_data, item, parent) {
    var path;
    if (!parent) {
      path = [];
      path.push(app_data.selected_session());
    } else {
      path = app_data.get_root_path_in_selected(parent);
    }
    path.push(item);
    this.unselect_all_item(app_data);
    return app_data.selected_tree_items.push(path);
  };

  TreeAppModule.prototype.unselect_all_item = function(app_data) {
    return app_data.selected_tree_items.clear();
  };

  TreeAppModule.prototype.watch_item = function(app_data, item) {
    return app_data.watch_item(item);
  };

  TreeAppModule.prototype.get_animation_module = function(app) {
    var child, j, len, ref;
    ref = app.data.modules;
    for (j = 0, len = ref.length; j < len; j++) {
      child = ref[j];
      if (child instanceof TreeAppModule_Animation) {
        return child;
      }
    }
  };

  TreeAppModule.prototype.get_display_settings_item = function(app) {
    var child, j, len, ref;
    ref = app.data.tree_items[0]._children;
    for (j = 0, len = ref.length; j < len; j++) {
      child = ref[j];
      if (child instanceof DisplaySettingsItem) {
        return child;
      }
    }
  };

  TreeAppModule.prototype.add_item_depending_selected_tree = function(app_data, typeItem) {
    var find_object, it, item, items, j, k, len, len1, object, parent, ref, session;
    items = app_data.get_selected_tree_items();
    find_object = false;
    if (find_object === false) {
      for (j = 0, len = items.length; j < len; j++) {
        it = items[j];
        item = new typeItem;
        if (typeof it.accept_child === "function" ? it.accept_child(item) : void 0) {
          if (find_object === false) {
            object = item;
            it.add_child(object);
            this.select_item(app_data, object, it);
            this.watch_item(app_data, object);
            find_object = true;
          }
        }
      }
    }
    if (find_object === false) {
      ref = app_data.selected_tree_items;
      for (k = 0, len1 = ref.length; k < len1; k++) {
        items = ref[k];
        parent = items[items.length - 2];
        item = new typeItem;
        if (parent instanceof typeItem) {
          object = parent;
          find_object = true;
        }
      }
    }
    if (find_object === false) {
      object = new typeItem;
      session = app_data.selected_session();
      session.add_child(object);
      this.select_item(app_data, object);
      this.watch_item(app_data, object);
    }
    return object;
  };

  TreeAppModule.prototype.child_in_selected = function(app, typeItem, sel_item, item) {
    var c, current, i, id, it, j, len, p, results;
    current = new typeItem;
    results = [];
    for (j = 0, len = sel_item.length; j < len; j++) {
      it = sel_item[j];
      if (current.accept_child(it)) {
        app.data.selected_tree_items[0][app.data.selected_tree_items[0].length - 2].rem_child(it);
        item.add_child(it);
        id = it.model_id;
        results.push((function() {
          var k, len1, ref, results1;
          ref = app.data.panel_id_list();
          results1 = [];
          for (k = 0, len1 = ref.length; k < len1; k++) {
            p = ref[k];
            results1.push((function() {
              var l, len2, ref1, results2;
              ref1 = app.data.visible_tree_items[p];
              results2 = [];
              for (i = l = 0, len2 = ref1.length; l < len2; i = ++l) {
                c = ref1[i];
                if (c.model_id === id) {
                  app.data.visible_tree_items[p].splice(i, 1);
                  break;
                } else {
                  results2.push(void 0);
                }
              }
              return results2;
            })());
          }
          return results1;
        })());
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  return TreeAppModule;

})(Model);
// Generated by CoffeeScript 1.11.1
var CollectionTreeItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

CollectionTreeItem = (function(superClass) {
  extend(CollectionTreeItem, superClass);

  function CollectionTreeItem() {
    CollectionTreeItem.__super__.constructor.call(this);
    this.add_attr({
      _collection_size: 0,
      _incr_id_collection_child: 0
    });
    this.bind((function(_this) {
      return function() {
        if (_this._collection_size.has_been_modified()) {
          return _this.change_collection();
        }
      };
    })(this));
  }

  CollectionTreeItem.prototype.display_suppl_context_actions = function(context_action) {};

  CollectionTreeItem.prototype.display_context_actions = function() {
    var contex_action;
    contex_action = new Lst;
    contex_action.push(new TreeAppAction_Save);
    contex_action.push({
      txt: "add",
      ico: "data:image/png;base64,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",
      fun: (function(_this) {
        return function(evt, app) {
          var i, item, items, len, path_item, results;
          items = app.data.selected_tree_items;
          results = [];
          for (i = 0, len = items.length; i < len; i++) {
            path_item = items[i];
            item = path_item[path_item.length - 1];
            results.push(item._collection_size.set(item._collection_size.get() + 1));
          }
          return results;
        };
      })(this)
    });
    contex_action.push({
      txt: "remove",
      ico: "data:image/png;base64,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",
      fun: (function(_this) {
        return function(evt, app) {
          var i, item, items, len, path_item, results;
          items = app.data.selected_tree_items;
          results = [];
          for (i = 0, len = items.length; i < len; i++) {
            path_item = items[i];
            item = path_item[path_item.length - 1];
            if (item._collection_size.get() > 0) {
              results.push(item._collection_size.set(item._collection_size.get() - 1));
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    });
    this.display_suppl_context_actions(contex_action);
    return contex_action;
  };

  CollectionTreeItem.prototype.ask_for_id_collection_child = function() {
    var id_child;
    id_child = parseInt(this._incr_id_collection_child);
    this._incr_id_collection_child.set(parseInt(this._incr_id_collection_child) + 1);
    return id_child;
  };

  CollectionTreeItem.prototype.remove_collection_item = function() {
    var size_splice;
    size_splice = this._children.length - this._collection_size;
    return this._children.splice(this._collection_size, size_splice);
  };

  CollectionTreeItem.prototype.add_collection_item = function() {
    var id_child, name_temp;
    id_child = this.ask_for_id_collection_child();
    name_temp = "child_" + id_child.toString();
    return this.add_child(new BoundaryConditionItem(name_temp, id_child, this._dim));
  };

  CollectionTreeItem.prototype.change_collection = function() {
    var i, num_c, ref, ref1, results, size_child0_child, size_splice;
    size_splice = 0;
    if (this._children.length > this._collection_size) {
      return this.remove_collection_item();
    } else {
      size_child0_child = this._children.length;
      results = [];
      for (num_c = i = ref = size_child0_child, ref1 = this._collection_size; ref <= ref1 ? i < ref1 : i > ref1; num_c = ref <= ref1 ? ++i : --i) {
        results.push(this.add_collection_item());
      }
      return results;
    }
  };

  return CollectionTreeItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var TreeItem_Computable,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeItem_Computable = (function(superClass) {
  extend(TreeItem_Computable, superClass);

  function TreeItem_Computable() {
    TreeItem_Computable.__super__.constructor.call(this);
    this.add_attr({
      _computation_req_date: 1,
      _computation_rep_date: 0,
      _computation_mode: 0,
      _ready_state: true,
      _computation_state: false,
      _pending_state: false,
      _processing_state: false,
      _finish_state: false,
      _stop_state: false,
      _sc_nb_proc: 1,
      _messages: [],
      auto_compute: false
    });
    this.bind((function(_this) {
      return function() {
        if (_this.auto_compute.has_been_modified()) {
          _this._computation_mode.set(_this.auto_compute.get() * 2);
        } else if (_this._computation_mode.has_been_modified()) {
          _this.auto_compute.set(_this._computation_mode.get());
        }
        if (_this.real_change()) {
          if (_this._computation_req_date.has_been_modified()) {
            return;
          }
          if (_this._computation_rep_date.has_been_modified()) {
            return;
          }
          return _this._computation_req_date.add(1);
        }
      };
    })(this));
  }

  TreeItem_Computable.prototype.cosmetic_attribute = function(name) {
    return name === "_ready_state" || name === "_pending_state" || name === "_processing_state" || name === "_finish_state" || name === "_computation_req_date" || name === "_computation_rep_date" || name === "_computation_mode" || name === "_computation_state" || name === "_stop_state" || name === "_messages" || name === "auto_compute";
  };

  TreeItem_Computable.prototype.nothing_to_do = function() {
    return this._computation_req_date.get() === this._computation_rep_date.get();
  };

  TreeItem_Computable.prototype.manual_mode = function() {
    return this._computation_mode.get();
  };

  TreeItem_Computable.prototype.do_it = function() {
    return TreeItem_Computable._do_it_rec(this);
  };

  TreeItem_Computable._do_it_rec = function(obj) {
    var c, i, len, ref, results;
    if (obj instanceof TreeItem_Computable) {
      obj._computation_state.set(true);
      obj._stop_state.set(false);
    }
    ref = obj._children;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      c = ref[i];
      results.push(TreeItem_Computable._do_it_rec(c));
    }
    return results;
  };

  TreeItem_Computable.prototype.stop_it = function() {
    return TreeItem_Computable._stop_it_rec(this);
  };

  TreeItem_Computable._stop_it_rec = function(obj) {
    var c, i, len, ref, results;
    if (obj instanceof TreeItem_Computable) {
      obj._computation_state.set(false);
      obj._computation_mode.set(false);
      obj._finish_state.set(true);
      obj._stop_state.set(true);
    }
    ref = obj._children;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      c = ref[i];
      results.push(TreeItem_Computable._stop_it_rec(c));
    }
    return results;
  };

  return TreeItem_Computable;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var TreeItem_Automatic,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeItem_Automatic = (function(superClass) {
  extend(TreeItem_Automatic, superClass);

  function TreeItem_Automatic() {
    TreeItem_Automatic.__super__.constructor.call(this);
    this.add_attr({
      _req_date: 1,
      _rep_date: 0,
      _messages: []
    });
    this.bind((function(_this) {
      return function() {
        if (_this.has_been_directly_modified()) {
          if (_this._req_date.has_been_modified()) {
            return;
          }
          if (_this._rep_date.has_been_modified()) {
            return;
          }
          return _this._req_date.add(1);
        }
      };
    })(this));
  }

  TreeItem_Automatic.prototype.cosmetic_attribute = function(name) {
    return name === "_rep_date" || name === "_messages";
  };

  TreeItem_Automatic.prototype.nothing_to_do = function() {
    return this._req_date.get() === this._rep_date.get();
  };

  return TreeItem_Automatic;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var TreeAppData,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

TreeAppData = (function(superClass) {
  extend(TreeAppData, superClass);

  function TreeAppData() {
    TreeAppData.__super__.constructor.call(this);
    this.add_attr({
      tree_items: new Lst,
      selected_tree_items: new Lst,
      visible_tree_items: new Model,
      closed_tree_items: new Lst,
      selected_canvas_pan: new Lst,
      last_canvas_pan: new Str,
      applications: new Lst,
      base_modules: new Lst,
      modules: new Lst,
      focus: -1,
      time: new ConstrainedVal(0, {
        min: 0,
        max: 100
      })
    });
  }

  TreeAppData.prototype.watch_item = function(item) {
    var j, len, p, ref, results;
    ref = this.panel_id_list();
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      p = ref[j];
      if (this.visible_tree_items[p] == null) {
        this.visible_tree_items.add_attr(p, []);
      }
      if (!this.visible_tree_items[p].contains_ref(item)) {
        results.push(this.visible_tree_items[p].push(item));
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  TreeAppData.prototype.unwatch_item = function(item) {
    var j, len, p, ref, results;
    ref = this.panel_id_list();
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      p = ref[j];
      if (this.visible_tree_items[p] == null) {
        this.visible_tree_items.add_attr(p, []);
      }
      if (!this.visible_tree_items[p].contains_ref(item)) {
        results.push(this.visible_tree_items[p].remove(item));
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  TreeAppData.prototype.watch_item_in_p = function(item, p) {
    if (this.visible_tree_items[p] == null) {
      this.visible_tree_items.add_attr(p, []);
    }
    if (!this.visible_tree_items[p].contains_ref(item)) {
      return this.visible_tree_items[p].push(item);
    }
  };

  TreeAppData.prototype.unwatch_item_in_p = function(item, p) {
    if (this.visible_tree_items[p] == null) {
      this.visible_tree_items.add_attr(p, []);
    }
    if (!this.visible_tree_items[p].contains_ref(item)) {
      return this.visible_tree_items[p].remove(item);
    }
  };

  TreeAppData.prototype.close_item = function(item) {
    return this.closed_tree_items.push(item);
  };

  TreeAppData.prototype.open_item = function(item) {
    var index, it, j, len, ref, results;
    ref = this.closed_tree_items;
    results = [];
    for (index = j = 0, len = ref.length; j < len; index = ++j) {
      it = ref[index];
      if (item.equals(it)) {
        results.push(this.closed_tree_items.splice(index, 1));
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  TreeAppData.prototype.display_framework = function() {
    var d;
    d = new DisplaySettingsItem({
      sep_norm: 0,
      children: [
        {
          panel_id: "ContextBar",
          immortal: true,
          min_size: [60, 0],
          max_size: [65, 1e5]
        }, {
          sep_norm: 0,
          children: [
            {
              sep_norm: 1,
              children: [
                {
                  panel_id: "TreeView",
                  immortal: true
                }, {
                  strength: 2,
                  panel_id: "EditView",
                  immortal: true
                }
              ]
            }, {
              panel_id: "MainView",
              strength: 3
            }
          ]
        }
      ]
    });
    return d;
  };

  TreeAppData.prototype.display_standard_framework = function() {
    var d;
    d = new DisplaySettingsItem({
      sep_norm: 0,
      children: [
        {
          panel_id: "ContextBar",
          immortal: true,
          min_size: [60, 0],
          max_size: [65, 1e5]
        }, {
          sep_norm: 0,
          children: [
            {
              panel_id: "TreeView",
              immortal: true
            }, {
              panel_id: "EditView",
              strength: 3
            }
          ]
        }
      ]
    });
    return d;
  };

  TreeAppData.prototype.new_session = function(name) {
    var d, s;
    if (name == null) {
      name = "Session";
    }
    s = new SessionItem(name, this);
    this.add_session(s);
    d = this.display_framework();
    s._children.push(d);
    return s;
  };

  TreeAppData.prototype.new_standard_session = function(name) {
    var d, s;
    if (name == null) {
      name = "Session";
    }
    s = new SessionItem(name, this);
    this.add_session(s);
    d = this.display_standard_framework();
    s._children.push(d);
    return s;
  };

  TreeAppData.prototype.add_session = function(session) {
    return this.tree_items.push(session);
  };

  TreeAppData.prototype.selected_session = function() {
    var j, len, ref, session;
    ref = this.tree_items;
    for (j = 0, len = ref.length; j < len; j++) {
      session = ref[j];
      if (this.has_a_selected_child(session)) {
        return session;
      }
    }
    return this.tree_items[0];
  };

  TreeAppData.prototype.selected_display_settings = function() {
    var session;
    session = this.selected_session();
    return session._children.detect(function(x) {
      return x instanceof DisplaySettingsItem;
    });
  };

  TreeAppData.prototype.panel_id_list = function() {
    var d;
    d = this.selected_display_settings();
    return d._layout.panel_id_of_term_panels().filter(function(x) {
      return x !== "EditView" && x !== "TreeView" && x !== "ContextBar" && x !== "IcoBar";
    });
  };

  TreeAppData.prototype.rm_selected_panels = function() {
    var d, j, len, panel_id, ref, results;
    d = this.selected_display_settings();
    ref = this.selected_canvas_pan;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      panel_id = ref[j];
      results.push(d._layout.rm_panel(panel_id));
    }
    return results;
  };

  TreeAppData.prototype.update_associated_layout_data = function(d) {
    var j, k, key, len, len1, pil, ref, ref1, ref2;
    pil = d._layout.panel_id_of_term_panels();
    ref = (function() {
      var k, len, ref, results;
      ref = this.visible_tree_items._attribute_names;
      results = [];
      for (k = 0, len = ref.length; k < len; k++) {
        key = ref[k];
        if (indexOf.call(pil, key) < 0) {
          results.push(key);
        }
      }
      return results;
    }).call(this);
    for (j = 0, len = ref.length; j < len; j++) {
      key = ref[j];
      this.visible_tree_items.rem_attr(key);
    }
    ref1 = (function() {
      var l, len1, ref1, results;
      ref1 = this.selected_canvas_pan;
      results = [];
      for (l = 0, len1 = ref1.length; l < len1; l++) {
        key = ref1[l];
        if (indexOf.call(pil, key) < 0) {
          results.push(key);
        }
      }
      return results;
    }).call(this);
    for (k = 0, len1 = ref1.length; k < len1; k++) {
      key = ref1[k];
      this.selected_canvas_pan.remove(key);
    }
    if (!this.selected_canvas_pan.length) {
      this.selected_canvas_pan.push(pil[pil.length - 1]);
    }
    if (ref2 = this.last_canvas_pan, indexOf.call(pil, ref2) < 0) {
      return this.last_canvas_pan.set(pil[pil.length - 1]);
    }
  };

  TreeAppData.prototype.get_current_cam = function() {
    var i, j, panel_id, ref;
    panel_id = this.last_canvas_pan.get();
    for (i = j = 0, ref = this.selected_display_settings()._children.length; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
      if (this.selected_display_settings()._children[i]._panel_id.get() === panel_id) {
        return this.selected_display_settings()._children[i].cam;
      }
    }
  };

  TreeAppData.prototype.has_a_selected_child = function(item) {
    var c, j, len, ref;
    if (indexOf.call(this.selected_tree_items, item) >= 0) {
      return true;
    }
    ref = item._children;
    for (j = 0, len = ref.length; j < len; j++) {
      c = ref[j];
      if (this.has_a_selected_child(c)) {
        return true;
      }
    }
    return false;
  };

  TreeAppData.prototype.get_child_of_type = function(item, type) {
    var res, visited;
    res = [];
    visited = {};
    this._get_child_of_type_rec(res, visited, item, type);
    return res;
  };

  TreeAppData.prototype.get_selected_tree_items = function() {
    var items, j, len, path, ref;
    items = new Lst;
    ref = this.selected_tree_items;
    for (j = 0, len = ref.length; j < len; j++) {
      path = ref[j];
      items.push(path[path.length - 1]);
    }
    return items;
  };

  TreeAppData.prototype.get_root_path_in_selected = function(item) {
    var it, j, k, len, len1, path, ref;
    ref = this.selected_tree_items;
    for (j = 0, len = ref.length; j < len; j++) {
      path = ref[j];
      for (k = 0, len1 = path.length; k < len1; k++) {
        it = path[k];
        if (it.model_id === item.model_id) {
          return path;
        }
      }
    }
  };

  TreeAppData.prototype.get_root_path = function(item) {
    var j, len, node, path, ref, res, root;
    res = [];
    path = [];
    ref = this.tree_items;
    for (j = 0, len = ref.length; j < len; j++) {
      root = ref[j];
      path.push(root);
      if (item.equals(root)) {
        res.push(path.slice(0));
      } else {
        node = root;
        this.get_root_path_rec(path, item, node, res);
      }
      return res;
    }
  };

  TreeAppData.prototype.get_root_path_rec = function(path, item, node, res) {
    var child, j, k, len, len1, ref, ref1, results;
    ref = node._children;
    for (j = 0, len = ref.length; j < len; j++) {
      child = ref[j];
      if (item.equals(child)) {
        path.push(child);
        res.push(path.slice(0));
        path.pop();
        return path;
      }
    }
    ref1 = node._children;
    results = [];
    for (k = 0, len1 = ref1.length; k < len1; k++) {
      child = ref1[k];
      path.push(child);
      this.get_root_path_rec(path, item, child, res);
      results.push(path.pop());
    }
    return results;
  };

  TreeAppData.prototype.delete_from_tree = function(item, root) {
    var c, child, i, j, k, l, len, len1, len2, m, n, p, parent, ref, ref1, ref2, ref3, ref4, results;
    if (root == null) {
      root = true;
    }
    child = false;
    if (item._children.length) {
      for (i = j = ref = item._children.length - 1; ref <= 0 ? j <= 0 : j >= 0; i = ref <= 0 ? ++j : --j) {
        c = item._children[i];
        if (c._children.length > 0) {
          this.delete_from_tree(c, false);
        }
        child = true;
        item.rem_child(c);
        this.closed_tree_items.remove(c);
        ref1 = this.panel_id_list();
        for (k = 0, len = ref1.length; k < len; k++) {
          p = ref1[k];
          this.visible_tree_items[p].remove(c);
        }
      }
    }
    if (item._output.length) {
      for (i = l = ref2 = item._output.length - 1; ref2 <= 0 ? l <= 0 : l >= 0; i = ref2 <= 0 ? ++l : --l) {
        c = item._output[i];
        if (c._output.length > 0) {
          this.delete_from_tree(c, false);
        }
        child = true;
        item.rem_child(c);
        this.closed_tree_items.remove(c);
        ref3 = this.panel_id_list();
        for (m = 0, len1 = ref3.length; m < len1; m++) {
          p = ref3[m];
          this.visible_tree_items[p].remove(c);
        }
      }
    }
    if (!child || root) {
      parent = this._get_parent(item);
      parent.rem_child(item);
      this.closed_tree_items.remove(item);
      ref4 = this.panel_id_list();
      results = [];
      for (n = 0, len2 = ref4.length; n < len2; n++) {
        p = ref4[n];
        results.push(this.visible_tree_items[p].remove(item));
      }
      return results;
    }
  };

  TreeAppData.prototype._get_parent = function(item) {
    var i, parent, path;
    path = item._parents;
    if (path[0].length <= 2) {
      parent = path[0][0];
    } else {
      parent = path[0][path[0].length - 2];
    }
    if (parent === item) {
      i = 1;
      while (parent === item && i < 50) {
        if (path[i].length > 1) {
          parent = path[i][path[i].length - 2];
        }
        i++;
      }
    }
    return parent;
  };

  TreeAppData.prototype._get_child_of_type_rec = function(res, visited, item, type) {
    var ch, j, len, ref, results;
    if (visited[item.model_id] == null) {
      visited[item.model_id] = true;
      if (item instanceof type) {
        res.push(item);
      }
      if (item._children != null) {
        ref = item._children;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          ch = ref[j];
          results.push(this._get_child_of_type_rec(res, visited, ch, type));
        }
        return results;
      }
    }
  };

  return TreeAppData;

})(Model);
// Generated by CoffeeScript 1.11.1
var TreeAppApplication_Test,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppApplication_Test = (function(superClass) {
  extend(TreeAppApplication_Test, superClass);

  function TreeAppApplication_Test() {
    var _ina;
    TreeAppApplication_Test.__super__.constructor.call(this);
    this.name = 'Test apps';
    this.powered_with = 'SC';
    _ina = (function(_this) {
      return function(app) {
        var ref, ref1;
        return app.data.focus.get() !== ((ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm.process_id : void 0 : void 0);
      };
    })(this);
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "test collection item",
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var test;
          app.undo_manager.snapshot();
          return test = _this.add_item_depending_selected_tree(app.data, ImgDirectorySetItem, function(object) {
            object.time = app.data.time;
            return object._app_data = app.data;
          });
        };
      })(this)
    });
  }

  return TreeAppApplication_Test;

})(TreeAppApplication);
// Generated by CoffeeScript 1.11.1
var TreeAppApplication_TreeItemParametric,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppApplication_TreeItemParametric = (function(superClass) {
  extend(TreeAppApplication_TreeItemParametric, superClass);

  function TreeAppApplication_TreeItemParametric() {
    var _ina;
    TreeAppApplication_TreeItemParametric.__super__.constructor.call(this);
    this.name = 'TreeItem Parametric';
    this.powered_with = 'SpinalCom';
    this.description = 'Insert a new TreeItem Parametric in the session.';
    _ina = (function(_this) {
      return function(app) {
        var ref, ref1;
        return app.data.focus.get() !== ((ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm.view_id : void 0 : void 0);
      };
    })(this);
    this.actions.push({
      txt: "TreeItem Parametric",
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var treeItem;
          app.undo_manager.snapshot();
          return treeItem = _this.add_item_depending_selected_tree(app.data, TreeItem_Parametric, function(object) {
            var name;
            name = prompt("Enter the name of the TreeItem:");
            if (name) {
              return object._name.set(name);
            } else {
              return object._name.set("Item");
            }
          });
        };
      })(this)
    });
  }

  return TreeAppApplication_TreeItemParametric;

})(TreeAppApplication);
// Generated by CoffeeScript 1.11.1
var TreeAppApplication_Sketcher,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppApplication_Sketcher = (function(superClass) {
  extend(TreeAppApplication_Sketcher, superClass);

  function TreeAppApplication_Sketcher() {
    var _ina;
    TreeAppApplication_Sketcher.__super__.constructor.call(this);
    this.name = 'Sketcher';
    this.powered_with = 'SC';
    _ina = (function(_this) {
      return function(app) {
        var ref, ref1;
        return app.data.focus.get() !== ((ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm.process_id : void 0 : void 0);
      };
    })(this);
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Web Sketcher",
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var sketcher;
          app.undo_manager.snapshot();
          return sketcher = _this.add_item_depending_selected_tree(app.data, SketchItem);
        };
      })(this)
    });
  }

  return TreeAppApplication_Sketcher;

})(TreeAppApplication);
// Generated by CoffeeScript 1.11.1
var TreeAppApplication_Grid,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppApplication_Grid = (function(superClass) {
  extend(TreeAppApplication_Grid, superClass);

  function TreeAppApplication_Grid() {
    TreeAppApplication_Grid.__super__.constructor.call(this);
    this.name = 'Add a grid';
    this.powered_with = 'SC';
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Grid",
      fun: (function(_this) {
        return function(evt, app) {
          var grid;
          app.undo_manager.snapshot();
          return grid = _this.add_item_depending_selected_tree(app.data, GridItem);
        };
      })(this)
    });
  }

  return TreeAppApplication_Grid;

})(TreeAppApplication);
// Generated by CoffeeScript 1.11.1
var TreeAppApplication_DeepCopy,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppApplication_DeepCopy = (function(superClass) {
  extend(TreeAppApplication_DeepCopy, superClass);

  function TreeAppApplication_DeepCopy() {
    TreeAppApplication_DeepCopy.__super__.constructor.call(this);
    this.name = 'Util';
    this.actions.push({
      ico: "data:image/png;base64,",
      txt: "deep_copy",
      siz: 1,
      fun: (function(_this) {
        return function(evt, app) {
          var m;
          app.undo_manager.snapshot();
          return m = _this.add_item_depending_selected_tree(app.data, DeepCopyItem);
        };
      })(this)
    });
  }

  return TreeAppApplication_DeepCopy;

})(TreeAppApplication);
// Generated by CoffeeScript 1.11.1
var TreeAppApplication_Annotation,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppApplication_Annotation = (function(superClass) {
  extend(TreeAppApplication_Annotation, superClass);

  function TreeAppApplication_Annotation() {
    TreeAppApplication_Annotation.__super__.constructor.call(this);
    this.name = 'Add a note';
    this.powered_with = 'SC';
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Note",
      fun: (function(_this) {
        return function(evt, app) {
          var note;
          app.undo_manager.snapshot();
          return note = _this.add_item_depending_selected_tree(app.data, AnnotationItem);
        };
      })(this)
    });
  }

  return TreeAppApplication_Annotation;

})(TreeAppApplication);
// Generated by CoffeeScript 1.11.1
var TreeAppAction_Save,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppAction_Save = (function(superClass) {
  extend(TreeAppAction_Save, superClass);

  function TreeAppAction_Save() {
    var save_sub;
    TreeAppAction_Save.__super__.constructor.call(this);
    this.name = 'Save';
    save_sub = {
      fa: "fa-floppy-o",
      siz: 1,
      txt: "Save",
      sub: {
        prf: "list",
        act: []
      },
      key: ["M"]
    };
    this.actions.push(save_sub);
    save_sub.sub.act.push({
      txt: "Save",
      key: [""],
      fa: "fa-floppy-o",
      loc: true,
      fun: (function(_this) {
        return function(evt, app) {
          var dir_save, fs, i, item, items, len, name, path_item, results;
          items = app.data.selected_tree_items;
          results = [];
          for (i = 0, len = items.length; i < len; i++) {
            path_item = items[i];
            item = path_item[path_item.length - 1];
            console.log("saving : ", item);
            if ((typeof FileSystem !== "undefined" && FileSystem !== null) && (FileSystem.get_inst() != null)) {
              fs = FileSystem.get_inst();
              name = prompt("Item name", item.to_string() + new Date());
              dir_save = FileSystem._home_dir;
              dir_save = dir_save + "/__files__";
              results.push(fs.load_or_make_dir(dir_save, function(d, err) {
                return d.add_file(name, item, {
                  model_type: "TreeItem"
                });
              }));
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    });
    save_sub.sub.act.push({
      txt: "Delete current tree item",
      fa: "fa-trash",
      key: ["Del"],
      loc: true,
      fun: (function(_this) {
        return function(evt, app) {
          var i, j, len, len1, m, mod, modules, path, ref;
          ref = app.data.selected_tree_items;
          for (i = 0, len = ref.length; i < len; i++) {
            path = ref[i];
            if (path.length > 1) {
              m = path[path.length - 1];
              if (m instanceof DisplaySettingsItem) {
                return true;
              } else if (m instanceof ViewItem) {
                modules = app.data.modules;
                for (j = 0, len1 = modules.length; j < len1; j++) {
                  mod = modules[j];
                  if (mod instanceof TreeAppModule_PanelManager) {
                    mod.actions[4].fun(evt, app);
                  }
                }
              } else {
                app.undo_manager.snapshot();
                path[path.length - 2].rem_child(m);
                app.data.delete_from_tree(m);
                app.data.selected_tree_items.clear();
              }
            }
          }
        };
      })(this)
    });
    save_sub.sub.act.push({
      txt: "Copy tree item",
      fa: "fa-copy",
      loc: true,
      fun: (function(_this) {
        return function(evt, app) {
          var copyItem, i, len, m, path, ref, results, session;
          ref = app.data.selected_tree_items;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            path = ref[i];
            if (path.length > 1) {
              m = path[path.length - 1];
              if (m instanceof DisplaySettingsItem || m instanceof ViewItem) {

              } else {
                copyItem = m.deep_copy();
                copyItem._name.set(m._name + "_copy");
                session = app.data.selected_session();
                session.add_child(copyItem);
                _this.select_item(app.data, copyItem);
                results.push(_this.watch_item(app.data, copyItem));
              }
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    });
  }

  return TreeAppAction_Save;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppAction_AddModel,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppAction_AddModel = (function(superClass) {
  extend(TreeAppAction_AddModel, superClass);

  function TreeAppAction_AddModel() {
    this.onPopupClose = bind(this.onPopupClose, this);
    var add_sub;
    TreeAppAction_AddModel.__super__.constructor.call(this);
    this.name = 'AddModel';
    add_sub = {
      fa: "fa-database",
      txt: "Add new model",
      sub: {
        prf: "list",
        act: []
      }
    };
    this.actions.push(add_sub);
    add_sub.sub.act.push({
      txt: "Add an attr",
      txtico: "New attr",
      loc: true,
      fun: (function(_this) {
        return function(evt, app) {
          var container_global, form, i, item, len, path, ref;
          app.undo_manager.snapshot();
          ref = app.data.selected_tree_items;
          for (i = 0, len = ref.length; i < len; i++) {
            path = ref[i];
            item = path[path.length - 1];
          }
          container_global = new_dom_element({
            className: "apps_container",
            id: "id_apps_container"
          });
          form = new ModelEditorItem_NewAttr({
            el: container_global,
            model: item
          });
          return _this.newSmallPopup("New Attribute", container_global, evt, app);
        };
      })(this)
    });
    add_sub.sub.act.push({
      txt: "Add a child",
      txtico: "New child",
      loc: true,
      fun: (function(_this) {
        return function(evt, app) {
          var container_global, form, i, item, len, path, ref;
          app.undo_manager.snapshot();
          ref = app.data.selected_tree_items;
          for (i = 0, len = ref.length; i < len; i++) {
            path = ref[i];
            item = path[path.length - 1];
          }
          container_global = new_dom_element({
            className: "apps_container",
            id: "id_apps_container"
          });
          form = new ModelEditorItem_NewTreeItem({
            el: container_global,
            model: item
          });
          return _this.newSmallPopup("New TreeItem", container_global, evt, app);
        };
      })(this)
    });
    add_sub.sub.act.push({
      txt: "Generate a new JavaScript class",
      txtico: "New class",
      loc: true,
      fun: (function(_this) {
        return function(evt, app) {
          var container_global, form, i, item, len, path, ref;
          app.undo_manager.snapshot();
          ref = app.data.selected_tree_items;
          for (i = 0, len = ref.length; i < len; i++) {
            path = ref[i];
            item = path[path.length - 1];
          }
          container_global = new_dom_element({
            className: "apps_container",
            id: "id_apps_container"
          });
          form = new ModelEditorItem_NewClass({
            el: container_global,
            model: item
          });
          return _this.newSmallPopup("New Class", container_global, evt, app);
        };
      })(this)
    });
  }

  TreeAppAction_AddModel.prototype.newSmallPopup = function(name, container_global, evt, app) {
    var Pheight, Pleft, Ptop, Pwidth, i, inst, inst_i, len, p, ref;
    inst = void 0;
    ref = app.selected_canvas_inst();
    for (i = 0, len = ref.length; i < len; i++) {
      inst_i = ref[i];
      inst = inst_i;
    }
    if (inst.divCanvas != null) {
      Ptop = this.getTop(inst.div) + 50;
      Pleft = this.getLeft(inst.div) + 50;
      Pwidth = 220;
      Pheight = 132;
    } else {
      Ptop = 100;
      Pleft = 100;
      Pwidth = 220;
      Pheight = 132;
    }
    p = new_popup(name, {
      event: evt,
      child: container_global,
      top_x: Pleft,
      top_y: Ptop,
      width: Pwidth,
      height: Pheight,
      onclose: (function(_this) {
        return function() {
          return _this.onPopupClose(app);
        };
      })(this)
    });
    return app.active_key.set(false);
  };

  TreeAppAction_AddModel.prototype.onPopupClose = function(app) {
    document.onkeydown = void 0;
    return app.active_key.set(true);
  };

  TreeAppAction_AddModel.prototype.getLeft = function(l) {
    if (l.offsetParent != null) {
      return l.offsetLeft + this.getLeft(l.offsetParent);
    } else {
      return l.offsetLeft;
    }
  };

  TreeAppAction_AddModel.prototype.getTop = function(l) {
    if (l.offsetParent != null) {
      return l.offsetTop + this.getTop(l.offsetParent);
    } else {
      return l.offsetTop;
    }
  };

  return TreeAppAction_AddModel;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_PanelManagerTop,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_PanelManagerTop = (function(superClass) {
  extend(TreeAppModule_PanelManagerTop, superClass);

  function TreeAppModule_PanelManagerTop() {
    var _ina, cube;
    TreeAppModule_PanelManagerTop.__super__.constructor.call(this);
    this.name = 'Windows';
    _ina = (function(_this) {
      return function(app) {
        var ref, ref1;
        return app.data.focus.get() !== ((ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm.process_id : void 0 : void 0);
      };
    })(this);
    this.actions.push({
      ico: "data:image/png;base64,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",
      siz: 1,
      txt: "Close current view (Shift+X)",
      ina: _ina,
      fun: function(evt, app) {
        app.undo_manager.snapshot();
        return app.data.rm_selected_panels();
      },
      key: ["Shift+X"]
    });
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAAZiS0dEAMgAyADIKiWVHwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90DDQ42JoYxPt4AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAGX0lEQVQ4EQFUBqv5Af///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAJSUl//z8/AAAAAAAAAAAAAAAAAAAAAAABAQEANvb2wEAAAAAJSUl//z8/AAAAAAAAAAAAAAAAAAAAAAABAQEANvb2wEAAAAABAAAAAAAAAAAhoaGAB4eHgAAAAAAAAAAAAAAAAAAAAAA4uLiAAAAAAAAAAAAhoaGAB4eHgAAAAAAAAAAAAAAAAAAAAAA4uLiAAAAAAAAAAAAAgAAAAAAAAAAHh4eAAAAAAAAAAAAAAAAAAAAAAAAAAAAHh4eAAAAAAAAAAAAHh4eAAAAAAAAAAAAAAAAAAAAAAAAAAAAHh4eAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAA5ubmAAAAAAAAAAAAAAAAAAAAAAAAAAAA5ubmAAAAAAAAAAAA5ubmAAAAAAAAAAAAAAAAAAAAAAAAAAAA5ubmAAAAAAAAAAAAAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAzNUpeS+fl6wAAAAASUVORK5CYII=",
      siz: 1,
      txt: "Vertical split (Shift+V)",
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          return _this.split_view(evt, app, 0);
        };
      })(this),
      key: ["Shift+V"]
    });
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAAZiS0dEAMgAyADIKiWVHwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90DDQ44IPHRtmUAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAGX0lEQVQ4EQFUBqv5Af///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAJSUl//z8/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEANvb2wEAAAAABAAAAAAAAAAAhoaGAB4eHgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4uLiAAAAAAAAAAAAAgAAAAAAAAAAHh4eAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHh4eAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAA5ubmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA5ubmAAAAAAAAAAAAAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAJSUl//z8/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEANvb2wEAAAAABAAAAAAAAAAAhoaGAB4eHgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4uLiAAAAAAAAAAAAAgAAAAAAAAAAHh4eAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHh4eAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAA5ubmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA5ubmAAAAAAAAAAAAAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwUQseaqm4e0AAAAASUVORK5CYII=",
      siz: 1,
      txt: "Horizontal split (Shift+H)",
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          return _this.split_view(evt, app, 1);
        };
      })(this),
      key: ["Shift+H"]
    });
    this.actions.push({
      ico: "data:image/png;base64,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",
      siz: 1,
      txt: "Fit object to the view (F)",
      ina: _ina,
      fun: function(evt, app) {
        var i, inst, len, ref, results;
        ref = app.selected_canvas_inst();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          inst = ref[i];
          results.push(inst.cm.fit());
        }
        return results;
      },
      key: ["F"]
    });
    cube = {
      siz: 1,
      txt: "View",
      ina: _ina,
      sub: {
        prf: "list",
        act: []
      },
      key: ["V"]
    };
    this.actions.push(cube);
    this.actions.push({
      ico: "data:image/png;base64,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",
      txt: "Origin camera (O)",
      ina: _ina,
      siz: 1,
      fun: function(evt, app) {
        var i, inst, len, ref, results;
        ref = app.selected_canvas_inst();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          inst = ref[i];
          results.push(inst.cm.origin());
        }
        return results;
      },
      key: ["O"]
    });
    this.actions.push({
      ico: "data:image/png;base64,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",
      txt: "Watch top (T)",
      ina: _ina,
      siz: 1,
      fun: function(evt, app) {
        var i, inst, len, ref, results;
        ref = app.selected_canvas_inst();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          inst = ref[i];
          results.push(inst.cm.top());
        }
        return results;
      },
      key: ["T"]
    });
    cube.sub.act.push({
      txt: "Watch bottom (B)",
      ina: _ina,
      vis: false,
      fun: function(evt, app) {
        var i, inst, len, ref, results;
        ref = app.selected_canvas_inst();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          inst = ref[i];
          results.push(inst.cm.bottom());
        }
        return results;
      },
      key: ["B"]
    });
    this.actions.push({
      ico: "data:image/png;base64,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",
      txt: "Watch right (R)",
      ina: _ina,
      siz: 1,
      fun: function(evt, app) {
        var i, inst, len, ref, results;
        ref = app.selected_canvas_inst();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          inst = ref[i];
          results.push(inst.cm.right());
        }
        return results;
      },
      key: ["R"]
    });
    cube.sub.act.push({
      txt: "Watch left (L)",
      ina: _ina,
      vis: false,
      siz: 1,
      fun: function(evt, app) {
        var i, inst, len, ref, results;
        ref = app.selected_canvas_inst();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          inst = ref[i];
          results.push(inst.cm.left());
        }
        return results;
      },
      key: ["L"]
    });
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB94HFgoSHELQquYAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAACmUlEQVQ4y82UP2hfVRTHv99Xo2JCW0Hk9zJ0cmmHH3n3oShoJ6O0FKtmE1K7WHATx6KotNVR6FQQHHQTIS4dtFWCVkoN794EinRQEJUkagbbohGR+3HwPvLadPHP4FkeF8753PM993ue9H+JtbW1W55v+6ewuq6VUtoNLNg+Xdf1giR5mLi+vq7RaCRJSintAO61fQI4JEm2zwIv2f5R0m5JHwEBON+27ew2YB8ppQeB12w/JkmAClCAbH9Yvo/nnJdsPxpCuHaD5IGMJ4H3JE1IehlItjfK5ZO254DnS9nntg+FEK719VUPrOtaMcYpYEHSOdt3jUajk7bvAxZzzp/knGeB2b+a5mvgaAjh56GKGx7F9rfAuyGEIwP5X0hqqqqalLQoaSrnfGViYiKMx+PNlNIY+HJ6evoPSVsdppT2A7uqqjomSTHGF2KMDzVNc1HSMUnvAFPAkqT94/F4s3R2yfYjPacaNHgceGZmZua30u0btjdijG9Kmgf2SVqWNNe27U8DH84Dx7cBAVVV9fvgDDBZXvoeSd8D8yGE72KMe+u67lM37S2zVIP5vQ68v7y8fEc5nwYuAPtsJ9sH2ra9HGOcs32kjOl22wvAqW3Apmk+lXQ153wmpbQz5/yU7UnbS8ATTdNcTinNSToBvFrK3pL0awhhsefcvHp7bF8HjlZVBXAl53ywbduNruv2AsF2kLQjxngWOChp5xBQ9StXZN4JfFZm+I3tBwrsYdt7JF0AXgR+sT0r6XAI4frq6uqW9Qa2uRv4WFJT/PZcCOGrlNKzwJlyWZ9+TtIrIYSLN6/t0DYfFNgl24cLbBdwP3BV0g+235Y0bftAD+vVbYuu657uuu78ysrK1K3+d38rhjP417D/Ov4EZX58Zur9qGUAAAAASUVORK5CYII=",
      siz: 1,
      txt: "Hide all",
      ina: _ina,
      fun: function(evt, app) {
        var i, inst, len, panel_id, ref, results;
        ref = app.selected_canvas_inst();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          inst = ref[i];
          panel_id = inst.view_item._panel_id;
          inst.app_data.visible_tree_items[panel_id].clear();
          inst.app_data.visible_tree_items[panel_id].push(inst.view_item);
          results.push(inst.cm.fit());
        }
        return results;
      }
    });
    this.actions.push({
      siz: 1,
      txt: "Zoom",
      ina: _ina,
      fun: function(evt, app) {
        var ref, ref1;
        if (!this.zoom_area) {
          this.old_cm = (ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm : void 0 : void 0;
          this.theme = this.old_cm.theme;
          this.zoom_area = new ZoomArea(this.old_cm, {
            zoom_factor: [this.theme.zoom_factor, this.theme.zoom_factor, 1]
          });
          this.zoom_area.zoom_pos.set([this.old_cm.mouse_x, this.old_cm.mouse_y]);
          return this.old_cm.items.push(this.zoom_area);
        } else {
          this.old_cm.items.remove_ref(this.zoom_area);
          this.old_cm.draw();
          this.theme.zoom_factor.set(this.zoom_area.zoom_factor[0]);
          return delete this.zoom_area;
        }
      },
      key: ["Z"]
    });
    this.actions.push({
      txt: "",
      key: ["UpArrow"],
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var i, inst, len, ref, results;
          ref = app.selected_canvas_inst();
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            inst = ref[i];
            results.push(inst.cm.cam.rotate(-0.1, 0, 0));
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      txt: "",
      key: ["DownArrow"],
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var i, inst, len, ref, results;
          ref = app.selected_canvas_inst();
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            inst = ref[i];
            results.push(inst.cm.cam.rotate(0.1, 0, 0));
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      txt: "",
      key: ["LeftArrow"],
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var i, inst, len, ref, results;
          ref = app.selected_canvas_inst();
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            inst = ref[i];
            results.push(inst.cm.cam.rotate(0, -0.1, 0));
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      txt: "",
      key: ["RightArrow"],
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var i, inst, len, ref, results;
          ref = app.selected_canvas_inst();
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            inst = ref[i];
            results.push(inst.cm.cam.rotate(0, 0.1, 0));
          }
          return results;
        };
      })(this)
    });
  }

  TreeAppModule_PanelManagerTop.prototype.split_view = function(evt, app, n) {
    var cam, child, d, i, j, len, len1, p, panel_id, ref, ref1, results, s;
    app.undo_manager.snapshot();
    cam = void 0;
    child = void 0;
    ref = app.data.selected_tree_items;
    for (i = 0, len = ref.length; i < len; i++) {
      p = ref[i];
      s = p[p.length - 1];
      if (s instanceof ShootingItem) {
        cam = s.cam;
        child = s;
      }
    }
    d = app.data.selected_display_settings();
    ref1 = app.data.selected_canvas_pan;
    results = [];
    for (j = 0, len1 = ref1.length; j < len1; j++) {
      panel_id = ref1[j];
      app._next_view_item_cam = cam;
      app._next_view_item_child = child;
      results.push(d._layout.mk_split(n, 0, panel_id, 0.5));
    }
    return results;
  };

  return TreeAppModule_PanelManagerTop;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_Download,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_Download = (function(superClass) {
  extend(TreeAppModule_Download, superClass);

  function TreeAppModule_Download() {
    var _ina;
    TreeAppModule_Download.__super__.constructor.call(this);
    this.name = 'Download';
    _ina = (function(_this) {
      return function(app) {
        var ref, ref1;
        return app.data.focus.get() !== ((ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm.view_id : void 0 : void 0);
      };
    })(this);
    this.actions.push({
      txt: "Download result files",
      fa: "fa-download",
      fun: (function(_this) {
        return function(evt, app) {
          var i, item, items, j, len, link, path_item, results;
          items = app.data.selected_tree_items;
          results = [];
          for (j = 0, len = items.length; j < len; j++) {
            path_item = items[j];
            item = path_item[path_item.length - 1];
            if ((item._files_to_save != null) && (item._names_to_save != null)) {
              results.push((function() {
                var k, ref, results1;
                results1 = [];
                for (i = k = 0, ref = item._files_to_save.length; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
                  evt.preventDefault();
                  link = document.createElement('a');
                  document.body.appendChild(link);
                  link.download = item._names_to_save[i];
                  link.href = "/sceen/_?u=" + item._files_to_save[i]._server_id;
                  results1.push(link.click());
                }
                return results1;
              })());
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      txt: "Add result files on the is-sim desk",
      fa: "fa-cloud-download",
      fun: (function(_this) {
        return function(evt, app) {
          var dir_save, fs, item, items, j, len, path_item, results;
          items = app.data.selected_tree_items;
          results = [];
          for (j = 0, len = items.length; j < len; j++) {
            path_item = items[j];
            item = path_item[path_item.length - 1];
            if ((typeof FileSystem !== "undefined" && FileSystem !== null) && (FileSystem.get_inst() != null) && (item._files_to_save != null) && (item._names_to_save != null)) {
              fs = FileSystem.get_inst();
              dir_save = FileSystem._home_dir + "/__files__";
              results.push(fs.load_or_make_dir(dir_save, function(d, err) {
                var i, k, ref;
                for (i = k = 0, ref = item._files_to_save.length; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
                  d.add_file(item._names_to_save[i], item._files_to_save[i], {
                    model_type: "Path"
                  });
                }
                return alert("Files saved on the is-sim desk!");
              }));
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    });
  }

  return TreeAppModule_Download;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_ImageSet,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_ImageSet = (function(superClass) {
  extend(TreeAppModule_ImageSet, superClass);

  function TreeAppModule_ImageSet() {
    TreeAppModule_ImageSet.__super__.constructor.call(this);
    this.name = 'Image';
    this.visible = true;
    this.numpic = 1;
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAIbUlEQVRYha2WW4xdVRnHf+uyL+c258x0OjdmOh0KBdppKL1pYgwVYwnES4MIPCAmDfqgEXnhRUtCG+OTD4QYwQLCmxIgBIzYCsGWy9BgK6VAkbbadtpO53rmXPY+t31ZPpyZYy+nFYhfspO9sve3/v/vsv7fEsYY/l/25NPPfiUMw/uNiWeAfalU8vUffP/e+pV8xPz8/OU/Skm1Umu+C4iiGCEEUgqklCilqFQq7H/vAJWKf5vneX+oVKvZZCJJb+9S4jj+i1LyHqB0OQz9xWK9wHqAB+byhZ+DEddcu4KV16xkyZIujh8/ftsnRz755clTpx64bJCfMwNaCLFCSrFOSrlJKbVJSjkahmHHmYkJzk1OsWx4iFqlxvjpcU6Pj1Mslifr9dogEH1RAsPARiH4tmVZX5ZSXq2ahlIKW2uEki2fP7+6m31vvUW1WiWODJal4s0333zHfKHwcjuM/1WCX8/Nzf7EdVx3ePkwUkqkFG1/jI2B2DC6+gYOf/gRy4aG6OzsJJfLyTAIngWuBWY/Twa+9uijj76xc+dOMLB9x3Z2bt8JC8EGYUjF8/EqHmXPp1Ku4FV8GkGDej0gDkMqtSr1RkAchqZSra4Ejl+SgXw+3xZ9bGzsFzt27GguVsALJ19A/Upx7133kurIcGr8FL5foex5eL5PvVonDAKCOMa2bUwU0rWki+6uDAjiiu/H7XAuV4LMa6+9tm5x0bW2i75sH1EyYtdvf8e2H/+Ig+8fwhgQGLS2cF2HZDqJrSVSKkaGhxDSIZVOks/nKdl2WyDdqLfVCatYLFqudoniiPx0Hr/LZ/1N6zlaPUouk0Vri450hlQ6SSKRIJlI4LouuWwGqTRhEPLp0aOUivOMrrmRSqXSBFTiIgKNoB0Bb/nykVkn6aSDckAwFfCe/R6PvfAYTz6wi97+pQwvGyKbzZHNZgnDBn7ZZ+LcBAcOTDA3X6Di+/zj4N/pXbqEG1aNmjAMy5aWgLoASHxw6IO2qTk1furQtm3bbsylc3SkO5hYMsHs5CzBP5uE33//MKlMirGxMVzXJgwioihCa43rutiOw/zcHK5js/L6G4xXLv1mZGRk5OTJk9uBFqjOdHS0JTA6usZs3bqVF194kWwuS+9kL/fddh+zU7N0dGbRlqZarZOfm+Nb37ydzmyO7p6etns1Gg1RmJ//qZtIIITIAV9tEbjSKNqyZQtX9V/F/nf3s3zFcq5bcx2P73qchx9+mCiKSCZTdHd3Ua3WePPNP9Hf34/rukRRRBw3mz6KIoQQBEGDdevWo5RKnI+h7ct0J4Drutx6++18546taKV599399Pf3NR21Zv/YOyitKJfLPP/88wwPDxMGAQYQQqCUIpfNUiyV2LVrF5OTkyQSiQuO4xWVcGCgnzA0eGWPjlyOwcFBjIkwBizbYXJqgoGBAVzXbUW7CK61JplMcvjDD9mzZw8ASqlLMLQQ7aUVIJlI4qbS1Ko+Qmo6OzswsSGKDVpJtNZAE8z3fQqFAkoptNbEcczbb7/NkSNHWvsJIbj4/qEvp+0A2rJxHYdcroMHf/YgURjwyCM7wMQorQGJMQalFJ7n4TgOjuMwPz/PiRMn8DyPnp4ehBBMTU21JyCEbI8OOI6NAYJ6wK3fuJVK1Ws2GDFKNsGNMQghKBQKhGFItVqlXC6jlKKzsxMpZashfd+/lEBf74VHZ3r6vwPLsmykEHhljzvu/C75uTmmp6cgBqUk1WqVWq2GEM3Nfd9v3pS0QgrZOg2LJNuV+5Im7OnpbpHQSmCkAgF+pUK9Xm9F1GgErFq1GilBCMlLL73E0NAQmUyGOIqITEwcRTQaAbVqlemZGWq1GoVCIXFFAgDd3UsoFosEQYxSCgEoKVGqeQ80xtBo1Fm3fj1vvP5Xdr+6m9EbRzl79iypTBoTmYVUG8IgwvM9bNs6cObMmbIQ4vDmzZsvS0DQnPgOAksAWkqElighcRybakURRU3ZLRYL9PUNsHHTlwjDiFPjpykf/zeWbaMtC0trlFJIIeING9b/MJ1OHzoPx1xMQCys01KKboFIKqVQlkYJiVQKy7JRWi24G5Sy6BvoZ/CqAT76+CNGrh4BEzM/X8AYg2UplLaJwlBorQeBs4AP1FoEwjBcJCDDMHSFEEsMZkhKmZTSQiGxLBvHsTAmaoqJASEUli2ZPHeORr0OQmErBcqmt6eHcEGCLcvC931Rq9W6jDHpOI4DoAHEAPqJJ55oEQDcOI6zcRx33333PW5fXy+lUolEwiWKYpRQaG01lc6y0FrS199Lf18fJ0+cIDSGpNYIIcg4DgCe5zMzMzP75r6/lYwxFmCKxWLrLOqHHnqoVYNUKmWMMVGj0aj09vWfvut7d2aDICII6hghsJTCdRPYtkUi4WBpm3KxSLFUZGlvL5lMBsdx8bwyx44diw4ePDhx5vTpD4QQh5977o8zpVKpHEVRo1QqteaBrtVqi+9RrVarAnOA/funn3qq0ajfv2XLllW5XE46joMQglQqBUA6lcJNuPT0rMEYQxTHFApF88wzT8/s3r3n07Nnxk9Kqcf7+/snBgcHz+Xz+dPlcrkA1Bfrv9h455sCHCB7003rllWrlQHLtlcNL1t2/dq1a6+95ZavX7Nhw/rOTCYjF8dsuVw2e/fuy7/yysvH9u7d+6+ZmZkzrpuYTafTM9lsx2R399LpWq02PTb2zsxC/S+QwnaDQADKdV0njuNUEAQZY0wH0AF0dXd3961evXownU6n6vVGcOTIx5MTExPnFrq7IqUsCCEKUsqS0rpi4ri2ceOmYGzsnZYkn2/thMgAIRA2Go3KQknUwr96dnZW79u37+IAFn2COI5DIJJStr2GfxYCF5OJFp7GZ9nw89p/AL0v4scTBTk2AAAAAElFTkSuQmCC",
      siz: 1,
      txt: "New Shooting",
      fun: (function(_this) {
        return function(evt, app) {
          var session;
          app.undo_manager.snapshot();
          _this.collection = new ShootingItem(app);
          session = app.data.selected_session();
          session._children.push(_this.collection);
          _this.unselect_all_item(app.data);
          _this.select_item(app.data, _this.collection);
          return _this.watch_item(app.data, _this.collection);
        };
      })(this)
    });
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sLFQ0kK/G2W0UAAARaSURBVEjH7ZRPTxMJGIefGacMtdBOaUtbUCgN1WUxrg2YAgJZ4z82mOXgwZj4Ufwim73tysUQEz3YEkM2HMi6bMDIaspCLezItjIzdAotnW5hhr0ZTWx2P4C/2+/yPnmS933hS/4jwsflwYMHJ7FYDMMwWF1dRZZlenp6SCaTpNNpFhcXSSQSTE5O4vf7yWQy5PN57t+/j8/nwzAMLly4wMzMzIe50scARVHIZDKYpokkScTjcR49esTJyQm6rnP27FmuXr3K0NAQjUYDRVEIhUIEAgHa2trI5XK8f//+E4NPANFolNu3b9PW1sb29jahUIhIJEIikaBUKjE2NkYsFsPlclGpVFhZWcFxHGzb5uHDh5TLZQYHBz8BiB+XWq2GLMv4/X7a29vZ2Njg8uXLZLNZgsEgW1tbzM7O8ubNG9rb27lx4waHh4esr6+zt7eHaZqYptncYGlpCcuyGB4eJp/Ps7CwgMfj4fXr18iyjGVZuN1uRFFkeXmZer1Ob28v0WiU8fFxnjx5QqFQaG6gaRqqqjI3N8fR0RHDw8OYpsnIyAiKonDu3Dm8Xi9er5e1tTWWlpYA2N/fp7W1lTNnzhCJRJob7O7ucnx8DIDb7SYWi5HL5dA0jWKxyN27d5EkCUmS6OvrQxAEXr16ha7rBINBLl68yNbWVnPA+fPncRyHmzdvEo/H0TSNlpYWJEmio6ODd+/ekUqlMAyDeDxOMpkk6A8x8e04uq7z+PFjVFVtDpienqbRaGDbNrlcju7ubnp6elBVlf39fSRJwjAMqtUqnZ2dCIJA1xWF9PwzFJ+fRqNBPB5nY2Pj84BiscjTp0+xbZtarcb09DRTU1OEw2EkSeL58+ek02nGxsaYuvUdmvKWhc4fGPBPov10TLVaJRqNNjeo1+uUy2VGR0dRVRVVVdF1nWKxiCiKHBwcAGAYBh63h1Lr3wgi1Dr36Ooawuf3knubaw6wLIuBgQGuX7/O7Owstm2TzWbJ5/NEo1FSqRSx3j48bg/CKTDfVRD8ItgiqdQIO7sq1Uq1OSCZTCLLMpqmMTg4iM/nw3EcDMOgVCrRaDQwAzvUhTKdTgfroWUkXFSEEpnQj4hhEW/EBz83AWxubiKKImtra3R3d6OqKoIgcOnSJUKBEG/1P1Fv/cKhv4Rpg+vEBUcildMGpqcAIshdcnODnZ0dVldXAVhcXEQURdxuN/fu3cMf8CMXPMRfTJIT/iDsj5Dz/k5Lv8PpQ4Wv/pqgfmJRUIvA9ucvWZZlrl27RigUIhwOk0wmsSyL+fl5NE3DcRyKvx4wWvkez28xDp61IEggILAxt0tk82vqi+7mr0JRFDo6OggEAkxMTDAzM0MikUDXddLpNJlMhtbTrQgSLK+84J/9I3AEXC4Jy6nycu0lVybGmgP6+/uRJInx8XEEQcDtdjMyMkJLSwvZbJZyuczm5iaFQoE7d+6Q/GYI+9gmKHThOeXFsmofVvlL/nf+BcEhzmREx+HfAAAAAElFTkSuQmCC",
      siz: 1,
      txt: "Add Image",
      fun: (function(_this) {
        return function(evt, app, img) {
          app.undo_manager.snapshot();
          _this.collection = _this.add_item_depending_selected_tree(app.data, ImgSetItem);
          if (img == null) {
            if (_this.numpic < 10) {
              img = new ImgItem("composite0" + _this.numpic + ".png", app);
            } else {
              img = new ImgItem("composite" + _this.numpic + ".png", app);
            }
            _this.numpic += 2;
          }
          _this.collection.add_child(img);
          app.data.time._max.set((_this.collection._children.length - 1 > 0 ? _this.collection._children.length - 1 : 0));
          app.data.time._div.set(app.data.time._max.get());
          if (_this.collection._children.length === 1) {
            app.data.time.set(0);
          }
          _this.watch_item(app.data, _this.collection);
          return app.fit();
        };
      })(this),
      key: ["Shift+A"]
    });
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAFeUlEQVR42p2Va2xT5xmAQ/90rZqiUan7s24MypSOduOirRQ27dbSibaUAmlpYdNo2lKGyMVNUpSQBBLnVodLEgOCQC7YxrGJHYf4EscOFQlKTBpjHJtcWgrrWAqkOM5xfEsc9uzEmiIuVTftPXp09Enfeb5Xr973OwkWi0VnNBqF/5Mxs9lsEWN+wv0xsyF2dZrYtWmmv7rzH8T1/8Dk1SkGu4ewd9ht3yqe+DyM/ec9ND5r4OTiJjqWdYv0fCf2pT10veIkMBjEZmsX7nZuWPXC9+Ni/9AEmoUWdv+ohOyFBzi2SEnTz9r+G+I3ZvyDAtZ2a2hGuGbpL+ZIP5Lskvx5c0dcPOoeo+pxBQVzK8hJLOXQPCXyJ+5inoLqb6EysYGbbh+WNksoZf3rj8qLpY1yaWHs/VfXvBAXA4xN+BEiAoFogOBUkPHQOF/f+JpAJED0TmSWyX9FiTPz3IkCoNfpItJMSe/H7/6Vv61bu2u2xgA+n48xvx//+DjjIp3N3eg/bOeCvY9QKBQnHA4TjkSIRKNEo6I4FiMcDFKQkU7G5rdJTd5g3rhqxUN3i++RCgEBxV4Ne+bI0e5vJiQKI6IwOjnF5FSMiYCfW9evcLmvi73paXz0ly2i+B3vGytXzL2nKwBu+27jsrpxNPThOu/myNY6KhJPUPOeAkEIMDU9zYTgY/C8igHbAZymKlLf2UDehx+Q+/5WzhxJN5Tt2pT4gHjkHzc4vk6FckkLtUtPU/lUA4d/oKJqfgPm/WfxOs7Rq8tFl/4GJ9KT2fHm6xRLMijYsZ09efloj+bgNOSfTX7tl4/cm/E3t1GUNbLvJzUoFrRQP19P7Y911P6wGe0rx3Gos/j72SpsC54mefky9u/ORZq2k3ZlCT12JV/01HGloxzbiR2VonbOrDgYDjLs+ZyDvzsa79HGJBOnFpnQ/l5BT2Mm33ga+KezjvfWvkh1USGlEgnGmhyEy0rGh05xy3WSm5dO0m+UxvK2r06aFV/74ivaKjow//ocxiWf0vJcB82/auV8rYRb7mOMXKhmZ/LLHJIW8UlWJs3yNHyuI9z21nO99ziD7Zs5X7+c7lMSGoo37U5oMZwRBs4McW6jA+vznZxebKbxGWM8a9tuKS11Mv6wvoa0D1I4mF9AcUYG+sod3HBUiOxj2C7jak89F81bMR5aQH9rHnWFbx5NaFI3CZbtNswrOyhPqiZ/aRn5S8opTtpPrzaDelku27IP43b2cay6Ck3FNq53lXOtsxynIYdLFhn99iP0GqQMthXh0n3MPsmagwkGvUHoMnQjz6zBqrYzeHE4ju2UhrryFErLihm9NUpnZycH87bh0GSKrbWNQ4UpWGrT6NYV8pl+L4PWEgbEbLsVqby66uk/zdZYGA8QiUaIxWKEwiHUjWpMbW1MTk5y5csvKSosQ5a5k6bKraiVtXgvD/Opppi31r3E6j/+FmdTDv26bCrSVl94MvHhx2bF4ZnJikYJBAL0fubA7x/HNzYWP6hUVoHRZEZ5tARl8SZ6msu4ZJLhOp3FvtwtLH/up3Q1pHIib61v2aJ5z9/Tx+LIxu8Dr9dDv+cSHo+boLh2e718IpNhMlvQHiuiqnQjLyl+Q/aeFxkySxk27cHdlIU86+WbK5KeWP29RxIeekA8OjqKw9GDy+XE43UzMOChtrYOtVpNn9OJRVVBnextVr61kNL89VzUZmM8sIXC1PWTC558ePHjcxPm3D/SszEyMhKXezz94rsbrVYrHuSKl6XLohRFm+lVpmI7nII8ey3GppMYTSYh4b544Geq1+sDGo0mYLVawzKZLCiXyydUKlXAYDAIWq1GOC5Ln6gqeHeiJC89oFIphdbWVmHGcb/330ijKo2XdMsXAAAAAElFTkSuQmCC",
      siz: 1,
      txt: "New Collection",
      fun: (function(_this) {
        return function(evt, app) {
          var session;
          app.undo_manager.snapshot();
          _this.collection = new ImgSetItem;
          session = app.data.selected_session();
          session._children.push(_this.collection);
          _this.unselect_all_item(app.data);
          return _this.select_item(app.data, _this.collection);
        };
      })(this)
    });
  }

  return TreeAppModule_ImageSet;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_UndoManager,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_UndoManager = (function(superClass) {
  extend(TreeAppModule_UndoManager, superClass);

  function TreeAppModule_UndoManager() {
    TreeAppModule_UndoManager.__super__.constructor.call(this);
    this.name = '';
    this.actions.push({
      ico: "data:image/png;base64,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",
      siz: 0.9,
      txt: "Undo",
      fun: function(evt, app) {
        return app.undo_manager.undo();
      },
      key: ["Ctrl+Z"]
    });
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAArpSURBVHic7VtfUFtVGv/d5N4bCAn/LKSBWqElaEpSbMFa1Gpbx2md1h11Rqe1Re3itNO12tW++Oa+uTPqvjiz++qs23F90I6u+7JTpx0U2sJQBAqFQkugIZJAAklIcnP/7gNJmj834YYk4L/fzPdwzzn3O+f8zne+fOfcL4QkSfgtQ7XeA1hv/E7Aeg9gvUEmF7xw7NhmAMcBtETkgbUeVJ4xBaAvIv+6cP78dHwlEXWCLxw7RgD4E4C/AtCt8SDXCksA3gPw9wvnz0tAhIDI5P8D4NB6jm4N8V8Az104f16KboF3kGbyNEVhu9WKhx58EDRFrdkIcwHLcRgdG8Pg0BBYjpNrcgjLc/4b8fwrr5gBXAdQFN+ioqIC5956C1vq6kAQROFHXQBIkoQ7Nhs+/uQTLCwsJFczAHaqH7Ja3wLwdHxN265deO/cOVTdd19M0S9RAKCivBz7n3oKc3NzsM/MxE+TBOAmAbTGl+r1erze3g6KoiCIYj4XZN1AURReb2/HjZs34ff746taVUgi4FRHBzQ0DVEUf1WioWmc6uhI5qaVBFAdfVKr1Wg0mWRXXgJiZpULQgwDNUGA1mhy1pUOBEFAzms1mkxQq9UQBCFaVJ0QCG3dsgWQpFgDQRQRDIfB8zy4ey8pgiRJcLlcmJ6ehsvpRCAUAsMwECN6iouLUVZWdk/Ky1FdVQUqT780lFoNkiSh1WigVt0LeLdu2YJb4+Ox5wQC6urqYqvPsCwCoRCyXfNAIIDBgQHYpqbAMEzGdoFAAA6HI1am0WhgsVhgNptzJoLlebA8jxDDoKS4GEU0DWB5jmkJoCgKvCCAYVmEwuGsOgyzLIYGBjA8MhJvYlkhFAqht7cXg4ODsFosMG/bljMREgB/MAheEFBE0yn6EggQeB4czyOYYeXkMGO349LlywhnSVo6hEIh9PT2YmBoCLt37UKDyZSzziDDQK1SQeD5hPIEAnhBWDb7LJzd0NAQenp68uIgkxEKBpeJ5ThsM5tz1hcIhcAnWWcKAckNMqGzsxNjY2Mp5clk0BQFw8aN0Ol00Gq1kCQJPr8fPq8XXq93Rcv5vrMTPMfBarUqHpsc5OaXQECYZRWvZF9fH0ZGRjK2MTU0wNTYiJqaGqjV6rTtHA4Hbty4AZvNlrb/rq4ucByHHTt2KBpfOoRZNuE5xQcoIeD2nTvo6elJW//A5s3YvXs3KiorY2WZ9BqNRhiNRviXltBz7RrG47x0PK5evQpCpULz9u0rjjEdMvqAlQYKAD6vF99dvAgxTZjc1taGhx9+WJGuZOhKSrB//35UVVWhu7tbto9rV6+iYetWaLXarHSnQ8KVWDTayyRdV66AZdmUUFOSJBw4cADNzc05H2IsFgueO3x4+TwiCAkSDodx5cqV1evPRABWeNnhcGBifDxh4tGBPf7446irq8vbSW6j0Yi9e/fKxvXDw8OYn5tb3QkxySqzsoCurq6UFRFFEWazGRaLJe/H2fr6elgsFlkSOn/4IS8WkOID0sHn88Fut6eU0zSNx9ralKqRRRFNQxAETN6+nVK3edMmDN+4AS7JeU3ZbBgeGkKZXi+rs6q6GlVVVfAFAhn7TiQgaiYyGL91S9Yp7WxpgaaoKGuHF48wx8FcX49/fvYZZp1Oxe/97+JF2XKSJPHB++/DGwymjmu1W+BW0t6POj5LU1POpi4IAmZcLnS0t6dssdXI4QMHQNI0/BECcnaCHMfBbrcnOD1BEGA0GlEUWf1cxeP1wlhTgz2PPZbTxcfG6mocPngQ0z/9pMgJKooDfD6f7AmvPuL184VJux3HX34Zff398CVeXSnGyRMnYHc6FYf0iVsgzer4fD5ZtvWlpXn1+mGWxcLSEl49enRVq7/3iSdQU1OD+cXFjP3EQ5EFeCMEJEOv1+fVAgDA4XLhkZYWWMxmDA4PK36vrLQUrx49ivHp6azGpMgJhhlGlnGKovJqAVEZn5rC6TfeWD6/K3R8J44fh8fnAxM50CmNAxQ5weLiYtlO/UtLBSFgKRiERBB4+cUXFZl+s8WCXa2tsDudK+pOdoKKLECn08l27Pf5CkKAJEmYnJnBc88+i021tRknT6rVOHPyJMYmJ5XpXo0FpCPAqYDx1YogCJicmcGfT5+GJElpCXjlpZcgEgT8gYAivauygJKSElAUldL56NhYwQiQJAnzCwuoNhjw7DPPyE7+gfvvxx8OHcKdu3eV612NBRAEgS319akWMDsLj9tdUBLGJidx4vhxlJWWphzC3nnzTdy+exe8ICjWl9ECkMYCJElCg8kk6wg7v/++oASEWRZOjwdnTp5MIP/wwYOoMhgw5/FkpS8ZinOEolfTyVZw/fp1uObmlKpZFeyzs2htacGjra0QRREV5eXoeO013JqczFm34sNQkUaD5ubmFAIEQcDXFy6Ai9wnFkpGJibw7pkzoCkKZ0+fhnN+Hkw4nL2uTASk8wFR2bdvH1QqVQoJtqkpXPjqq4IS4A8EEBYEfPzBB2jZuTPtYScnH7DSjZBOp8PuRx+V9cj9/f345ptvIGThkLKV21NTeNBkwsjExOr1JFmA4guRKPY8+SQGh4bgdrtT6rq7uzE/P48jR46gqKhI5u3cwAsCrg0MpMv7UYaMFqCAQY1Gg/b2dlBpkihGR0fx4Ycforu7G3wB/EJ4pVhfyTaIg/ohq/Uv0QeDwYBNmzatSKJWq0WN0Yj+/n7ZDliWxejoKPr6+uD3+UBpNCgtLV39quURdrsdLpcr9py4BQgCoigqygozmUw4cuQIvvjiC/BJF5ZReDweXLp8GZcuX4aaJKHX6VBWVoZTp05l/FRWKEiSBCTNLYEAQlqOwZUOzmq1oqKiAp9++im8Xm/GtoIgwB0Ow+12QxBFqFRrn6YsCAIIIGGBVSqVClEBQSynsUQuPJVIbW0t3n77bTQ2Niq+uSnUr0QmEUURDMOAIAjEz5mMrkSUGTby9bS4uFgxszqdDh0dHRgfH8e3334r+/0gHlKEhLVEKBQCy7IgCCLBwkmSvLcLeI4DFye6khIQWZhqQ0MDzp49i+HhYfT39+PmzZuyeUJy3rhQkEQRS4FAbGEFjgMVN2fy/tpaYdbpVAPLd39c5DeW4zgwoRCKtVqQFAWKJBXv26amJjQ1NYHneYxPTMA2OYnFxUX4fL6YrygkAaIoguN58ByHUDCYkPbn8/tjeUKG6mqBNBoMs56FhVoAYEKhZQIiToLDcrZYLtDr9bAmfc/P5utPXiFJYBgGdCRjzGgwOEmtVmvTaDS10Tb+paVYStmvDWGWhSZublqt1kZam5oWZhwOBIJBAIDb5cIGgyElZPzFgyCw6HbHQvQSrRYWs3mBcMzOPuL2eL7795dfxj6zUhQFdeQK7NcAlUoFiGJCesxLzz+/VFlR8TRpNBh6OY77fE9b2x/7fvyRBJZ/EqNOiskicernBkKlQrFGA4okl3OHI+a/Y/t2Xq/Tfb7RYOiJ/meIWFhcHFlYXNx68dIliolLW4sGEXy21pAmYXnViDhmJToJggCpVoNUqxOiPo1Gg3179nDlZWV3BFHctqGyUiTiV9fr831EkuSbkzYbPTc/r5pzu7GUIcEgqjqbf5QobZuvdrqSEtxXWYkNGzaIdZs3swLP/0Ov178bez/ZvJlweDsBnOMF4RGKJOtomlYeEv4MwXJciOe4KZIkewF8RNP0YHx9CgG/Nfzm/zn6OwHrPYD1xv8Bz875Qnsh5PEAAAAASUVORK5CYII=",
      siz: 0.9,
      txt: "Redo",
      fun: function(evt, app) {
        return app.undo_manager.redo();
      },
      key: ["Ctrl+Shift+Z"]
    });
  }

  return TreeAppModule_UndoManager;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_Collection,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_Collection = (function(superClass) {
  extend(TreeAppModule_Collection, superClass);

  function TreeAppModule_Collection(collection_size1) {
    this.collection_size = collection_size1;
    TreeAppModule_Collection.__super__.constructor.call(this);
    this.mesher = '';
    this.name = 'Mesher';
    this.add_attr({
      _collection_size: collection_size
    });
    this.actions.push({
      txt: "add boundary condition",
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAeKElEQVR4nO2deYwlx33fP1XV/a55b96cO8fukgzFa6GLokjuJqEjOnEQIBACgVBg/aE4lCVRB0lZCJK/RCNOAAsKEMCkDkOKTUdBFHsRWIQDS0YUKwgRScwuuUvQlOTVRXKXe82bN9ebd/ZVlT+6+03P7MzuzHTv7szsfAc1fVfX69+3fnX+fiXYATh69BhHjx3j2LG/y9FjxwAQQiBEvBUIIZFrjvvXwweibf8fVxyaTSZIJPZN8jGzcmwMBjDGYEy8XQl6zbExK7E89+wfcPLECU6ePLGVz3RdIK59y/XB05/7HY4eO8bRo0mBC6SMtkIipED2BZ4I4QPrJj4pLGMg0PogYAFDwNA1SRBGegHwpRBLQojGesRae2Si98Xv1dpgjO4ToX+sVxPi5MkTnDxxgq98+bnNfLbMcUMJ8PDDR3n6c7/Dw0ePhi8XAiklMtrGApdSRiQQoaDFlcnUWue1NvcBdxjMXUabQ9qYQ8CkFOKQEGJMSFHuxwFIKTeVzkBrAIw2GAxamxljzJIxZgY4K4W4IKS4IBC/As5aSr7BOmmMhay1Xk2CaF9r3b8G8PLJk3zly8/x8ssnt/ppt40bQoAnn3qap57+XPjCKJdLKSPhyzDXR0RI5vQQBs8PDgLHtDb3a63vF0K8S0l5h1IKpcJ4VEQgtUkhbwehEMNcHETCCwJNoHUvCIKfAT+xlHoNwWtSyBNKivaK5jAYbdCGvibQRofntO7HF5Phq1/5Ml/76leu22+JcV0J8Nknn+bJp54OXyRAKYmSakX4MirLo5wfw/eDe4Hf8Hz/USHEI5alJm3LwrIsLCVRSm06DbHQIFLL1ygDZIJ8W31PEGh838cLAnzfx/eD14ATtmW9KKX4n1LKRvL+pFZIEiomGcDXvvoV/vBr148I14UADz70MJ998ikeeuhhhBCh4JVCSYlUV+Z0rY3SWj/q+f6HgQ/atn0on7PI2TksS61bBECoWv0gCHNhEPQ/YpyTgkCn/i1XaiwR/pbo91wrfZ7n47gerucRBMEJKeV3lJTHbdt6A1ipMEZ1g0BrdPRbgiDoE+Fjj/8Wp155OfXvueL3ZR3hpz/zJJ/57JNAmIMsS6FkqKqTlToQ+L5/1PP9x0F8OJ+zxwqFPIV8bt2y2vN8PN8Pc5jn4wdBP2ffbCilsC2FZVnYloVtW+tqD8/36fUcej0HPwhei4jwTSllbaU1EdURIlLHBDfGcOqVl/n4bz+eadozJcAfPf+fefChhxAIrOiDKKXCHCQkCDDa5D3f/4jW+vNKqfsHSkVKxcIVH8x1PRzXxXFdPM/fMcLeLJRS5HM2uVyOfD6Htc7va3e6dHs93xjzF7Zt/UfLsk6SaFZqvUIC3/fRxnDqlVf45Mc/llk6MyPAf/rj53n/gw8hRagWbctCWSopeOX5wSe01r9n29bkYGWAYqHQV5/GGLpR7ug6DjoD9b2TYNsWhUKeUqFALmf3zwda02p3aLXaaG1etC3rGctSP4KV4iGICOD5YUY4feoVnvjExzNJVyYE+OSnPs0Tn/o0UkospbBtu5/zQRD4wQc83/+6Uuq+oWqF8kCp/6zjurRaHTrd3q7L5duFbVsMlEqUB4p9zae1Zmm5SavVxhiO53P256WUNRO1HgId9IvBkASn+PQTn0idlkwIcPLUqwgRqv2cbaOUhZQizvXPaq2fqlQGGBmq9sv3dqdLY7mJ47hZJGFXQgjBQKlItVohZ4dawXVd6vOLuK63JKV8PJ+z/0fYyWTw/QDP8/B8H2MMn/nUJ3n19OlUadh8O2cDfPyTT/DA+98flfthmS+EIAj0hOO6f2UwHx4fHWG4OogQgk63y0x9jsZyE9/3wx60W/XPGBzXZbnZwvd9crkcOdumXB7A9/1Cz3E+EmhtSSn/T9jHacLezSDAGMPk5BR/9d3vpJKflZYA97/vgbDzQhiEEBgDvh9UXc97UUp539SBcYrFAr7vMzs3T7vTTfvKPYnGcpPlZovR4SGGqoMcGBtFCMFSY/kZrXUhZ1v/Jh5OEIT1g/sfeCD1e1MT4MEH3x8RQKCNQWiN47rfAu6bGB+jWCzQaneYma0TBEHqBO91zM7N02y1mZ48wPjoCK7r0mp3/rXW+jVLqf+mddhM9H2fXq+X+n2pCSARBJE6M1rjBsFvaq0/OFguM1gps9hoUJudWzUato+ro93p8NbbF7jt0DQTB8Zpv3UO3/e/ijHfMcY0giCsCzSXl1O/KzUBRNjN3W+yeJ73FMDI8BDNZovLM7P7wt8GXNfl3PmL3Hn7bVQHK8wtLA55xjxujHnO8zxcx6HdaqV+T2oCIKKmRNheHQi0fsRSCsu2ePPt8/tqPwUCx+Hi5cuMDA8TzM0DPKp9/znPden1enR76etT6TUAK21JJRhztEEoQb0+j+f5aaO/5bHYaFIdHERrw3y9PlSplOn1evR6PVw3fRM6vQaAFS0ACGPwg4DFpcae6827WZip1dGBZubyJSzrcEiAbhff81LHnZ0GCMsBLCXpOU7aaPeRQLvdxhjDpUsXGBkdwXEcut0Orpv+O2dQBxAk5m6Qy1k4jtufVbOPbHD+7XM4vR6ddgfH6dHpdOi0O6njzUYDiNXH5XKRpUZrv/afEVqtJm++8UsAut2QAL1eF8fZAf0AEPZpY+hXBGzLYnhokPnFpX0SpESv0+XnZ37aHygLBe/gOk4mLawM+gFWCz9GPmczMTbK7PwCvr/fGtgOWs1lzr31Jl6isuc6Lq7j4nleJpkrIw2w/vl8PsdtB6eYm19kKYNeq1sFRmuWFheYq89eMUTueS6+72U2dJ5NMxBWTexIQkrJ1OQBhoerXJqZpdvdHwy6GjzHYbmxuOF3CjKeCpcZAa6F8sAAR+65i+XlFpdmZmhlUIPdSxBG47o9nN7VJ8ZkPWnmhhEgxvBwlbGxEdqdDjO1WWqzc7fMTKC1UFKSsy0w4exhbkKF+YYTIEalXGaoWuXee+5mfn6Bmdosc3Pze77/QCnFQKnIQKmIwOA4Ds5N7Di7aQToJ0AppiYnODg9hQHm5uap1+eozdZpd3Z/MSEE2LZNqViIQhEpJVrrTMbz0+KmEyAJSymmpyY5OD0FQLPVol6fY35hkUajQbPV3vGji1KKvm1APmeTz+WwbbtvWLLTsKMIsBbFQoGpyQnGx0YjUyuf5WY4c7bd6dDpdOn1HFzPxfdvLDFC41WimdAyMg6x+lZQscA3shraKdjRBFgPpWKRnG0zWCn3SRHOkPFxnB6O6+GFZlj4fhAZXgaRyXZoYRNZcRNPsoyNymO7/9j2HwwiMuyUQqyyXl5lLtYX9k34ICmx6wiwEeKyVgiBbanQVjARYpvBeD82zNRGr9jrr+PMoW+eLiTreyTY3dh5hdI+bij2CXCLY58Atzj2CbDLkHWrYp8AuxBZkiBTAkgpzwHpJ6vvYyP8ajdogOPXIc59APl8/s+zjjNTAhhASvkl4OZ3cu89/LBSqXwv7lbOShOkJsCpU6cA+j1tCPEGQjyVOmX7SGJubGz8o4VikUKxSKFQyGxcIXUsp0+fxg905LTJRF6txPPAM+mTtw+gVSyWPjQ0NHRuYKBMuVyhMlhlaHiYWq2WOvLUXcFO5Mwpdg8Tzg7VaCN+33G7vzFYKT+aOpW3KPL5Aodvu/0p3/d/FA1J9F3jSTnG6dOvpn5HagK8893vwXE9LGVF5VLovaLbcf5Aa/1ovlCguAWHi/sIMTU1zeT0Qbq93td9z5vrdjvfFZENnjFg2Ta//YknOP5nf5rqPakJ8L773xe6ThUBQSAxBrye82+11p8fHqpiWxatVocgCBgbHdmS981bEbl8nonJaaanp1BKoRd0wWhzvFgaeMRo/TehFxaDQRBkMN0+dR3AtlXfzavWGtfz3usHwTOFQp5isUir3aE+v8DCUoM3zp5jtj6/4yd13AxIZVEeHGZ49ABIRS2yrh6qVkGIshDym0pZKvTBJAkCn3annf69aSNQiXHw0HVJ8IwxxioPDNDtdlmIrINiL1e1+hw/OfML3r5wic7+FHGMAWnlyBVKKMtKfCuf+tw8xhhKxQLGmPsN5kPxkLbneTvDQUTcJjWEziCNMR+UUqKUZLa+vmsYYwz1uXnqc/MMlIqMj49xYGyUUql05Qv2IFwvchnrutGEFLHujGDP91lYXKRcHmC52cIYPqiD4Nu+7+G5Lr0MMlAmpmHhJEeDUvKQ53sFgaCx3CTQ11b1rXabVrvNW2fPUR4YYGxslNGR4VD17REYY3A9Dz8Ip3/rLUz/7nS7lEpFjNH0ut07lFKhG13H2Rnm4UIQeQSFnG3RcxwCbWh3ulu2XWu2WjRbLd46ew6lFIOVCpXyAMVikUIhv2vm44QrlRh8HaD11gS+HpYayxhjmJ+fZ2hoCNdxcHo9/Aw8sGRgHh6t8IFGADnLzsRBhK99FhYWWVhY7J+zbZtCIU+4dkDosl3eRFaEax1IhFQgJBqB1gIytm1wI2+qs7UZCoU8ruPSc3p4/k7wEBKt72MkIASlUp7udZrv7rruun5x+j79I8fUgpW5fTouYyMX9fFiU6DDVUpY8XAmjEnca5BSResdqHA/nvwZrXSShFn9L3N0Oh0WF+YZP3AgKv97O8RPoJIoDFqHiylYlqJUKtBq38AavjGE7og2qnPIcFKnFfrGzaInIq1a3wqMMbzxq59jjAmdQzkOTq+Ls1O8hEkhQep+c3BosEIQaDrd/UHBFQR0Sz/GKf6SwGqse4fQBXLOYUqth5B6pUV0/txbfaeQrtPDcVwc18nE70JmHkKkkCuewoRgYnyU+twCzX0rYLzcZRam/pjh0cNMFe7Fkneve58hoOmcpdb491Qu/nOKrfdx+eJ55ufq/Xtc18FzXXwvGx8BmdQBhABjotGKBKYmD1BsNJmNOjRuRQSyyfId3+TeiQ/TdM9Sa71EYDb27zeYv5N3Tn2ac4W/5OKJRVqN8VXXPd/Fi4xhskBmhiFSinWtm0dHhqgOVrh4eYZWO33X5W7D8vhfcvv4P+FXC39Kx7t47fudX3K5+X+5b/yTtI/8NZz9x6uuB76PjtzFZ4FMLYPigYq1yOdz3HPXnTSWW1y6PLMnrH43i/IUvN34zqaEHyMwXc7Uv87hiX/K4vBluDzWv6ZNdsKHG2waNjJcZXxshKXGMpdrs6va+HsRgdXAyA7NztmtP2tcul4NMVAGxhJXsi1Kb4pt4OjIMONjo3iex6WZGjO1Op09qBUMHm138zl/LZads2DedUWsWS72dlONQwuFAne/407uvfsums0WtXqdmZlZlpvNm5mszGCMoeNeZrsC63lzV54Ue4gASVSrg4yMDPPOI/fhuC612iz1+hxzCwu0d2lTUimFZvttdZPi2c1ixxAgiUI+z+23Hebg9BSe59Ht9lhcWqTRaLLcbNIJF1zcMc6lhAgXrbaURFnRgpG2jW8HXN7hrd8dSYC1sG2LkeFhBiuVvlMI3/dptzt0upHr1Gh93tA5hEYbncnawSHMqk4uIYjWEJb9ZXGTjiJ207S3XUGAjZDP51BKUopWJYtX2Ew6hugvuxo7hwjCRZfCwaJole74GBMu4hyugQPEAhcrA0GI/pL3MukpfQOkVQDXW4HsagJsBuFYhYgnLkQWLKELGG2ikcNoTb5Q6Gbd2TnbhtnZsxj2PAFuNnZ4FWCfANcdO7wM2CfAdca+BrjVkboOcH3rEFkPBi3dqsO+GyHjEqAVt0qyQqb+AYQQDeC1LOPczTD0/U5uOySh8v4Pw67g7JC5hxAhxLNZx7l7IdKHFXm3iuPdb0olyVILZFoEGGOQUn4L+ATwSJZx71akLRHjx63B1jP2gfmaaflAB2tgAXWgxn/4F3ekij81Ab7xjW/wxBNPYAwICVLIQErxYeAEkC51ewAZKexvDT947jkVlJHVPDKvsKs5coOjqPwGb4h6NgPjEWiHQLtoE6CNj9Yunu7iBZ30BAgdFmgQAoVECIMxombgEWPMi8Bdad+xq5GyFSBHa8fLY63HZclDGQdl2oi8hxxw0SrAbGJqoEAhhU1kxhPZO9goWUhPANcPcD0/9FljCYQIu1O7rntMG3PH8GB5Vw2OZI20GuDu8V+/f9GcGWvLxZoWGoEHtosRPmx6sCv22hJPJwu1g0CmJ8Bv/cuP4QcBCpDaEAhNz/P+kdbmeN62Lcu20eHS8juaCFp2WR55iW7lb9FWZ0Vy/YWxxaomebheslj3OP5vRBDNlt4+3rT/630Q/MwXnaX+SQNsz/quB7yYU4PP2qryc4xJTwDLCi2DQ/frGm1MNQiC40pKqzpYRmvDYqOB7/lUqxVGhod2HBG8XJ2Z2/4I8j3uGHmUicp7qeSnMon7x5f/jEuNV7b1bNEe5h+843cBhqKwbbh+i9nWT3hz/q/v63qLj/tB76N5a+TbqQmgpETrIHRgZDQ60M8Yw1ilPIAB5ucX8CILlvmFJZYaywwPVXeMuxgjfGqH/wRZCHj/oSept/+WVy88T89buNlJo+st8r2f/atM4rJkkYnKe3jg0BP8dOa/F5a6bx13g+VH0tsGinhNjUgLBPqjCCgW8iwuLl1hzOlrTb0+T31ugepghfHREYaGh26a0+Jm9RU8e4l3jf8mZ2p/wVL3bHRlZw/jbhVe0OPC0svUmj/lvdMf5bWL/8Xygu7vpbcMkiudEkEQTGhjJpVS9Bzn6raBxrC41GBxqREuNj08xNjoCCPDQ1jWjRuiaA/8gqI9xlL3bRa3MX17t8H12/x05ttMDr6P84v/79H0GiDyD2CMppjLFVrtLiaQNJttzCbn7LnRJNBabRYpJYODFUaGhymXSxTy+bRJvCq0cBnMTXJh6VRi4tfeRtudZyA3iUEU0mc1EU6N0pESl1LgBx5+sL3VrXWgWVhcZGExNBqRQlKM1tvL53PYtoXKePm15d4Mgb61Vjhf7l0K/Q2mjajvIibsCyJn27Q72fkGCAhotdq0WqvtCi3Lwrbi5dmiWoiJ5vRtgXjGCDruAnutzL8WOu4SIDJwECEERsYtX0GxkKPT62U4I3d9uF44C/hqiPx8gBRhN7XWCLWyLJwxBiHlzp+1cR2RkYsY0R+8EkIwPFhhbmHphnrR2BTEik/Dlfwub5myfz1k5yBCrixlksvZjI8NM1tfQJudYbyxEdYbd7+VkIkGiHZW5aNCPs/05AEu1eqZuDK5XggJsK8BUkGI9dfULBTyvOOOw9Rm51hsLGfxqsxhByO3sgaYyazHJdYEa2vgUkoOHZxidHSYC5dm6GTYQsgCw90HmS9sr69+98Mcv2FdbpVymXcduZdGY5kLl2ZotXfG4mJl5y6GOg+wWEy/+MIuw1kB6buCt4qRkWHGx8dotTtcnqkxU5u96Va+h5c+AtpmofTyTU3HDcQJgfmIETRS135efTXMOVERcLsx5qxSoRtXy7JYbz/0vBla0RoD9fl5Ls/UmJubv6lk6KlZlgtn0GJjL15bQSC61Ad+mCoOa/42WB4iCI1ez6pDM99EBKB8sDywt1TB9oETAv43AGIHGIZYluLg1CSHD06HZJibo16fY6Y2e8OdSeX0GGPer2UWn6sWmS3+KFUc1tztcOF2AschcN2zVsH8O61cyHVhoIWwt16UmsTOTSdAEpalODg9xaGD0wA0my1m63XmFxZZajRoNls7frURKSU528K2LYq5cvpZwWZNJ3W7AtLD5BUoH1FJV5faUQRYi2KxwPTUJAfGx/pOIZabTZqtNp12m3anSy9yDnGjiSEIx0CkjLyDWAo7UcxJKXFkL/s+huUhMAHGKmJ8gRyfTxXdjibAeigVi+Rsm2ql3CdFuISKj+P0cNzYS0iA7wehYwgd9Be2NNE4QPzPJDx8h7srYwWhZ5BoREEIROQUIukNJBnWM9ZI38285vnWELgCEwQEFyf40uPfTRX7riPARhAiXE9ACIFtqVVeQoIgJELfS0hEBK0N2ui+a/m+p5Ck3o6tcIRk/e6uqyPzIiBj7BkC7ESEI447u5t5nwDXGVmZhl0v7BPgOiO1Btj3ELKLYUDfSg4i9nElsqgErkWWDiIyJYCU8lwQBC2gnGW8uxci60rgr4TItlS4HvYYx69DnLsWaT2EJIWtKt6fZ10iZE4ApdSXCI0Qb3nEzcA0IWFe/kOGmt9DmEw9hKQmwKlTp4AVl6pKqTeEEE+lTtkegTYiVYg0wJx38O2Pastnx/kIOn369BXnLMt6XgjxTNq49wIycBLV8kvLH/LKi+eM5YJa0QDnz59Pnb5MNMBadRT5Cvp9Ql9BO3dG6A1A2iJg8cCPP794+PSPtOWhbRdhmf64w0svvZQ6fdtqBTz22GOr9t94441ogecCtm0nJ388XygUTpVKpW8Ba9c+2fvIYsaxEL4lC9gUydtVhiojFAaqFAoFvvjFLwJw5swZzpw5c8X+ZrBpAhw5coTHHnuMI0eOXHGt1+vhOA6WZZHL5cjlcti2jW3b9Hq9v3Ec5/7BwcHPl0qlZ0jp6GC3IS0BJDnylMkzyIAco1yokqO0yrfCkSNHrpDLCy+8wAsvvHDN+DfloeHIkSN84QtfYHx8/Kr3JUfckr77Xdc1nU7nhOM437Btu5fL5e4XQhSSw6giGmZN1nDj+K4VYu8kye21AnDlyN866K8XsIUQ/w4lFD92vh87o99WyAeV4xVz4KdFPUTRDFGkihLWNVsBMSl+8IMfXPW+TRHg2Wc35ftRANIYI7TWUmutfN9Xrusqx3Fsx3HsVqsV1Ov1l+bm5v5Qa325UqkcVEpN7FkCSJuz3mv0dIftOooc8+/+3SH/UMOiIAumImxTElKoTamVOMNerUhI0xMoCCuRgpBIMtoqY4zyfT8+J6P32PH1RqNBrVb7X6+//vr3Dx8+/O7JyckPTU9Pf0ApNZEiPTsS9+V/jRPta6vi9ZDTAz+8p/cPG8AIoAmXR0+G+JyJ9rfcRtwuARShQHNAPgrJ/fjYikIOKCTOxeRR58+fz58/f/4k8NrExMTtExMT7zx48OAd1Wp1muvTU3lDcV/h73PJ+6X/tvvjLX1raezGe7r/7HnCyrMfBZfQP1gc3DX7HiEhNo3tEEARCnMQGCas1FUI+/8HgFIUCqwIPx8d51lDABKEqdVqVq1Wc19//fVf2Lb95vj4+HC1Wh0ZHBwcKJfLZSHErhi8CoLA6fV6Hc/zGq7rzv8d5wNNkSu840LutalAeFf/DUbokeC2i/f0fv37RVN9J6GjTZeQAD2gE4U20AKawBKwCCxH92yaBFv9oCJ6ZgCYAG4HDhGubTrEahLkWMnxduJYsTLGmSweLFaKFDzPE5cuXeLSpUsQMtzL5/N2uVzOFQoFK5/Py1wuJy3LEiLL4bEtQIcwWmtjjNG+7/tBEHjGGJ9QJReBQxLFne7f43b34fmWrNuB8ELPjRgN+Ca8VwuEqQTjHZuiC7yblVwd536X1cJfAuaAC8A5QsHH795UcbAdAsQaYBiYBu4EpqLjMiu5PxaqFT0TCzgmQBzkmi2Ja6vgOI5wHCd5zQBGShn3PYhoRm7kt1FcUeGLw9Uqi0nEx9FcQhMdmzX3xd9FEZI8rsSvgsIyVT0Vn0+W2zrxTIWV8t1nRag+IRliLdAizPWD0b3LwEJ0Xqz3/vWwVQIkWyhxwrxEiI+TZXdSWCqxje/RiW1MBLnm2bXvX3VNa510R5ckVyZYI/R1hZtI34bRsCLspMDXXluvkhd/16RGWPvdA1bLZ1PYDgECQgbWCctuj1ANxUVArAGS5X6cO+KiwI5CUlCx4GPNsVZTXAvx8zG5siRB/EFj4cXC2cyH3ijTxHEl74kFmqzQBYRFYC+xjTVAXARcJJRHhxUibArbqVT5hGXQbJSYOqHaisv+wjohFmgucS7HarUfCz+uFNpsXpBx3SRZ79hIi2wHSQGuFdBmn9XRM3GtPSYBiesu4TftRfsxYXrrhLgu0AQahEVAmy2OvWyHAHFCA6BLWA7l2LjSF1f8Yg2wkYBjAmxEkKshjns7z24GsRB9VudGn81rgbUCjglwNYLEGsBNhLWVwuT5WDNtGtttVsXqK/4gyc6gZIgFn2z2JTuFkpW++PraXLxZ9b9d7bEZJAkQCzHOBFshQFJwa4uRpIbx11xP1gmSIVUnEGySAC+88MKqEcAE4sQRJTop0Hi7dj9Z608iSQK1wT0bISbgeuTKErEgYiFtpcK1njDXPrteq4B19pPbq+JaA0KbJgCwEQmS2Gzi1hJl7bWrXb9anBuRKyusrclv9dlkHFe7nhpnzpzZ1Gjg/wcJbZdOPycbiAAAAABJRU5ErkJggg==",
      fun: (function(_this) {
        return function(evt, app) {
          var i, item, items, len, path_item, results;
          items = app.data.selected_tree_items;
          results = [];
          for (i = 0, len = items.length; i < len; i++) {
            path_item = items[i];
            item = path_item[path_item.length - 1];
            results.push(_this.collection_size.set(_this.collection_size.get() + 1));
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      txt: "remove boundary condition",
      ico: "data:image/png;base64,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",
      fun: (function(_this) {
        return function(evt, app) {
          var i, item, items, len, path_item, results;
          items = app.data.selected_tree_items;
          results = [];
          for (i = 0, len = items.length; i < len; i++) {
            path_item = items[i];
            item = path_item[path_item.length - 1];
            if (_this.collection_size.get() > 0) {
              results.push(_this.collection_size.set(_this.collection_size.get() - 1));
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    });
  }

  return TreeAppModule_Collection;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_Transform,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_Transform = (function(superClass) {
  extend(TreeAppModule_Transform, superClass);

  function TreeAppModule_Transform() {
    var transf;
    TreeAppModule_Transform.__super__.constructor.call(this);
    transf = '';
    this.name = 'Transformation';
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 2,
      txt: "Start making transformation",
      fun: (function(_this) {
        return function(evt, app) {
          var selected_items;
          app.undo_manager.snapshot();
          selected_items = app.data.get_selected_tree_items();
          transf = _this.add_item_depending_selected_tree(app.data, TransformItem);
          return _this.child_in_selected(app, TransformItem, selected_items, transf);
        };
      })(this)
    });
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Add a transformation node",
      fun: (function(_this) {
        return function(evt, app) {
          var canvas, j, len, p, p_cur, pos_x, pos_y, ref, results, selected_items, trans;
          app.undo_manager.snapshot();
          canvas = app.selected_canvas_inst()[0].div;
          if (evt.clientY < get_top(canvas)) {
            p = [0, 0, 0];
          } else {
            pos_x = evt.clientX - get_left(canvas);
            pos_y = evt.clientY - get_top(canvas);
            p = app.selected_canvas_inst()[0].cm.cam_info.sc_2_rw.pos(pos_x, pos_y);
          }
          selected_items = app.data.get_selected_tree_items();
          transf = _this.add_item_depending_selected_tree(app.data, TransformItem);
          _this.child_in_selected(app, TransformItem, selected_items, transf);
          ref = app.data.get_selected_tree_items();
          results = [];
          for (j = 0, len = ref.length; j < len; j++) {
            transf = ref[j];
            if (!(transf instanceof TransformItem)) {
              continue;
            }
            trans = [0, 0, 0];
            p_cur = p;
            if (transf.transform.cur_points.length >= 1) {
              trans = Vec_3.sub(transf.transform.cur_points[0].pos, transf.transform.old_points[0].pos);
              p_cur = Vec_3.sub(p, trans);
            }
            transf.transform.cur_points.push(p);
            results.push(transf.transform.old_points.push(p_cur));
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Remove a transformation node",
      fun: (function(_this) {
        return function(evt, app) {
          var cam_info, i, j, len, ref, results, selected_point;
          app.undo_manager.snapshot();
          cam_info = app.selected_canvas_inst()[0].cm.cam_info;
          ref = app.data.get_selected_tree_items();
          results = [];
          for (j = 0, len = ref.length; j < len; j++) {
            transf = ref[j];
            if (transf instanceof TransformItem) {
              if (transf.transform.cur_points.length > 0) {
                selected_point = transf.transform._selected;
                if (selected_point.length > 0) {
                  results.push((function() {
                    var k, ref1, results1;
                    results1 = [];
                    for (i = k = ref1 = selected_point.length - 1; ref1 <= 0 ? k <= 0 : k >= 0; i = ref1 <= 0 ? ++k : --k) {
                      app.undo_manager.snapshot();
                      transf.transform.cur_points.splice(selected_point[i], 1);
                      results1.push(transf.transform.old_points.splice(selected_point[i], 1));
                    }
                    return results1;
                  })());
                } else {
                  results.push(void 0);
                }
              } else {
                results.push(void 0);
              }
            }
          }
          return results;
        };
      })(this)
    });
  }

  return TreeAppModule_Transform;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_File,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_File = (function(superClass) {
  extend(TreeAppModule_File, superClass);

  function TreeAppModule_File(params) {
    if (params == null) {
      params = {};
    }
    this.onPopupClose = bind(this.onPopupClose, this);
    TreeAppModule_File.__super__.constructor.call(this);
    this.name = params.name != null ? params.name : 'Files';
    this.home_dir = params.home_dir != null ? params.home_dir : void 0;
    this.use_icons = params.use_icons != null ? params.use_icons : true;
    this.use_upload = params.use_upload != null ? params.use_upload : true;
    this.use_manage = params.use_manage != null ? params.use_manage : true;
    this.use_share = params.use_share != null ? params.use_share : false;
    this.use_download = params.use_download != null ? params.use_download : false;
    this.visible = true;
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAADdcAAA3XAUIom3gAAAAJdnBBZwAAACAAAAAgAIf6nJ0AAAKPSURBVEjH7dXPSyJhGAfwxxZhibDFwPYQGtstqE72Q+rQqVjoEgTRabtFEEREeuh/6BI4aBQ4aZBEUNpJ2WymmaZxRl0tZ1SItKAOWdGlyHx7S10yNngPe1r2/VyG932+39v7DsD/9bfWERzVqI0pY0naeGxkjHsfM4Q0oeoCFdTG9M9MLnP6In0qn7Ify7FB1sBWFyQhaUpl06jkFzpAfBmH8e9leRNfXSCB1CxnZfRCQiI6/COxIis2i9UFUYh+i+aiiFAOT1eiuzV8w8FX3hCxxC/iiNBFxMIbcKphtwZW9K5Feofe9uxu3W8jMlv3ayF6m95xLa7ogaqlKHvMLjmT7kcPchPAU4/OpF2yxyiKqoVVoKxUhBKXkp7CGiLjKSwlKRGnrKsATnCMOMIOcVnxFDyIUGFZcYg4NeIEcIHLTLN02K2uP60jQk9ulQ7TrMvsAvCCt8nr90obqc3iJiJU3Eh5JZxq8gL4wKfz0T7Zn/EX/YhQ0Z/xyTil8wEEIKANLgTl4EkAkQue4MRCQBsAYCEMrI2VmWwIkWOyrMzacBJAwA5+CBJ3ziJy3Lkg4RTOvl6k8HfpULjkEDnhUjrEqd8XqSfKi3kBkRPzUR6nSgUJSLTFGelOROSkuziTaEuUChRQWo5DkQcJkYs8HIeUFqVUcAaqSeFixSiKYW/vfaTs7V5pJlZUONV0VnkT5lsFRrji89z1/s3+DXvL3jKv9sqYMnyCz7lrPi9cCcx8ayWv6dBZ2yd7RweHhgfG+sf7JixTPdPdM12znXNmm9nWOdc12z3TM22Z6pvoHx8YGxoeHZzstbZ36EDz/nXXwCfQwmeoAx3UwxfQQwOmx1/1eKcOn2jxhOYf+6c9AywIEs2PE0peAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDA5LTA5LTEzVDE0OjIxOjQ2KzAyOjAwmMe/4wAAACV0RVh0ZGF0ZTptb2RpZnkAMjAwOS0wOS0xM1QxNDoyMTo0NiswMjowMOmaB18AAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC",
      siz: 0.9,
      txt: "Open in Tree",
      fun: (function(_this) {
        return function(evt, app) {
          var Pheight, Pleft, Ptop, Pwidth, dir, fs, inst, inst_i, j, len, p, ref;
          _this.d = new_dom_element({
            className: "browse_container",
            id: "id_browse_container"
          });
          if ((typeof FileSystem !== "undefined" && FileSystem !== null) && (FileSystem.get_inst() != null)) {
            fs = FileSystem.get_inst();
          } else {
            fs = new FileSystem;
            FileSystem._disp = false;
          }
          dir = _this.home_dir != null ? _this.home_dir : FileSystem._home_dir + "/__files__";
          fs.load_or_make_dir(dir, function(d, err) {
            var item_cp;
            ModelEditorItem_Directory.add_action("Mesh", function(file, path, browser) {
              var j, len, m, modules, results;
              console.log("open mesh");
              if ((typeof TreeAppModule_Sketch !== "undefined" && TreeAppModule_Sketch !== null) && (app != null)) {
                modules = app.data.modules;
                results = [];
                for (j = 0, len = modules.length; j < len; j++) {
                  m = modules[j];
                  if (m instanceof TreeAppModule_Sketch) {
                    results.push(m.actions[4].fun(evt, app, file));
                  } else {
                    results.push(void 0);
                  }
                }
                return results;
              }
            });
            ModelEditorItem_Directory.add_action("TreeItem", function(file, path, browser) {
              return file.load(function(object, err) {
                var session;
                app.undo_manager.snapshot();
                session = app.data.selected_session();
                session.add_child(object);
                _this.select_item(app.data, object);
                return _this.watch_item(app.data, object);
              });
            });
            ModelEditorItem_Directory.add_action("Path", function(file, path, browser) {
              return file.load(function(m, err) {
                var done, file_item, img_item, item, j, k, len, len1, len2, n, ref, ref1, ref2, rv;
                if (file.name.ends_with(".raw")) {
                  rv = _this.add_item_depending_selected_tree(app.data, RawVolume);
                  return rv._children.push(new FileItem(file));
                } else if (file.name.ends_with(".unv") || file.name.ends_with(".csv") || file.name.ends_with(".geo") || file.name.ends_with(".stp")) {
                  file_item = new FileItem(file);
                  ref = app.data.get_selected_tree_items();
                  for (j = 0, len = ref.length; j < len; j++) {
                    item = ref[j];
                    if (typeof item.accept_child === "function" ? item.accept_child(file_item) : void 0) {
                      item.add_child(file_item);
                      done = true;
                    }
                  }
                  if (!done) {
                    return alert("Please select in the tree an item which accepts a file");
                  }
                } else if (file.name.ends_with(".jpg") || file.name.ends_with(".png") || file.name.ends_with(".tiff") || file.name.ends_with(".tif") || file.name.ends_with(".jpeg")) {
                  img_item = new ImgItem(m, app);
                  img_item._name.set(file.name);
                  done = false;
                  ref1 = app.data.get_selected_tree_items();
                  for (k = 0, len1 = ref1.length; k < len1; k++) {
                    item = ref1[k];
                    if (typeof item.accept_child === "function" ? item.accept_child(img_item) : void 0) {
                      item.add_child(img_item);
                      done = true;
                    }
                  }
                  if (!done) {
                    return alert("Please select in the tree an item which accepts an image");
                  }
                } else {
                  file_item = new FileItem(file);
                  ref2 = app.data.get_selected_tree_items();
                  for (n = 0, len2 = ref2.length; n < len2; n++) {
                    item = ref2[n];
                    if (typeof item.accept_child === "function" ? item.accept_child(file_item) : void 0) {
                      item.add_child(file_item);
                      done = true;
                    }
                  }
                  if (!done) {
                    return alert("Please select in the tree an item which accepts a file");
                  }
                }
              });
            });
            ModelEditorItem_Directory.add_action_2("Mesh", ModelEditorItem_Directory._action_list["Mesh"][0]);
            ModelEditorItem_Directory.add_action_2("TreeItem", ModelEditorItem_Directory._action_list["TreeItem"][0]);
            ModelEditorItem_Directory.add_action_2("Path", ModelEditorItem_Directory._action_list["Path"][0]);
            ModelEditorItem_Directory.add_action_2("Directory", function(file, path, browser) {
              return file.load(function(m, err) {
                var done, elem, file_item, i, item, j, k, len, len1, len2, n, ref, ref1;
                done = false;
                for (i = j = 0, len = m.length; j < len; i = ++j) {
                  elem = m[i];
                  if (elem.name.ends_with(".jpg") || elem.name.ends_with(".png") || elem.name.ends_with(".tiff") || elem.name.ends_with(".tif") || elem.name.ends_with(".jpeg")) {
                    file_item = new FileItem(elem);
                    ref = app.data.get_selected_tree_items();
                    for (k = 0, len1 = ref.length; k < len1; k++) {
                      item = ref[k];
                      if (typeof item.accept_child === "function" ? item.accept_child(file_item) : void 0) {
                        item.add_child(file_item);
                        if (!done) {
                          elem.load(function(res, err) {
                            var img_temp;
                            img_temp = new Img(res);
                            return item.img = img_temp;
                          });
                        }
                        done = true;
                      }
                    }
                  } else if (elem.name.ends_with(".raw")) {
                    file_item = new RawVolume;
                    file_item._children.push(new FileItem(elem));
                    ref1 = app.data.get_selected_tree_items();
                    for (n = 0, len2 = ref1.length; n < len2; n++) {
                      item = ref1[n];
                      if (typeof item.accept_child === "function" ? item.accept_child(file_item) : void 0) {
                        item.add_child(file_item);
                        done = true;
                      }
                    }
                  }
                }
                if (!done) {
                  return alert("No image can be found in this directory");
                }
              });
            });
            return item_cp = new ModelEditorItem_Directory({
              el: _this.d,
              model: d,
              initial_path: dir,
              use_icons: _this.use_icons,
              use_upload: _this.use_upload,
              use_manage: _this.use_manage,
              use_share: _this.use_share,
              use_download: _this.use_download
            });
          });
          inst = void 0;
          ref = app.selected_canvas_inst();
          for (j = 0, len = ref.length; j < len; j++) {
            inst_i = ref[j];
            inst = inst_i;
          }
          if (inst.divCanvas != null) {
            Ptop = _this.getTop(inst.div);
            Pleft = _this.getLeft(inst.div);
            Pwidth = inst.divCanvas.offsetWidth;
            Pheight = inst.divCanvas.offsetHeight;
            Pheight = Pheight + 22;
          } else {
            Ptop = 100;
            Pleft = 100;
            Pwidth = 800;
            Pheight = 500;
          }
          p = new_popup("Browse Folder", {
            event: evt,
            child: _this.d,
            top_x: Pleft,
            top_y: Ptop,
            width: Pwidth,
            height: Pheight,
            onclose: function() {
              return _this.onPopupClose(app);
            }
          });
          return app.active_key.set(false);
        };
      })(this)
    });
  }

  TreeAppModule_File.prototype.getLeft = function(l) {
    if (l.offsetParent != null) {
      return l.offsetLeft + this.getLeft(l.offsetParent);
    } else {
      return l.offsetLeft;
    }
  };

  TreeAppModule_File.prototype.getTop = function(l) {
    if (l.offsetParent != null) {
      return l.offsetTop + this.getTop(l.offsetParent);
    } else {
      return l.offsetTop;
    }
  };

  TreeAppModule_File.prototype.onPopupClose = function(app) {
    document.onkeydown = void 0;
    return app.active_key.set(true);
  };

  return TreeAppModule_File;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_Compute,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_Compute = (function(superClass) {
  extend(TreeAppModule_Compute, superClass);

  function TreeAppModule_Compute() {
    var _ina, _ina_auto, _ina_build, _ina_builded;
    TreeAppModule_Compute.__super__.constructor.call(this);
    this.name = 'Compute';
    this.visible = true;
    _ina = (function(_this) {
      return function(app) {
        return app.data.focus.get() !== app.treeview.process_id;
      };
    })(this);
    _ina_build = (function(_this) {
      return function(app) {
        var cm, cs, el, i, len, ref;
        if (app.treeview.flat != null) {
          ref = app.treeview.flat;
          for (i = 0, len = ref.length; i < len; i++) {
            el = ref[i];
            if (!(el.item instanceof TreeItem_Computable)) {
              continue;
            }
            cm = el.item._computation_mode.get();
            cs = el.item._computation_state.get();
            if (cm === false && cs === true) {
              return true;
            }
          }
        }
        return false;
      };
    })(this);
    _ina_builded = (function(_this) {
      return function(app) {
        var cm, cs, el, i, len, ref;
        if (app.treeview.flat != null) {
          ref = app.treeview.flat;
          for (i = 0, len = ref.length; i < len; i++) {
            el = ref[i];
            if (!(el.item instanceof TreeItem_Computable)) {
              continue;
            }
            cm = el.item._computation_mode.get();
            cs = el.item._computation_state.get();
            if (cm === false && cs === false) {
              return true;
            } else if (cm === true) {
              return true;
            }
          }
        }
        return false;
      };
    })(this);
    _ina_auto = (function(_this) {
      return function(app) {
        var cm, cs, el, i, len, ref;
        if (app.treeview.flat != null) {
          ref = app.treeview.flat;
          for (i = 0, len = ref.length; i < len; i++) {
            el = ref[i];
            if (!(el.item instanceof TreeItem_Computable)) {
              continue;
            }
            cm = el.item._computation_mode.get();
            cs = el.item._computation_state.get();
            if (cm === true) {
              return true;
            }
          }
        }
        return false;
      };
    })(this);
    this.actions.push({
      txt: "Manual Compute",
      ico: "data:image/png;base64,",
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var el, i, len, ref, results;
          ref = app.treeview.flat;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            el = ref[i];
            if (el.item instanceof TreeItem_Computable) {
              results.push(el.item._computation_mode.set(false));
            }
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      txt: "Build",
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKDQ04CWpsETwAAAPaSURBVEjH3VVdbBRVFP7u7s52+1/2tdL1kSYWlaiJ2u2PbWrxSUojRnlQqDWSQtUHjTHRmCBNMfxUTYxQwDT4Q5T2QQmltOzCVpBEXrrFl5ogjQXdtjPd2Z+Ze+7MXB+22y5uW+BRT/LN3Llz7v3mu+fMOcB/3dhaLy9FxlEXrMUPpwf9fr8/yBgrAQDHkUlNUyPtW9vUyPg4grW198c6ODQEADg3cr41Onl9Ymbmlvzr79gSbt2+LW/8cVNOXv9tYnTsQisAnB0+d28KRkZH0dLcjJ8vXwkFAlUNtu1IzjkDAMaW3aWUkBlj8/Pz4aeferJxZHQMLc1NqxOcHhzC1rYt+OXq1ZuVlQ9UxePxe1IspYSmadN1wdrAya+/wfaXX1pdQSh8MRQIBBpUTQNjDEY6jaLiYkDKNUkcx0EsNht+bvOzjSsq+Pa7U7Asq3XTpkfPxuM6GGNQVRWPPLwRExNRVKxbd1clpmkiFottltIZfnHbtnwFo2NjE77Coodsy2IAkEyl8ExDPaSUiEajiM3OobyiAo7j5EmXmYtU1fnJti3Pb8zOu7KDvXt7/G63pyaVTDHOCZwTBAkAgGVZqK6uxhOPP4akriOVTCHrkwVxAhExj0epOXDosD+PoLyiPCiEgBAEIg4iDiHojszx+Xyor6/D+vWVmJ2LQVgCfNE3C9uxUVRYGMyu8eRkQommLcCjLE2BFhUsBYwx2LaNQFUVHgwEcCEUhuNISCwngGVZEJZVkkdAgkBEcBxnyVkIWr0EMAbbtkDCQs7+sGwLRMvrlgmIknxR4jKpyMt3j8eDqakpjF++gtKyMsicD8oqIE7JPIIFbSFSWlKKgoKCHAUCOSEAEeHHn85gIa7Dq3jBDTNPmWEamJubi+QFeX9vj6on9CjnXHLi4ESgxSNSFAW/XruGE18NYCGuQ0oHnOhf4OCcy0QiET144BM1u687O/jgw49gGMYNF3NtBwNs20Y6lUb1hg0YGDiJP2dm4HK5YdsWbNteEWkjzRK6/kpjU9Pvly6GVy4V7773fqisrKwhezTpdBrFxcWQa5YKBikd6Loe7u3Zd0epcOU+7Orajd6ejxs1TZs2TQ4iAY9byfxIJPLBM3fTNKGq2nRvz77GXV271y7X3W++jb7DB9G1pzvk8xU2KIoiV2tMEpBCCMYN4/znn/W17Ol+C5/2Hbp7R3t1RwdOHO/Hzo7OVsXr3e/1KjUul3vJWQJwbBtEFBWC3jnWf3T4tdffwNEvv7i/lrmjoxPH+4+gvf0Fv6+oMMiQaZkSMpk2zMjg96fUnR2dONZ/BP9f+wfw8EzPD+V7OAAAAABJRU5ErkJggg==",
      ina: _ina_build,
      fun: (function(_this) {
        return function(evt, app) {
          var el, i, len, ref, results;
          ref = app.treeview.flat;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            el = ref[i];
            if (el.item instanceof TreeItem_Computable) {
              results.push(el.item.do_it());
            }
          }
          return results;
        };
      })(this),
      key: ["X"]
    });
    this.actions.push({
      txt: "Auto Compute",
      ico: "data:image/png;base64,",
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var el, i, len, ref, results;
          ref = app.treeview.flat;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            el = ref[i];
            if (el.item instanceof TreeItem_Computable) {
              results.push(el.item._computation_mode.set(true));
            }
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      txt: "Already computed",
      ico: "data:image/png;base64,",
      bnd: (function(_this) {
        return function(app) {
          return app;
        };
      })(this),
      loc: true,
      vis: _ina_builded,
      fun: (function(_this) {
        return function(evt, app) {
          var i, len, m, path, ref, results;
          ref = app.data.selected_tree_items;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            path = ref[i];
            if (!(path.length > 1)) {
              continue;
            }
            m = path[path.length - 1];
            if (m instanceof TreeItem_Computable) {
              m._computation_mode.set(false);
              results.push(m._computation_state.set(false));
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      txt: "Set Item to manual compute",
      ico: "data:image/png;base64,",
      loc: true,
      bnd: (function(_this) {
        return function(app) {
          return app;
        };
      })(this),
      vis: _ina_build,
      fun: (function(_this) {
        return function(evt, app) {
          var i, len, m, path, ref, results;
          ref = app.data.selected_tree_items;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            path = ref[i];
            if (!(path.length > 1)) {
              continue;
            }
            m = path[path.length - 1];
            if (m instanceof TreeItem_Computable) {
              m._computation_mode.set(false);
              results.push(m.do_it());
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      txt: "Set Item to auto compute",
      ico: "data:image/png;base64,",
      loc: true,
      bnd: (function(_this) {
        return function(app) {
          return app;
        };
      })(this),
      vis: _ina_auto,
      fun: (function(_this) {
        return function(evt, app) {
          var i, len, m, path, ref, results;
          ref = app.data.selected_tree_items;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            path = ref[i];
            if (!(path.length > 1)) {
              continue;
            }
            m = path[path.length - 1];
            if (m instanceof TreeItem_Computable) {
              m._computation_mode.set(true);
              results.push(m.do_it());
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    });
    this._toggle_inactive = function(app) {
      var i, len, m, path, ref;
      ref = app.data.selected_tree_items;
      for (i = 0, len = ref.length; i < len; i++) {
        path = ref[i];
        if (!(path.length > 1)) {
          continue;
        }
        m = path[path.length - 1];
        if (m instanceof TreeItem_Computable) {
          if (m.nothing_to_do()) {
            0;
          } else if (m._computation_mode.get() === 1) {
            1;
          } else if (m._computation_mode.get() === 2) {
            2;
          }
          return true;
        }
      }
      return false;
    };
  }

  return TreeAppModule_Compute;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_Logo_SC,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_Logo_SC = (function(superClass) {
  extend(TreeAppModule_Logo_SC, superClass);

  function TreeAppModule_Logo_SC() {
    var _ina;
    TreeAppModule_Logo_SC.__super__.constructor.call(this);
    this.name = 'Structure Computation';
    this.visible = true;
    _ina = (function(_this) {
      return function(app) {
        var ref, ref1;
        return app.data.focus.get() !== ((ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm.process_id : void 0 : void 0) && app.data.focus.get() !== app.treeview.process_id;
      };
    })(this);
    this.icon_app = new Lst;
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 1.8,
      txt: "Structure Computation",
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {};
      })(this)
    });
  }

  return TreeAppModule_Logo_SC;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_Sketch,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_Sketch = (function(superClass) {
  extend(TreeAppModule_Sketch, superClass);

  function TreeAppModule_Sketch() {
    this.create_mesher = bind(this.create_mesher, this);
    var _ctx_act, _ina, _ina_cm, mesher_sub;
    TreeAppModule_Sketch.__super__.constructor.call(this);
    this.name = 'Sketch';
    _ina_cm = (function(_this) {
      return function(app) {
        var ref, ref1;
        return app.data.focus.get() !== ((ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm.process_id : void 0 : void 0) && app.data.focus.get() !== app.treeview.process_id;
      };
    })(this);
    _ina = (function(_this) {
      return function(app) {
        var ref, ref1;
        return app.data.focus.get() !== ((ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm.process_id : void 0 : void 0);
      };
    })(this);
    _ctx_act = (function(_this) {
      return function(act) {
        if (act.sub != null) {
          return false;
        } else {
          return true;
        }
      };
    })(this);
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Transform line to curve",
      ina: _ina_cm,
      ctx: _ctx_act,
      fun: (function(_this) {
        return function(evt, app) {
          var i, it, len, ref, results;
          app.undo_manager.snapshot();
          ref = app.data.get_selected_tree_items();
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            it = ref[i];
            if (it instanceof SketchItem) {
              if (it.mesh != null) {
                results.push(it.mesh.make_curve_line_from_selected());
              } else {
                results.push(void 0);
              }
            }
          }
          return results;
        };
      })(this),
      key: ["Shift+C"]
    });
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Break curve to line",
      ina: _ina_cm,
      ctx: _ctx_act,
      fun: (function(_this) {
        return function(evt, app) {
          var i, it, len, ref, results;
          app.undo_manager.snapshot();
          ref = app.data.get_selected_tree_items();
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            it = ref[i];
            if (it instanceof SketchItem) {
              if (it.mesh != null) {
                results.push(it.mesh.break_line_from_selected());
              } else {
                results.push(void 0);
              }
            }
          }
          return results;
        };
      })(this),
      key: ["Shift+B"]
    });
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Create a cube",
      ina: _ina,
      ctx: _ctx_act,
      fun: (function(_this) {
        return function(evt, app) {
          var coord, current_point, i, len, lines, ls, point, ref, sketch, surfaces;
          sketch = _this.add_item_depending_selected_tree(app.data, SketchItem);
          sketch.mesh.visualization.display_style.set("Wireframe");
          sketch.mesh.move_scheme = MoveScheme_3D;
          current_point = sketch.mesh.points.length;
          ref = [[-0.333, -0.333, -0.333], [0.333, -0.333, -0.333], [0.333, 0.333, -0.333], [-0.333, 0.333, -0.333], [-0.333, -0.333, +0.333], [0.333, -0.333, +0.333], [0.333, 0.333, +0.333], [-0.333, 0.333, +0.333]];
          for (i = 0, len = ref.length; i < len; i++) {
            coord = ref[i];
            point = app.selected_canvas_inst()[0].cm.cam.get_screen_coord(coord);
            sketch.mesh.add_point(point);
          }
          lines = [new Element_Line([current_point + 0, current_point + 1]), new Element_Line([current_point + 1, current_point + 2]), new Element_Line([current_point + 2, current_point + 3]), new Element_Line([current_point + 3, current_point + 0]), new Element_Line([current_point + 0, current_point + 4]), new Element_Line([current_point + 1, current_point + 5]), new Element_Line([current_point + 2, current_point + 6]), new Element_Line([current_point + 3, current_point + 7]), new Element_Line([current_point + 4, current_point + 5]), new Element_Line([current_point + 5, current_point + 6]), new Element_Line([current_point + 6, current_point + 7]), new Element_Line([current_point + 7, current_point + 4])];
          surfaces = (function() {
            var j, len1, ref1, results;
            ref1 = [[-1, 0, -1, 1, -1, 2, -1, 3], [+1, 0, +1, 5, -1, 8, -1, 4], [+1, 1, +1, 6, -1, 9, -1, 5], [+1, 2, +1, 7, -1, 10, -1, 6], [+1, 3, -1, 7, -1, 11, +1, 4], [+1, 8, +1, 9, +1, 10, +1, 11]];
            results = [];
            for (j = 0, len1 = ref1.length; j < len1; j++) {
              ls = ref1[j];
              results.push(new Element_BoundedSurf([
                {
                  o: ls[0],
                  e: lines[ls[1]]
                }, {
                  o: ls[2],
                  e: lines[ls[3]]
                }, {
                  o: ls[4],
                  e: lines[ls[5]]
                }, {
                  o: ls[6],
                  e: lines[ls[7]]
                }
              ]));
            }
            return results;
          })();
          return sketch.mesh.add_element(new Element_BoundedVolume([
            {
              o: -1,
              e: surfaces[0]
            }, {
              o: +1,
              e: surfaces[1]
            }, {
              o: +1,
              e: surfaces[2]
            }, {
              o: +1,
              e: surfaces[3]
            }, {
              o: -1,
              e: surfaces[4]
            }, {
              o: +1,
              e: surfaces[5]
            }
          ]));
        };
      })(this)
    });
    mesher_sub = {
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Create Shape",
      ina: _ina_cm,
      ctx: _ctx_act,
      sub: {
        prf: "list",
        act: []
      },
      key: ["M"]
    };
    this.actions.push(mesher_sub);
    mesher_sub.sub.act.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Create a square",
      ina: _ina_cm,
      ctx: _ctx_act,
      fun: (function(_this) {
        return function(evt, app) {
          var coord, current_point, i, len, point, ref, sketch;
          app.undo_manager.snapshot();
          _this.create_mesher(app);
          sketch = _this.add_item_depending_selected_tree(app.data, SketchItem);
          sketch.mesh.visualization.display_style.set("Wireframe");
          sketch.mesh.move_scheme = MoveScheme_2D;
          current_point = sketch.mesh.points.length;
          ref = [[-0.333, -0.333], [0.333, -0.333], [0.333, 0.333], [-0.333, 0.333]];
          for (i = 0, len = ref.length; i < len; i++) {
            coord = ref[i];
            point = app.selected_canvas_inst()[0].cm.cam.get_screen_coord(coord);
            sketch.mesh.add_point(point);
          }
          return sketch.mesh.add_element(new Element_BoundedSurf([
            {
              o: +1,
              e: new Element_Line([current_point + 0, current_point + 1])
            }, {
              o: +1,
              e: new Element_Line([current_point + 1, current_point + 2])
            }, {
              o: +1,
              e: new Element_Line([current_point + 2, current_point + 3])
            }, {
              o: +1,
              e: new Element_Line([current_point + 3, current_point + 0])
            }
          ]));
        };
      })(this)
    });
    mesher_sub.sub.act.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Create a disc",
      ina: _ina_cm,
      ctx: _ctx_act,
      fun: (function(_this) {
        return function(evt, app) {
          var coord, current_point, i, len, point, ref, sketch;
          app.undo_manager.snapshot();
          _this.create_mesher(app);
          sketch = _this.add_item_depending_selected_tree(app.data, SketchItem);
          current_point = sketch.mesh.points.length;
          ref = [[-0.33, 0], [0, 0.33], [0.33, 0]];
          for (i = 0, len = ref.length; i < len; i++) {
            coord = ref[i];
            point = app.selected_canvas_inst()[0].cm.cam.get_screen_coord(coord);
            sketch.mesh.add_point(point);
          }
          sketch.mesh.add_element(new Element_BoundedSurf([
            {
              o: +1,
              e: new Element_Arc([current_point + 0, current_point + 1, current_point + 2, current_point + 0])
            }
          ]));
          return sketch.mesh.visualization.display_style.set("Wireframe");
        };
      })(this)
    });
    mesher_sub.sub.act.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Create a Triangle edge",
      ina: _ina_cm,
      ctx: _ctx_act,
      fun: (function(_this) {
        return function(evt, app) {
          var coord, current_point, i, len, point, ref, sketch;
          app.undo_manager.snapshot();
          _this.create_mesher(app);
          sketch = _this.add_item_depending_selected_tree(app.data, SketchItem);
          current_point = sketch.mesh.points.length;
          ref = [[0, 0.33], [-0.33, -0.333], [0.33, -0.333]];
          for (i = 0, len = ref.length; i < len; i++) {
            coord = ref[i];
            point = app.selected_canvas_inst()[0].cm.cam.get_screen_coord(coord);
            sketch.mesh.add_point(point);
          }
          sketch.mesh.add_element(new Element_BoundedSurf([
            {
              o: +1,
              e: new Element_Line([current_point + 0, current_point + 1])
            }, {
              o: +1,
              e: new Element_Line([current_point + 1, current_point + 2])
            }, {
              o: +1,
              e: new Element_Line([current_point + 2, current_point + 0])
            }
          ]));
          return sketch.mesh.visualization.display_style.set("Wireframe");
        };
      })(this)
    });
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Delete Point",
      ina: _ina,
      ctx: _ctx_act,
      fun: (function(_this) {
        return function(evt, app) {
          var cam_info, i, it, len, ref, results;
          app.undo_manager.snapshot();
          cam_info = app.selected_canvas_inst()[0].cm.cam_info;
          ref = app.data.get_selected_tree_items();
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            it = ref[i];
            if (it instanceof SketchItem) {
              if (it.mesh != null) {
                results.push(it.mesh.delete_selected_point(cam_info));
              } else {
                results.push(void 0);
              }
            }
          }
          return results;
        };
      })(this),
      key: ["Del"]
    });
  }

  TreeAppModule_Sketch.prototype.create_mesher = function(app) {
    var ch, create_mesher, discret, i, it, j, len, len1, ref, ref1;
    create_mesher = true;
    discret = false;
    ref = app.data.get_selected_tree_items();
    for (i = 0, len = ref.length; i < len; i++) {
      it = ref[i];
      if (!(it instanceof DiscretizationItem)) {
        continue;
      }
      discret = true;
      if (it._children.length > 0) {
        ref1 = it._children;
        for (j = 0, len1 = ref1.length; j < len1; j++) {
          ch = ref1[j];
          if (ch instanceof MesherItem) {
            create_mesher = false;
          }
        }
      }
    }
    if (discret === false) {
      create_mesher = false;
    }
    if (create_mesher === true) {
      return this.add_item_depending_selected_tree(app.data, MesherItem);
    }
  };

  return TreeAppModule_Sketch;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_MapManagerTop,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_MapManagerTop = (function(superClass) {
  extend(TreeAppModule_MapManagerTop, superClass);

  function TreeAppModule_MapManagerTop() {
    var _ina;
    TreeAppModule_MapManagerTop.__super__.constructor.call(this);
    this.name = 'Windows';
    _ina = (function(_this) {
      return function(app) {
        var ref, ref1;
        return app.data.focus.get() !== ((ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm.process_id : void 0 : void 0);
      };
    })(this);
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAMgAyADIKiWVHwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90DDQ8MMriAXu0AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAGX0lEQVQ4EQFUBqv5Af///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQHGE/w1IYAABBAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//PoA87igAMCPfAEAAAAAAf///wAAAAAATbnk/wAAAAD86+UAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEFRsAAAAAALNHHAEAAAAABAAAAAAAAAAAAQQGAPvn3wC3XDcBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABJpMn/BRkhAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADlNVf8JLj0A9MKuAMrDwAEAAAAANj1A/ww+UgD30sMAx7OrAQAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkuPQAMQlgAByUyADY9QP8AAAAAE2OEAAUdJgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPTCrgAHJTIABR0mABNlhgAAAAAABRskAPvj2gD0wq4AAABuAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMrDwAHtnXwA++XcAAUbJAAFGyQA++XcAO2dfADKw8ABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADY9QP8TY4QABRskAPvl3AD75dwABRskABNjhAA2PUD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAw+UgAFHSYA++PaAO2dfAAAAAAAE2OEAAUdJgAMPlIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPfSwwAAAAAA9MKuAMrDwAEAAAAANj1A/ww+UgD30sMAAABuAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMezqwEAAAAAAABuAAAAAAAAAAAAysPAAQAAAAAAAG4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAA//z6AAQVGwBJpMn/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEFRsA//z6AAAAAAAAAAAABAAAAAAAAAAA87igAA1IYAAFGSEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//PoA87igAABHfAAAAAAAAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAdJqDHQxpLFcAAAAASUVORK5CYII=",
      siz: 1,
      txt: "Close current view",
      ina: _ina,
      fun: function(evt, app) {
        app.undo_manager.snapshot();
        return app.data.rm_selected_panels();
      },
      key: ["Shift+X"]
    });
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAAZiS0dEAMgAyADIKiWVHwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90DDQ42JoYxPt4AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAGX0lEQVQ4EQFUBqv5Af///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAJSUl//z8/AAAAAAAAAAAAAAAAAAAAAAABAQEANvb2wEAAAAAJSUl//z8/AAAAAAAAAAAAAAAAAAAAAAABAQEANvb2wEAAAAABAAAAAAAAAAAhoaGAB4eHgAAAAAAAAAAAAAAAAAAAAAA4uLiAAAAAAAAAAAAhoaGAB4eHgAAAAAAAAAAAAAAAAAAAAAA4uLiAAAAAAAAAAAAAgAAAAAAAAAAHh4eAAAAAAAAAAAAAAAAAAAAAAAAAAAAHh4eAAAAAAAAAAAAHh4eAAAAAAAAAAAAAAAAAAAAAAAAAAAAHh4eAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAA5ubmAAAAAAAAAAAAAAAAAAAAAAAAAAAA5ubmAAAAAAAAAAAA5ubmAAAAAAAAAAAAAAAAAAAAAAAAAAAA5ubmAAAAAAAAAAAAAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAzNUpeS+fl6wAAAAASUVORK5CYII=",
      siz: 1,
      txt: "Vertical Split",
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          return _this.split_view(evt, app, 0);
        };
      })(this),
      key: ["Shift+V"]
    });
    this.actions.push({
      ico: "data:image/png;base64,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",
      siz: 1,
      txt: "Horizontal Split",
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          return _this.split_view(evt, app, 1);
        };
      })(this),
      key: ["Shift+H"]
    });
  }

  TreeAppModule_MapManagerTop.prototype.split_view = function(evt, app, n) {
    var cam, child, d, i, j, len, len1, p, panel_id, ref, ref1, results, s;
    app.undo_manager.snapshot();
    cam = void 0;
    child = void 0;
    ref = app.data.selected_tree_items;
    for (i = 0, len = ref.length; i < len; i++) {
      p = ref[i];
      s = p[p.length - 1];
      if (s instanceof ShootingItem) {
        cam = s.cam;
        child = s;
      }
    }
    d = app.data.selected_display_settings();
    ref1 = app.data.selected_canvas_pan;
    results = [];
    for (j = 0, len1 = ref1.length; j < len1; j++) {
      panel_id = ref1[j];
      app._next_view_item_cam = cam;
      app._next_view_item_child = child;
      results.push(d._layout.mk_split(n, 0, panel_id, 0.5));
    }
    return results;
  };

  return TreeAppModule_MapManagerTop;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_Animation,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_Animation = (function(superClass) {
  extend(TreeAppModule_Animation, superClass);

  function TreeAppModule_Animation() {
    this.clear_timer = bind(this.clear_timer, this);
    this.run_timer = bind(this.run_timer, this);
    var _ina;
    TreeAppModule_Animation.__super__.constructor.call(this);
    this.play_state = false;
    this.add_attr({
      img_per_sec: 2,
      right: true
    });
    this.name = '';
    this.timeline = true;
    _ina = (function(_this) {
      return function(app) {
        var ref, ref1;
        return app.data.focus.get() !== ((ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm.process_id : void 0 : void 0) && app.data.focus.get() !== app.treeview.process_id;
      };
    })(this);
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKDQ05NsURDUAAAAPsSURBVEjH3VVNTFxVFP7ue/NehykBMzsC6Systo1iYjemlWkgEgRXlhJr1I0tYmxoURcaY6I21hJq+oOaGFuKXYi10cIS2oJgZ6p2C1RWWoG01SnMY2aAefe8++PiDQNkCrZLPcnNu/e8e+93vnPOPQf4rwtb7+fVWBy7olX44WJvOBwORxljxQCglJ53nGSsaU9jMhaPI1pV9WCovX19AIBLl6/Uj43fGL1167b+6+9Efty+c0ff/HNSj9/4bXRw6Md6AOgfuHR/DC4PDqKuthbXfv5lOBLZVC2l0pxzBgCMLW/XWkP7wmZnZ0ee3rmj5vLgEOpqn1kb4GJvH/Y07sav169PlpdXbEqlUvfFWGsNx3GmdkWrIt/0fItXXn5pbQbDIz8NRyKR6qTjwGAMzDD8S5RaF0QphUTi7shzDc/W3JPB+e8uQAhRv337k/2pVBqMMSwuLiIY3AAAcF2OUCi06lLXdSGlwMaNxfl1IpFo0FoNvLh3byGDwaGh0WBR6HEpBGOGgaBtY+vWLQCAiYkJcE9AKwVmGHCSDrY8uhnpTAYuJyilAA2dTM6ON+5+/omlO42lyZEj7WHTDFQuzC8wzgnECRp6KZgAYyBO4Jwwe3cGO3c8hbKyMmitQbn9RMQCAavy+MlT4QKA0odKo57nwfMIRBycOJRc9ruSCql0CqbJUFdXC9u283pOHJQbUkmEioqiS+cCKzKh2HHmELB8lcEMSCXzANlsFo9t24aKinIIIcAYg9YaUkkQJyjtGyOEgCdEcQEAeQSinC8BMINBrmSgFQyj8OHLHAOttA8gBYgIBS4ionmec41PmSDlMgPDMDFyNY54/Bosy/LjAkBKCSLKn+OcgzjNFwDMOXOx7GI2HzDuEtQKACUlGBgmp6bR03Menifyeu5S/tzCwgJmZmZiBQDHOtqT6Ux6jHOul6wRQuQBhBA+M88D9zx0nzuHqelpKK1WWq8zmczYieOfJgse2gcfHgZ5VF9aUtpvb/AzxDRNPLL5YSil8PsfN1e5DAC4y2EGTAQCfig550inUg2WbQ98fPije5eKd997f7ikpKTar2ssX+B8n+s1q77WCul0eqSj/eiqUmGsXBxoPYiO9k9qHMeZcl0/0NzNBY4IRN7qwf2v67pIJp2pjvajNQdaD65frtvefBudp06g9VDbcDBYVG1Zll6rMWlAe57HeDZ75YvPO+sOtb2FzzpP/ntHe3VfM77u7sL+5pZ6y7aP2bZVaRhmfrPOZQ8RjXkevXO268zAa6+/gTNffflgLXNfcwu6u06jqemFcDBUFGXwW6aGnl/MurHe7y8k9ze34GzXafx/5R9/KnJND6QWgwAAAABJRU5ErkJggg==",
      siz: 0.9,
      ord: false,
      ina: _ina,
      txt: "Go to First Image",
      fun: (function(_this) {
        return function(evt, app) {
          app.data.time.set(app.data.time._min);
          return _this.clear_timer();
        };
      })(this),
      key: ["Shift+1"]
    });
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKDQ4AJDpqT+sAAAPoSURBVEjH3VVbTBxVGP7O7M4IhILuk00r+266D/bFatnKWgqLb7ZE6uXFFjE2tKgPGmOiNtYSML2gJsZCqXdtLKC+QCkVdPHS19LWx7Yk7cICO8zsLjvnP2fm+DCwLVmo8Kgn+TMz/+37L2f+H/ivH3Yv4W+JceyIVuNcX38oFApFGWPlAOB5Kmua6UTjnt3pxPg4otXV60PtHxgAAJwfvhCfuHL18q1bt9XUdKpAt5NJdf3GTXXl6rXLIxd/iQPA4ND5tWUwPDKCutpa/P7Hn6PhcFWN63qKc84AgLE76kopKP+wubm5se2PPxYbHrmIutqdqwP09Q9gz+6n8delSzc3bdpcZVnWmjJWSsE0zckd0erw1998ixeef271DEbHfh0Nh8M1adOExtiay+p5HlKpmbGnGupjK2bw3fdnIaWMb936yKBl2cvKAQCapmF2ZgYPhEIFGWNAJpOFYRgwDAOO4yCVSjUo5Q3tbWry7ZYcPLu3CRs3PthpzltKCAEiAhGBE4GEwNTUFLZtexTJZBJEBCEEklPTiGx5GBk7A04ExjSl63rnkvNlAEeOtIcCgWAkl80xzgkFcjgytoVdtTuhaRqEEBBCIjU9jSeqt2PDhgoIKUCcQEQsGNQjx06cDBUBVN5fGfWNCUQcnDiyuSx0PYAnYzEIIcAYA5GAZZmoq9uFQDAIxpgPQBxEHK7noqy0NLrkN3jXTSg3zXkEdZ/lShdVD21GJLIFUso7PVEe4vX1y3hSSPAA+e9SQkhZXgRAwq+553m+oiuhlFd0W6Qri3lCgjEqyImouAdElOWLpeHE4bouJq79jURiHLquQykFAJi3bJzr64emaQWekKJgxzkHccoWAcyb84n8Qt5v1iIpT+H6jUn8+NPPMAzDD4QTSEh88eVXhWyFlAWbXC6H2dnZRBFAZ0d72s7YE5xz5Ufjl0y6ArNzafSe+RyMMXDO4TgOwDR09/TCtm24Ui5FrzKZzMTxYx+mi360d949DBIUr6yoHDTuM4qHFmPIZrIoLSuDprGCeT6/AEM3EAgGwDmHbVkNumEMvX/4vZVHxZtvvT1aUVFRs44pAYBBKQ+2bY91tB9dNiq0uz8OtB5ER/sHMdM0Jx2Hg0iAuPCfK9GizHEcpNPmZEf70diB1oP3Htdtr76OrpPH0XqobbSkpLRG13W12mJSgBJCMJ7PX/jk4666Q22v4aOuE/++0V7c14wzvT3Y39wS1w2j0zD0iKYFCsoKgOe6IKIJIeiN0z3dQy+9/Aq6P/t0fStzX3MLentOobHxmVBJWWmUwV+ZCiq7kHcS/T+cTe9vbsHpnlP4/55/APMGZWqwyzAaAAAAAElFTkSuQmCC",
      siz: 0.9,
      ord: false,
      ina: _ina,
      txt: "Rewind",
      fun: (function(_this) {
        return function(evt, app) {
          if (app.data.time.get() > 0) {
            app.data.time.set(app.data.time.get() - 1);
            return _this.clear_timer();
          }
        };
      })(this),
      key: ["Shift+2"]
    });
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKDQ04CWpsETwAAAPaSURBVEjH3VVdbBRVFP7u7s52+1/2tdL1kSYWlaiJ2u2PbWrxSUojRnlQqDWSQtUHjTHRmCBNMfxUTYxQwDT4Q5T2QQmltOzCVpBEXrrFl5ogjQXdtjPd2Z+Ze+7MXB+22y5uW+BRT/LN3Llz7v3mu+fMOcB/3dhaLy9FxlEXrMUPpwf9fr8/yBgrAQDHkUlNUyPtW9vUyPg4grW198c6ODQEADg3cr41Onl9Ymbmlvzr79gSbt2+LW/8cVNOXv9tYnTsQisAnB0+d28KRkZH0dLcjJ8vXwkFAlUNtu1IzjkDAMaW3aWUkBlj8/Pz4aeferJxZHQMLc1NqxOcHhzC1rYt+OXq1ZuVlQ9UxePxe1IspYSmadN1wdrAya+/wfaXX1pdQSh8MRQIBBpUTQNjDEY6jaLiYkDKNUkcx0EsNht+bvOzjSsq+Pa7U7Asq3XTpkfPxuM6GGNQVRWPPLwRExNRVKxbd1clpmkiFottltIZfnHbtnwFo2NjE77Coodsy2IAkEyl8ExDPaSUiEajiM3OobyiAo7j5EmXmYtU1fnJti3Pb8zOu7KDvXt7/G63pyaVTDHOCZwTBAkAgGVZqK6uxhOPP4akriOVTCHrkwVxAhExj0epOXDosD+PoLyiPCiEgBAEIg4iDiHojszx+Xyor6/D+vWVmJ2LQVgCfNE3C9uxUVRYGMyu8eRkQommLcCjLE2BFhUsBYwx2LaNQFUVHgwEcCEUhuNISCwngGVZEJZVkkdAgkBEcBxnyVkIWr0EMAbbtkDCQs7+sGwLRMvrlgmIknxR4jKpyMt3j8eDqakpjF++gtKyMsicD8oqIE7JPIIFbSFSWlKKgoKCHAUCOSEAEeHHn85gIa7Dq3jBDTNPmWEamJubi+QFeX9vj6on9CjnXHLi4ESgxSNSFAW/XruGE18NYCGuQ0oHnOhf4OCcy0QiET144BM1u687O/jgw49gGMYNF3NtBwNs20Y6lUb1hg0YGDiJP2dm4HK5YdsWbNteEWkjzRK6/kpjU9Pvly6GVy4V7773fqisrKwhezTpdBrFxcWQa5YKBikd6Loe7u3Zd0epcOU+7Orajd6ejxs1TZs2TQ4iAY9byfxIJPLBM3fTNKGq2nRvz77GXV271y7X3W++jb7DB9G1pzvk8xU2KIoiV2tMEpBCCMYN4/znn/W17Ol+C5/2Hbp7R3t1RwdOHO/Hzo7OVsXr3e/1KjUul3vJWQJwbBtEFBWC3jnWf3T4tdffwNEvv7i/lrmjoxPH+4+gvf0Fv6+oMMiQaZkSMpk2zMjg96fUnR2dONZ/BP9f+wfw8EzPD+V7OAAAAABJRU5ErkJggg==",
      siz: 0.9,
      ord: false,
      ina: _ina,
      txt: "Play",
      fun: (function(_this) {
        return function(evt, app) {
          if (_this.play_state === false) {
            _this.play_state = true;
            if (app.data.time.get() === app.data.time._max.get()) {
              app.data.time.set(0);
            }
            return setTimeout(_this.run_timer, 1000 / _this.img_per_sec, app);
          }
        };
      })(this),
      key: ["Shift+3", "Space"]
    });
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKDQ4BB4EWD9gAAAO8SURBVEjH3VVNTFxVFP7um18mFMxsazoLNdZUTOzKVqaBSHBwZSmxRt3YIsaGFnWhMSZqY+2Emv6gJsaW1o1/jRaWUAoOOlDtFqjjRmtJ2uoI7zEDhXfP/XPxZqYMM9R2qSe5i3vueee733fuOwf4rxu73eGP6QnsiDfiu3MD0Wg0GmeM1QKA1mbJcex0x652Oz0xgXhj492hDgwOAgDOj1xITM9cnrp27br5869saV2/ccNc+eOqmbn8y9To2PcJABgaPn9nDEZGR9Ha0oLJiz+lYrFNTUppwzlnAMDYrXBjDIxnbH5+fvzx7duaR0bH0NryxPoA5wYGsat9J36+dOnqxo33bsrlcnfE2BgDx3Fmd8QbY198+RVeeP659Rmkxn9IxWKxJttxYDEGZlm3EmntfVTFp7VGNvv3+FNtTzZXZfD1N2chpUxs3froUC6XB2MMy8vLCIdDgPHkcV0XABAOh2GMARjguhyRSAQA4LoustlsmzF6+NnduysZjI6NTYVrIg8rKRmzLISDQWze/CAAwO/3Y3LyIphlYfu2xyClBABkMhlwIaG1BgyMbc/PtO98+pFizhLXQ4eSUZ/P33Bz6SbjnECcYGC8m5aKCmily3xgDFSIJyLm9wcajh4/Ea0AqL+nPi6EgBAEIg5OHFrpsvoIKSCkKPNppcGJgwpLaYVITU28eO5f9RJqHWcB/oDnspgFpVVZsqIsq01pBeIEbXQpRkhZWwFAgkBEnpYAmMWgqjCoACgwMNqTTSoJIkIlANESL1AEAMuyoNQaBqIKA6XKLialBHFaqgBYcBbSG2o3IBQKeQyYBb0GQFQB0EqBuwRTkGjFXcHc3Fy6oshHepN2fjE/zTk3vFDkoubGGDDGSoVkjJVekpQSxXjOuVlcXJw+dvRDu+JHe+fdgyBBifq6+qFgKAgA8Pl8eOD++8AYgxASmcyvAIAtWx6Cz+eDUgq//X6lJCXnHPlcri0QDA6/f/C96q3izbfeTtXV1TV5fY2taXC6JN/qPlQ8y+fz473Jw2Wtwlq92de9H73JD5odx5l1XQ4iAnc5OPcWkQCRKO15IcZ1Xdi2M9ubPNy8r3v/7dt1z6uvo+/EMXQf6EmFwzVNgUDArDeYDGCEEIyvrFz45OO+1gM9r+GjvuP/PtFe3NOJz8/0Y29nVyIQDB4JBgMNluUrBZvC6yGiaSHojdP9p4ZfevkVnPrs07sbmXs6u3Cm/yQ6Op6JhiM1cQZvZBqYpeUVNz3w7Vl7b2cXTvefxP/X/gErE0R6J5atMAAAAABJRU5ErkJggg==",
      siz: 0.9,
      ord: false,
      ina: _ina,
      txt: "Pause",
      fun: (function(_this) {
        return function(evt, app) {
          return _this.clear_timer();
        };
      })(this),
      key: ["Shift+4"]
    });
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKDQ07N4AgX1QAAAPySURBVEjH3VVNTFxVFP7uY96DITNgJjah1nT2RhZ20VbLUBCEwZ0tkfqzaYsYG1rUhcaYqI21BEx/UBNjC9SFtW0soG6glAp08Kfb0rrVktCh4zBv5jEw755737su5keagUqXepKT9945597vfu+eH+C/LuxBzuuRGdSGanB5aDgQCARCjDEfALiuSptmItK6d08iMjODUE3Nw6EOj4wAAK6MXw3P3rp9c37+rlq4Fyvo3WhU/fHnHXXr9u83J679FAaA0bErG2MwPjGBpsZG/PzLr5PB4NY6x3EV55wBAGP/hCuloLLCFhcXp3Y983T9+MQ1NDU2rA8wNDyCvXtewG83btzZsuXxralUakOMlVIwTXOuNlQT/Ob8t3j1lZfXZzA5NT0ZDAbrEqYJjbEN/1bXdRGL/TX1fEtz/ZoMLly8BClleNu2p0ZTKQtCCBAR/H4flFp10kQCj27aBNd1i0Bs20YsFmtRyh3b19YGANDyzpf2tWHz5qpeM5lSQggsWUuofvIJRBfuFcCi0Sh27tyBhYUFkBDgRKCcciIwpild13vzm98HcOxYd6CkxFO9nF5mnBOEFPD7K1BbswvxeBxCSAghoGkanmtswEo6DTtjg3MC5wTiBCJiHo9efeLU6UARQOUjlSEhBIQgEHEIKcAYg8fjQWPDs0ilTBBlbUII7N5dC8PwIL2cBicOyqnjOij3ekNFAEopn2kmwXN0pZDIp6ZSCuHmZkC5YIyBMQYpJXZs347HqqqQWckU1hERhJS+/L6e/AuJrDN/eXmA1SIduUaKuuDE4XE8hRgiQjEAUZrnKAKAI2UhczRNw+WhYSRTVsFmGAamp69jbn4ehq7DcbLrpJQgTukigKSZjPh9fpSWlmbzWmWZOI6L8xcuQtcNEM+ezDAMfP/Dj0gmLWglWsEOABk7g3g8Him6g96e7oS1ZM1yzhUnDkdKWJaF/oFBuK6CbdvgnIMxhsFzXyO+mIB0RCFFOXFwztXS0tLsyROfJooK7YMPj4IEhSsrKkeNUgOOdECC4PWWA1C5alXIrKzA5/dB5atvlXDOYaVSLbphjH189KO1W8W7770/WVFRUfcQXQIAg1IuLMua6uk+fl+r0FZ/HOo8jJ7uT+pN05yzbQ4iAeIi+1xLcz7btpFImHM93cfrD3UefnC77nrzbfSdPonOI12TZWXeOl3X1XqDSQFKCMF4JnP1i8/7mo50vYXP+k79+0Tbf6Ad5wb7cbC9I6wbRq9h6NWaVlIIVgBcxwERzQpB7wz0nx177fU3cParLx9uZB5o78Bg/xm0tr4YKCv3hhiyI1NBpVcydmT4u0uJg+0dGOg/g/+v/A2/iWrBMlPeuQAAAABJRU5ErkJggg==",
      siz: 0.9,
      ord: false,
      ina: _ina,
      txt: "Forward",
      fun: (function(_this) {
        return function(evt, app) {
          if (app.data.time.get() < app.data.time._max.get()) {
            app.data.time.set(app.data.time.get() + 1);
            return _this.clear_timer();
          }
        };
      })(this),
      key: ["Shift+5"]
    });
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKDQ05BuPIPewAAAPzSURBVEjH3VVNTFxVFP7um5k3j3EKdnakppPYmroQ03ZjWpkGIuHHlaXEGnXTlmJsaFEXGmOiNtYSavqDmhhbipr411hgCaUg6EBrt0DbaLQtYFscYB4zDMy7/y7mzQiZgu1ST3Jz7zv3vvPd75xzzwH+60JW2/w5OoQdkVKc7+gMhUKhCCEkCABK6ZRtx6N1u2rj0aEhREpLHwy1s6sLAHCh92L16NjVkdu37+ipv2K5cefuXX3z1rgeu3ptpK//x2oA6O65cH8Mevv6UFlRgeFLlwfC4fVlUipNKSUAQMg/x7XW0Bkhs7Ozg09v31be29ePyopnVgbo6OzCrtqd+OXKlfF16x5Zn0gk7oux1hq2bU/siJSGv/7mW7z80osrMxgY/GkgHA6XxW0bBlk5RMQwMsaVQiYuCrHY9OCzNVXl92Tw3ffnIISo3rp1S3cikQQhBAsLKXg8XliWtcz44uIiLMsPAHAcikAg4K4dxGKxGq1Vzwu7d+cz6OvvH7EKAk9IIQgxDAQsC8HgQ/j1t9+xNrQWWikQw4DlN/H4pk0AgGvXr4NxAaUUoKHj8dmx2p3PPZm1aWQXR440hzweb8lCaoFQysAog1QSxcXF2L7tKcxOTyOrdwMMrTUIIWCunjFGvF5fyfGTp0J5AEUPF0U45+CcgTEKyiiUzPjXNE1UVVXCskwkkomcHgCUVKCMgrlDKolAQUEku+9dkglB256D15dRGcSAVBLZ9BRCYMvmzZiamsLk5J85AKkkGGVQOgMqhAAXIpgHwDgDYyzjSwDEIJBLbro0JbPGAEC6DLTSGQApwBhDPgBjKepSBADDMCClzBk1TR+Ghy/jxq1xbNzw6BIAuexiQggwylJ5AHP2XHRNcA38fr/rFgPKBeCc43xHF7gQ8BienD4TAwnqMGiXVdpJY2ZmJpoX5GMtzfHkfHKUUqppNshaYWJyEu1ffoW044BzDsoohBA5ACEEsucppXp+fn70xPGP4nkP7d33DoNxVl1UWNRt+s3cz1JI+N1HlRWPx4PHNm6AUgp/3LiZcyWlFMlEosZnmj0fHH7/3qXirbffGSgsLCwjZPUqny18Wmt3Vkgmk4MtzUeXlQpj6ceBxoNoaf6w3LbtCcehYIyDUZ6Zlw0GSimoQ8EYg+M4iMftiZbmo+UHGg+uXq6bXnsDradOoPFQ04BlFZT5fD69UmPSgOacE5pOX/z0k9bKQ02v4+PWk//e0fbsrccX7W3YV99Q7TPNY6bpKzEMT+6wdrOHMTbKOXvzbNuZnv2vvIozn3/2YC1zb30D2ttOo67u+ZAVKIgQZFqmhk4tpp1o5w/n4vvqG3C27TT+v/I3Wa5Y3bqRT/cAAAAASUVORK5CYII=",
      siz: 0.9,
      ina: _ina,
      txt: "Go to Last Image",
      fun: (function(_this) {
        return function(evt, app) {
          app.data.time.set(app.data.time._max.get());
          return _this.clear_timer();
        };
      })(this),
      key: ["Shift+6"]
    });
    this.actions.push({
      mod: function(app) {
        return app.data.time;
      },
      siz: 1
    });
  }

  TreeAppModule_Animation.prototype.run_timer = function(app) {
    if (app.data.time.get() < app.data.time._max.get() && this.play_state === true) {
      if (app.data.time.get() === app.data.time._max.get()) {
        return this.clear_timer();
      } else {
        app.data.time.set(app.data.time.get() + 1);
        return setTimeout(this.run_timer, 1000 / this.img_per_sec, app);
      }
    } else {
      return this.clear_timer();
    }
  };

  TreeAppModule_Animation.prototype.clear_timer = function() {
    return this.play_state = false;
  };

  return TreeAppModule_Animation;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_PanelManager,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_PanelManager = (function(superClass) {
  extend(TreeAppModule_PanelManager, superClass);

  function TreeAppModule_PanelManager() {
    var _ina, cube;
    TreeAppModule_PanelManager.__super__.constructor.call(this);
    this.name = ' ';
    _ina = (function(_this) {
      return function(app) {
        var ref, ref1, ref2;
        return app.data.focus.get() !== ((ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? (ref2 = ref1.cm) != null ? ref2.process_id : void 0 : void 0 : void 0);
      };
    })(this);
    this.actions.push({
      vis: false,
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90JFAs3HDhMFHIAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAh0lEQVQ4y+2UMQoEIQxFk+WfIkU6b+V5LLyiXQpPEXCq2dVBGNy1m02V+MND4SG31mhn4WxCCM3dPwFA7s4AhvMpBKBSCg/AlBKp6nvJzEhVycyWbvg6mx42m5eBu+rJwFrrEFznZQ9FhPtARH4DxhinYuecvwP+xX6y2ADuVel2ePePvf3JBxY+Odo/jSlIAAAAAElFTkSuQmCC",
      siz: 0.9,
      txt: "Scientific framework",
      fun: (function(_this) {
        return function(evt, app) {
          var d;
          app.data.display_scientific_framework();
          d = app.data.selected_display_settings();
          app.data.update_associated_layout_data(d);
          return alert("ok scientific");
        };
      })(this)
    });
    this.actions.push({
      vis: false,
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAAZiS0dEAMgAyADIKiWVHwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90DDQ42JoYxPt4AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAGX0lEQVQ4EQFUBqv5Af///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAJSUl//z8/AAAAAAAAAAAAAAAAAAAAAAABAQEANvb2wEAAAAAJSUl//z8/AAAAAAAAAAAAAAAAAAAAAAABAQEANvb2wEAAAAABAAAAAAAAAAAhoaGAB4eHgAAAAAAAAAAAAAAAAAAAAAA4uLiAAAAAAAAAAAAhoaGAB4eHgAAAAAAAAAAAAAAAAAAAAAA4uLiAAAAAAAAAAAAAgAAAAAAAAAAHh4eAAAAAAAAAAAAAAAAAAAAAAAAAAAAHh4eAAAAAAAAAAAAHh4eAAAAAAAAAAAAAAAAAAAAAAAAAAAAHh4eAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAA5ubmAAAAAAAAAAAAAAAAAAAAAAAAAAAA5ubmAAAAAAAAAAAA5ubmAAAAAAAAAAAAAAAAAAAAAAAAAAAA5ubmAAAAAAAAAAAAAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAzNUpeS+fl6wAAAAASUVORK5CYII=",
      siz: 0.9,
      txt: "Standard framework",
      fun: function(evt, app) {
        var d;
        app.data.display_scientific_framework();
        d = app.data.selected_display_settings();
        app.data.update_associated_layout_data(d);
        return alert("ok standard");
      }
    });
    this.actions.push({
      vis: false,
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAAZiS0dEAMgAyADIKiWVHwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90DDQ42JoYxPt4AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAGX0lEQVQ4EQFUBqv5Af///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAJSUl//z8/AAAAAAAAAAAAAAAAAAAAAAABAQEANvb2wEAAAAAJSUl//z8/AAAAAAAAAAAAAAAAAAAAAAABAQEANvb2wEAAAAABAAAAAAAAAAAhoaGAB4eHgAAAAAAAAAAAAAAAAAAAAAA4uLiAAAAAAAAAAAAhoaGAB4eHgAAAAAAAAAAAAAAAAAAAAAA4uLiAAAAAAAAAAAAAgAAAAAAAAAAHh4eAAAAAAAAAAAAAAAAAAAAAAAAAAAAHh4eAAAAAAAAAAAAHh4eAAAAAAAAAAAAAAAAAAAAAAAAAAAAHh4eAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAA5ubmAAAAAAAAAAAAAAAAAAAAAAAAAAAA5ubmAAAAAAAAAAAA5ubmAAAAAAAAAAAAAAAAAAAAAAAAAAAA5ubmAAAAAAAAAAAAAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAzNUpeS+fl6wAAAAASUVORK5CYII=",
      siz: 1,
      txt: "Vertical Split",
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          return _this.split_view(evt, app, 0);
        };
      })(this),
      key: ["Shift+V"]
    });
    this.actions.push({
      vis: false,
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wBEgwmOfuZMhgAAAIISURBVFjDxZexihNRFIa/c++5yQTRFFoIwiBilV4bYWsxFhZZ7HwBwScQBfEJBF/CLCLIamm1jfZ5gHXtLBYbDcncY5FMNolZmRn2JgemuMOd+X/+859zzxUzY5fh2HEIoDdeffowFdc3M7D0iCKCWjz88eLBIwU6U1z/9cO7FDHiJC1+NPDO8fzj1z7QUSArLHKl7Xl2+B31QioOBkwL403/JoVFgEwBiQbdtnLrakZwkkyFaDCJRretxFmqRQGKaHTUc/1Shk9syyJCRz3FnIECTCLs5W328nxr7p9EzgjMyTAajTAEqZCCp9+Ut3em9TxgIBi9Xm+BqcsbWq2ASdUcREKrVb8KLa6s9cyfoBqgMoExQUODUoisYK6wUV9DAfDqGyggmxSYL3zApHoNqtcGBOx8AiF4Yo02pA0UcGwiUDpStSYBbU5guQps8cOwKI9UKSi7rG30gHqKGgSamNCvCbxC4P67k1o/a6KAl/9UwZcnt4kx7UDg1k46tz4tOOdqP4/fn1TeC3LxI9lwkLN/cMz+wXHtb/WipB0OZidpSaJcb30oHQ7yhSLrseldsvGjalo0pePX07KTe0ElBVKO4ueZscR0AMFv/4JUYipg2fj0qPvy871JEUncCHEyA8/Gp0e/wAS4DOTAtdSmXIop8BM4ljloB8j+6ZPpwoA/wO9dX475C9dYnN3eMJ3aAAAAAElFTkSuQmCC",
      siz: 1,
      txt: "Fit object to the view",
      ina: _ina,
      fun: function(evt, app) {
        var i, inst, len, ref, results;
        ref = app.selected_canvas_inst();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          inst = ref[i];
          results.push(inst.cm.fit());
        }
        return results;
      },
      key: ["F"]
    });
    this.actions.push({
      vis: false,
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAeZJREFUeNrslc9q1FAUxr9zczu5Qx1HsItCoZTu2gdwUcEHcFyID+ITaAvSdQt9kkL/7bpz0wew6yruBEXEWie5x3MyudNk6PZkXMwlN5BLyPfL+fcRAL/24fy4IDdiZkAu00VyEcFzPPu6+/K1l6N+ATfaf/UMZYxwZKsf5Qcz5/Du5Gqk2goQSo54nGd4e/YFPiNYMWhwi5JxNNqAaqq2ApBSDXOPzacBSxICqyiozlhuqhUnqSYFkNCzxCLD6nKQ8NimoIyotMqaoAIYy+GL9Vz2Orpa44h7gMgTmuvrT5InqqrUpAZYv87Y2tqeavrmC/3QB5NtDohj67kFECoAMgbgBwA4AfQQYQvgkhg3ABJTyIP0p23xZdTSnwDQNAV5BWA5iBIANQFcmjwuQ9ZRGybNCqAnWDffb/HrrpAIsHEKCI9kEqrm7wSQy/jbPrjE3yJWvWraBQLQ8w6Dnm8X4eGbHRmPpXEP1HUgqX5/etWchBFPQrduGOuB5JNLzckNsXDDhRsu3PD/cEM03LCItgR+ZshM3DCdyYj0rps2nBqw3pYyh65X0tQIcLj78XG4d/F8LGPKOAPVn6u4av4UbQ3EQLaOwJXZmjBchexvsj9TLdrXGgTM3bhpjH9k32Le658AAwAHpcq9MWLTJwAAAABJRU5ErkJggg==",
      siz: 1,
      txt: "Horizontal Split",
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          return _this.split_view(evt, app, 1);
        };
      })(this),
      key: ["Shift+H"]
    });
    cube = {
      vis: false,
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAbCAYAAACX6BTbAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAABVQAAAVUB1l9HcgAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAARmSURBVEiJlVZtSLJnFD6Pc2VkL62hGLyu2gjeWEYFWUQEo6IIMvrY+lHSBxj0o19mBVK6OeYqaEOL2IowipJBPn1QRB8wIumTFhUrh2+m683abIXY7Ovx7M+rqKW1C+4f55z7XPf13Pe5n/sQiAjPgSCI8MrKyuaMjIyi4+PjnZmZme8PDg7+eDYREQMOAAivqqr6ZmRk5Pf7+3t0Q6/X/9Xc3DyQkJAQHyyfeEo5QRBMoVDYUlBQUM5gMN4sLCw8mpOYmAipqal/T01NTU5PT3fs7+8bgyoHAKZQKPx2dHT00K10e3sbNRoNajQajIqKQqVSiRqNBhcXFz1fsrq6ei6VSn9OTEz8zIfvPWlEdXX1d1qt1vDw8ICBwOFwcHt7O2B8bW3tvK2t7Scej/cpIgKUlZX9+BzpS8ndWF9fPy8vL/+Fxmazv7RareEOh+P5snkBzGbz7dzcnDMuLi4TSJK0uFwu7OzsPB8aGrJ6V8X/Ue5wOFzd3d1/9vf32xARSZK00AEACYIAiUTCvry8BIVC8S4rK4uRl5f38UuUIiKMjY1Zj46OoLW19TWdTveEgCRJs7+K3d3dO7lcbtnb23N4+yUSCZ6cnHjs5eXlf6RSqeX09NTlz0GSpPlJcjcmJyftSqXScnZ25rNXRqPxX7lcbl5ZWXEGyiVJ0kxHDHz/BQJBhEAgiFCpVLaQkJDb0tLS6OHh4XdsNvuVTCb75JntQtDpdMf+q15cXKDVavXxOZ1OFIlEZxRFPVJpNBqxo6MDBwYGPD6dTndMAwAf5TKZDLhcLvD5fBCJROByuQAAgMFgQEpKipNGo3nm2mw2EIvFIBaLwWAwQFdXl494mre1tLQEWq0W9Ho9bG1tgclkgt7eXp/K8EZDQwMwmUyYmJiA3NxcSE9P94n7kI+Pj0NxcTEkJycDm82GyspKmJ+fD7ivFEUBh8OBhYUFkMvlIBAIfOJ0bzUGgwGampo8dnR0NNjt9oDKCYIAjUYDXC4XMjMzoaamBsLCwqCwsBAQEXyqhaIouL6+9iRfXFxAZGRkQOUEQYBAIACpVAoAAEwmE2ZnZ93kSAevA42PjweTyeRJnpqaAj6f77Hdh+sGjUbzWVytVnuHke5t1dXVQUlJCdBoNLBYLLCzswM9PT1BlVMUFTD+AYvF4sXGxsazWKxQLpcLPB4P5ufngaIoUKlUEBMT45m8ubl5yefzP3LboaGhUFZWBiEhIT6ker3+XKfTaQERIScn54vOzs6lq6urxzfEC2q1+ihY3GKx3La3t+vS0tI+R/dL9P5MiYqKisaxsbEDl+vRfygo+c3NDfb19W0UFRV9hf7PnPeIiop61djY2LOxsWF7gvytv29ubs5SW1v7NQB86M8VsC3Izs5OUSgU01ar9e4p8sPDQ0dLS8twUlLS60AcQfsWRITS0lLh4ODgb3d3d6hWq9/a7XZXd3f3r/n5+bnP5T7ZtzxRcqH19fXy6+vrIoIgBkdGRn7AFyT+B8V0vTlNCwgQAAAAAElFTkSuQmCC",
      siz: 1,
      txt: "View",
      ina: _ina,
      sub: {
        prf: "list",
        act: []
      },
      key: ["V"]
    };
    this.actions.push(cube);
    cube.sub.act.push({
      vis: false,
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAcCAYAAADr9QYhAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAB8wAAAfMB4Ueu7gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAQ2SURBVEiJ7ZZNSHJZGMf/V+/YcInqHUnMECwTDdpUFm1iiCYqEoKKaHAjDEEJaQUtWqWrgr4/sGCiIKJdZJNR0OciaDZBQ4xoVqhRlGRjQ2nJa2cWM4p9XBXe6YWB+W/uuff5P+f+znnOPfdQhBCwiWEYcVFR0U9yubwoPT1dQlEUBwAoiqIAwOfzfeP3+7nhZwzDhNLS0j6H4/+Iis55lU9vbm5+4vP5nPv7+wcqGoaiKI5UKv1eoVD8KJPJ8kpKSuQ1NTXfJScnvwt7dnaGhYUF1NbWQiwWg2EY8Hg81sEBwOHhISYmJv58fn4OSqVSWq1Wp0gkEo7RaHRRAFIKCwvVMpnsB6lUqlCpVDnFxcU8DocTs9OlpSUEAgE0NTUhntdsNj8vLi7eJScnf1YqlUkNDQ0pqampLzxGo9FF5efnX2dnZ39L0/SLeoVn9fX1taKfR7fDgC6Xi9fd3U3Ky8sZmqZZgY1Go4uura0N9PT0CGIO7QukVqv/qKys/JSIN/b8fmX9D8OmhGAIIZicnER1dTVEIhEEAgEqKiowMDCAUCj09WB8Ph9UKhW0Wi2CwSC0Wi06OzuRlJSErq4ulJWV4erqijU/+gtzOp3Y3d3F+vo6vF7vW7PBYHCSGGppaSEAyPDw8JvYzMwMoSiKNDY2suar1erbcLu5uZkoFApSVVVF+Hw+aW9vj/gMBoMzJszR0RHhcrmkoqKC9WV1dXUEANnf348Lo9fryejoKCGEkMvLS5KamkoeHh4iMDHLtLa2hlAohLa2NlaPTqcDAFgsltj1BsAwDPx+PwBAKBSCw+G8KDH7lgjg5OQEACCTyVg9CoUCAGC32xOCub6+xvHxMebn55GRkYGsrKzEYC4uLgAAAgH7Bi0QCMDlcnF+fp4QTF9fH5aXl+F2uzE3N/fyFxIrOTMzEwDg8XhYPR6PB6FQCGKxOCEYjUaDs7MzHB0doaOjAzc3N4nB5OTkAAAcDgerx2azAQDkcvm78eiRMwyDx8dHAEBubi40Gg0GBwcTg6murgaXy8X4+DirZ2xsDACgUqlidRWBCQQCkXu9Xo/p6Wnc3d3Fh8nLy0NzczM2NjYwMjLyJj47O4ulpSU0NjaipKQkLoxEIkFBQUHkXiQSYWpqKlKqmAsYAHp7e+F2u9HR0YGVlRWUlZWBpmns7e1hdXUVpaWlGB0dZc2nKCpyTlIqlVAqlS/i9fX1kXbc30FaWhosFgtMJhN4PB5MJhOGhobw9PSE/v5+7OzsQCgUxusmIcWdGeDvRdja2orW1tZ/5aVs+vAjBNtx9T39984zH63b21tYrVZOQmvmS8RWJqvV+mw2m13Hx8f209PTX/f29n7+cJiwgsEgtre373d2dhwOh8Nqt9uXrVbrL4SQp7CH3traCgFwfRSE0+lkdDrdls1m++3g4GDG6/X+zub9C+mQLtnIGvhlAAAAAElFTkSuQmCC",
      txt: "Origin Camera",
      ina: _ina,
      siz: 1,
      fun: function(evt, app) {
        var i, inst, len, ref, results;
        ref = app.selected_canvas_inst();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          inst = ref[i];
          results.push(inst.cm.origin());
        }
        return results;
      },
      key: ["O"]
    });
    cube.sub.act.push({
      vis: false,
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAcCAYAAAAEN20fAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAB4wAAAeMBqFO+JAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAMpSURBVEiJ7ZfBSxtBFMa/iYkmpekSLz3IepCtEVlkJaCCRlI2evFiLkUxhSSVCj14MOBRRRAlORX8BzwYYiseJAdRVEIOwZNGSShR0VJFUEOkLsWYZKeHNqlRI0qb6KEfLMy8ebz5Md/szg5pa2vbFEXxOQqgUCj0TJKk+NnZ2edAIPCRUhrLmzw6OhqmBZLX66XBYJDG43E6OTl5aLVaffX19e8AlFJKcfUpCshV7e7upkdGRr50dnZ6OI4zZUCUhbDkmigAkulUVVUphoeH9QD0gUDAMjAwEN7c3PQXAySvjEaj2mg0Gtxu90vFY4JcVd4VWVxcxODg4L0L6fV6zMzM3DaUY82DQRQKBdRqdU7s/PwckUgEDMOgpqYmZ6y0tPRewA8GMZvNMJvNOTG/3w+TyYSmpiYsLCz81cTX9WT2yH+Q6yo4CKUUp6enaG5uRkNDA7xebza+v7+PcDhcHBAAmJqaQnd3N5aWljA3N4euri7U1taiv78fGxsbxQM5PDxEZWUlGIaBw+FAIpFAJBLB/Pw8enp6igNCKaUdHR2Ynp5GY2MjXC4XNBoNTk5OcvKKctaIoghRFEEpRSgUwvLyMux2O+LxOIaGhooHkhEhBIIgQBAEOJ1OJJNJSJKEra2touwRmm9ApVJBp9MBeELfkQdZIwgCVldXUV5e/rggDMPAZDL9cwjgKVkTi8VU0Wi0IMWPjo7Asuy9cgnHcZ8kSWo3GAwlLS0tSYUiu0iEEJJpINPO9AFAlmWSTqeJLMvQaDTZtyNT4/LykqytrSVZlqU2m+1FXV3drX9Pbrf7QLm9vf0GADiOew3gPc/z9Var9RXP83fa5vF4sLe3h9bWVsiyjPX1daRSKTidzhxoALi4uMD4+PiPiYmJ74IglPT29upubPgbFx1AxfP8W4vF4hsbG/t6cHBw653F5/PRvr4+enx8nI3Z7Xa6srJy511nZ2eH2my2M4fDEZudnZVSqRR1uVzfyO/Jb/eNEMZgMHyorq5ur6ioYMgvZT1LJBIl0WhUW1ZWRmVZJlqtNsWy7MVVX8mf5cn2MzWCwSATi8UYpVL5/SdNaUM7QHCHsAAAAABJRU5ErkJggg==",
      txt: "Watch top",
      ina: _ina,
      siz: 1,
      fun: function(evt, app) {
        var i, inst, len, ref, results;
        ref = app.selected_canvas_inst();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          inst = ref[i];
          results.push(inst.cm.top());
        }
        return results;
      },
      key: ["T"]
    });
    cube.sub.act.push({
      txt: "Watch bottom",
      ina: _ina,
      vis: false,
      fun: function(evt, app) {
        var i, inst, len, ref, results;
        ref = app.selected_canvas_inst();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          inst = ref[i];
          results.push(inst.cm.bottom());
        }
        return results;
      },
      key: ["B"]
    });
    cube.sub.act.push({
      vis: false,
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAcCAYAAAAEN20fAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAB6QAAAekB8yd1yAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAASJSURBVEiJzZZLSCtXGMf/Mxmr+G6sRhyKLgSfiEnU1AeKoOhCoVIUouJCrU8QRcWFIKKLq9koBMGIiAvRhURBEHShoo0PihpKBA2C+GggJG01WI0mM54uSqK9Nya59t7e/mE458z/+878vjNn8VEymeyK4zihQCCwFhYWWiiKIgBACKHwLAoAbDYbZbVaBYQQihCCFyN4nqeEQiEnEAjIy9yHhwfLycnJz1qtdtRoNB7hNSkUiiu73U7UavWfdXV15vLy8t80Gg1HXOjh4YHo9XpyenpKzs7OyPz8PCkuLiYzMzPEYDCQu7s7V2nEZrORhYUFS0NDw085OTmDAL5xFOB4oFAorl4m3dzckNHR0Wu5XG6qra39/fLy0uXmDnEcRyYmJkh9fT3RarVuYwkh5Pr6miiVyl8rKyuXU1JS6gF8RQgBpVAoLru7u791dVrn5+dPk5OTfxwfH4NlWZ/AwEACAE9PT84Yx2+w2+2UyWSiIyMjeZqmX/qvzi8uLpitrS06JCTkFygUCvclE0K0Wi1RqVR2j+W+Uf39/efP6F9YNHl5Xl9Q/5sTYV4ujEYjOjs7odFokJ+fD5VKBV9fX4+bbGxs4OLiwrmmaRoRERGIjo5GQkLCx4HwPI/S0lIIhUI0NTVhZGQEfX19GB4e9riJUqnE4uKiS08ikUCpVCIrK8s7kPHxcQQFBWF1dRUAIJVKUVVVhcHBQa8qAoCJiQmkp6eD53lsb29jfn4eGo0GZWVl0Ol0iIiIeDXXeUfUajV6e3udRkFBARiGgV6v9xokNjYWqampkEqlaGtrw8bGBkQiEUwmE5aWltzm0gDI/f099vf3kZ2d/WzQNOLi4nB1deU1yPtiGAYVFRUA4LEgGgBMJhPCw8Ph5+f3D1MkEsFsNr8ZBAAODg4AAMnJyW7jGACwWCwICAj4wOR5HoGBgW8CuL29xcLCAnZ2dkDTNIqKijyDcBwHm83mcrOQkBCvP97a2org4GDwPA+dTofHx0fExcVhamoKkZGRbnNpAGBZFkaj8QNTp9MhMTHRaxCHrFars7DMzEyIxWKPOTTw9114fHzE0dFz33J4eIjw8HBERUV5DTA2Noa9vT0cHR3BbDajuroa09PTqKur8wxCCCEURaGsrAxDQ0POijo6OtDY2Og1xPsKCwuDSqVCUlIS5ubmsLy87B7EMenq6oJarUZGRgbi4+Ph4+OD5ubmN4MAgL+/P6ampgAAnZ2d4HneM4hEIsHKygpkMhl6enqwuroKiqJeTfRWGRkZKCkpgV6vx+zsrFsQZxuQl5cHpVKJlpYWCASCfw3h0MDAgHN87VQ+SRuQnJyMvLw8hIaGuvTFYjHa29vBsix2d3ddxjAu336kHBW708jIiFtfwPO8v06nEzAMI4yJifF1dS+MRiMMBsOTVCr9LI3U5uamhVlfX38H4B3LsmKZTNaSmpr6XU1NTUJMTMynuyReyPlrDAaDFsCPFEX5qNXqSolE8kN2drZELpez/wUI5a53pihKlJub2yEUCr/nOO7rtLQ06+eAWFtb4/8CgETWcCacduEAAAAASUVORK5CYII=",
      txt: "Watch right",
      ina: _ina,
      siz: 1,
      fun: function(evt, app) {
        var i, inst, len, ref, results;
        ref = app.selected_canvas_inst();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          inst = ref[i];
          results.push(inst.cm.right());
        }
        return results;
      },
      key: ["R"]
    });
    cube.sub.act.push({
      txt: "Watch left",
      ina: _ina,
      vis: false,
      siz: 1,
      fun: function(evt, app) {
        var i, inst, len, ref, results;
        ref = app.selected_canvas_inst();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          inst = ref[i];
          results.push(inst.cm.left());
        }
        return results;
      },
      key: ["L"]
    });
    this.actions.push({
      vis: false,
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABCRJREFUeNq0V0tsG1UUPe/NjD1WUrvYaZQoklsFtZUiAQJKN+EjIRYFVy2qxKZIfBYVCIkiYFNEBIgCAqkSpeqiRUJULECwKaQ1XwkW0E1pqpaA1TaElkAS4sTOOLGdj+fDvWO7NY2dFGfmaa498+Zzzzv3vHvfEwDUrte//NwUMuE4DkCHL03QIQRUx06OvvLQw9RjcrdKFjIhE29s3wrLtiGFP/5tGpgiJfpOnE6wT7LZKgDdcmyEgwr2Jv+Cqgh4jYFJNS0HhxIbwL7YZy0AwegiQRXdMR0aUeA1C/z9Ev2wD9upBqTcGABR7yCkKuho0Ykmf0Jg0cDZh2X/V2QugBLdvDceJIvD71aysRRAFVQqlaJ4kQY8DgFPLkFf7unpwXUElAFUWyCgwRH+xEA4dt1+9ZpO6ULV6EmfRHAVgNOYAZVE4h8DYjkGKhcKh0D4BMBZGYCmKbDhDwCJ5QA41RCo/gOoNwucqxrQlkwTzwCIuv6XitBaLQDhlj238tVlQKwgwkZiuRHHgqqdoFwul/q5dq2ojQEoJELRTAwEF7Cyi9yv53Hl6EFMJI+7gMopwEbn9l245cV9WNBbGwNgnHIVpfD3A/sx9ukxbEjsxM0HDkFtKTszC3lMD57DwKM78Nz6B/BeYwDNt1Tf8zBOfY8tfftRGk6h+NkHMCfHy07WdSKy9R6073sNT7x/GNvu2vj2gz8P7eEi6Unam00NYuqbk7jt2Rcwf+ITLHzXD+RniYGwa3w+T33FLz7G5j3PYG207cljd2zshVeJ/48j76J71yMwf/wadnoMUtchqbBJyiuu8Tn1WROjWPwhifXbEugMKG9x7vMEAAsu2r4O1vAlCMsC5uaAYoEsX7GC28f3rOGLuCkWQVBKZiCk1iaJpqc+jVL5+zIUmgmR5Llln83t3AIxMlzNCgGXAW2V6zBNo3HkpiE1feWMyM8Y09XoC2bA0ReMU5FXv+ot0cLt/6QBWyoohcI4HaR1xIwBJRxBfvf9cEyzvAy6PlExU/SMbRioLrsYwHz6nd1P0X9bk9NSnbw9/qZRXLwzGl0LO6ij7gansjGRlAmnjBxmTOssD54dkmIwQpauk0FvpIVOZucOxyamPmwjIUq3oNn1CCCtlUP95/gkvk0bB+l0UWEm+YSsSFZowubO5IqZ+2Lh7lIhv7mro8MFIRVK6xQi/leYeuoTBGAgdQFDRr7/pd+uHKV3pxUv9h1sx8cyZ3sjrfH5GWNTSA+iZc0ayGCQRKe51GeyWQxeHMKFzEzy8YFLL9M7/zB4r1YfPJAIWddj8fa7d3RGn46pyq1OTSXMmNYv/ePZIx+NpH+iy1GekZyKvVz+MIgWsmhF0K2VPndjREYZCVNk2UroLDQpuhU24dAqu99Azfedis5Y8KXahdG/AgwADk9zOiQNsccAAAAASUVORK5CYII=",
      siz: 1,
      txt: "Close current view",
      ina: _ina,
      fun: function(evt, app) {
        app.undo_manager.snapshot();
        return app.data.rm_selected_panels();
      },
      key: ["Shift+X"]
    });
    this.actions.push({
      vis: false,
      ico: "data:image/png;base64,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",
      siz: 1,
      txt: "Zoom",
      ina: _ina,
      fun: function(evt, app) {
        var ref, ref1;
        if (!this.zoom_area) {
          this.old_cm = (ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm : void 0 : void 0;
          this.theme = this.old_cm.theme;
          this.zoom_area = new ZoomArea(this.old_cm, {
            zoom_factor: [this.theme.zoom_factor, this.theme.zoom_factor, 1]
          });
          this.zoom_area.zoom_pos.set([this.old_cm.mouse_x, this.old_cm.mouse_y]);
          return this.old_cm.items.push(this.zoom_area);
        } else {
          this.old_cm.items.remove_ref(this.zoom_area);
          this.old_cm.draw();
          this.theme.zoom_factor.set(this.zoom_area.zoom_factor[0]);
          return delete this.zoom_area;
        }
      },
      key: ["Z"]
    });
    this.actions.push({
      vis: false,
      txt: "",
      key: ["UpArrow"],
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var i, inst, len, ref, results;
          ref = app.selected_canvas_inst();
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            inst = ref[i];
            results.push(inst.cm.cam.rotate(-0.1, 0, 0));
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      vis: false,
      txt: "",
      key: ["DownArrow"],
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var i, inst, len, ref, results;
          ref = app.selected_canvas_inst();
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            inst = ref[i];
            results.push(inst.cm.cam.rotate(0.1, 0, 0));
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      vis: false,
      txt: "",
      key: ["LeftArrow"],
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var i, inst, len, ref, results;
          ref = app.selected_canvas_inst();
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            inst = ref[i];
            results.push(inst.cm.cam.rotate(0, -0.1, 0));
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      vis: false,
      txt: "",
      key: ["RightArrow"],
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var i, inst, len, ref, results;
          ref = app.selected_canvas_inst();
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            inst = ref[i];
            results.push(inst.cm.cam.rotate(0, 0.1, 0));
          }
          return results;
        };
      })(this)
    });
  }

  TreeAppModule_PanelManager.prototype.split_view = function(evt, app, n) {
    var cam, child, d, i, j, len, len1, p, panel_id, ref, ref1, results, s;
    app.undo_manager.snapshot();
    cam = void 0;
    child = void 0;
    ref = app.data.selected_tree_items;
    for (i = 0, len = ref.length; i < len; i++) {
      p = ref[i];
      s = p[p.length - 1];
      if (s instanceof ShootingItem) {
        cam = s.cam;
        child = s;
      }
    }
    d = app.data.selected_display_settings();
    ref1 = app.data.selected_canvas_pan;
    results = [];
    for (j = 0, len1 = ref1.length; j < len1; j++) {
      panel_id = ref1[j];
      app._next_view_item_cam = cam;
      app._next_view_item_child = child;
      results.push(d._layout.mk_split(n, 0, panel_id, 0.5));
    }
    return results;
  };

  return TreeAppModule_PanelManager;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_Projects,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_Projects = (function(superClass) {
  extend(TreeAppModule_Projects, superClass);

  function TreeAppModule_Projects() {
    this.onPopupClose = bind(this.onPopupClose, this);
    TreeAppModule_Projects.__super__.constructor.call(this);
    this.name = 'Projects';
    this.visible = false;
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 0.9,
      txt: "Open in Tree",
      fun: (function(_this) {
        return function(evt, app) {
          var Pheight, Pleft, Ptop, Pwidth, dir, fs, i, inst, inst_i, len, p, ref;
          _this.d = new_dom_element({
            className: "browse_container",
            id: "id_browse_container"
          });
          if ((typeof FileSystem !== "undefined" && FileSystem !== null) && (FileSystem.get_inst() != null)) {
            fs = FileSystem.get_inst();
          } else {
            fs = new FileSystem;
            FileSystem._disp = false;
          }
          dir = FileSystem._home_dir;
          fs.load_or_make_dir(dir, function(session_dir, err) {
            var button_new, div_top, item_cp, t;
            t = new Directory;
            div_top = new_dom_element({
              parentNode: _this.d,
              style: {
                width: "90%",
                padding: "10px 20px 10px 20px",
                height: "50px"
              }
            });
            button_new = new_dom_element({
              nodeName: "button",
              txt: "New project",
              parentNode: div_top,
              onclick: function(evt) {
                var name, td;
                clear_page();
                name = prompt("Project name", "project " + new Date());
                td = new_session();
                session_dir.add_file(name, td, {
                  model_type: "Session",
                  icon: "session"
                });
                return window.location = "#" + encodeURI(dir + "/" + name);
              }
            });
            ModelEditorItem_Directory.add_action("Session", function(file, path, browser) {
              return file.load((function(_this) {
                return function(object, err) {
                  clear_page();
                  return window.location = "#" + encodeURI(dir + "/" + (file.name.get()));
                };
              })(this));
            });
            return item_cp = new ModelEditorItem_Directory({
              el: _this.d,
              model: session_dir,
              initial_path: dir,
              use_icons: false,
              use_upload: false,
              use_breadcrumb: false,
              display: "Session"
            });
          });
          inst = void 0;
          ref = app.selected_canvas_inst();
          for (i = 0, len = ref.length; i < len; i++) {
            inst_i = ref[i];
            inst = inst_i;
          }
          if (inst.divCanvas != null) {
            Ptop = _this.getTop(inst.div);
            Pleft = _this.getLeft(inst.div);
            Pwidth = inst.divCanvas.offsetWidth;
            Pheight = inst.divCanvas.offsetHeight;
            Pheight = Pheight + 22;
          } else {
            Ptop = 100;
            Pleft = 100;
            Pwidth = 800;
            Pheight = 500;
          }
          p = new_popup("Browse Folder", {
            event: evt,
            child: _this.d,
            top_x: Pleft,
            top_y: Ptop,
            width: Pwidth,
            height: Pheight,
            onclose: function() {
              return _this.onPopupClose(app);
            }
          });
          return app.active_key.set(false);
        };
      })(this)
    });
  }

  TreeAppModule_Projects.prototype.getLeft = function(l) {
    if (l.offsetParent != null) {
      return l.offsetLeft + this.getLeft(l.offsetParent);
    } else {
      return l.offsetLeft;
    }
  };

  TreeAppModule_Projects.prototype.getTop = function(l) {
    if (l.offsetParent != null) {
      return l.offsetTop + this.getTop(l.offsetParent);
    } else {
      return l.offsetTop;
    }
  };

  TreeAppModule_Projects.prototype.onPopupClose = function(app) {
    document.onkeydown = void 0;
    return app.active_key.set(true);
  };

  return TreeAppModule_Projects;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_Apps,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_Apps = (function(superClass) {
  extend(TreeAppModule_Apps, superClass);

  function TreeAppModule_Apps(withConfig, APPS) {
    var _ina, app, i, len;
    if (withConfig == null) {
      withConfig = true;
    }
    if (APPS == null) {
      APPS = void 0;
    }
    this.display_app = bind(this.display_app, this);
    this.get_fs_instance = bind(this.get_fs_instance, this);
    this.onPopupClose = bind(this.onPopupClose, this);
    TreeAppModule_Apps.__super__.constructor.call(this);
    if (!APPS) {
      APPS = new Lst;
      APPS.push(new TreeAppApplication_TreeItemParametric);
      for (i = 0, len = APPLIS.length; i < len; i++) {
        app = APPLIS[i];
        APPS.push(new window[app]());
      }
    }
    this.name = 'Apps';
    this.visible = true;
    _ina = (function(_this) {
      return function(app) {
        var ref, ref1;
        return app.data.focus.get() !== ((ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm.process_id : void 0 : void 0) && app.data.focus.get() !== app.treeview.process_id;
      };
    })(this);
    this.icon_app = new Lst;
    this.actions.push({
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAAbp0lEQVR42t1aB3hU1da9+BR+kKIiHRHEYBAUUIoCUgWRJ6KCKCKiSO8hCQlJSK8zSSYzycwkk94bCSmk9957ISF0IaF3ARXY/zpnkpDQ5Pl8PJ/wre/eueXk7rXb2ndGEP5L/1Kyc4T4tNQuabl5w7MLis3zS8qOZBcWizPyCvpk5hcIf9t/KZnZQnxiipCSldM/I79wfXFFVdGho8d+OXGqmarqDvycU1QiS8/J65eZ9zcjISopTTh18rAQl575IoxfkVdSmnWg6dCtc+cv0LXr1+nylavESKiub/gtp7A4JCUrd0R6Tq6QkvM/ToR/WpyQkpQpxCSm9IxPy/gsM78wHkb+3HzmDF2C0ZevXsX2Ct+/cPlyGwl3swqKcFv2uNyMEiEpK/t/1OvxScK+uMTuMH4evB5eWlVz9fjJU3T+4iW6cOkS396PcxcuchJqDjRSVn5RaUJ65qygvYFCfGra/47h4bFxQmh0bNfI/QnTElIzfApKyi8gz+nMufN0FiHPtr8HRlRtAyOh8FBccvqSuITEf8Qlpf61DQ/eFyMEREY9Gxa1f0J0YooLPNhSf7CJTja30KmW03SSAftPiiPHTyASGghpczo2KXUDoqlbdELyX8/wgLAIwS8w7JmgvVGaEbHxNqlZOccqa+vvMgOOnviJG3L4+HG+/VfRePgIYS3KzCu8HJOYbIz1e0fGJfxFDN8bBa/HdvEPixweEhljGJ+S3lhcXnnnwMFD1HjoMLEti4AD/xYO8XqA+gESCm6irriERMX2C4uJ+wtU+LBIwSc4fNDemLhMhPudrLwCKq2oosqaOqqoqf1TUVpZTYWl5ZSRW3AbqRAaFBE1IjQqRgiOiP7vEeAbEi54+Adr7k9Ka2loOsLClBCiBLFDuYXFVFBS9qcir6iEsguKKD234G7k/sTUwPB946NDcoTAiIj/DgFeASGCm0+AJgpTS3FFNZXD84wEv5C95B8aQegClJCSTikZ2ZSWlUvp2XmPQC6lZT/ufB6/n62zPymVr5uUng2yE8pQf2bLXdwEfzjjqf9T+QYJcg9fTXijpbCsgnuntLIG22ICOSR39yFXL3/y9AvmhIRERFN41H7aBwOi45OAZIpJ6Ax2jJ2LikukSEQTuz54bxQn1QPrKL38yMXdG58jkA6FFB4dV+4dEDoY558+AXgYQaby1MRDtBSAAKg3jqLyKqRAKSE9yFGuaodE4U5OSg+SunqSs8qLE6Tw8CWlpx+I8iOFpy+M8yFnNy9+DQO7nt3H7ndwcSMZjiHvsX4J/zuIhmZ3vyAN76Cwp08APCHg4TRD98W2FKBAtRHAUFBaQbnFZSAhhGwcXchW8sdh4+hMYpmSfIP3cmIPHztBDU2HCYMTQXM0I8o0EB1PnwB4SBA7u2qi/7fkl3QmgCGPFa7icqRDKJnbOZKZrSPfPgnYtaY2DmQllpK7bxCr/tAER+nYTye5tmD1hv0NtN9mOELD1dv/6RPgKHcT7JxcNP1DI1vy4G0otgeAGR9ElMN74bTHUkQGZjZkaP54GJhZk7GViKdDMopdXWMTHTp6nJogpxkaoDEYuZn5RYRO0Cx189CQe/o8fQJEUqVgaS/T9AkKb8lC4UtFJU9Fxe4MVPfcfBBRQgFh+8jA1Jp0DM1Ix8i8M3BM28CU9Iwteb6jtaL/13MhVdd4sBVN/HNZdQ2l5WBtAMWvWeKi0kDdePoE2EicBYSrpqd/SEtaTj4lpGUSprcHgeOJ6Vmsf6OAxcBIK9qqY0DbdA1pK7AF+zv0jckWtSIyNhHFrZIqauuovLpWjXZBVMf3MyC4+JoZWeQdGNYslik0JArV0yfAUuwkmFiLNVU+gS1J6NEYex+OpHtbdl1YVBzpm1jR2q06tElLn+c7I4a1z0IUz3yEd367AConVmCZCizknaaQYpNT+Xr7k9PI3S+4GY7QsHdWPn0C8OCCobmtptLLvyUOgoepwAj0+EeCnQcw2VFUfAr6eihPi5TMHKbzKR0hrUY+il4bCvi5tvPRicnt6+yDXnD1DmhGodSwk8ifPgEoVMJuU0tNFKuW6IQUVpGfCMGR0cSuL66o44ouLiWN4uBNDFNqpKZTQmqGGmkZlMhSC/tMAXZcB/qDIMSazW0lGtb2sqdPALwv7DK2GIt2eBqylKs9/7AnAK4LhgEpWfmEQaoV8e2ejcRazFimGDH48GNM/LTd27YNwjGZm1ezsbVYw1wkeYrtz1kuiCWyZ2VK13H2UheVRO7+C8QQl79PCmZAfGoWUiCy3Si2z4DW1g52zico7KFrMDmMv91saGGjgVr0nzdc7CQTzK1tnpEqXN9QenhZuXp4HbWzl9wVOSnwsFHk5u1PGI6eCF6BoSiK6Vwuq3wD2wFZy8E//84anhBY9s5uzfrGVq8bWdj95wy3l7kI5jZ2XZwUrsOVnl673b19G6Quijv2Dg6k8vDkctUH3lBree8ngptPIEXGJeMevye+52Fr2DkpzlqKJF/IVaq+Ti6ugk+4x5/ocZlUMLDeI0jlykEKD6+t7j5+FS5K199s7UTkplJRcnIy5eTkkgc8jweBZA1mOYnhRT34PBoqFC8fCo9JwPWe913/e/d2WANKEXPCHYmL8pJU6RYhU6o07OUKQeHq/m963EEqLBo2SZDIlX0V7p4/wPB8uZvqF2tbO5JIJLR3715ufEpKCkcS9lWePtDtMrSlQP6AIqkcUDwSbMoLjtzPJ7zHXfdoyEmq9MRWSUWlZbQvdj85yV2zkJ4TrcVbBZnyD0SCjdhG8AmMFiQyeW+5m/syd2+/VKW7500rGzuysrYmb29vity3j6KiotSIRjuLiaGY2FiKBVQe3mSGAcbFww+GqcjKXvpIiGWuKHzRPH0ed93DYO0gQ+678jXEIOBk8xm6fOUKxSUlgwRllcRFMd/R36uLROn6L0x2CqXg6CLv4eLmvhA5Hu3m4X3dGqFubGJKUpmM/Pz8KCAwkAKBoKAgCgoOpuCQEAoJDaXQsDAKCw9HZESQm7snhh47eNiLFShMdPatcOiwbw8jnMknOIIsRE6djj+Ie/cxxagerRWEGYSUnv6UU1BKx0+epguXrtLVa9cpLTOLnBTKY/Yy52+kLspnWcd67D+EueAgk3dzdlXNUnn7Bqm8fC7ZiuxJf7cBWcPrCoWSVMh3lbs7uXt4kIenJ3l6eZEXosHbx4d8ff1Ajj/5BwRwghgxrioPMsREJ5a5cRKMLGwx5XWEDUZeCTpAGKY+8X3nHrwWFZ5fz0gzs5XAQA+Ioxw60HQM4/FpOn7qNP3UfJbOX7xCP9+4QXmFRQSHnhM5Om13lLl0d5A6P5oAmdLtfbQ0Nxh/VuQgId1demRoaEgisZgkTk7k5CQlqVRGMmdncnZxIblcQQqlkpSuruTqBmJUHYnxBjE+5ANSlDi328SSrBxcSOys4tp/1x6LdrDR2NUnmHab2nQ63hFsMtxjKSZzkZSMre255/fFpVBl7UE6eOQnjMYn6fDxZpDQQidOnaGTLec4CTdu3qLyyiqCU6/aOkisxE7SF0QS6cMJQIE7ER4Ve1dvtyHt0NIiE1NTsrKyhvdtyMbWlmzt7EgkEpPY3p5Y23NEEeTEtJMiJ7mCkeIKo914d1C5M0K8SOHqRruNLcjE2hEkuJMujGJTnxagj7FY7hnAR2H2WWu3iXrbus/Om1g7IAJE8L6UAvfGUmF5LdU0HqW6g0fpwKHjnIRDx07R0RMt7VHQfOY8nbt4mW7eukX1DY2k9PC8ZS22dwcRgyztxYKf7L4XJz6BwXdiMVkp3RC2RkZkAO/vMTbhuW9qZkZm5hZkYWlJliDFyoaRYkd2IhEihBHiSA6cECk5yRghLuSMCJEjbZjxrogOOYhhJOw2teUkaBua0+adu/lW6uZLO/SMaYu2AbCbj8XaBmZkaCHi1zPvewaEU2Z+GZXVHKSKuiaqOnCYahqOUD3Cv/HwiXtRcBJRgGJ46vQ5ajl7QU3CzV/oyLFj5OHjd8fSThxlLRKPsrATCbZ29vcI8A4Ivu3lF0hyEODh7UfbtmvRho2baJeeHhmAEKM9e9SEmDJCzMncwpIsrKzQFdRk2CI6RIgOMSfDiSSIDCeZM8kQGS6tRMiRLkamVtxokUzFjdy2y4gc5Z60CWSs36ZLW3WN4HWkg7E16ZlYo5P4Y94voIKyOiqqPEAlVQ1UDhIq6w9RNUh4IAqQBsdPsjRQR8HpcxeRDpd5OpxqbiHfwGCysLXLtrCxm7TBarlgZWN/jwAVDDeCcSgWpHT3ou9/XEuLFn9GK1d9T5u3bCUd3V2kb2BAhnuMeWSY4FozCwtOhCWIsG4nwoHsHSXkgIhoI4LBEfs2OL9FS5c27tAnGwkIsbQHGe60WdsQxFggFaz41t7Fg6ISMiizsJJyiqspr7SGCsrrqBgklFY3UkUtogAk1DY+JApQEDtGwdnz7Gt4dU04d/48hUREEgioNrOy/cjQVNbF1FIkCF7+QbcVMFrPcA/pGxmzC8gNombT1u304fyPaME/P6Evln5JK1Z+R6vXrqONIGT7Tm3S3rWL9NApDBAhRoiQdpiYkCGHKc6Z0C4DGKinz2FsbknWYgltg7dtpVByXsGks8cKOa9+FeYbGk0pOaWUlldOGQUVlFVYRbkl1ZRfVktFFfWdowBp8NAoOHWaF0MWBWcQBecuXKaLl6+iO9ykS5evUHRcHCJBdBzP8o2lrc1znABnpYp2ovpr6yE3d+mTgbEpKVSeZGhsRp99sZQWffY5fbZkKS1Z9hUtW/4NfQMyVn7/AyJlDf24bj2tRcqs37SFk7N523baskOLtu3UoR06u/iaJhZWSAMV+QeFUGh4BNmIHemHDdtp9SYtWrZyNUVgrq+uO8BfnEYlZlB6fgVQTpkgIbuo6sEoaK0F90fBkROsFjwYBawzXLp8ja6DBPZznJT0DLISic/uMbMwEjz8Am5LnJW0dcdOPLQ2x1Ytbdqpq0cSZwXZ2ku4sV99s4JWfLeK76+C4Swa1mzYqDZ86zbasl2L36ulu4t7m3nezMqGXGC4N2qMb0AQhSEE4+ITSOzoxAlasuxrWvT5F5SUlkHXfr5JBw8fxVQZyadE5nXmfZYGuSU1D0ZBHYuCw4+JgrMPRMEVCCWWDqfPnKVgiDZjC8tbgpuX722MubRhM/Pgtg7YSpvgTWuIIqncle//sGYtrVl/z+jNrUarPa1Pumil+kZ7yNzalhvu4e0LeexFPv7+FB4RQfsgnYNDQkkHUbEdBHz51df08aJFFJecige8RpevXuc/j9kbHcv7fWl1A6/+zOvM8FIG7LcTwKMABDQd51Fw6Jg6CpgybCOARQAznq3dfPoM1dTVU92BBmo82IRIdCAB+X/bxt6RViOU16zf0Ak/tsLQxIx3CVYjWIhv0+psNKsfLG0sbUXccFcY7axw5R3AG6LIHwrRPzCIAoKCeYFcu2ETJ5TVlvkfL6TYhGTuJYZLV67R6bPnaX9SCoVG7UfY1/OcrzrADD7CDWZeZ6HfcOhEZ0F0Uq0FTp1GF2Dhz9ZEJzj+0ykqq6ym8qpqHD9Ld+7coTPYWkHqCzJX1W0LWzFCezV9t/rHh+OH1bRDW5eTYGVnTzr6BjDaiHajyBmZmuOYmKkunHfn4S1GJ2B6gAkjpgiV0AOukNJsXxu1ZiXWW7dxMy3+7Auai0IbFZfA85Xn7AW1x85hy74xDtwbRfml1eq8by1+jAROwOET7aHfnv+n1PnPSGg6cpy/TS4qK6efEFm3bv1Ct2H8nTt3eWs0RwcTMEvfNrG0oa9XfEvLv/3uEVjJz7Ocx/U8JViYs8hhhssUbmSJ7mEKjcAGKNYOGZg2YG2RwRGeN8N5RubXWO+HNevon4s+pZlz51JETByv3AwtZy7QmfPo4WhfrIUVlpRjaoykrIIy3gJZ6LcVwLqDLAoQ/kfuFUFWA+oaD2NIKua/UWA/s7n+8w365ddfgd/oV4BtTyAqUANIsJe63DYytaAlXy6jpcjJx4F1gW9WroJecKHYxFRoBm+0PTPSRSrsRkTsQRrsQfszNjXjYHrBFEqSGc72f1y7npai8DF8C42xYOE/afrMWRS2L5Z7ry2E24QMC18WDVXoEOxdYUpWIZXXHmyPhpoOrZBFQ0VtA6ImnzJy8lFQj2BEvsaLXhtuIgIY2P5REMNSWxA5Sm/rG5nwVrcYFfnxWMKvY+kSGhHDi9kmFMNtWjtpO7CDdQFtHdLS0aWdgDY6gg5CnuFHdI3PvljC1/kUYF1l3vwF9P70Dyg4IorncPtg09rGTndICdYhQiKjKS41u4MgOswLYRFmhMT0bErOyKa6hiZeS65e+5muXlfj2vUb6DI3EAk3eTSwc4eOHOM1TbAWO97W0Tfk3lj4yaLfxccQRiwSHNEi12/aTN+jRvzA2iI6BDNyDdMFKJzrNjBsRK5vpG/RPj/5dDF93LYGwCJuztwPafL7U7l3G5HLnVvZmQ4pcYnP++y3g+xHE6xDsLqQXVhBsWiZccnpVFlTzyOHXXcBhF3kuMaLKouEK+gCDBdbzzU2HeYFXIAqur1DR4/mzptPH3604PeBosU8aGvvBHW4Sp06IIS1tGVfL6evli+nr+Fdhq8gmpjH5y/4mN/XaQ0UwBmzZtO7k6bw7/1ZUWsXNR3aWVtKnOHa/gr2z3ESrB2lFIQCWVJRw/s+Sxl2DasfrPWxyGGRwOaBC631hN3PyGTH6xubIP70STC1sr2zZYc2fYBcnDl7zu9iBsA8aGEj5kQwg5iBH6GdsShi0pmBHZvz4bxHrsPWmDZ9Bo1/513+ipy1uBoubNSF7SBvbada9f291saMaEL4ijC3lFXXc4IYWN9XV3+1DG45q77+dCspjBx2nNeXsxeppr6RtiNdBeT/GT1DE+6V96dNo6nIycfh/WnTudEmFjY0D9up06fTtA8+AGbQ9Bkz+JZ9Vl8//RHrTOf3vofwHztuPPuCk+c0K27t4uY+ddf2woM9/JHjJ8knKJRqoA145W+t/mwkZtHArv2p+UwrMeruwuqK+jiOgSSWMkyyC5u37fgSNaB+5y4DmrdgIU2cNJkmTZ5Ck6Y8HBNxbubsucQ6B9uyz5MehcesMWuO+t7RY9/ib5JLqhq58mNV/oFpr5PCO8f7uzeipqK2sb12sDbIlCAjjEVOW0tkL0vYfvvn1vpSVlnLFa+wZuanAgaaadD/hdp6hihyi2jc+Ak0bsIEGj/hnQfAzjEv6huZ8i37/LDrHnovxwR+z+w5H9IEhP+o0W+SwsufCisOAGqtX9YqdWtatT5TfB3VXkPTUfL0D6ISqESuDFuFEZPEDa0tsbENHQhqaiXoCEgpLq/mYkz4btVqYdnKbwWMu2PWbNiUgEi4+yna3Rh45s0xY+nNsfcBxyZNeQ9q0IhvH3rN2Iffx/DOuxN5wUUBvDNg4KCjI0aObNmqo0/J2UV84Ll/6rs/JRgJtQ2H+Fdnhbiey+TWlyRsOKppVYpqyawurFwntBHTKpoKSiog/zcQfymy5OuvBIgT4Ysvlw1b8d33gdt19H5b+tUK0nzzTXp91CjSGPVGO9hnVrh26O7m2/vPPwyva4yisW+9zQso0uYuPh/v3r2HCH96zLBXX/0EaVC/bssOiknOwuhbCyLqMPmpSWhLiZq2lAAJVXUHkTb+lFdSxaOFDUdtAqmyVSQxtVh9oI2QI50IYRGVW1SGqXYtdXo/+Mniz4WFixa/DCKcNm3TurFi1Wp6AyH66vDhNHzEaxyvDh/BjdmqpUtjsGWf2851xgh+36g3NHmqzJozj0a/Oaa5Z8+eLvhT7wDPdu/eXejeRxCGDBkydaSGRsFXK7/HAJSoHn9BRKeUaFV+zIDy6gP8e0imA1i0FLe+MmOEldU0qklhhNSqCam8j5B6pEpadgHG++/pgbfE8xYsEObMm9cTrcxw9bqNl39YuxGRMIYGDR5MQ4YOpcFDhtAbmqMxDu+kUdiyz+x4GwYPGYprh3BiJk1+j2bPnUdvjRt/7oUXX/TE8lOBrh3/3pDBg4X+w4YJAwcPGjNs+PD4jxd/ftcrcO8Dr8PK2lICBhRX1pEzZHhGfhk/z1BYXs/fF3QmBGgnRE0Emy7Zjyt26Or9BhsbHvqqfMbMmcIH06d3mzlr9rrlK1edXrdpG419ezy93K8f9evXn14b+TqxYyNeG0n9+ven/v0H8C07z4hixY4Z/s7EyZdwPLhLly5zsOz/Peq7ib4gYfCAgcKA/gNeGTx0qP8Hc+b+6uTqxd8IdXwZ0lYXCsqqSermSak5xfw8AyMrn6dPbSshde2EsPsKcJz9Dklrl/6dhYs+bZw+Y6bRBzNnj3rkFyaQqMKEiZP/Mfm995Ys/mLpoQ1btLhq69OnD70ybBgKyCYa+sow6vPCCxx9X36ZRqPIsVCf/N7Ua4iEqGefe24hlurxpF/Pvdy/v4B1+vYfONDxncnv/WwuksDIks4pAWNyiivJUelBiZmFlFVYycFenTG0vUFqi56c4iooRuZx/bvzP154dPJ779ug1WtOnDDlmYkTpzz+gd4eN04Y+urLwltvj5s9d/6CsvUoVFOnz6SBgwbTytXrqP+AgdSzVy8a+boGqvpcDDYzbiD0k5DbS3B7727duv3LX9D27ddPeOnlvj0RTbtHj337kraBMcWn57enBCMhE6OxvVxF8Wn5/AVqOkO++kVqJiejGvvlFADDt+vo350z/6NTKNjSt8eNx/93nx0//p0nf6A3Ro8Rxo4eLqDaT5jy/rS01es23/186XJEwGbUhrE09YOZGGnn3Hpd443sXr16r+zyTJeX/t3fJbz00ksCakbXF198cc0IDY2WH5Fu+xLSKZuRAO+m5ZaQSOZKMSm5aJ8llJJd2v42mW39w2NoG1rrzDkfnh3z1luqN0aPnoKO1hX4Yw/02ojhiARg6NCRY98et/f7tRtvG5raQBIv/BUkFL/U9+X1Xbt27f9n/ioFqSb07NH9GaTX50OGDTu49NvvKCgyjns3OauQbJwUtC8xixIyiygpq4Rv2Wt1Zvj0WXMuamhqBqBGzRw5cmS310aO/HMeauCgQUI/VKrhI0Yq0BlKBgwcqNWjR48hONXlmWf/8af/NKdn717oGc8IvXr1mtF/wICS+YsWk7t/GFIij6wlcopMyKL9aQXkExJNW3V209QZM6/C6IghQ4d8NGToK92BP//3Qj179sID9emBPO/b9blnn+nW9bn/6A+z8IeEfiD++R49xr3Yt2/K1Flz7lo5OpOZ2IlU/uG0TdeApkyf8TMKcny/fv0+69e/X8+hiNgeXbsKf5t/PZ9/Xuja7f8EFNXhvXv3CRk74Z3fPlr8OU18f9qNAYMGpfXu3Xt57z69X+g7TEPo3et54W/7j3UV1JqBzz//vH/vF1440L1Hj+1du3UbwARGtz/o8f8Hi1n+S7vDNesAAAAldEVYdGRhdGU6Y3JlYXRlADIwMDktMDktMTNUMTM6MDM6MDMrMDI6MDBvX/EaAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDA5LTA5LTEzVDEzOjAzOjAzKzAyOjAwHgJJpgAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=",
      siz: 0.9,
      txt: "Load app in tree",
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var Pheight, Pleft, Ptop, Pwidth, application_list, container_global, inst, inst_i, j, len1, p, ref;
          container_global = new_dom_element({
            className: "apps_container",
            id: "id_apps_container"
          });
          application_list = new ModelEditorItem_ApplicationLite({
            el: container_global,
            model: APPS,
            use_icons: false,
            app: app,
            use_in_lab: true
          });
          inst = void 0;
          ref = app.selected_canvas_inst();
          for (j = 0, len1 = ref.length; j < len1; j++) {
            inst_i = ref[j];
            inst = inst_i;
          }
          if (inst.divCanvas != null) {
            Ptop = _this.getTop(inst.div);
            Pleft = _this.getLeft(inst.div);
            Pwidth = inst.divCanvas.offsetWidth;
            Pheight = inst.divCanvas.offsetHeight;
            Pheight = Pheight + 22;
          } else {
            Ptop = 100;
            Pleft = 100;
            Pwidth = 800;
            Pheight = 500;
          }
          p = new_popup("My apps", {
            event: evt,
            child: container_global,
            top_x: Pleft,
            top_y: Ptop,
            width: Pwidth,
            height: Pheight,
            onclose: function() {
              return _this.onPopupClose(app);
            }
          });
          return app.active_key.set(false);
        };
      })(this)
    });
  }

  TreeAppModule_Apps.prototype.onPopupClose = function(app) {
    document.onkeydown = void 0;
    return app.active_key.set(true);
  };

  TreeAppModule_Apps.prototype.getLeft = function(l) {
    if (l.offsetParent != null) {
      return l.offsetLeft + this.getLeft(l.offsetParent);
    } else {
      return l.offsetLeft;
    }
  };

  TreeAppModule_Apps.prototype.getTop = function(l) {
    if (l.offsetParent != null) {
      return l.offsetTop + this.getTop(l.offsetParent);
    } else {
      return l.offsetTop;
    }
  };

  TreeAppModule_Apps.prototype.get_fs_instance = function() {
    var fs;
    if ((typeof FileSystem !== "undefined" && FileSystem !== null) && (FileSystem.get_inst() != null)) {
      fs = FileSystem.get_inst();
      return fs;
    } else {
      fs = new FileSystem;
      FileSystem._disp = false;
      return fs;
    }
  };

  TreeAppModule_Apps.prototype.display_app = function(app, application) {
    var act, group_app, i, ico_app, len, link_app, ref, results, text_app;
    if (application.actions != null) {
      group_app = new_dom_element({
        parentNode: container_global,
        className: "app_group",
        nodeName: "div"
      });
      ref = application.actions;
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        act = ref[i];
        ico_app = new_dom_element({
          parentNode: group_app,
          className: "app_icon",
          nodeName: "div",
          onmousedown: (function(_this) {
            return function(evt) {
              return act.fun(evt, app);
            };
          })(this)
        });
        this.picture = new_dom_element({
          parentNode: ico_app,
          className: "app_picture",
          nodeName: "img",
          src: act.ico,
          alt: act.txt,
          title: act.txt,
          style: {
            maxWidth: 150,
            maxHeight: 75
          }
        });
        text_app = new_dom_element({
          parentNode: group_app,
          className: "app_group_text",
          nodeName: "div"
        });
        this.name_app = new_dom_element({
          parentNode: text_app,
          className: "app_group_title",
          nodeName: "div",
          txt: application.name
        });
        this.editor_app = new_dom_element({
          parentNode: text_app,
          className: "app_group_name",
          nodeName: "div",
          style: {
            fontWidth: 0.8
          },
          txt: "powered by"
        });
        this.powered_app = new_dom_element({
          parentNode: text_app,
          className: "app_group_name",
          nodeName: "div",
          txt: application.powered_with
        });
        link_app = new_dom_element({
          parentNode: group_app,
          className: "app_group_link",
          nodeName: "div"
        });
        this.publication_link_app = new_dom_element({
          parentNode: link_app,
          className: "app_group_publication_link",
          nodeName: "div",
          src: act.ico,
          alt: "Related publications",
          title: "Related publications",
          onmousedown: (function(_this) {
            return function(evt) {
              var myWindow;
              myWindow = window.open('', '');
              myWindow.document.location.href = application.publication_link;
              return myWindow.focus();
            };
          })(this)
        });
        results.push(this.tutorial_link_app = new_dom_element({
          parentNode: link_app,
          className: "app_group_tutorial_link",
          nodeName: "div",
          src: act.ico,
          alt: application.tutorial_link,
          title: "Video tutorial",
          onmousedown: (function(_this) {
            return function(evt) {
              var myWindow;
              myWindow = window.open('', '');
              myWindow.document.location.href = application.tutorial_link;
              return myWindow.focus();
            };
          })(this)
        }));
      }
      return results;
    }
  };

  return TreeAppModule_Apps;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_TreeView,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_TreeView = (function(superClass) {
  extend(TreeAppModule_TreeView, superClass);

  function TreeAppModule_TreeView() {
    var _ina, _ina_cm, lst_equals, up_down_fun;
    TreeAppModule_TreeView.__super__.constructor.call(this);
    this.name = 'Tree View';
    this.visible = false;
    _ina = (function(_this) {
      return function(app) {
        return app.data.focus.get() !== app.treeview.process_id;
      };
    })(this);
    _ina_cm = (function(_this) {
      return function(app) {
        var ref, ref1;
        return app.data.focus.get() !== ((ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm.process_id : void 0 : void 0) && app.data.focus.get() !== app.treeview.process_id;
      };
    })(this);
    lst_equals = function(a, b) {
      var ia, j, len, va;
      if (a.length !== b.length) {
        return false;
      }
      for (ia = j = 0, len = a.length; j < len; ia = ++j) {
        va = a[ia];
        if (va !== b[ia]) {
          return false;
        }
      }
      return true;
    };
    up_down_fun = function(evt, app, inc) {
      var f, flat, i, items, j, len, results, session;
      items = app.data.selected_tree_items;
      session = app.data.selected_session();
      if (items.length === 0) {
        app.data.selected_tree_items.clear();
        return app.data.selected_tree_items.push([session]);
      } else if (items.length === 1) {
        flat = app.layouts[session.model_id]._pan_vs_id.TreeView.treeview.flat;
        results = [];
        for (i = j = 0, len = flat.length; j < len; i = ++j) {
          f = flat[i];
          if (i + inc >= 0 && i + inc < flat.length && lst_equals(items[0], f.item_path)) {
            app.data.selected_tree_items.clear();
            app.data.selected_tree_items.push(flat[i + inc].item_path);
            break;
          } else {
            results.push(void 0);
          }
        }
        return results;
      }
    };
    this.actions.push({
      txt: "",
      key: ["UpArrow"],
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          return up_down_fun(evt, app, -1);
        };
      })(this)
    });
    this.actions.push({
      txt: "",
      key: ["DownArrow"],
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          return up_down_fun(evt, app, 1);
        };
      })(this)
    });
    this.actions.push({
      txt: "",
      key: ["LeftArrow"],
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var close, item, items, j, len, results;
          items = app.data.selected_tree_items;
          results = [];
          for (j = 0, len = items.length; j < len; j++) {
            item = items[j];
            close = _this.is_close(app, item);
            if (item[item.length - 1]._children.length > 0 && close === false) {
              results.push(_this.add_item_to_close_tree(app, item));
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      txt: "",
      key: ["RightArrow"],
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var close, item, items, j, len, results;
          items = app.data.selected_tree_items;
          results = [];
          for (j = 0, len = items.length; j < len; j++) {
            item = items[j];
            close = _this.is_close(app, item);
            if (item[item.length - 1]._children.length > 0 && close === true) {
              results.push(_this.rem_item_to_close_tree(app, item));
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      txt: "",
      key: ["Enter"],
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var item, j, len, p, path_item, path_items, ref, results;
          path_items = app.data.selected_tree_items;
          results = [];
          for (j = 0, len = path_items.length; j < len; j++) {
            path_item = path_items[j];
            item = path_item[path_item.length - 1];
            if ((ref = item._viewable) != null ? ref.get() : void 0) {
              results.push((function() {
                var k, len1, ref1, results1;
                ref1 = app.data.selected_canvas_pan;
                results1 = [];
                for (k = 0, len1 = ref1.length; k < len1; k++) {
                  p = ref1[k];
                  results1.push(app.data.visible_tree_items[p].toggle(item));
                }
                return results1;
              })());
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      txt: "Save",
      key: [""],
      ina: _ina,
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAADqElEQVRIiZWUTY8UVRSGn3Nv9VQ39MgwDIEZSNQBXUDAjcGFIUHiRyRGE+OvcO/SlXsX7twY48K40MTowvgD2JhAghthEiEmLhAyOsqk6+Oee46Lqm66B130TX1XnfPWc897rpw58/zqpJr8eGTt2NntZ59OV69eacBxZ6kRQuTBwz82vv/uh/0Yw7c/37rxPoAcP765jvDT4fFTZ44eOczNmzeWyzw3Ll16iY3NbQ6NRnz91WcCUGQ3ihB58dLL/LpzCzWwrPiSCOXKAAA3x+ZiC9xwF/b2/gZ3kmY856UFQixwIGfFcp4TQHAHM8OBplV+v/vLUskBnnnuPLiTcyYvCLjjdC9wSJo5fmp7aYJWtSc4IOAA3qE5TtMm9u7fW5rg2Nb2jEBV5wUccSNrp5qSMjp6cmmbJs04oKqzXJ2AOR6kI3Bok5L+ub80AWunwMFyJuc5AgB3RzUDTpsUG6wtTdCmboqz6oEp6jNl7Qh27tzm3Lnzc1726bYwZPHAzs5tAJIqhT7hIpAg7D7Y5aMPP0D6oOmpu5y7wRcFvft2d/dP1jdO/5eLOquub5yiahIhBHI2QhBCCIiE/twlMzfcvesdd4oYMTPW1jcRgZzTk1Ok2j0syxVijEz2/yJKJIYIyOMlYArnEAWyZWKxiqvRtg2xGBBjOCAg9I3mKLBajnnn7WtcufIKK8MhuFOWJaNhSdu2iHQqMUauX7/OF19+g9baCahSDodzNaBboDQ9xtKsXL58mdt3dvj4k09xc9584yrvvfsWVVXPBEIIbG5t9UhCDLFrtHTQRe6dd11wHE1KXdeoKkUIeHDMMnVd07ZtV1d3RIRqUqEpoSmRc8bMFmswLXBKigi4d/WYTCZUVdU3oJNSom0TdV3P1qkYI23bklLnfbM8M8WcixzvCYRp0yVSSjRNQ0oJd6dtGqpqQtO0s+DObRnLGdU0ozKzOQFz3N1z333ukDVTT5ObYW5oVpqmoWnaRYKUUE108U5yX1iJi6aZPBKRnaapzpo5lg231F68cGHwwsWL8vprr+I4g2LAYFAsBIsIDx4+ZH9/n8lkQowBMyeEx00pQACeXllZ+Xw4HBVNU58ej8e/nTh5YiuGKCEEkc420ieVvsg+Lfbdu/dKd8fd3N0953yrrutrXb/M/ZGqipmNYgirDodCCGMRGYvIGBgBJRD7zzPQuHslIhXwyN0e5Wz7Oee9sizbJwT6v4x9fxzcY0875XfAeiH9n51/Ac3vnsxrMRLjAAAAAElFTkSuQmCC",
      fun: (function(_this) {
        return function(evt, app) {
          var fs, item, items, j, len, name, path_item, results;
          items = app.data.selected_tree_items;
          results = [];
          for (j = 0, len = items.length; j < len; j++) {
            path_item = items[j];
            item = path_item[path_item.length - 1];
            console.log("saving : ", item);
            if ((typeof FileSystem !== "undefined" && FileSystem !== null) && (FileSystem.get_inst() != null)) {
              fs = FileSystem.get_inst();
              name = item.to_string();
              results.push(fs.load_or_make_dir("/home/monkey/test_browser", function(d, err) {
                return d.add_file(name, item, {
                  model_type: "TreeItem"
                });
              }));
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    });
    this.actions.push({
      txt: "Delete current tree item",
      ico: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAANBJREFUSEvtVbENgzAQNBOwh2tmYAcXqbxGBIvQMQKNO7dIrhE9PUiUVBfOgiIRkZUo6f6lE6//O5148FspiQ8nAK01yrKEtRZ1XaNpGjjnMAwD1nWNYM4ae+SQSw21ux/xNsQgOSKVZRm6roP3HiEEjOOIaZqwLAu2bYtgzhp75JBLDbXJby4GMiL5i5QctPSqOPb5ubTik+vjClfc5EGjKM9zFEUBYwyqqkLbtuj7HvM8RzBnjT1yyKUmddmc5v83eH31X4/othvcvwS1T/EATq2IdOg+xX0AAAAASUVORK5CYII=",
      key: ["Del"],
      ina: _ina,
      fun: (function(_this) {
        return function(evt, app) {
          var j, k, len, len1, m, mod, modules, path, ref;
          ref = app.data.selected_tree_items;
          for (j = 0, len = ref.length; j < len; j++) {
            path = ref[j];
            if (path.length > 1) {
              m = path[path.length - 1];
              if (m instanceof DisplaySettingsItem) {
                return true;
              } else if (m instanceof ViewItem) {
                modules = app.data.modules;
                for (k = 0, len1 = modules.length; k < len1; k++) {
                  mod = modules[k];
                  if (mod instanceof TreeAppModule_PanelManager) {
                    mod.actions[4].fun(evt, app);
                  }
                }
              } else {
                app.undo_manager.snapshot();
                path[path.length - 2].rem_child(m);
                app.data.delete_from_tree(m);
                app.data.selected_tree_items.clear();
              }
            }
          }
        };
      })(this)
    });
  }

  TreeAppModule_TreeView.prototype.is_close = function(app, item) {
    var closed_item_path, j, len, ref;
    ref = app.data.closed_tree_items;
    for (j = 0, len = ref.length; j < len; j++) {
      closed_item_path = ref[j];
      if (item.equals(closed_item_path)) {
        return true;
      }
    }
    return false;
  };

  TreeAppModule_TreeView.prototype.add_item_to_close_tree = function(app, item) {
    return app.data.close_item(item);
  };

  TreeAppModule_TreeView.prototype.rem_item_to_close_tree = function(app, item) {
    return app.data.open_item(item);
  };

  return TreeAppModule_TreeView;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_ScillsAssembly,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_ScillsAssembly = (function(superClass) {
  extend(TreeAppModule_ScillsAssembly, superClass);

  function TreeAppModule_ScillsAssembly() {
    this.add_ass = bind(this.add_ass, this);
    TreeAppModule_ScillsAssembly.__super__.constructor.call(this);
    this.name = 'Assemblage';
    this.actions.push({
      ico: "data:image/png;base64,",
      txt: "Assembly",
      siz: 1,
      fun: (function(_this) {
        return function(evt, app) {
          var m;
          app.undo_manager.snapshot();
          return m = _this.add_item_depending_selected_tree(app.data, ScillsAssemblyComputeItem);
        };
      })(this)
    });
  }

  TreeAppModule_ScillsAssembly.prototype.add_ass = function(app_data) {
    var m;
    m = this.add_item_depending_selected_tree(app_data, ScillsAssemblyComputeItem);
    return app_data.watch_item(m);
  };

  return TreeAppModule_ScillsAssembly;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var TreeAppModule_Mesher,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeAppModule_Mesher = (function(superClass) {
  extend(TreeAppModule_Mesher, superClass);

  function TreeAppModule_Mesher() {
    var _ina;
    TreeAppModule_Mesher.__super__.constructor.call(this);
    this.mesher = '';
    this.name = 'Mesher';
    _ina = (function(_this) {
      return function(app) {
        var ref, ref1;
        return app.data.focus.get() !== ((ref = app.selected_canvas_inst()) != null ? (ref1 = ref[0]) != null ? ref1.cm.process_id : void 0 : void 0);
      };
    })(this);
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Remove a mesher point",
      fun: (function(_this) {
        return function(evt, app) {
          var cam_info, i, ind, pm, ref, ref1, ref2, results;
          if (_this.mesher != null) {
            cam_info = app.selected_canvas_inst()[0].cm.cam_info;
            if (((ref = _this.mesher) != null ? (ref1 = ref.p_mesher) != null ? ref1.length : void 0 : void 0) > 0) {
              results = [];
              for (ind = i = ref2 = _this.mesher.p_mesher.length - 1; ref2 <= 0 ? i <= 0 : i >= 0; ind = ref2 <= 0 ? ++i : --i) {
                pm = _this.mesher.p_mesher[ind];
                if (pm._selected.indexOf(pm.point) >= 0) {
                  results.push(_this.mesher.remove_point(pm));
                } else {
                  results.push(void 0);
                }
              }
              return results;
            }
          }
        };
      })(this)
    });
    this.actions.push({
      ico: "data:image/png;base64,",
      siz: 1,
      txt: "Add a mesher point",
      fun: (function(_this) {
        return function(evt, app) {
          var canvas, p, pm, pos_x, pos_y;
          app.undo_manager.snapshot();
          canvas = app.selected_canvas_inst()[0].div;
          if (evt.clientY < get_top(canvas)) {
            p = [0, 0, 0];
          } else {
            pos_x = evt.clientX - get_left(canvas);
            pos_y = evt.clientY - get_top(canvas);
            p = app.selected_canvas_inst()[0].cm.cam_info.sc_2_rw.pos(pos_x, pos_y);
          }
          _this.mesher = _this.add_item_depending_selected_tree(app.data, MesherItem);
          pm = new PointMesher(p);
          return _this.mesher.add_point(pm);
        };
      })(this)
    });
  }

  return TreeAppModule_Mesher;

})(TreeAppModule);
// Generated by CoffeeScript 1.11.1
var FieldSetSetItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

FieldSetSetItem = (function(superClass) {
  extend(FieldSetSetItem, superClass);

  function FieldSetSetItem(name) {
    if (name == null) {
      name = "Field collection";
    }
    FieldSetSetItem.__super__.constructor.call(this);
    this._name.set(name);
    this._viewable.set(false);
    this.add_attr({
      visualization: new FieldSet
    });
  }

  FieldSetSetItem.prototype.apply_to_children = function() {};

  FieldSetSetItem.prototype.accept_child = function(ch) {
    return ch instanceof FieldSetItem;
  };

  FieldSetSetItem.prototype.display_context_actions = function() {
    var contex_action;
    contex_action = new Lst;
    contex_action.push(new TreeAppAction_Save);
    return contex_action;
  };

  FieldSetSetItem.prototype.add_collection_item = function() {
    var id_child, name_temp;
    id_child = this.ask_for_id_collection_child();
    name_temp = "field_" + id_child.toString();
    return this.add_child(new FieldSetItem(name_temp, id_child));
  };

  return FieldSetSetItem;

})(CollectionTreeItem);
// Generated by CoffeeScript 1.11.1
var AnnotationItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

AnnotationItem = (function(superClass) {
  extend(AnnotationItem, superClass);

  function AnnotationItem(name) {
    if (name == null) {
      name = "Note";
    }
    AnnotationItem.__super__.constructor.call(this);
    this._name.set(name);
    this._viewable.set(true);
    this.add_attr({
      title: this._name,
      posted_by: USER_EMAIL,
      _point: new PointMesher([0, 0, 0], 2, 6),
      note: "test",
      link: "http://www.structure-computation.com"
    });
    this.add_attr({
      radius: new ConstrainedVal(4, {
        min: 0,
        max: 40
      }),
      point: this._point.point
    });
    this._point.radius = this.radius;
    this.note.set("test");
  }

  AnnotationItem.prototype.display_suppl_context_actions = function(context_action) {
    return context_action.push({
      txt: "link",
      ico: "data:image/png;base64,",
      fun: (function(_this) {
        return function(evt, app) {
          var myWindow;
          myWindow = window.open('', '');
          myWindow.document.location.href = _this.link.get();
          return myWindow.focus();
        };
      })(this)
    });
  };

  AnnotationItem.prototype.accept_child = function(ch) {
    return false;
  };

  AnnotationItem.prototype.sub_canvas_items = function() {
    return [this._point];
  };

  AnnotationItem.prototype.z_index = function() {
    return this._point.z_index();
  };

  AnnotationItem.prototype.get_model_editor_parameters = function(res) {
    return res.model_editor["note"] = ModelEditorItem_TextArea;
  };

  AnnotationItem.prototype.draw = function(info) {
    var draw_point, i, len, pm, ref, results;
    draw_point = info.sel_item[this.model_id];
    if (this._point.length && draw_point) {
      ref = this._point;
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        pm = ref[i];
        results.push(pm.draw(info));
      }
      return results;
    }
  };

  AnnotationItem.prototype.get_movable_entities = function(res, info, pos, phase) {
    var i, len, pm, ref, results;
    ref = this._point;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      pm = ref[i];
      results.push(pm.get_movable_entities(res, info, pos, phase));
    }
    return results;
  };

  AnnotationItem.prototype.on_mouse_down = function(cm, evt, pos, b) {
    var i, len, pm, ref;
    ref = this._point;
    for (i = 0, len = ref.length; i < len; i++) {
      pm = ref[i];
      pm.on_mouse_down(cm, evt, pos, b);
    }
    return false;
  };

  AnnotationItem.prototype.on_mouse_move = function(cm, evt, pos, b, old) {
    var i, len, pm, ref;
    ref = this._point;
    for (i = 0, len = ref.length; i < len; i++) {
      pm = ref[i];
      pm.on_mouse_move(cm, evt, pos, b, old);
    }
    return false;
  };

  return AnnotationItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var MeshItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

MeshItem = (function(superClass) {
  extend(MeshItem, superClass);

  function MeshItem(legend) {
    if (legend == null) {
      legend = void 0;
    }
    MeshItem.__super__.constructor.call(this);
    this._name.set("Mesh");
    this._ico.set("data:image/png;base64,");
    this._viewable.set(true);
    this.add_attr({
      _mesh: new Mesh({
        not_editable: true
      })
    });
    this.add_attr({
      visualization: this._mesh.visualization
    });
    this.visualization.display_style.num.set(1);
  }

  MeshItem.prototype.display_suppl_context_actions = function(context_action) {};

  MeshItem.prototype.accept_child = function(ch) {
    return ch instanceof SketchItem || ch instanceof ImgItem;
  };

  MeshItem.prototype.z_index = function() {
    return this._mesh.z_index();
  };

  MeshItem.prototype.sub_canvas_items = function() {
    return [this._mesh];
  };

  MeshItem.prototype.cosmetic_attribute = function(name) {
    return MeshItem.__super__.cosmetic_attribute.call(this, name) || (name === "_mesh" || name === "visualization");
  };

  MeshItem.prototype.get_file_info = function(info) {
    info.model_type = "Mesh";
    return info.icon = "mesh";
  };

  MeshItem.prototype.draw = function(info) {
    var app_data, sel_items;
    app_data = this.get_app_data();
    sel_items = app_data.selected_tree_items[0];
    if (sel_items != null ? sel_items.has_been_directly_modified() : void 0) {
      if (sel_items[sel_items.length - 1] === this) {
        return this.colorize("blue");
      } else {
        return this.colorize();
      }
    }
  };

  MeshItem.prototype.colorize = function(color) {
    var drawable, i, len, ref, results;
    ref = this.sub_canvas_items();
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      drawable = ref[i];
      if (color === "blue") {
        drawable.visualization.line_color.r.val.set(77);
        drawable.visualization.line_color.g.val.set(188);
        results.push(drawable.visualization.line_color.b.val.set(233));
      } else {
        drawable.visualization.line_color.r.val.set(255);
        drawable.visualization.line_color.g.val.set(255);
        results.push(drawable.visualization.line_color.b.val.set(255));
      }
    }
    return results;
  };

  MeshItem.prototype.is_app_data = function(item) {
    if (item instanceof TreeAppData) {
      return true;
    } else {
      return false;
    }
  };

  MeshItem.prototype.get_app_data = function() {
    var it;
    it = this.get_parents_that_check(this.is_app_data);
    return it[0];
  };

  return MeshItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var FieldSetsVisuItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

FieldSetsVisuItem = (function(superClass) {
  extend(FieldSetsVisuItem, superClass);

  function FieldSetsVisuItem(fs_data_item, name, id_c) {
    if (name == null) {
      name = "Fields";
    }
    if (id_c == null) {
      id_c = 0;
    }
    FieldSetsVisuItem.__super__.constructor.call(this);
    this._name.set(name);
    this._viewable.set(true);
    this.add_attr({
      id: id_c,
      visualization: new FieldSet,
      _fs_data_ptr: new Ptr(fs_data_item),
      _has_result: false,
      _old_visualisation_field: "",
      _old_time_step: -1,
      time: -1
    });
    this.bind((function(_this) {
      return function() {
        if (_this._has_result.has_been_modified()) {
          return _this.draw();
        }
      };
    })(this));
  }

  FieldSetsVisuItem.prototype.draw = function(info) {
    var ref;
    if (((ref = this.time.val) != null ? ref.has_been_modified() : void 0) || this._has_result.has_been_modified() || this._viewable.has_been_modified()) {
      return this._fs_data_ptr.load((function(_this) {
        return function(res, err) {
          var ref1;
          return (ref1 = res._children[_this.time.get()]) != null ? ref1._fs_ptr.load(function(res, err) {
            var i, j, k, output_data, ref2, ref3, res_data, results;
            results = [];
            for (i = k = 0, ref2 = _this.visualization.color_by.lst.length; 0 <= ref2 ? k < ref2 : k > ref2; i = 0 <= ref2 ? ++k : --k) {
              output_data = _this.visualization.color_by.lst[i].data._data;
              output_data.clear();
              res_data = (ref3 = res.color_by.lst[i]) != null ? ref3.data._data : void 0;
              results.push((function() {
                var l, ref4, results1;
                results1 = [];
                for (j = l = 0, ref4 = res_data != null ? res_data.length : void 0; 0 <= ref4 ? l < ref4 : l > ref4; j = 0 <= ref4 ? ++l : --l) {
                  results1.push(output_data.push(res_data[j]));
                }
                return results1;
              })());
            }
            return results;
          }) : void 0;
        };
      })(this));
    }
  };

  FieldSetsVisuItem.prototype.accept_child = function(ch) {
    return false;
  };

  FieldSetsVisuItem.prototype.sub_canvas_items = function() {
    var res;
    res = [this.visualization];
    return res;
  };

  FieldSetsVisuItem.prototype.cosmetic_attribute = function(name) {
    return FieldSetsVisuItem.__super__.cosmetic_attribute.call(this, name) || (name === "visualization");
  };

  return FieldSetsVisuItem;

})(TreeItem_Automatic);
// Generated by CoffeeScript 1.11.1
var RawVolume,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

RawVolume = (function(superClass) {
  extend(RawVolume, superClass);

  function RawVolume() {
    RawVolume.__super__.constructor.call(this);
    this.add_attr({
      scalar_type: new Choice(0, ["PI8", "SI8", "PI16", "SI16", "PI32", "SI32", "FP32", "FP64"]),
      endianness: new Choice(0, ["LittleEndian", "BigEndian"]),
      img_size: [0, 0, 0],
      min_val: new ConstrainedVal(0, {
        min: 0,
        max: 255,
        div: 255
      }),
      max_val: new ConstrainedVal(255, {
        min: 0,
        max: 255,
        div: 255
      })
    });
    this._name.set("Raw volume");
    this._ico.set("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADPUlEQVR42o2TW0zbBRSH/yVqvMTJhhHxQVejCWCmARfmNLtoMuPmbYRscSrRGiZM0AgEsWVrGWNUS2lgY5YNV1scZYO1hTBu1TJcAccYvcGmDKdhTEQuLYjrqD58/tfgDIkm/pIvJ+fhfA8n5whibhNZKSL9n6wQFpPyzFMRN+qq4IUFJtv8TLUHRPxM/gdTHQFGzlz+SZyJ3p+X87wifWerIBEkCaON4+gfNqF7xIAlroOTce3/Tmw7o03jvL0t5aBGnh/K2Pry+rDgYt1l5MvUZEcWUXGviXKRcI0y/k24r4gyYZRX83GajHdf2VIgLCYBwD8XYG5+jlmR/mY3HscQwVCQ66HrLPyxQOjPEA01RgrS08hIftWydc1qyVLBbIDpaT8z0zMc2HIUg6yOa8EgwWu/c3X4LFWaYva+n8W+92Rkpm5+MTYuXlgiGPaM0JLZySnVV5THGqhcXcOI+zyDbaUcULzDpx/lody1E1P1IVqMit86DNkblwguDf6Ado0e00obhgct1K77HNfJQkyaHMqVu1FmyHC3avE5zVzqNeBuUk1WKnfE3BQEZmeplzdiibfTsLae/uNKLFUFVBYVotol46y1iCnPF/zqMTDUFMvpw/HUqneUhAUzo3569/fTsu40tlV2nBV7cVjLOKzVUJCWitOcx1h3KT+e0XLRoWO4Mwm7PgqzJtUh3CLc+mS3+lvqkqx8knSQss0l6HVy+vr6qDEepb5Mhq95D762Qs7ZlAx+fYhvTNn0mD+kpvi15ht3kDj63RhdVifnewcwGr/kypUxOru6KM7fwxHV69RV5lBTpab7xG5OPZtExoq7OXc8l9w31qbf3MHExDhDF4YIBAL8MjGBXJGPw9FJre4Dehu1fN9jxmtV4Ny+iZz7IinJfK77/uV33RkWzM/P43a78PncXP15DJu1gVJ1IQMDA1RXpJHWksJbug14bUpxudnsS1/f89hD9zywbZkQzhMAXq9XxI1v0MOxY7W4XC78/gCF2jd5NDeGmBeW85k8mdYTeiIihMRI4Z/cLvK4VCrdYLd32LOyMlVinyzytEQiJKSnJMi3vxTn2pgYXSWNvmOTRPze8Mxi/gKHPkiflBBh7wAAAABJRU5ErkJggg==");
    this._viewable.set(true);
  }

  RawVolume.prototype.update_min_max = function(x_min, x_max) {
    var d, i, results;
    results = [];
    for (d = i = 0; i < 3; d = ++i) {
      x_min[d] = Math.min(x_min[d], 0);
      results.push(x_max[d] = Math.max(x_max[d], this.img_size[d].get()));
    }
    return results;
  };

  return RawVolume;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var ViewItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ViewItem = (function(superClass) {
  extend(ViewItem, superClass);

  function ViewItem(app_data, panel_id, cam) {
    this.app_data = app_data;
    if (cam == null) {
      cam = new Cam;
    }
    ViewItem.__super__.constructor.call(this);
    this.add_attr({
      background: new Background,
      cam: cam,
      axes: new Axes,
      _panel_id: panel_id,
      _repr: ""
    });
    this._buff = new Image;
    this._buff.onload = (function(_this) {
      return function() {
        return _this._signal_change();
      };
    })(this);
    this.bind((function(_this) {
      return function() {
        if ((_this._repr != null) && _this._repr.has_been_modified()) {
          return _this._buff.src = _this._repr.get();
        }
      };
    })(this));
    this._name.set("View");
    this._date_tex = -1;
  }

  ViewItem.prototype.accept_child = function(ch) {};

  ViewItem.prototype.z_index = function() {
    return 1;
  };

  ViewItem.prototype.draw = function(info) {
    var fs, gl, ibuf, idx, initBuffer, ps, tbuf, txc, vbuf, vs, vtx, z;
    if (info.ctx_type === '2d') {
      return info.ctx.drawImage(this._buff, 0, 0);
    } else {
      if (this._buff.width) {
        vs = "attribute vec3 a_position;\n attribute vec2 textureCoords;\n varying vec2 texcoords;\n void main( void ) {\n texcoords = textureCoords;\n gl_Position = vec4( a_position, 1.0 );\n }\n";
        fs = "precision mediump float;\n varying vec2 texcoords;\n uniform sampler2D uSampler;\n void main( void ) {\n gl_FragColor = texture2D( uSampler, texcoords );\n }\n";
        gl = info.ctx;
        ps = info.cm.gl_prog(vs, fs);
        gl.useProgram(ps);
        ps.atexAttrib = gl.getAttribLocation(ps, "textureCoords");
        ps.aposAttrib = gl.getAttribLocation(ps, "a_position");
        if (this._date_tex < this._repr._date_last_modification) {
          this._date_tex = this._repr._date_last_modification;
          if (this.tex != null) {
            gl.deleteTexture(this.tex);
          }
          this.tex = gl.createTexture();
          gl.activeTexture(gl.TEXTURE0);
          gl.bindTexture(gl.TEXTURE_2D, this.tex);
          gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
          gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this._buff);
          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
        }
        gl.bindTexture(gl.TEXTURE_2D, this.tex);
        ps.samplerUniform = gl.getUniformLocation(ps, "uSampler");
        gl.uniform1i(ps.samplerUniform, 0);
        z = 1.0 - 1e-5;
        vtx = new Float32Array([-1.0, -1.0, z, 1.0, 1.0, z, 1.0, -1.0, z, -1.0, 1.0, z]);
        txc = new Float32Array([0, 0, 1, 1, 1, 0, 0, 1]);
        idx = new Uint16Array([0, 2, 3, 1]);
        initBuffer = function(glELEMENT_ARRAY_BUFFER, data) {
          var buf;
          buf = gl.createBuffer();
          gl.bindBuffer(glELEMENT_ARRAY_BUFFER, buf);
          gl.bufferData(glELEMENT_ARRAY_BUFFER, data, gl.STATIC_DRAW);
          return buf;
        };
        vbuf = initBuffer(gl.ARRAY_BUFFER, vtx);
        ibuf = initBuffer(gl.ELEMENT_ARRAY_BUFFER, idx);
        gl.vertexAttribPointer(ps.aposAttrib, 3, gl.FLOAT, false, 0, 0);
        gl.enableVertexAttribArray(ps.aposAttrib);
        tbuf = initBuffer(gl.ARRAY_BUFFER, txc);
        gl.vertexAttribPointer(ps.atexAttrib, 2, gl.FLOAT, false, 0, 0);
        gl.enableVertexAttribArray(ps.atexAttrib);
        gl.drawElements(gl.TRIANGLE_STRIP, 4, gl.UNSIGNED_SHORT, 0);
        gl.disableVertexAttribArray(ps.aposAttrib);
        gl.disableVertexAttribArray(ps.atexAttrib);
        gl.bindBuffer(gl.ARRAY_BUFFER, null);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);
        gl.bindTexture(gl.TEXTURE_2D, null);
        gl.deleteBuffer(tbuf);
        gl.deleteBuffer(ibuf);
        return gl.deleteBuffer(vbuf);
      }
    }
  };

  ViewItem.prototype.sub_canvas_items = function() {
    return [this.background, this.axes];
  };

  return ViewItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var FileItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

FileItem = (function(superClass) {
  extend(FileItem, superClass);

  function FileItem(file) {
    FileItem.__super__.constructor.call(this);
    if (file != null) {
      this.add_attr({
        _file: file,
        _ptr: file._ptr
      });
      this._name.set(file.name);
    }
  }

  return FileItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var TreeItem_Parametric,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeItem_Parametric = (function(superClass) {
  extend(TreeItem_Parametric, superClass);

  function TreeItem_Parametric() {
    TreeItem_Parametric.__super__.constructor.call(this);
    this.add_attr({
      _class_export_name: "Item",
      _class_export_language: "JavaScript",
      _class_export_state: false
    });
  }

  TreeItem_Parametric.prototype.display_context_actions = function() {
    var contex_action;
    contex_action = new Lst;
    contex_action.push(new TreeAppAction_Save);
    contex_action.push(new TreeAppAction_AddModel);
    this.display_suppl_context_actions(contex_action);
    return contex_action;
  };

  return TreeItem_Parametric;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var ShootingItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ShootingItem = (function(superClass) {
  extend(ShootingItem, superClass);

  function ShootingItem(app, panel_id) {
    var lst_view;
    this.app = app;
    this.panel_id = panel_id;
    ShootingItem.__super__.constructor.call(this);
    lst_view = new Lst;
    this.add_attr({
      view: new Choice(0, lst_view),
      cam: new Cam
    });
    this.add_attr({
      _cam_representation: new CamRepresentation(this.cam)
    });
    this._name.set("Shooting informations");
    this._ico.set("data:image/png;base64,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");
    this._viewable.set(true);
    this.add_child(new ImgSetItem);
  }

  ShootingItem.prototype.accept_child = function(ch) {
    return ch instanceof ImgItem || ch instanceof ImgSetItem || ch instanceof SketchItem || ch instanceof TransformItem;
  };

  ShootingItem.prototype.sub_canvas_items = function() {
    return [this._cam_representation];
  };

  ShootingItem.prototype.z_index = function() {
    return 0.1;
  };

  ShootingItem.prototype.draw = function(info) {
    var c, i, len, ref;
    info.shoot_cam = this.cam;
    ref = this._children;
    for (i = 0, len = ref.length; i < len; i++) {
      c = ref[i];
      c.draw(info);
    }
    if (this.cam === info.cam) {
      info.ctx.beginPath();
      info.ctx.fillStyle = "white";
      info.ctx.font = "10px Arial";
      info.ctx.textBaseline = 'top';
      info.ctx.textAlign = 'right';
      info.ctx.fillText("Shooting Cam " + this.cam.model_id, info.w - 10, 10);
    }
    return delete info.shoot_cam;
  };

  return ShootingItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var FieldSetItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

FieldSetItem = (function(superClass) {
  extend(FieldSetItem, superClass);

  function FieldSetItem(name, id_c) {
    if (name == null) {
      name = "Field";
    }
    if (id_c == null) {
      id_c = 0;
    }
    FieldSetItem.__super__.constructor.call(this);
    this._name.set(name);
    this._viewable.set(true);
    this.add_attr({
      id: id_c,
      visualization: new FieldSet
    });
  }

  FieldSetItem.prototype.accept_child = function(ch) {
    return false;
  };

  FieldSetItem.prototype.sub_canvas_items = function() {
    var res;
    res = [this.visualization];
    return res;
  };

  return FieldSetItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var FieldSetFileItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

FieldSetFileItem = (function(superClass) {
  extend(FieldSetFileItem, superClass);

  function FieldSetFileItem(file) {
    var field_set;
    FieldSetFileItem.__super__.constructor.call(this);
    if (file != null) {
      this._name.set(file.name);
      this.add_attr({
        _file: file,
        _ptr: file._ptr
      });
    }
    field_set = new FieldSet;
    this.add_attr({
      _fs_ptr: new Ptr(field_set)
    });
  }

  return FieldSetFileItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var ImgDirectorySetItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ImgDirectorySetItem = (function(superClass) {
  extend(ImgDirectorySetItem, superClass);

  function ImgDirectorySetItem(name) {
    if (name == null) {
      name = 'Image directory';
    }
    ImgDirectorySetItem.__super__.constructor.call(this);
    this._name.set(name);
    this._viewable.set(true);
    this.add_attr({
      reference_image: new ConstrainedVal(0, {
        min: 0,
        max: 20,
        div: 0
      }),
      img: new Img,
      _current_reference: -1
    });
  }

  ImgDirectorySetItem.prototype.accept_child = function(ch) {
    return ch instanceof FileItem;
  };

  ImgDirectorySetItem.prototype.draw = function(info) {
    if (this._children.length > 0) {
      this.reference_image.set_params({
        max: this._children.length - 1
      });
      if (this._current_reference.get() !== this.reference_image.get()) {
        this._current_reference.set(this.reference_image.get());
        if (this._children[this._current_reference] != null) {
          this._current_img = this._children[this._current_reference]._name.get();
          return this._children[this._current_reference]._file.load((function(_this) {
            return function(res, err) {
              var test;
              test = new Img(res);
              _this.img = test;
              return info.cm.origin();
            };
          })(this));
        }
      }
    }
  };

  ImgDirectorySetItem.prototype.sub_canvas_items = function() {
    return [this.img];
  };

  return ImgDirectorySetItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var DirectoryFieldSetCorreliItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

DirectoryFieldSetCorreliItem = (function(superClass) {
  extend(DirectoryFieldSetCorreliItem, superClass);

  function DirectoryFieldSetCorreliItem(name) {
    if (name == null) {
      name = 'FieldSet directory';
    }
    DirectoryFieldSetCorreliItem.__super__.constructor.call(this);
    this._name.set(name);
    this._viewable.set(true);
    this.add_attr({
      reference_image: new ConstrainedVal(0, {
        min: 0,
        max: 20,
        div: 0
      }),
      visualization: new FieldSet,
      _current_reference: -1,
      _directory: new directory
    });
  }

  DirectoryFieldSetCorreliItem.prototype.accept_child = function(ch) {
    return ch instanceof FileItem;
  };

  DirectoryFieldSetCorreliItem.prototype.draw = function(info) {
    if (this._children.length > 0) {
      this.reference_image.set_params({
        max: this._children.length - 1
      });
      if (this._current_reference.get() !== this.reference_image.get()) {
        this._current_reference.set(this.reference_image.get());
        if (this._children[this._current_reference] != null) {
          this._current_img = this._children[this._current_reference]._name.get();
          return this._children[this._current_reference]._file.load((function(_this) {
            return function(res, err) {
              var test;
              test = new Img(res);
              _this.img = test;
              return info.cm.origin();
            };
          })(this));
        }
      }
    }
  };

  DirectoryFieldSetCorreliItem.prototype.sub_canvas_items = function() {
    return [this.visualization];
  };

  return DirectoryFieldSetCorreliItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var FieldSetsDataItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

FieldSetsDataItem = (function(superClass) {
  extend(FieldSetsDataItem, superClass);

  function FieldSetsDataItem(name) {
    if (name == null) {
      name = "FieldSets data";
    }
    FieldSetsDataItem.__super__.constructor.call(this);
    this.add_attr;
    this._name.set(name);
    this._viewable.set(false);
  }

  FieldSetsDataItem.prototype.accept_child = function(ch) {
    return ch instanceof FileItem || ch instanceof FieldSetFileItem;
  };

  FieldSetsDataItem.prototype.add_child = function(child) {
    var new_file_item;
    if (child instanceof FileItem) {
      new_file_item = new FieldSetFileItem(child._file);
      new_file_item._name = child._name;
      return this._children.push(new_file_item);
    }
  };

  return FieldSetsDataItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var DisplaySettingsItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

DisplaySettingsItem = (function(superClass) {
  extend(DisplaySettingsItem, superClass);

  function DisplaySettingsItem(layout_manager_data) {
    if (layout_manager_data == null) {
      layout_manager_data = {};
    }
    DisplaySettingsItem.__super__.constructor.call(this);
    this.add_attr({
      theme: new Theme,
      _layout: new LayoutManagerData(layout_manager_data)
    });
    this._name._set("Display settings");
    this._ico._set("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAADdgAAA3YBfdWCzAAAAAd0SU1FB9oBEAMpLRHXlgEAAAQbSURBVDgRARAE7/sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADNzdEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAc3N0bcCAgNIAAD/AAAAAAAAAAEABAQEwS0tKEDT09fA+/v7PwAAAAAAAAEAAQEAAAAAAAAAAAAAAAABAP7+/bgE+fn5SC0tKQD7+/sA/Pz8APz8/ADl5ek/AAAAAPb29z82NjEA+vr6APv7+wD+/v4A/v7+AP7+/gD///4A2dnfSAT19fYAAwMCAPr6/wAEBAQAAQEAAPT09QAAAAAA9fX0AAAAAAABAQEAAAAAAAEBAQD///8AAgICAP//AQD29vUAAvb29gAHBwcABQUFANLS0gAHBwgA9vb2AAAAAAD19fYAAAAAAAMDAwAHBwcA0tLSAAYGBgDQ0NAABQUEAPb29gAE9vb2AAICAwAMDAwAOjo6AP7+/AD29vYAAAAAAPf39wAAAAAAAgICAAICAgA6OjoA+/v7ADo6OQD9/fwA9vb3AAT8/Py4oKClSAEBAAAAAAEAAAAAAAkJCMEAAAAA///+xqCgpToAAAAAAAAAAAAAAAABAQEAAAAAAAAAAQADAwG9AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABzc3RtwEBAUgAAAAAAAAAAAAAAQABAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAABAQAA/f38uAT4+PhIOjo2AP39/QD8/PwA/Pz7AP39/gD///8A/v7+AP7+/gD+/v0A+/v8AP7+/gD+/vwAAAABAAAAAQDm5upIBPb29gAAAAAAAAAAAP///wAAAAEA////AP7+/gD+/v4A////AAEBAgACAgIAAQEBAP7+/gAAAAAAAAAAAPb29gAC9vb3AAAAAAACAgIABAQEAAICAgADAwMAAQEBAAICAgAFBQUA09PTAAcHBwDU1NQABwcHANTU1AAEBAMA9vb3AAT39/cAAAAAAAEBAQAEBAQABAQEAP7+/QD8/PwA/f3+AP///gA3NzYA/Pz8ADY2NgD7+/sANTU1APz8+wD39/cAAaWlqbf8/P1IAAD/AAAAAAAAAAEAAAAAAAAAAAABAQAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgIBAAAAAbgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFy8/azHbCOEAAAAAElFTkSuQmCC");
    this._layout.bind((function(_this) {
      return function() {
        var i, l, len, ref, ref1, results, view_item;
        l = _this._layout.panel_id_of_term_panels();
        ref = _this._children;
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          view_item = ref[i];
          if (view_item instanceof ViewItem) {
            if (ref1 = view_item._panel_id.get(), indexOf.call(l, ref1) < 0) {
              results.push(_this.rem_child(view_item));
            } else {
              results.push(void 0);
            }
          }
        }
        return results;
      };
    })(this));
    this._layout.allow_destruction = (function(_this) {
      return function(data) {
        return _this._layout.panel_id_of_term_panels().length >= 4;
      };
    })(this);
  }

  DisplaySettingsItem.prototype.accept_child = function(ch) {
    return ch instanceof ViewItem;
  };

  DisplaySettingsItem.prototype.z_index = function() {};

  return DisplaySettingsItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var SketchItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

SketchItem = (function(superClass) {
  extend(SketchItem, superClass);

  function SketchItem(name) {
    if (name == null) {
      name = "Sketch";
    }
    SketchItem.__super__.constructor.call(this);
    this.add_attr({
      mesh: new Sketch
    });
    this._name.set(name);
    this._viewable.set(true);
  }

  SketchItem.prototype.display_suppl_context_actions = function(context_action) {
    context_action.push(new TreeAppModule_Mesher);
    return context_action.push(new TreeAppModule_Sketch);
  };

  SketchItem.prototype.accept_child = function(ch) {
    return false;
  };

  SketchItem.prototype.sub_canvas_items = function() {
    return [this.mesh];
  };

  SketchItem.prototype.z_index = function() {
    return this.sub_canvas_items()[0].z_index();
  };

  SketchItem.prototype.disp_only_in_model_editor = function() {
    return this.mesh;
  };

  SketchItem.prototype.get_movable_entities = function(res, info, pos, phase, dry) {
    if (dry == null) {
      dry = false;
    }
    return this.mesh.get_movable_entities(res, info, pos, phase, dry);
  };

  SketchItem.prototype.contextual_actions = function(res, module) {
    var act, i, len, results;
    results = [];
    for (i = 0, len = module.length; i < len; i++) {
      act = module[i];
      if (act.ctx_act() === true) {
        results.push(res.push(act));
      }
    }
    return results;
  };

  SketchItem.prototype._closest_point_closer_than = function(proj, pos, dist) {
    var i, len, m, ref, results;
    ref = this.sub_canvas_items();
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      m = ref[i];
      if (m instanceof Mesh) {
        results.push(m._closest_point_closer_than(proj, pos, dist));
      }
    }
    return results;
  };

  return SketchItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var MesherItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

MesherItem = (function(superClass) {
  extend(MesherItem, superClass);

  function MesherItem(name) {
    if (name == null) {
      name = "Mesher";
    }
    MesherItem.__super__.constructor.call(this);
    this.add_attr({
      _mesh: new Mesh({
        not_editable: true
      })
    });
    this.add_attr({
      visualization: this._mesh.visualization,
      cell_type: new Choice(0, ["Triangle 3", "Triangle 6", "Quad 4", "Quad 8"]),
      base_size: 100,
      p_mesher: new Lst
    });
    this._name.set(name);
    this._viewable.set(true);
    this.visualization.display_style.num.set(1);
    this._computation_mode.set(false);
    this.bind((function(_this) {
      return function() {
        if (_this._mesh.has_been_modified()) {
          return alert(_this._mesh.points.length + " " + _this._mesh._elements.length);
        }
      };
    })(this));
  }

  MesherItem.prototype.display_suppl_context_actions = function(context_action) {
    context_action.push(new TreeAppModule_Mesher);
    return context_action.push(new TreeAppModule_Sketch);
  };

  MesherItem.prototype.cosmetic_attribute = function(name) {
    return MesherItem.__super__.cosmetic_attribute.call(this, name) || (name === "_mesh" || name === "visualization");
  };

  MesherItem.prototype.add_point = function(p) {
    if (p == null) {
      p = new PointMesher;
    }
    if (p instanceof PointMesher) {
      return this.p_mesher.push(p);
    }
  };

  MesherItem.prototype.remove_point = function(p) {
    var ind;
    if (p instanceof PointMesher) {
      ind = this.p_mesher.indexOf(p);
      if (ind !== -1) {
        return this.p_mesher.splice(ind, 1);
      }
    } else if (p !== (0/0)) {
      return this.p_mesher.splice(p, 1);
    }
  };

  MesherItem.prototype.accept_child = function(ch) {
    return ch instanceof MaskItem || ch instanceof MesherItem || ch instanceof SketchItem || ch instanceof ImgItem || ch instanceof TransformItem;
  };

  MesherItem.prototype.sub_canvas_items = function() {
    return [this._mesh];
  };

  MesherItem.prototype.draw = function(info) {
    var draw_point, i, len, pm, ref, results;
    draw_point = info.sel_item[this.model_id];
    if (this.p_mesher.length && draw_point) {
      ref = this.p_mesher;
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        pm = ref[i];
        results.push(pm.draw(info));
      }
      return results;
    }
  };

  MesherItem.prototype.z_index = function() {
    return this._mesh.z_index();
  };

  MesherItem.prototype.disp_only_in_model_editor = function() {};

  MesherItem.prototype.get_movable_entities = function(res, info, pos, phase) {
    var i, len, pm, ref, results;
    ref = this.p_mesher;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      pm = ref[i];
      results.push(pm.get_movable_entities(res, info, pos, phase));
    }
    return results;
  };

  MesherItem.prototype.on_mouse_down = function(cm, evt, pos, b) {
    var i, len, pm, ref;
    ref = this.p_mesher;
    for (i = 0, len = ref.length; i < len; i++) {
      pm = ref[i];
      pm.on_mouse_down(cm, evt, pos, b);
    }
    return false;
  };

  MesherItem.prototype.on_mouse_move = function(cm, evt, pos, b, old) {
    var i, len, pm, ref;
    ref = this.p_mesher;
    for (i = 0, len = ref.length; i < len; i++) {
      pm = ref[i];
      pm.on_mouse_move(cm, evt, pos, b, old);
    }
    return false;
  };

  return MesherItem;

})(TreeItem_Computable);
// Generated by CoffeeScript 1.11.1
var ImgSetItem,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ImgSetItem = (function(superClass) {
  extend(ImgSetItem, superClass);

  function ImgSetItem(name) {
    if (name == null) {
      name = 'Image collection';
    }
    this.update_min_max = bind(this.update_min_max, this);
    ImgSetItem.__super__.constructor.call(this);
    this._name.set(name);
    this._ico.set("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADPUlEQVR42o2TW0zbBRSH/yVqvMTJhhHxQVejCWCmARfmNLtoMuPmbYRscSrRGiZM0AgEsWVrGWNUS2lgY5YNV1scZYO1hTBu1TJcAccYvcGmDKdhTEQuLYjrqD58/tfgDIkm/pIvJ+fhfA8n5whibhNZKSL9n6wQFpPyzFMRN+qq4IUFJtv8TLUHRPxM/gdTHQFGzlz+SZyJ3p+X87wifWerIBEkCaON4+gfNqF7xIAlroOTce3/Tmw7o03jvL0t5aBGnh/K2Pry+rDgYt1l5MvUZEcWUXGviXKRcI0y/k24r4gyYZRX83GajHdf2VIgLCYBwD8XYG5+jlmR/mY3HscQwVCQ66HrLPyxQOjPEA01RgrS08hIftWydc1qyVLBbIDpaT8z0zMc2HIUg6yOa8EgwWu/c3X4LFWaYva+n8W+92Rkpm5+MTYuXlgiGPaM0JLZySnVV5THGqhcXcOI+zyDbaUcULzDpx/lody1E1P1IVqMit86DNkblwguDf6Ado0e00obhgct1K77HNfJQkyaHMqVu1FmyHC3avE5zVzqNeBuUk1WKnfE3BQEZmeplzdiibfTsLae/uNKLFUFVBYVotol46y1iCnPF/zqMTDUFMvpw/HUqneUhAUzo3569/fTsu40tlV2nBV7cVjLOKzVUJCWitOcx1h3KT+e0XLRoWO4Mwm7PgqzJtUh3CLc+mS3+lvqkqx8knSQss0l6HVy+vr6qDEepb5Mhq95D762Qs7ZlAx+fYhvTNn0mD+kpvi15ht3kDj63RhdVifnewcwGr/kypUxOru6KM7fwxHV69RV5lBTpab7xG5OPZtExoq7OXc8l9w31qbf3MHExDhDF4YIBAL8MjGBXJGPw9FJre4Dehu1fN9jxmtV4Ny+iZz7IinJfK77/uV33RkWzM/P43a78PncXP15DJu1gVJ1IQMDA1RXpJHWksJbug14bUpxudnsS1/f89hD9zywbZkQzhMAXq9XxI1v0MOxY7W4XC78/gCF2jd5NDeGmBeW85k8mdYTeiIihMRI4Z/cLvK4VCrdYLd32LOyMlVinyzytEQiJKSnJMi3vxTn2pgYXSWNvmOTRPze8Mxi/gKHPkiflBBh7wAAAABJRU5ErkJggg==");
    this._viewable.set(true);
    this.visible = true;
  }

  ImgSetItem.prototype.accept_child = function(ch) {
    return ch instanceof ImgItem || ch instanceof RawVolume;
  };

  ImgSetItem.prototype.draw = function(info) {
    if ((info.time_ref._max != null) && info.time_ref._max.get() < this._children.length - 1) {
      info.time_ref._max.set(this._children.length - 1);
    }
    if (info.time_ref != null) {
      info.time_ref._div.set(Math.max(info.time_ref._max.get(), 1));
    }
    if (this._children[info.time] != null) {
      return this._children[info.time].draw(info);
    } else if (this._children[0] != null) {
      return this._children[0].draw(info);
    }
  };

  ImgSetItem.prototype.z_index = function() {
    if (this._children.length) {
      return this._children[0].z_index();
    }
    return 0;
  };

  ImgSetItem.prototype.update_min_max = function(x_min, x_max) {
    if (this._children[0] != null) {
      return this._children[0].update_min_max(x_min, x_max);
    }
  };

  ImgSetItem.prototype.anim_min_max = function() {
    return this._children.length;
  };

  return ImgSetItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var SessionItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

SessionItem = (function(superClass) {
  extend(SessionItem, superClass);

  function SessionItem(name, app_data) {
    SessionItem.__super__.constructor.call(this);
    this.add_attr({
      _selected_tree_items: new Lst,
      _visible_tree_items: new Model,
      _closed_tree_items: new Lst,
      _selected_canvas_pan: new Lst,
      _last_canvas_pan: new Str,
      _modules: new Lst,
      time: (app_data != null ? app_data.time : void 0) || new ConstrainedVal(0, {
        min: 0,
        max: 20,
        div: 0
      })
    });
    this._name._set(name);
    this._ico._set("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAAAlwSFlzAABuugAAbroB1t6xFwAAAAd0SU1FB9kKFg0RBwNC0kUAAAEsUExURQAAAAAAAAgICAAAAAAAAAAAAAAAAAAAAAAAAAAAADiB2SNtwjqC2S51yDqD2TZ8zjqD2T6D1DyE20aJ2P///wBMowJOqAJPqA9YqhBguhhUnRlWnSJrvzmC2TmD3jqD2TqE3jx2vzyE20GH206Cw1CU5lCV5lCV6FSU4WmTy26Hpm+Wy3aNp3mp5n6SqX6VsX6t6Iiz65CdrZCu1JGw1pG67pS56pW56p69457C7aDD7a7L767N76/K7q/N77DQ97fQ77jS8bnU8bzV9L3W9MPY8sXZ88bZ8dDg9tnn9+Lj4+jp6evr6+vs7O3t7e3u7u7v7+/v7+/w8PDw8PHx8fHy8vLz8/Pz8/T09PT19fX19fb29vj4+Pn5+fr6+vv7+/z8/P//+v///v///158d/IAAAAVdFJOUwARHyorMzQ1Njf6+/v8/P39/f7+/prq3iMAAAABYktHRGNcvi2qAAAAq0lEQVQYGUXBPUoDARQE4Jl587KQEBRstRKCrY2tR/ACOZ+9rUextVFIa4z795LNEvw+AkpiVt0IA9zi4vUXvu/6tydSCuC6A7h8/n78siwK702GdGihSNuhl5tNa7UjwhYJoT/IImBLJM6sRWJN4iwdvB1qEE4KHIPB1aa964hJ5efiw+r3P3/EpJq9ZMUJMamIkJXZJGbKlLWMHTGrq0Z8GEhcVAVp4l/1R+7tLK9NVBYVAAAAAElFTkSuQmCC");
  }

  SessionItem.prototype.accept_child = function(ch) {
    return true;
  };

  return SessionItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var ImgItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ImgItem = (function(superClass) {
  extend(ImgItem, superClass);

  function ImgItem(file, app) {
    ImgItem.__super__.constructor.call(this);
    this.add_attr({
      img: new Img(file, app)
    });
    if (file instanceof Str) {
      this._name.set(file.replace(/^.*\//, ""));
    } else {
      this._name.set("image");
    }
    this._ico.set("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADPUlEQVR42o2TW0zbBRSH/yVqvMTJhhHxQVejCWCmARfmNLtoMuPmbYRscSrRGiZM0AgEsWVrGWNUS2lgY5YNV1scZYO1hTBu1TJcAccYvcGmDKdhTEQuLYjrqD58/tfgDIkm/pIvJ+fhfA8n5whibhNZKSL9n6wQFpPyzFMRN+qq4IUFJtv8TLUHRPxM/gdTHQFGzlz+SZyJ3p+X87wifWerIBEkCaON4+gfNqF7xIAlroOTce3/Tmw7o03jvL0t5aBGnh/K2Pry+rDgYt1l5MvUZEcWUXGviXKRcI0y/k24r4gyYZRX83GajHdf2VIgLCYBwD8XYG5+jlmR/mY3HscQwVCQ66HrLPyxQOjPEA01RgrS08hIftWydc1qyVLBbIDpaT8z0zMc2HIUg6yOa8EgwWu/c3X4LFWaYva+n8W+92Rkpm5+MTYuXlgiGPaM0JLZySnVV5THGqhcXcOI+zyDbaUcULzDpx/lody1E1P1IVqMit86DNkblwguDf6Ado0e00obhgct1K77HNfJQkyaHMqVu1FmyHC3avE5zVzqNeBuUk1WKnfE3BQEZmeplzdiibfTsLae/uNKLFUFVBYVotol46y1iCnPF/zqMTDUFMvpw/HUqneUhAUzo3569/fTsu40tlV2nBV7cVjLOKzVUJCWitOcx1h3KT+e0XLRoWO4Mwm7PgqzJtUh3CLc+mS3+lvqkqx8knSQss0l6HVy+vr6qDEepb5Mhq95D762Qs7ZlAx+fYhvTNn0mD+kpvi15ht3kDj63RhdVifnewcwGr/kypUxOru6KM7fwxHV69RV5lBTpab7xG5OPZtExoq7OXc8l9w31qbf3MHExDhDF4YIBAL8MjGBXJGPw9FJre4Dehu1fN9jxmtV4Ny+iZz7IinJfK77/uV33RkWzM/P43a78PncXP15DJu1gVJ1IQMDA1RXpJHWksJbug14bUpxudnsS1/f89hD9zywbZkQzhMAXq9XxI1v0MOxY7W4XC78/gCF2jd5NDeGmBeW85k8mdYTeiIihMRI4Z/cLvK4VCrdYLd32LOyMlVinyzytEQiJKSnJMi3vxTn2pgYXSWNvmOTRPze8Mxi/gKHPkiflBBh7wAAAABJRU5ErkJggg==");
    this._viewable.set(true);
  }

  ImgItem.prototype.accept_child = function(ch) {
    return false;
  };

  ImgItem.prototype.sub_canvas_items = function() {
    return [this.img];
  };

  ImgItem.prototype.z_index = function() {
    return this.img.z_index();
  };

  ImgItem.prototype.update_min_max = function(x_min, x_max) {
    return this.img.update_min_max(x_min, x_max);
  };

  ImgItem.prototype.get_file_info = function(info) {
    info.model_type = "Img";
    return info.icon = "picture";
  };

  return ImgItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var TransformItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TransformItem = (function(superClass) {
  extend(TransformItem, superClass);

  function TransformItem() {
    TransformItem.__super__.constructor.call(this);
    this._name.set("Transform");
    this._ico.set("data:image/png;base64,");
    this._viewable.set(true);
    this.add_attr({
      transform: new Transform
    });
  }

  TransformItem.prototype.accept_child = function(ch) {
    return ch instanceof MaskItem || ch instanceof DiscretizationItem || ch instanceof SketchItem || ch instanceof MeshItem || ch instanceof ImgSetItem || ch instanceof ImgItem;
  };

  TransformItem.prototype.sub_canvas_items = function() {
    var Z, angle, ch, d_cur, d_old, flat, i, len, lst, ref, scale, torig, trans, vec_cur, vec_old, x, y;
    flat = [];
    ref = this._children;
    for (i = 0, len = ref.length; i < len; i++) {
      ch = ref[i];
      CanvasManager._get_flat_list(flat, ch);
    }
    trans = [0, 0, 0];
    torig = [0, 0, 0];
    if (this.transform.cur_points.length >= 1) {
      torig = this.transform.cur_points[0].pos.get();
      trans = Vec_3.sub(this.transform.cur_points[0].pos, this.transform.old_points[0].pos);
    }
    scale = 1;
    angle = 0;
    if (this.transform.cur_points.length === 2) {
      vec_old = Vec_3.sub(this.transform.old_points[1].pos.get(), this.transform.old_points[0].pos.get());
      vec_cur = Vec_3.sub(this.transform.cur_points[1].pos.get(), this.transform.cur_points[0].pos.get());
      d_old = Vec_3.len(vec_old);
      d_cur = Vec_3.len(vec_cur);
      if (d_old) {
        scale = d_cur / d_old;
        vec_old = Vec_3.dis(vec_old, d_old);
        vec_cur = Vec_3.dis(vec_cur, d_cur);
        Z = Vec_3.cro(vec_old, vec_cur);
        y = Vec_3.len(Z);
        if (y) {
          Z = Vec_3.dis(Z, y);
          x = Vec_3.dot(vec_old, vec_cur);
          angle = Math.atan2(y, x);
        }
      }
    }
    lst = (function() {
      var j, len1, results;
      results = [];
      for (j = 0, len1 = flat.length; j < len1; j++) {
        ch = flat[j];
        results.push((function(_this) {
          return function(ch) {
            return {
              draw: function(info) {
                var key, n_info, val;
                n_info = {};
                for (key in info) {
                  val = info[key];
                  n_info[key] = val;
                }
                n_info.re_2_sc = {
                  proj: function(p) {
                    var np;
                    np = Vec_3.add(p, trans);
                    np = Vec_3.sub(np, torig);
                    if (angle) {
                      np = Vec_3.rot(np, Vec_3.mus(angle, Z));
                    }
                    if (scale) {
                      np = Vec_3.mus(scale, np);
                    }
                    np = Vec_3.add(np, torig);
                    return info.re_2_sc.proj(np);
                  }
                };
                return ch.draw(n_info);
              },
              z_index: function() {
                return ch.z_index();
              }
            };
          };
        })(this)(ch));
      }
      return results;
    }).call(this);
    lst.push(this.transform);
    return lst;
  };

  TransformItem.prototype.get_movable_entities = function(res, info, pos, phase) {
    return this.transform.get_movable_entities(res, info, pos, phase);
  };

  return TransformItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var GridItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

GridItem = (function(superClass) {
  extend(GridItem, superClass);

  function GridItem(name) {
    if (name == null) {
      name = "Grid";
    }
    GridItem.__super__.constructor.call(this);
    this._name.set(name);
    this._viewable.set(true);
    this.add_attr({
      graph_attr: {
        line_color: new Color(0, 0, 0),
        line_width: new ConstrainedVal(1, {
          min: 0,
          max: 20
        }),
        shadow: false,
        show_marker: true,
        marker: new Choice(0, ["dot", "square", "cross", "diamond", "bar"]),
        marker_size: new ConstrainedVal(5, {
          min: 0,
          max: 40
        }),
        marker_color: new Color(0, 0, 0),
        line_width: new ConstrainedVal(1, {
          min: 1,
          max: 5
        }),
        marker_size: new ConstrainedVal(1, {
          min: 1,
          max: 50
        }),
        font_size: new ConstrainedVal(20, {
          min: 5,
          max: 30
        }),
        legend_x_division: new ConstrainedVal(10, {
          min: 1,
          max: 30
        }),
        legend_y_division: new ConstrainedVal(10, {
          min: 1,
          max: 30
        })
      },
      _point1: new PointMesher([0, 0, 0], 2, 6),
      _point2: new PointMesher([2, 0, 0], 2, 6)
    });
    this.add_attr({
      point1: this._point1.point,
      point2: this._point2.point,
      _graph: new Graph({
        marker: 'dot',
        marker_color: "#f00",
        line_width: this.graph_attr.line_width,
        line_color: "#f00",
        marker_size: this.graph_attr.marker_size,
        font_size: this.graph_attr.font_size,
        legend_x_division: 10,
        legend_y_division: 10,
        x_axis: 'x',
        y_axis: 'y'
      })
    });
    this._graph.marker = this.graph_attr.marker;
    this._graph.marker_color = this.graph_attr.marker_color;
    this._graph.line_width = this.graph_attr.line_width;
    this._graph.line_color = this.graph_attr.line_color;
    this._graph.marker_size = this.graph_attr.marker_size;
    this._graph.points.push(this.point1);
    this._graph.points.push(this.point2);
    this._graph.points[0] = this.point1;
    this._graph.points[1] = this.point2;
  }

  GridItem.prototype.accept_child = function(ch) {
    return false;
  };

  GridItem.prototype.sub_canvas_items = function() {
    return [this._graph, this._point1, this._point2];
  };

  GridItem.prototype.draw = function(info) {
    var draw_point, i, len, pm, ref, results;
    draw_point = info.sel_item[this.model_id];
    if (this._graph.points.length && draw_point) {
      ref = this._graph.points;
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        pm = ref[i];
        results.push(pm.draw(info));
      }
      return results;
    }
  };

  GridItem.prototype.get_movable_entities = function(res, info, pos, phase) {
    var i, j, len, len1, pm, ref, ref1, results;
    ref = this._point1;
    for (i = 0, len = ref.length; i < len; i++) {
      pm = ref[i];
      pm.get_movable_entities(res, info, pos, phase);
    }
    ref1 = this._point2;
    results = [];
    for (j = 0, len1 = ref1.length; j < len1; j++) {
      pm = ref1[j];
      results.push(pm.get_movable_entities(res, info, pos, phase));
    }
    return results;
  };

  GridItem.prototype.on_mouse_down = function(cm, evt, pos, b) {
    var i, j, len, len1, pm, ref, ref1;
    ref = this._point1;
    for (i = 0, len = ref.length; i < len; i++) {
      pm = ref[i];
      pm.on_mouse_down(cm, evt, pos, b);
    }
    ref1 = this._point2;
    for (j = 0, len1 = ref1.length; j < len1; j++) {
      pm = ref1[j];
      pm.on_mouse_down(cm, evt, pos, b);
    }
    return false;
  };

  GridItem.prototype.on_mouse_move = function(cm, evt, pos, b, old) {
    var i, j, len, len1, pm, ref, ref1;
    ref = this._point1;
    for (i = 0, len = ref.length; i < len; i++) {
      pm = ref[i];
      pm.on_mouse_move(cm, evt, pos, b, old);
    }
    ref1 = this._point2;
    for (j = 0, len1 = ref1.length; j < len1; j++) {
      pm = ref1[j];
      pm.on_mouse_move(cm, evt, pos, b, old);
    }
    return false;
  };

  return GridItem;

})(TreeItem);
// Generated by CoffeeScript 1.11.1
var AdminDeskConfig,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

AdminDeskConfig = (function(superClass) {
  extend(AdminDeskConfig, superClass);

  function AdminDeskConfig() {
    AdminDeskConfig.__super__.constructor.call(this);
    this.add_attr({
      name: "configuration desk",
      list_desk_items: new Lst,
      selected_list_desk_items: new Lst,
      account: new UserModel,
      list_contact: new Lst,
      selected_organisation: new Lst
    });
    this.list_desk_items.push(new DeskItem("Files", "Files"));
    this.selected_list_desk_items.push(this.list_desk_items[0]);
  }

  return AdminDeskConfig;

})(Model);
// Generated by CoffeeScript 1.11.1
var DeskConfig,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

DeskConfig = (function(superClass) {
  extend(DeskConfig, superClass);

  function DeskConfig() {
    DeskConfig.__super__.constructor.call(this);
    this.add_attr({
      name: "configuration desk",
      list_desk_items: new Lst,
      selected_list_desk_items: new Lst,
      account: new UserModel,
      list_contact: new Lst,
      selected_organisation: new Lst,
      selected_site: new Lst
    });
    this.list_desk_items.push(new DeskItem("Files", "Files"));
    this.list_desk_items.push(new DeskItem("Projects", "Projects"));
    this.selected_list_desk_items.push(this.list_desk_items[0]);
  }

  return DeskConfig;

})(Model);
// Generated by CoffeeScript 1.11.1
var AdminDeskData,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

AdminDeskData = (function(superClass) {
  extend(AdminDeskData, superClass);

  function AdminDeskData(config) {
    AdminDeskData.__super__.constructor.call(this);
    this.add_attr({
      config: config
    });
    this.add_attr({
      list_desk_items: this.config.list_desk_items,
      selected_list_desk_items: this.config.selected_list_desk_items
    });
    this.layout = new LayoutManagerData({
      sep_norm: 0,
      children: [
        {
          panel_id: "DeskListView",
          immortal: true
        }, {
          panel_id: "AdminDeskNavigatorView",
          strength: 3
        }
      ]
    });
  }

  return AdminDeskData;

})(Model);
// Generated by CoffeeScript 1.11.1
var DeskData,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

DeskData = (function(superClass) {
  extend(DeskData, superClass);

  function DeskData(config) {
    DeskData.__super__.constructor.call(this);
    this.add_attr({
      config: config
    });
    this.add_attr({
      list_desk_items: this.config.list_desk_items,
      selected_list_desk_items: this.config.selected_list_desk_items
    });
    this.layout = new LayoutManagerData({
      sep_norm: 0,
      children: [
        {
          sep_norm: 1,
          children: [
            {
              panel_id: "DeskListView",
              immortal: true
            }
          ]
        }, {
          panel_id: "DeskNavigatorView",
          strength: 3
        }
      ]
    });
  }

  return DeskData;

})(Model);
// Generated by CoffeeScript 1.11.1
var DeskItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

DeskItem = (function(superClass) {
  extend(DeskItem, superClass);

  function DeskItem(name, ref) {
    if (ref == null) {
      ref = "";
    }
    DeskItem.__super__.constructor.call(this);
    this.add_attr({
      _ico: "",
      _name: "",
      _ref: "",
      _context_actions: new Lst
    });
    this._name._set(name);
    this._ref._set(ref);
  }

  DeskItem.prototype.to_string = function() {
    return this._name.get();
  };

  return DeskItem;

})(Model);
// Generated by CoffeeScript 1.11.1
var View,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

View = (function(superClass) {
  extend(View, superClass);

  function View() {
    return View.__super__.constructor.apply(this, arguments);
  }

  return View;

})(Process);
// Generated by CoffeeScript 1.11.1
var _index_current_popup, add_class, get_left, get_top, new_dom_element, new_popup, rem_class,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

new_dom_element = function(params, nodeName) {
  var k, n, name, v, val;
  if (params == null) {
    params = {};
  }
  if (nodeName == null) {
    nodeName = "div";
  }
  n = document.createElement(params.nodeName || nodeName);
  for (name in params) {
    val = params[name];
    switch (name) {
      case "parentNode":
        val.appendChild(n);
        break;
      case "nodeName":
        void 0;
        break;
      case "style":
        for (k in val) {
          v = val[k];
          n.style[k] = v;
        }
        break;
      case "txt":
        n.innerHTML = val;
        break;
      default:
        n[name] = val;
    }
  }
  return n;
};

add_class = function(obj, src) {
  var old, p_1;
  if (typeof src === "string") {
    return add_class(obj, src.split(" "));
  }
  old = (obj.className || "").split(" ");
  p_1 = src.filter(function(x) {
    return indexOf.call(old, x) < 0;
  });
  return obj.className = (old.concat(p_1)).filter(function(x) {
    return x;
  }).join(" ");
};

rem_class = function(obj, src) {
  var old;
  if (typeof src === "string") {
    return rem_class(obj, src.split(" "));
  }
  old = (obj.className || "").split(" ");
  return obj.className = (old.filter(function(x) {
    return indexOf.call(src, x) < 0;
  })).join(" ");
};

get_left = function(l) {
  if (l.offsetParent != null) {
    return l.offsetLeft + get_left(l.offsetParent);
  } else {
    return l.offsetLeft;
  }
};

get_top = function(l) {
  if (l.offsetParent != null) {
    return l.offsetTop + get_top(l.offsetParent);
  } else {
    return l.offsetTop;
  }
};

_index_current_popup = 100;

new_popup = function(title, params) {
  var _drag_end_func, _drag_evt_func, b, clientX, clientY, close_element, extention, height, old_x, old_y, repos, res, t, top_x, top_y, w, width;
  if (params == null) {
    params = {};
  }
  if (params.popup_closer == null) {
    b = new_dom_element({
      parentNode: document.body,
      id: "popup_closer",
      onmousedown: function() {
        if (typeof params.onclose === "function") {
          params.onclose();
        }
        document.body.removeChild(b);
        return document.body.removeChild(w);
      },
      ondrop: function(evt) {
        if (!evt) {
          evt = window.event;
        }
        evt.cancelBubble = true;
        if (typeof evt.stopPropagation === "function") {
          evt.stopPropagation();
        }
        if (typeof evt.preventDefault === "function") {
          evt.preventDefault();
        }
        if (typeof evt.stopImmediatePropagation === "function") {
          evt.stopImmediatePropagation();
        }
        return false;
      },
      style: {
        position: "fixed",
        top: 0,
        bottom: 0,
        left: 0,
        right: 0,
        background: params.fixed_opacity || "#000",
        opacity: params.fixed_opacity || 0,
        zIndex: _index_current_popup
      }
    });
  }
  if ((params.event != null) && params.event.clientX) {
    clientX = params.event.clientX;
    clientY = params.event.clientY;
  } else {
    clientX = window.innerWidth / 2 - 10;
    clientY = window.innerHeight / 2 - 10;
  }
  top_x = params.top_x || -1000;
  top_y = params.top_y || -1000;
  old_x = 0;
  old_y = 0;
  w = void 0;
  if (params.width != null) {
    width = params.width;
  }
  if (params.height != null) {
    height = params.height;
  }
  repos = function() {
    top_x = clientX - w.clientWidth / 2;
    top_y = clientY - w.clientHeight / 2;
    if ((top_x + w.clientWidth) > window.innerWidth) {
      top_x = window.innerWidth - w.clientWidth - 50;
    }
    if ((top_y + w.clientHeight) > window.innerHeight) {
      top_y = window.innerHeight - w.clientHeight + 50;
    }
    if (top_x < 50) {
      top_x = 50;
    }
    if (top_y < 50) {
      top_y = 50;
    }
    w.style.left = top_x;
    return w.style.top = top_y;
  };
  _drag_evt_func = function(evt) {
    top_x += evt.clientX - old_x;
    top_y += evt.clientY - old_y;
    w.style.left = top_x;
    w.style.top = top_y;
    old_x = evt.clientX;
    old_y = evt.clientY;
    return typeof evt.preventDefault === "function" ? evt.preventDefault() : void 0;
  };
  _drag_end_func = function(evt) {
    if (typeof document.detachEvent === "function") {
      document.detachEvent("onmousemove", _drag_evt_func);
    }
    if (typeof document.detachEvent === "function") {
      document.detachEvent("onmouseup", _drag_end_func);
    }
    if (typeof document.removeEventListener === "function") {
      document.removeEventListener("mousemove", _drag_evt_func, true);
    }
    return typeof document.removeEventListener === "function" ? document.removeEventListener("mouseup", _drag_end_func, true) : void 0;
  };
  extention = "px";
  if (!params.top_x) {
    setTimeout(repos, 1);
    extention = "%";
  }
  w = new_dom_element({
    parentNode: document.body,
    className: "Popup",
    style: {
      position: "absolute",
      left: top_x,
      top: top_y,
      width: width + extention,
      height: height + extention,
      zIndex: _index_current_popup + 1
    }
  });
  _index_current_popup += 2;
  close_element = new_dom_element({
    parentNode: w,
    className: "PopupClose",
    txt: "Close",
    onmousedown: function(evt) {
      if (typeof params.onclose === "function") {
        params.onclose();
      }
      if (b != null) {
        document.body.removeChild(b);
      }
      return document.body.removeChild(w);
    }
  });
  if (title) {
    t = new_dom_element({
      parentNode: w,
      className: "PopupTitle",
      innerHTML: title,
      onmousedown: function(evt) {
        old_x = evt.clientX;
        old_y = evt.clientY;
        top_x = parseInt(w.style.left);
        top_y = parseInt(w.style.top);
        document.addEventListener("mousemove", _drag_evt_func, true);
        document.addEventListener("mouseup", _drag_end_func, true);
        return typeof evt.preventDefault === "function" ? evt.preventDefault() : void 0;
      }
    });
  }
  res = new_dom_element({
    parentNode: w,
    className: "PopupWindow",
    style: {
      padding: "6px"
    }
  });
  if (params.child != null) {
    res.appendChild(params.child);
  }
  return res;
};
// Generated by CoffeeScript 1.11.1
var TreeView,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

TreeView = (function(superClass) {
  extend(TreeView, superClass);

  function TreeView(el1, roots, selected, visible, closed, visibility_context) {
    this.el = el1;
    this.roots = roots;
    this.selected = selected != null ? selected : new Lst;
    this.visible = visible != null ? visible : new Model;
    this.closed = closed != null ? closed : new Lst;
    this.visibility_context = visibility_context;
    if (this.visibility_context == null) {
      this.visibility_context = new Str("default_visibility_context");
    }
    if (this.visible[this.visibility_context.get()] == null) {
      this.visible.add_attr(this.visibility_context.get(), new Lst);
    }
    TreeView.__super__.constructor.call(this, [this.roots, this.closed, this.selected, this.visible, this.visibility_context]);
    this.css_prefix = "";
    this.icon_width = 18;
    this.line_height = 18;
    this.index_color_for_tree = 0;
    this.sep_x = this.line_height * 4 / 4;
    this._line_div = new_dom_element({
      className: this.css_prefix + "TreeLine",
      style: {
        position: "absolute",
        height: 2,
        right: 0
      }
    });
    this._created_elements = [];
    this.linked_id_dom = {};
  }

  TreeView.prototype.get_children_of = function(item) {
    return item._children;
  };

  TreeView.prototype.get_output_of = function(item) {
    return item._output;
  };

  TreeView.prototype.insert_child = function(par, pos, chi) {
    if (par._children == null) {
      par.add_attr({
        _children: []
      });
    }
    return par._children.insert(pos, [chi]);
  };

  TreeView.prototype.get_viewable_of = function(item) {
    return item._viewable;
  };

  TreeView.prototype.get_computable_of = function(item) {
    return item instanceof TreeItem_Computable;
  };

  TreeView.prototype.get_name_of = function(item) {
    return item._name;
  };

  TreeView.prototype.get_name_class_of = function(item) {
    return item._name_class;
  };

  TreeView.prototype.get_ico_of = function(item) {
    return item._ico;
  };

  TreeView.prototype.onchange = function() {
    var dom_elem, el, j, len, model, ref, ref1, ref2, results;
    if (this._need_render()) {
      this._update_repr();
      this._render();
    }
    ref = this.flat;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      el = ref[j];
      model = el.item;
      if (this.linked_id_dom[model.model_id] != null) {
        if ((ref1 = this.get_children_of(model)) != null ? ref1.has_been_directly_modified() : void 0) {
          dom_elem = this.linked_id_dom[model.model_id];
          dom_elem.classList.add("TreeJustModified");
        }
        if ((ref2 = this.get_output_of(model)) != null ? ref2.has_been_directly_modified() : void 0) {
          dom_elem = this.linked_id_dom[model.model_id];
          results.push(dom_elem.classList.add("TreeJustModified"));
        } else {
          results.push(void 0);
        }
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  TreeView.prototype._get_color_element = function(info) {
    var col;
    col = "#262626";
    return col;
  };

  TreeView.prototype._get_next_color_element = function() {
    var tab;
    tab = ["lightSeaGreen"];
    if (this.index_color_for_tree === tab.length - 1) {
      this.index_color_for_tree = 0;
    } else {
      this.index_color_for_tree++;
    }
    return tab[this.index_color_for_tree];
  };

  TreeView.prototype._render = function() {
    var c, info, j, k, len, len1, pos_y, ref, ref1, results;
    ref = this._created_elements;
    for (j = 0, len = ref.length; j < len; j++) {
      c = ref[j];
      this.el.removeChild(c);
    }
    this._created_elements = [];
    this.linked_id_dom = {};
    pos_y = 0;
    this.height_header = this.line_height + 10;
    this.height_icon_bar = 0;
    pos_y += this.height_header;
    pos_y += this.height_icon_bar;
    this.treeContainer = new_dom_element({
      nodeName: "div",
      id: "ContainerTreeView",
      parentNode: this.el
    });
    this._created_elements.push(this.treeContainer);
    ref1 = this.flat;
    results = [];
    for (k = 0, len1 = ref1.length; k < len1; k++) {
      info = ref1[k];
      results.push((function(_this) {
        return function(info) {
          var div, elem, is_ref, l, len2, ref2;
          div = new_dom_element({
            parentNode: _this.treeContainer,
            className: _this.css_prefix + "TreeView",
            my_item: info,
            style: {
              position: "absolute",
              top: pos_y,
              height: _this.line_height,
              lineHeight: _this.line_height + "px",
              left: 0,
              right: 0,
              overflow: "hidden",
              color: _this._get_color_element(info)
            },
            onclick: function(evt) {
              if (evt.ctrlKey) {
                _this.selected.toggle(info.item_path);
              } else {
                _this.selected.clear();
                _this.selected.push(info.item_path);
              }
              return true;
            },
            draggable: true,
            ondragstart: function(evt) {
              _this.drag_info = info;
              _this.drag_kind = evt.ctrlKey ? "copy" : "move";
              evt.dataTransfer.effectAllowed = _this.drag_kind;
              return evt.dataTransfer.setData('text/plain', '');
            },
            ondragend: function(evt) {
              if (_this._line_div.parentNode === _this.el) {
                _this.el.removeChild(_this._line_div);
              }
              evt.returnValue = false;
              return false;
            },
            ondragover: function(evt) {
              var bar, l, n, num, par, ref2;
              for (num = l = ref2 = info.path.length - 1; ref2 <= 0 ? l <= 0 : l >= 0; num = ref2 <= 0 ? ++l : --l) {
                par = info.path[num];
                if (_this._accept_child(par, _this.drag_info)) {
                  n = par.num_in_flat;
                  if (num + 1 < info.path.length) {
                    bar = info.path[num + 1];
                    n = bar.num_in_flat + _this._nb_displayed_children(bar);
                  }
                  _this._line_div.style.top = _this.line_height * (n + 1) + _this.height_header + _this.height_icon_bar;
                  _this._line_div.style.left = _this.sep_x * (num + 1);
                  _this.el.appendChild(_this._line_div);
                  break;
                }
              }
              evt.returnValue = false;
              return false;
            },
            ondragleave: function(evt) {
              if (_this._line_div.parentNode === _this.el) {
                _this.el.removeChild(_this._line_div);
              }
              evt.returnValue = false;
              return false;
            },
            ondrop: function(evt) {
              var accept_child, file, files, format, l, len2, m, n, num, p, par, pic, ref2, ref3;
              if (typeof files === "undefined") {
                evt.stopPropagation();
                evt.returnValue = false;
                evt.preventDefault();
                files = evt.dataTransfer.files;
              }
              if (evt.dataTransfer.files.length > 0) {
                for (l = 0, len2 = files.length; l < len2; l++) {
                  file = files[l];
                  format = file.type.indexOf("image");
                  console.log("TODO, need to create an Img who contains a Path");
                  if (format !== -1) {
                    pic = new ImgItem(file.name);
                    accept_child = info.item.accept_child(pic);
                    if (accept_child === true) {
                      info.item.add_child(pic);
                      info.item.img_collection.push(pic);
                    }
                  }
                }
              }
              for (num = m = ref2 = info.path.length - 1; ref2 <= 0 ? m <= 0 : m >= 0; num = ref2 <= 0 ? ++m : --m) {
                par = info.path[num];
                if (_this._accept_child(par, _this.drag_info)) {
                  if (_this.drag_kind === "move" && _this.drag_info.parents.length) {
                    p = _this.drag_info.parents[_this.drag_info.parents.length - 1];
                    if ((ref3 = _this.get_children_of(p.item)) != null) {
                      ref3.remove_ref(_this.drag_info.item);
                    }
                  }
                  n = 0;
                  if (num + 1 < info.path.length) {
                    n = info.path[num + 1].num_in_parent + 1;
                  }
                  _this.insert_child(par.item, n, _this.drag_info.item);
                  break;
                }
              }
              evt.returnValue = false;
              evt.stopPropagation();
              evt.preventDefault();
              return false;
            }
          });
          _this.linked_id_dom[info.item.model_id] = div;
          is_ref = false;
          ref2 = _this.flat;
          for (l = 0, len2 = ref2.length; l < len2; l++) {
            elem = ref2[l];
            if (elem.item.equals(info.item)) {
              if (!_this.selected.contains(info.item_path)) {
                if (_this.selected.contains(elem.item_path)) {
                  is_ref = true;
                  break;
                }
              }
            }
          }
          if (is_ref) {
            div.className += " " + _this.css_prefix + "TreePartiallySelected";
          }
          if (_this.selected.contains(info.item_path)) {
            div.className += " " + _this.css_prefix + "TreeSelected";
          } else if (_this.closed.contains(info.item_path) && _this._has_a_selected_child(info.item, info.item_path)) {
            div.className += " " + _this.css_prefix + "TreePartiallySelected";
          }
          pos_y += _this.line_height;
          _this._add_tree_signs(div, info);
          return _this._make_line(div, info);
        };
      })(this)(info));
    }
    return results;
  };

  TreeView.prototype._add_tree_signs = function(div, info) {
    var j, len, len_i, num_i, p, pos_x, ref, ref1, ref2, tc;
    pos_x = 0;
    ref = info.parents;
    for (j = 0, len = ref.length; j < len; j++) {
      p = ref[j];
      if (p.num_in_parent < p.len_sibling - 1) {
        new_dom_element({
          parentNode: div,
          nodeName: 'span',
          className: this.css_prefix + "TreeIcon_tree_cnt",
          style: {
            position: "absolute",
            top: 0,
            left: pos_x,
            width: this.sep_x,
            height: this.line_height
          }
        });
      }
      pos_x += this.sep_x;
    }
    tc = this.css_prefix + "TreeIcon_tree";
    num_i = info.num_in_parent;
    len_i = info.len_sibling;
    if (len_i === 1) {
      tc += "_end";
    } else if (num_i === 0 && info.path.length === 1) {
      tc += "_beg";
    } else if (num_i < len_i - 1) {
      tc += "_mid";
    } else {
      tc += "_end";
    }
    if (((ref1 = this.get_children_of(info.item)) != null ? ref1.length : void 0) || ((ref2 = this.get_output_of(info.item)) != null ? ref2.length : void 0)) {
      if (this.closed.contains(info.item_path)) {
        tc += "_add";
      } else {
        tc += "_sub";
      }
    }
    return new_dom_element({
      parentNode: div,
      className: tc,
      nodeName: 'span',
      onmousedown: (function(_this) {
        return function(evt) {
          return _this.closed.toggle(info.item_path);
        };
      })(this),
      style: {
        position: "absolute",
        top: 0,
        left: pos_x,
        width: this.sep_x,
        height: this.line_height
      }
    });
  };

  TreeView.prototype._make_line = function(div, info) {
    var classTitle, name, pos_x, ref, ref1;
    pos_x = this.sep_x * info.path.length;
    name = new_dom_element({
      parentNode: div,
      txt: info.name,
      className: info.name_class,
      style: {
        position: "absolute",
        top: 0,
        height: this.line_height,
        left: pos_x,
        right: 0
      }
    });
    if (info.is_an_output) {
      name.style.textAlign = "left";
      name.style.color = "red";
      name.style.right = "20px";
    }
    if (this.get_computable_of(info.item)) {
      classTitle = "TreeComputableItem";
      new_dom_element({
        parentNode: div,
        className: this.css_prefix + classTitle,
        onmousedown: (function(_this) {
          return function(evt) {
            if (!info.item._computation_mode.get() && !info.item._computation_state.get()) {
              return info.item.do_it();
            }
          };
        })(this),
        style: {
          position: "absolute",
          top: 0,
          right: 22
        }
      });
    }
    if ((ref = this.get_viewable_of(info.item)) != null ? ref.toBoolean() : void 0) {
      return new_dom_element({
        parentNode: div,
        className: (ref1 = info.item, indexOf.call(this.visible[this.visibility_context.get()], ref1) >= 0) ? this.css_prefix + "TreeVisibleItem" : this.selected.contains(info.item_path) ? this.css_prefix + "TreeSelectedItem" : this.css_prefix + "TreeHiddenItem",
        onmousedown: (function(_this) {
          return function(evt) {
            if ((info.item._allow_vmod != null) === false || info.item._allow_vmod.get()) {
              return _this.visible[_this.visibility_context.get()].toggle_ref(info.item);
            }
          };
        })(this),
        style: {
          position: "absolute",
          top: 0,
          right: 0
        }
      });
    }
  };

  TreeView.prototype._update_repr = function() {
    var num_item;
    this.flat = [];
    return this.repr = (function() {
      var j, ref, results;
      results = [];
      for (num_item = j = 0, ref = this.roots.length; 0 <= ref ? j < ref : j > ref; num_item = 0 <= ref ? ++j : --j) {
        results.push(this._update_repr_rec(this.roots[num_item], num_item, this.roots.length, []));
      }
      return results;
    }).call(this);
  };

  TreeView.prototype._update_repr_rec = function(item, number, length, parents, output) {
    var ch, info, num_ch, p, par, ref;
    if (output == null) {
      output = false;
    }
    info = {
      item: item,
      name: this.get_name_of(item).get(),
      name_class: ((ref = this.get_name_class_of(item)) != null ? ref.get() : void 0) || "",
      num_in_parent: number,
      len_sibling: length,
      children: [],
      outputs: [],
      parents: parents,
      path: (function() {
        var j, len, results;
        results = [];
        for (j = 0, len = parents.length; j < len; j++) {
          p = parents[j];
          results.push(p);
        }
        return results;
      })(),
      item_path: (function() {
        var j, len, results;
        results = [];
        for (j = 0, len = parents.length; j < len; j++) {
          p = parents[j];
          results.push(p.item);
        }
        return results;
      })(),
      num_in_flat: this.flat.length,
      is_an_output: output
    };
    info.path.push(info);
    info.item_path.push(item);
    this.flat.push(info);
    if (!this.closed.contains(info.item_path)) {
      ch = this.get_children_of(item);
      if (ch != null) {
        info.children = (function() {
          var j, ref1, results;
          results = [];
          for (num_ch = j = 0, ref1 = ch.length; 0 <= ref1 ? j < ref1 : j > ref1; num_ch = 0 <= ref1 ? ++j : --j) {
            par = (function() {
              var k, len, results1;
              results1 = [];
              for (k = 0, len = parents.length; k < len; k++) {
                p = parents[k];
                results1.push(p);
              }
              return results1;
            })();
            par.push(info);
            results.push(this._update_repr_rec(ch[num_ch], num_ch, ch.length, par, false));
          }
          return results;
        }).call(this);
      }
      ch = this.get_output_of(item);
      if (ch != null) {
        info.outputs = (function() {
          var j, ref1, results;
          results = [];
          for (num_ch = j = 0, ref1 = ch.length; 0 <= ref1 ? j < ref1 : j > ref1; num_ch = 0 <= ref1 ? ++j : --j) {
            par = (function() {
              var k, len, results1;
              results1 = [];
              for (k = 0, len = parents.length; k < len; k++) {
                p = parents[k];
                results1.push(p);
              }
              return results1;
            })();
            par.push(info);
            results.push(this._update_repr_rec(ch[num_ch], num_ch, ch.length, par, true));
          }
          return results;
        }).call(this);
      }
    }
    return info;
  };

  TreeView.prototype._need_render = function() {
    var i, item, j, k, len, len1, ref, ref1, ref2, ref3, ref4, ref5;
    if (this.visible[this.visibility_context.get()] == null) {
      this.visible.add_attr(this.visibility_context.get(), new Lst);
    }
    ref = [this.closed, this.selected, this.visible[this.visibility_context.get()], this.visibility_context];
    for (j = 0, len = ref.length; j < len; j++) {
      i = ref[j];
      if (i.has_been_directly_modified()) {
        return true;
      }
    }
    ref1 = this._flat_item_list();
    for (k = 0, len1 = ref1.length; k < len1; k++) {
      item = ref1[k];
      if (item.has_been_directly_modified()) {
        return true;
      }
      if ((ref2 = this.get_children_of(item)) != null ? ref2.has_been_directly_modified() : void 0) {
        return true;
      }
      if ((ref3 = this.get_output_of(item)) != null ? ref3.has_been_directly_modified() : void 0) {
        return true;
      }
      if ((ref4 = this.get_viewable_of(item)) != null ? ref4.has_been_directly_modified() : void 0) {
        return true;
      }
      if ((ref5 = this.get_name_class_of(item)) != null ? ref5.has_been_modified() : void 0) {
        return true;
      }
    }
    return false;
  };

  TreeView.prototype._has_a_selected_child = function(item, item_path) {
    var c, cp, j, len, p, ref;
    if (this.get_children_of(item) != null) {
      ref = this.get_children_of(item);
      for (j = 0, len = ref.length; j < len; j++) {
        c = ref[j];
        cp = (function() {
          var k, len1, results;
          results = [];
          for (k = 0, len1 = item_path.length; k < len1; k++) {
            p = item_path[k];
            results.push(p);
          }
          return results;
        })();
        cp.push(c);
        if (this.selected.contains(cp)) {
          return true;
        }
        if (this._has_a_selected_child(c, cp)) {
          return true;
        }
      }
    }
    return false;
  };

  TreeView.prototype._nb_displayed_children = function(info) {
    var c, j, len, ref, res;
    res = 0;
    ref = info.children;
    for (j = 0, len = ref.length; j < len; j++) {
      c = ref[j];
      res += 1 + this._nb_displayed_children(c);
    }
    return res;
  };

  TreeView.prototype._accept_child = function(parent, source) {
    var base;
    return (source != null) && (indexOf.call(parent.parents, source) < 0) && (typeof (base = parent.item).accept_child === "function" ? base.accept_child(source.item) : void 0);
  };

  TreeView.prototype._flat_item_list = function() {
    var item, j, len, ref, res;
    res = [];
    ref = this.roots;
    for (j = 0, len = ref.length; j < len; j++) {
      item = ref[j];
      this._flat_item_list_rec(res, item);
    }
    return res;
  };

  TreeView.prototype._flat_item_list_rec = function(res, item) {
    var c, j, k, len, len1, ref, ref1, results;
    res.push(item);
    if (this.get_output_of(item) != null) {
      ref = this.get_output_of(item);
      for (j = 0, len = ref.length; j < len; j++) {
        c = ref[j];
        this._flat_item_list_rec(res, c);
      }
    }
    if (this.get_children_of(item) != null) {
      ref1 = this.get_children_of(item);
      results = [];
      for (k = 0, len1 = ref1.length; k < len1; k++) {
        c = ref1[k];
        results.push(this._flat_item_list_rec(res, c));
      }
      return results;
    }
  };

  return TreeView;

})(View);
// Generated by CoffeeScript 1.11.1
var LayoutManager,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

LayoutManager = (function(superClass) {
  extend(LayoutManager, superClass);

  function LayoutManager(el, model, browser_state) {
    var i;
    this.el = el;
    this.model = model;
    if (browser_state == null) {
      browser_state = new BrowserState;
    }
    LayoutManager.__super__.constructor.call(this, [this.model, browser_state.window_size]);
    this.disp_top = 0;
    this.disp_left = 0;
    this.disp_right = 0;
    this.disp_bottom = 0;
    this.border_size = 4;
    this._pan_vs_id = {};
    this._int_edges = [];
    this._ext_edges = (function() {
      var j, results;
      results = [];
      for (i = j = 0; j < 4; i = ++j) {
        results.push((function(_this) {
          return function(i) {
            return new_dom_element({
              className: "LayoutManager_Border",
              onmousedown: function(evt) {
                return _this._cut_border_mouse_down(i % 2, i >= 2, evt);
              },
              style: {
                position: "absolute",
                cursor: "wnes"[i] + "-resize"
              }
            });
          };
        })(this)(i));
      }
      return results;
    }).call(this);
    this.tmp_border = document.createElement("div");
    this.tmp_border.style.position = "absolute";
    this.tmp_border.style.opacity = 0.5;
    this._hidden = false;
  }

  LayoutManager.prototype.onchange = function() {
    if (!this._hidden) {
      return this.render();
    }
  };

  LayoutManager.prototype.new_panel_instance = function(data, title) {
    var b, g, r, res;
    res = new LayoutManagerPanelInstance(this.el, data, title);
    r = Math.floor(Math.random() * 255);
    g = Math.floor(Math.random() * 255);
    b = Math.floor(Math.random() * 255);
    res.div.style.background = "rgb( " + r + ", " + g + ", " + b + " )";
    return res;
  };

  LayoutManager.prototype.render = function() {
    var b, e, info, j, k, key, keys, len, len1, len2, len3, m, n, p, p_max, p_min, ref, ref1, ref2, results, used_pid, val;
    b = this.border_size;
    p_min = [this.disp_left + b, this.disp_top + b];
    p_max = [this.el.offsetWidth - this.disp_right - b, this.el.offsetHeight - this.disp_bottom - b];
    this.flat = this.model.make_info(p_min, p_max, b);
    this._ext_edges[0].style.left = this.disp_left + 0;
    this._ext_edges[0].style.top = this.disp_top;
    this._ext_edges[0].style.bottom = this.disp_bottom;
    this._ext_edges[0].style.width = this.border_size;
    this._ext_edges[1].style.top = this.disp_top + 0;
    this._ext_edges[1].style.left = this.disp_left + this.border_size;
    this._ext_edges[1].style.right = this.disp_right + this.border_size;
    this._ext_edges[1].style.height = this.border_size;
    this._ext_edges[2].style.right = this.disp_right + 0;
    this._ext_edges[2].style.top = this.disp_top;
    this._ext_edges[2].style.bottom = this.disp_bottom;
    this._ext_edges[2].style.width = this.border_size;
    this._ext_edges[3].style.bottom = this.disp_bottom + 0;
    this._ext_edges[3].style.left = this.disp_left + this.border_size;
    this._ext_edges[3].style.right = this.disp_right + this.border_size;
    this._ext_edges[3].style.height = this.border_size;
    ref = this._ext_edges;
    for (j = 0, len = ref.length; j < len; j++) {
      e = ref[j];
      if (e.parentNode !== this.el) {
        this.el.appendChild(e);
      }
    }
    ref1 = this._int_edges;
    for (k = 0, len1 = ref1.length; k < len1; k++) {
      b = ref1[k];
      if (b.parentNode === this.el) {
        this.el.removeChild(b);
      }
    }
    this._int_edges = (function() {
      var len2, m, ref2, results;
      ref2 = this.flat;
      results = [];
      for (m = 0, len2 = ref2.length; m < len2; m++) {
        p = ref2[m];
        if (p.d_border != null) {
          results.push((function(_this) {
            return function(p) {
              return new_dom_element({
                parentNode: _this.el,
                className: "LayoutManager_Border",
                onmousedown: function(evt) {
                  return _this._int_border_mouse_down(p, evt);
                },
                style: {
                  position: "absolute",
                  cursor: p.d_border ? "row-resize" : "col-resize",
                  left: p.d_border ? p.p_min[0] : p.p_max[0],
                  top: p.d_border ? p.p_max[1] : p.p_min[1],
                  width: p.d_border ? p.p_max[0] - p.p_min[0] : p.border_s,
                  height: p.d_border ? p.border_s : p.p_max[1] - p.p_min[1]
                }
              });
            };
          })(this)(p));
        }
      }
      return results;
    }).call(this);
    used_pid = {};
    ref2 = this.flat;
    for (m = 0, len2 = ref2.length; m < len2; m++) {
      info = ref2[m];
      if (!(info.children.length === 0)) {
        continue;
      }
      used_pid[info.panel_id] = true;
      if (this._pan_vs_id[info.panel_id] == null) {
        this._pan_vs_id[info.panel_id] = this.new_panel_instance(info.data);
      }
      this._pan_vs_id[info.panel_id].render(info);
    }
    keys = (function() {
      var ref3, results;
      ref3 = this._pan_vs_id;
      results = [];
      for (key in ref3) {
        val = ref3[key];
        if (!(used_pid[key] == null)) {
          continue;
        }
        val.destructor();
        results.push(key);
      }
      return results;
    }).call(this);
    results = [];
    for (n = 0, len3 = keys.length; n < len3; n++) {
      key = keys[n];
      results.push(delete this._pan_vs_id[key]);
    }
    return results;
  };

  LayoutManager.prototype.hide = function() {
    var b, j, k, key, len, len1, ref, ref1, ref2, results, val;
    this._hidden = true;
    ref = this._pan_vs_id;
    for (key in ref) {
      val = ref[key];
      val.hide();
    }
    ref1 = this._int_edges;
    for (j = 0, len = ref1.length; j < len; j++) {
      b = ref1[j];
      if (b.parentNode === this.el) {
        this.el.removeChild(b);
      }
    }
    ref2 = this._ext_edges;
    results = [];
    for (k = 0, len1 = ref2.length; k < len1; k++) {
      b = ref2[k];
      if (b.parentNode === this.el) {
        results.push(this.el.removeChild(b));
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  LayoutManager.prototype.show = function() {
    this._hidden = false;
    return this.model._signal_change();
  };

  LayoutManager.prototype.set_message = function(msg) {
    if (this.message == null) {
      this.message = document.createElement("span");
      this.message.className = "LayoutManager_Message";
      this.message.appendChild(document.createTextNode(msg));
    }
    if (this.message.parentNode === this.el) {
      this.el.removeChild(this.message);
    }
    this.el.appendChild(this.message);
    return this.message.firstChild.nodeValue = msg;
  };

  LayoutManager.prototype.del_message = function() {
    if ((this.message != null) && this.message.parentNode === this.el) {
      return this.el.removeChild(this.message);
    }
  };

  LayoutManager.prototype._end_mouse_interact = function() {
    this.el.onmouseup = null;
    this.el.onmouseout = null;
    this.el.onmousemove = null;
    if ((this.tmp_border != null) && this.tmp_border.parentNode === this.el) {
      this.el.removeChild(this.tmp_border);
    }
    return this.del_message();
  };

  LayoutManager.prototype._int_border_mouse_down = function(repr, evt) {
    if (evt == null) {
      evt = window.event;
    }
    this.el.onmouseup = (function(_this) {
      return function(evt) {
        return _this._int_border_mouse_up(repr, evt);
      };
    })(this);
    this.el.onmouseout = (function(_this) {
      return function(evt) {
        return _this._int_border_mouse_out(repr, evt);
      };
    })(this);
    this.el.onmousemove = (function(_this) {
      return function(evt) {
        return _this._int_border_mouse_move(repr, evt);
      };
    })(this);
    if (typeof evt.preventDefault === "function") {
      evt.preventDefault();
    }
    evt.returnValue = false;
    return false;
  };

  LayoutManager.prototype._int_border_mouse_up = function(repr, evt) {
    this._end_mouse_interact();
    return this._use_int_border(repr, LayoutManager.abs_evt_pos(this.el, evt));
  };

  LayoutManager.prototype._int_border_mouse_out = function(repr, evt) {
    var from;
    if (evt == null) {
      evt = window.event;
    }
    from = evt.relatedTarget || evt.toElement;
    if (!from || from.nodeName === "HTML") {
      return this._end_mouse_interact();
    }
  };

  LayoutManager.prototype._int_border_mouse_move = function(repr, evt) {
    if (evt == null) {
      evt = window.event;
    }
    return this._update_int_border(repr, LayoutManager.abs_evt_pos(this.el, evt));
  };

  LayoutManager.prototype._update_int_border = function(info, p) {
    var c_0, c_1, d, l_0, l_1, ok, p_0, p_1, p_max, p_min, par;
    par = info.parent;
    d = info.d_border;
    p_0 = par.children[info.num_in_p + 0].p_min[d];
    p_1 = par.children[info.num_in_p + 1].p_max[d];
    if (p[d] < p_0 || p[d] > p_1) {
      c_0 = p[d] < p_0 && par.children[info.num_in_p + 0].can_be_destroyed();
      c_1 = p[d] > p_1 && par.children[info.num_in_p + 1].can_be_destroyed();
      if (c_0 || c_1) {
        if (c_0) {
          LayoutManager.resize_div(this.tmp_border, par.children[info.num_in_p + 0].p_min, par.children[info.num_in_p + 0].p_max);
        } else {
          LayoutManager.resize_div(this.tmp_border, par.children[info.num_in_p + 1].p_min, par.children[info.num_in_p + 1].p_max);
        }
        this.tmp_border.style.background = "#000000";
        this.set_message("Destruction ?");
      } else {
        this.set_message("This item cannot be destroyed");
      }
      return true;
    }
    ok = true;
    l_0 = p_0 + info.border_s / 2 + par.children[info.num_in_p + 0].min_by(d);
    l_1 = p_1 - info.border_s / 2 - par.children[info.num_in_p + 1].min_by(d);
    if (p[d] < l_0 || p[d] > l_1) {
      if (p[d] < l_0) {
        p[d] = l_0;
      } else {
        p[d] = l_1;
      }
      this.tmp_border.style.background = "#FF0000";
      this.set_message("The minimum size is achieved.");
      ok = false;
    }
    l_0 = p_0 + info.border_s / 2 + par.children[info.num_in_p + 0].max_by(d);
    l_1 = p_1 - info.border_s / 2 - par.children[info.num_in_p + 1].max_by(d);
    if (p[d] > l_0 || p[d] < l_1) {
      if (p[d] > l_0) {
        p[d] = l_0;
      } else {
        p[d] = l_1;
      }
      this.tmp_border.style.background = "#FF0000";
      this.set_message("The maximum size is achieved.");
      ok = false;
    }
    if (ok) {
      this.tmp_border.style.background = "#FFFFFF";
      this.del_message();
    }
    p_min = [info.p_min[0], info.p_min[1]];
    p_max = [info.p_max[0], info.p_max[1]];
    p_min[d] = p[d] - info.border_s / 2;
    p_max[d] = p[d] + info.border_s / 2;
    LayoutManager.resize_div(this.tmp_border, p_min, p_max);
    if (this.tmp_border.parentNode !== this.el) {
      return this.el.appendChild(this.tmp_border);
    }
  };

  LayoutManager.prototype._use_int_border = function(info, p) {
    var c_0, c_1, d, l_0, l_1, p_0, p_1, par;
    par = info.parent;
    d = info.d_border;
    p_0 = par.children[info.num_in_p + 0].p_min[d];
    p_1 = par.children[info.num_in_p + 1].p_max[d];
    if (p[d] < p_0 || p[d] > p_1) {
      c_0 = p[d] < p_0 && par.children[info.num_in_p + 0].can_be_destroyed();
      c_1 = p[d] > p_1 && par.children[info.num_in_p + 1].can_be_destroyed();
      if (c_0) {
        this.model.rm_panel(par.children[info.num_in_p + 0].panel_id);
      }
      if (c_1) {
        this.model.rm_panel(par.children[info.num_in_p + 1].panel_id);
      }
      return true;
    }
    l_0 = p_0 + this.border_size / 2 + par.children[info.num_in_p + 0].min_by(d);
    l_1 = p_1 - this.border_size / 2 - par.children[info.num_in_p + 1].min_by(d);
    p[d] = Math.max(p[d], l_0);
    p[d] = Math.min(p[d], l_1);
    if (par.children.length > 2) {
      console.log("TODO: par.children.length > 2");
    }
    this.model.find_item_with_panel_id(par.children[0].panel_id).strength.set(p[d] - this.border_size / 2 - p_0);
    return this.model.find_item_with_panel_id(par.children[1].panel_id).strength.set(p_1 - p[d] - this.border_size / 2);
  };

  LayoutManager.prototype._cut_border_mouse_down = function(d, s, evt) {
    if (evt == null) {
      evt = window.event;
    }
    this._update_cut_border(d, s, LayoutManager.abs_evt_pos(this.el, evt));
    this.el.onmouseup = (function(_this) {
      return function(evt) {
        return _this._cut_border_mouse_up(d, s, evt);
      };
    })(this);
    this.el.onmouseout = (function(_this) {
      return function(evt) {
        return _this._cut_border_mouse_out(d, s, evt);
      };
    })(this);
    this.el.onmousemove = (function(_this) {
      return function(evt) {
        return _this._cut_border_mouse_move(d, s, evt);
      };
    })(this);
    if (typeof evt.preventDefault === "function") {
      evt.preventDefault();
    }
    evt.returnValue = false;
    return false;
  };

  LayoutManager.prototype._cut_border_mouse_up = function(d, s, evt) {
    var di, info, j, len, p, ref;
    this._end_mouse_interact();
    p = LayoutManager.abs_evt_pos(this.el, evt);
    ref = this.flat;
    for (j = 0, len = ref.length; j < len; j++) {
      info = ref[j];
      if (info.children.length === 0) {
        if (info.contains(p)) {
          if (info.p_max[d] - info.p_min[d] <= info.min_by(d) - this.border_size) {
            return false;
          }
          di = info.p_max[d] - info.p_min[d] - this.border_size;
          di += di === 0;
          this.model.mk_split(d, s, info.panel_id, (p[d] - info.p_min[d] - this.border_size / 2.0) / di);
        }
      }
    }
  };

  LayoutManager.prototype._cut_border_mouse_out = function(d, s, evt) {
    var from;
    if (evt == null) {
      evt = window.event;
    }
    from = evt.relatedTarget || evt.toElement;
    if (!from || from.nodeName === "HTML") {
      return this._end_mouse_interact();
    }
  };

  LayoutManager.prototype._cut_border_mouse_move = function(d, s, evt) {
    if (evt == null) {
      evt = window.event;
    }
    return this._update_cut_border(d, s, LayoutManager.abs_evt_pos(this.el, evt));
  };

  LayoutManager.prototype._update_cut_border = function(d, s, p) {
    var info, j, len, p_max, p_min, ref;
    ref = this.flat;
    for (j = 0, len = ref.length; j < len; j++) {
      info = ref[j];
      if (!(info.children.length === 0 && info.contains(p))) {
        continue;
      }
      if (p[d] - info.p_min[d] <= this.border_size / 2) {
        continue;
      }
      if (info.p_max[d] - p[d] <= this.border_size / 2) {
        continue;
      }
      p_min = [info.p_min[0], info.p_min[1]];
      p_max = [info.p_max[0], info.p_max[1]];
      p_min[d] = p[d] - this.border_size / 2;
      p_max[d] = p[d] + this.border_size / 2;
      if (info.p_max[d] - info.p_min[d] === info.min_by(d)) {
        this.tmp_border.style.background = "#FF0000";
        this.set_message("The panel size is already minimal for this direction.");
      } else if ((s === 0 && info.p_max[d] - p[d] < info.min_by(d)) || (s === 1 && p[d] - info.p_min[d] < info.min_by(d))) {
        this.tmp_border.style.background = "#FF0000";
        this.set_message("Dividing here would cause this panel to be under minimal size.");
      } else {
        this.tmp_border.style.background = "#FFFFFF";
        this.del_message();
      }
      LayoutManager.resize_div(this.tmp_border, p_min, p_max);
      if (this.tmp_border.parentNode !== this.el) {
        this.el.appendChild(this.tmp_border);
      }
      return true;
    }
    if (this.tmp_border.parentNode === this.el) {
      this.el.removeChild(this.tmp_border);
    }
    return false;
  };

  LayoutManager.resize_div = function(obj, p_min, p_max) {
    obj.style.left = p_min[0];
    obj.style.top = p_min[1];
    obj.style.width = p_max[0] - p_min[0];
    return obj.style.height = p_max[1] - p_min[1];
  };

  LayoutManager.getLeft = function(l) {
    if (l.offsetParent != null) {
      return l.offsetLeft + LayoutManager.getLeft(l.offsetParent);
    }
    return l.offsetLeft;
  };

  LayoutManager.getTop = function(l) {
    if (l.offsetParent != null) {
      return l.offsetTop + LayoutManager.getTop(l.offsetParent);
    }
    return l.offsetTop;
  };

  LayoutManager.abs_evt_pos = function(obj, evt) {
    return [evt.clientX - LayoutManager.getLeft(obj), evt.clientY - LayoutManager.getTop(obj)];
  };

  return LayoutManager;

})(View);
// Generated by CoffeeScript 1.11.1
var LayoutManagerPanelInstance;

LayoutManagerPanelInstance = (function() {
  function LayoutManagerPanelInstance(el, data, title, elem_kind) {
    this.el = el;
    if (title == null) {
      title = "";
    }
    if (elem_kind == null) {
      elem_kind = "div";
    }
    this.div = document.createElement(elem_kind);
    this.div.style.position = "absolute";
    this.title = title;
  }

  LayoutManagerPanelInstance.prototype.destructor = function() {
    return this.hide();
  };

  LayoutManagerPanelInstance.prototype.render = function(info, offset) {
    var p_max, p_min;
    if (offset == null) {
      offset = 0;
    }
    this.el.appendChild(this.div);
    p_min = info.p_min;
    p_max = info.p_max;
    this.div.style.left = p_min[0] - offset;
    this.div.style.top = p_min[1] - offset;
    this.div.style.width = p_max[0] - p_min[0];
    this.div.style.height = p_max[1] - p_min[1];
    if (this.title !== "" && (this.title_elem == null)) {
      return this.title_elem = new_dom_element({
        nodeName: "div",
        className: "Title",
        parentNode: this.div,
        txt: this.title
      });
    }
  };

  LayoutManagerPanelInstance.prototype.hide = function() {
    var ref;
    if (((ref = this.title_elem) != null ? ref.parentNode : void 0) === this.div) {
      this.div.removeChild(this.title_elem);
    }
    if (this.div.parentNode === this.el) {
      return this.el.removeChild(this.div);
    }
  };

  return LayoutManagerPanelInstance;

})();
// Generated by CoffeeScript 1.11.1
var ModelEditorItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

ModelEditorItem = (function(superClass) {
  extend(ModelEditorItem, superClass);

  ModelEditorItem.default_types = [
    function(model) {
      if (model instanceof Bool) {
        return ModelEditorItem_CheckBox;
      }
    }, function(model) {
      if (model instanceof Choice) {
        return ModelEditorItem_Choice;
      }
    }, function(model) {
      if (model instanceof Button) {
        return ModelEditorItem_Button;
      }
    }, function(model) {
      if (model instanceof ConstrainedVal) {
        return ModelEditorItem_ConstrainedVal;
      }
    }, function(model) {
      if (model instanceof Text) {
        return ModelEditorItem_TextArea;
      }
    }, function(model) {
      if (model instanceof Obj) {
        return ModelEditorItem_Input;
      }
    }, function(model) {
      if (model instanceof ConstOrNotModel) {
        return ModelEditorItem_ConstOrNotModel;
      }
    }, function(model) {
      if (model.dim()) {
        return ModelEditorItem_Lst;
      }
    }, function(model) {
      if (model instanceof MoveButtons) {
        return ModelEditorItem_MoveButtons;
      }
    }
  ];

  function ModelEditorItem(params) {
    var key, ref, val;
    ModelEditorItem.__super__.constructor.call(this, params.model);
    this.default_types = [];
    for (key in params) {
      val = params[key];
      this[key] = val;
    }
    if ((this.focus == null) && (this.parent == null)) {
      this.focus = new Val(-1);
    }
    if (!this.closed_models && (this.parent == null)) {
      this.closed_models = new Lst;
    }
    if ((ref = this.get_focus()) != null) {
      ref.bind(this);
    }
    this.make_ed();
  }

  ModelEditorItem.prototype.destructor = function() {
    var ref;
    if (((ref = this.ce) != null ? ref.parentNode : void 0) != null) {
      this.ce.parentNode.removeChild(this.ce);
    }
    return ModelEditorItem.__super__.destructor.call(this);
  };

  ModelEditorItem.prototype.get_property = function(name, default_value) {
    if (this[name] != null) {
      return this[name];
    }
    if (this.parent != null) {
      return this.parent.get_property(name, default_value);
    }
    return default_value;
  };

  ModelEditorItem.prototype.get_focus = function() {
    return this.get_property("focus");
  };

  ModelEditorItem.prototype.get_item_width = function() {
    return this.get_property("item_width", 98);
  };

  ModelEditorItem.prototype.get_className = function() {
    return this.get_property("className", '');
  };

  ModelEditorItem.prototype.get_closed_models = function() {
    return this.get_property("closed_models");
  };

  ModelEditorItem.prototype.get_label_ratio = function() {
    return this.get_property("label_ratio", 0.35);
  };

  ModelEditorItem.prototype.get_justification = function() {
    if (this.justification != null) {
      return this.justification;
    }
    if (this.parent != null) {
      return this.parent.get_justification();
    }
    return true;
  };

  ModelEditorItem.prototype.snapshot = function() {
    if (this.undo_manager != null) {
      return this.undo_manager.snapshot();
    } else if (this.parent != null) {
      return this.parent.snapshot();
    }
  };

  ModelEditorItem.prototype.get_display_name = function(model, name) {
    var res;
    if (model.get_model_editor_parameters != null) {
      res = ModelEditorItem._get_model_editor_parameters(model);
      if (res.display_name[name] != null) {
        return res.display_name[name];
      }
    }
    return this.trans_name(name);
  };

  ModelEditorItem.prototype.trans_name = function(name) {
    var r, res;
    if (this.parent != null) {
      return this.parent.trans_name(name);
    }
    r = /\_/g;
    res = name.replace(r, " ");
    return res[0].toUpperCase() + res.slice(1);
  };

  ModelEditorItem.prototype.make_ed = function() {
    var closed_models, el, legend;
    if (this.label != null) {
      if (this.ok_for_label()) {
        this.ce = new_dom_element({
          parentNode: this.el,
          nodeName: "span"
        });
        if (this.display_label()) {
          this.ev = new_dom_element({
            parentNode: this.ce,
            nodeName: "span",
            innerHTML: this.label,
            style: {
              display: "inline-block",
              fontSize: 12,
              width: this.get_item_width() * this.get_label_ratio() + "%",
              paddingLeft: 0.5 * (100 - this.get_item_width()) + "%"
            }
          });
          this.ew = this.get_item_width() * (1.0 - this.get_label_ratio());
        } else {
          this.ew = this.get_item_width();
        }
        return this.ed = this.ce;
      } else {
        this.ce = new_dom_element({
          parentNode: this.el,
          nodeName: "fieldset"
        });
        closed_models = this.get_closed_models();
        legend = new_dom_element({
          parentNode: this.ce,
          nodeName: "legend",
          innerHTML: this.label,
          onclick: (function(_this) {
            return function() {
              closed_models = _this.get_closed_models();
              return closed_models.toggle_ref(_this.model);
            };
          })(this)
        });
        el = new_dom_element({
          parentNode: this.ce
        });
        closed_models.bind((function(_this) {
          return function() {
            var ref;
            if (ref = _this.model, indexOf.call(closed_models, ref) >= 0) {
              el.style.display = "none";
              add_class(_this.ce, "ModelEditor_closed");
              return add_class(legend, "ModelEditor_closed");
            } else {
              el.style.display = "block";
              rem_class(_this.ce, "ModelEditor_closed");
              return rem_class(legend, "ModelEditor_closed");
            }
          };
        })(this));
        this.ew = this.get_item_width();
        return this.ed = el;
      }
    } else {
      this.ce = new_dom_element({
        parentNode: this.el,
        nodeName: "span",
        className: this.get_className()
      });
      this.ew = this.get_item_width();
      return this.ed = this.ce;
    }
  };

  ModelEditorItem.prototype.ok_for_label = function() {
    return true;
  };

  ModelEditorItem.prototype.display_label = function() {
    return true;
  };

  ModelEditorItem.prototype.contains_labels = function() {
    return false;
  };

  ModelEditorItem._get_model_editor_parameters = function(model) {
    var res;
    res = {
      display_name: {},
      model_editor: {}
    };
    model.get_model_editor_parameters(res);
    return res;
  };

  ModelEditorItem.get_item_type_for = function(params) {
    var i, it, len, r, ref, ref1, res, t;
    it = params.item_type;
    if (it != null) {
      return it;
    }
    if ((params.name != null) && (((ref = params.parent) != null ? ref.model.get_model_editor_parameters : void 0) != null)) {
      res = ModelEditorItem._get_model_editor_parameters(params.parent.model);
      if (res.model_editor[params.name] != null) {
        return res.model_editor[params.name];
      }
    }
    ref1 = ModelEditorItem.default_types;
    for (i = 0, len = ref1.length; i < len; i++) {
      t = ref1[i];
      r = t(params.model);
      if (r != null) {
        return r;
      }
    }
    return ModelEditorItem_Aggregate;
  };

  return ModelEditorItem;

})(View);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Aggregate,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Aggregate = (function(superClass) {
  extend(ModelEditorItem_Aggregate, superClass);

  function ModelEditorItem_Aggregate(params) {
    ModelEditorItem_Aggregate.__super__.constructor.call(this, params);
    this.containers = {};
  }

  ModelEditorItem_Aggregate.prototype.onchange = function() {
    var i, info, j, k, l, len, len1, len2, len3, me, model_id, name, o, ref, ref1, ref2, ref3, ref4, res, span, val, w;
    ref = this.containers;
    for (model_id in ref) {
      me = ref[model_id];
      res = false;
      ref1 = this.model._attribute_names;
      for (i = 0, len = ref1.length; i < len; i++) {
        name = ref1[i];
        if (!(name[0] !== "_")) {
          continue;
        }
        val = this.model[name];
        res |= val.model_id === parseInt(model_id);
      }
      if (!res) {
        me.edit.destructor();
        delete this.containers[model_id];
      }
    }
    ref2 = this.model._attribute_names;
    for (j = 0, len1 = ref2.length; j < len1; j++) {
      name = ref2[j];
      if (!(name[0] !== "_")) {
        continue;
      }
      val = this.model[name];
      if (this.containers[val.model_id] == null) {
        this.containers[val.model_id] = {
          edit: new_model_editor({
            el: this.ed,
            model: this.model[name],
            label: this.get_display_name(this.model, name),
            parent: this,
            name: name
          }),
          span: this.get_justification() ? new_dom_element({
            parentNode: this.ed,
            nodeName: "span"
          }) : void 0
        };
      }
    }
    if (this.get_justification()) {
      w = 0;
      o = [];
      ref3 = this.model._attribute_names;
      for (k = 0, len2 = ref3.length; k < len2; k++) {
        name = ref3[k];
        if (!(name[0] !== "_")) {
          continue;
        }
        val = this.model[name];
        info = this.containers[val.model_id];
        if (w + info.edit.get_item_width() > 100) {
          info.span.style.width = 0;
          ref4 = o.slice(0, o.length - 1);
          for (l = 0, len3 = ref4.length; l < len3; l++) {
            span = ref4[l];
            span.style.display = "inline-block";
            span.style.width = (100 - w) / (o.length - 1) + "%";
          }
          w = 0;
          o = [];
        }
        w += info.edit.get_item_width();
        o.push(info.span);
      }
      if (w < 100 && o.length >= 2) {
        span = o[o.length - 2];
        span.style.display = "inline-block";
        return span.style.width = (100 - w) / (o.length - 1) + "%";
      }
    }
  };

  ModelEditorItem_Aggregate.prototype.ok_for_label = function() {
    return false;
  };

  ModelEditorItem_Aggregate.prototype.contains_labels = function() {
    return true;
  };

  ModelEditorItem_Aggregate.prototype.set_disabled = function(val) {
    var me, model_id, ref, results;
    ref = this.containers;
    results = [];
    for (model_id in ref) {
      me = ref[model_id];
      results.push(me.edit.set_disabled(val));
    }
    return results;
  };

  return ModelEditorItem_Aggregate;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_NewAttr,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_NewAttr = (function(superClass) {
  extend(ModelEditorItem_NewAttr, superClass);

  function ModelEditorItem_NewAttr(params) {
    var i, len, ref, type;
    ModelEditorItem_NewAttr.__super__.constructor.call(this, params);
    this.name = "my_attribute";
    this.nameTxt = new_dom_element({
      parentNode: this.ed,
      nodeName: "span",
      txt: "Name:",
      style: {
        display: "inline-block",
        fontSize: 12,
        color: "#262626",
        width: 0.3 * this.ew + "%",
        paddingLeft: 0.5 * (100 - this.get_item_width()) + "%",
        paddingTop: "5px"
      }
    });
    this.nameInput = new_dom_element({
      parentNode: this.ed,
      nodeName: "input",
      value: this.name,
      style: {
        width: 0.7 * this.ew + "%"
      },
      onchange: (function(_this) {
        return function() {
          _this.snapshot();
          return _this.name = _this.nameInput.value;
        };
      })(this)
    });
    this.typeTxt = new_dom_element({
      parentNode: this.ed,
      nodeName: "span",
      txt: "Type:",
      style: {
        display: "inline-block",
        fontSize: 12,
        color: "#262626",
        width: 0.3 * this.ew + "%",
        paddingLeft: 0.5 * (100 - this.get_item_width()) + "%",
        paddingTop: "5px"
      }
    });
    this.typeSelect = new_dom_element({
      parentNode: this.ed,
      nodeName: "select",
      onchange: (function(_this) {
        return function() {
          _this.snapshot();
          return _this.type = _this.typeSelect.value;
        };
      })(this),
      style: {
        width: 0.7 * this.ew + "%"
      }
    });
    ref = ['Val', 'Str', 'Bool', 'Lst', 'TypedArray_Int32', 'Mesh', 'Point'];
    for (i = 0, len = ref.length; i < len; i++) {
      type = ref[i];
      new_dom_element({
        parentNode: this.typeSelect,
        nodeName: "option",
        txt: type,
        value: type
      });
    }
    this.type = this.typeSelect.value;
    this.confirmContainer = new_dom_element({
      parentNode: this.ed,
      nodeName: "span",
      style: {
        display: "inline-block",
        textAlign: "center",
        paddingTop: "5px",
        width: this.ew + "%"
      }
    });
    this.confirm = new_dom_element({
      parentNode: this.confirmContainer,
      type: "text",
      nodeName: "button",
      txt: "Create attribute",
      onclick: (function(_this) {
        return function() {
          if (_this.name) {
            _this.model.mod_attr(_this.name, new window[_this.type](_this.val));
            if (!_this.model._gen_attr) {
              _this.model.add_attr({
                _gen_attr: []
              });
            }
            return _this.model._gen_attr.push([_this.name, _this.type]);
          }
        };
      })(this)
    });
  }

  return ModelEditorItem_NewAttr;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_NewTreeItem,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_NewTreeItem = (function(superClass) {
  extend(ModelEditorItem_NewTreeItem, superClass);

  function ModelEditorItem_NewTreeItem(params) {
    ModelEditorItem_NewTreeItem.__super__.constructor.call(this, params);
    this["class"] = "TreeItem_Parametric";
    this.name = "Item";
    this.classTxt = new_dom_element({
      parentNode: this.ed,
      nodeName: "span",
      txt: "Class:",
      style: {
        display: "inline-block",
        fontSize: 12,
        color: "#262626",
        width: 0.3 * this.ew + "%",
        paddingLeft: 0.5 * (100 - this.get_item_width()) + "%",
        paddingTop: "5px"
      }
    });
    this.classInput = new_dom_element({
      parentNode: this.ed,
      nodeName: "input",
      value: this["class"],
      style: {
        width: 0.7 * this.ew + "%"
      },
      onchange: (function(_this) {
        return function() {
          _this.snapshot();
          return _this["class"] = _this.classInput.value;
        };
      })(this)
    });
    this.nameTxt = new_dom_element({
      parentNode: this.ed,
      nodeName: "span",
      txt: "Name:",
      style: {
        display: "inline-block",
        fontSize: 12,
        color: "#262626",
        width: 0.3 * this.ew + "%",
        paddingLeft: 0.5 * (100 - this.get_item_width()) + "%",
        paddingTop: "5px"
      }
    });
    this.nameInput = new_dom_element({
      parentNode: this.ed,
      nodeName: "input",
      value: this.name,
      style: {
        width: 0.7 * this.ew + "%"
      },
      onchange: (function(_this) {
        return function() {
          _this.snapshot();
          return _this.name = _this.nameInput.value;
        };
      })(this)
    });
    this.confirmContainer = new_dom_element({
      parentNode: this.ed,
      nodeName: "span",
      style: {
        display: "inline-block",
        textAlign: "center",
        paddingTop: "5px",
        width: this.ew + "%"
      }
    });
    this.confirm = new_dom_element({
      parentNode: this.confirmContainer,
      type: "text",
      nodeName: "button",
      txt: "Create TreeItem",
      onclick: (function(_this) {
        return function() {
          var item;
          if (_this.name && _this["class"]) {
            item = new window[_this["class"]]();
            item._name.set(_this.name);
            item._name_class.set(_this["class"]);
            return _this.model.add_child(item);
          }
        };
      })(this)
    });
  }

  return ModelEditorItem_NewTreeItem;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_ConstOrNotModel,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_ConstOrNotModel = (function(superClass) {
  extend(ModelEditorItem_ConstOrNotModel, superClass);

  function ModelEditorItem_ConstOrNotModel(params) {
    ModelEditorItem_ConstOrNotModel.__super__.constructor.call(this, params);
    this.inp = new_model_editor({
      el: this.ed,
      model: this.model.model,
      parent: this,
      item_width: this.ew
    });
  }

  ModelEditorItem_ConstOrNotModel.prototype.onchange = function() {
    var ref;
    if (this.model.bool.has_been_modified()) {
      if ((ref = this.check_disabled) != null ? ref.get() : void 0) {
        return this.inp.set_disabled(!this.model.bool.get());
      } else {
        return this.inp.set_disabled(this.model.bool.get());
      }
    }
  };

  return ModelEditorItem_ConstOrNotModel;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Lst,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Lst = (function(superClass) {
  extend(ModelEditorItem_Lst, superClass);

  function ModelEditorItem_Lst(params) {
    ModelEditorItem_Lst.__super__.constructor.call(this, params);
    this.lst = [];
    this.dst = [];
  }

  ModelEditorItem_Lst.prototype.onchange = function() {
    var br, i, j, k, l, len, len1, len2, ref, ref1, ref2, res, v, w;
    if (this.model.has_been_directly_modified() || this.lst.length === 0) {
      ref = this.lst;
      for (j = 0, len = ref.length; j < len; j++) {
        v = ref[j];
        if (v.destructor) {
          v.destructor();
        } else {
          if (v.parentNode) {
            v.parentNode.removeChild(v);
          }
        }
      }
      ref1 = this.dst;
      for (k = 0, len1 = ref1.length; k < len1; k++) {
        v = ref1[k];
        v.parentNode.removeChild(v);
      }
      this.dim = ModelEditorItem_Lst._rec_dim(this.model);
      if (this.model.length < 50) {
        w = this.ew;
        if (this.model.length) {
          br = new_dom_element({
            parent: this,
            nodeName: 'br'
          });
          this.ed.appendChild(br);
          this.lst = [];
          this.lst.push(br);
          ref2 = this.model;
          for (l = 0, len2 = ref2.length; l < len2; l++) {
            i = ref2[l];
            res = new_model_editor({
              el: this.ed,
              model: i,
              parent: this
            });
            br = new_dom_element({
              parent: this,
              nodeName: 'div',
              style: {
                height: '5px'
              }
            });
            this.ed.appendChild(br);
            this.lst.push(res);
            this.lst.push(br);
          }
          this.dst = [];
        } else {
          this.lst = [];
          this.dst = [
            new_dom_element({
              parentNode: this.ed,
              style: {
                width: this.ew + "%",
                background: "#123456"
              }
            })
          ];
        }
        if (this.lst.length && (this.ev != null)) {
          this.ev.onmousedown = (function(_this) {
            return function() {
              var ref3;
              return (ref3 = _this.get_focus()) != null ? ref3.set(_this.lst[0].process_id) : void 0;
            };
          })(this);
        }
      }
    }
    return this.fd = true;
  };

  ModelEditorItem_Lst.prototype.ok_for_label = function() {
    return ModelEditorItem_Lst._rec_dim(this.model) === 1;
  };

  ModelEditorItem_Lst._rec_dim = function(model) {
    var d;
    while (typeof model.disp_only_in_model_editor === "function" ? model.disp_only_in_model_editor() : void 0) {
      model = model.disp_only_in_model_editor();
    }
    d = model.dim(true);
    if (d && (model[0] != null)) {
      return d + ModelEditorItem_Lst._rec_dim(model[0]);
    }
    return d;
  };

  return ModelEditorItem_Lst;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var new_model_editor;

new_model_editor = function(params) {
  var TI, base, key, n_params, sub_model, val;
  sub_model = typeof (base = params.model).disp_only_in_model_editor === "function" ? base.disp_only_in_model_editor() : void 0;
  if (sub_model != null) {
    n_params = {};
    for (key in params) {
      val = params[key];
      n_params[key] = val;
    }
    n_params.model = sub_model;
    return new_model_editor(n_params);
  }
  TI = ModelEditorItem.get_item_type_for(params);
  return new TI(params);
};
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Bool_Img,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Bool_Img = (function(superClass) {
  extend(ModelEditorItem_Bool_Img, superClass);

  function ModelEditorItem_Bool_Img(params) {
    ModelEditorItem_Bool_Img.__super__.constructor.call(this, params);
    this.ed.onclick = (function(_this) {
      return function() {
        _this.snapshot();
        return _this.model.toggle();
      };
    })(this);
    this.span = new_dom_element({
      parentNode: this.ed,
      nodeName: "span",
      style: {
        display: "inline-block",
        width: this.ew + "%"
      }
    });
  }

  ModelEditorItem_Bool_Img.prototype.onchange = function() {
    if (this.model.get()) {
      add_class(this.span, "ModelEditorItem_CheckImg_1");
      rem_class(this.span, "ModelEditorItem_CheckImg_0");
    } else {
      add_class(this.span, "ModelEditorItem_CheckImg_0");
      rem_class(this.span, "ModelEditorItem_CheckImg_1");
    }
    if (this.label != null) {
      if (this.model.toBoolean()) {
        return add_class(this.label, "modelEditor_checked");
      } else {
        return rem_class(this.label, "modelEditor_checked");
      }
    }
  };

  return ModelEditorItem_Bool_Img;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Input,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Input = (function(superClass) {
  extend(ModelEditorItem_Input, superClass);

  function ModelEditorItem_Input(params) {
    var ref;
    ModelEditorItem_Input.__super__.constructor.call(this, params);
    this.input = new_dom_element({
      parentNode: this.ed,
      type: "text",
      nodeName: "input",
      style: {
        width: this.ew + "%"
      },
      onchange: (function(_this) {
        return function() {
          _this.snapshot();
          return _this.model.set(_this.input.value);
        };
      })(this),
      onfocus: (function(_this) {
        return function() {
          var ref;
          return (ref = _this.get_focus()) != null ? ref.set(_this.process_id) : void 0;
        };
      })(this)
    });
    if ((ref = this.ev) != null) {
      ref.onmousedown = (function(_this) {
        return function() {
          var ref1;
          return (ref1 = _this.get_focus()) != null ? ref1.set(_this.process_id) : void 0;
        };
      })(this);
    }
  }

  ModelEditorItem_Input.prototype.onchange = function() {
    var ref;
    if (this.model.has_been_modified()) {
      this.input.value = this.model.get();
    }
    if ((ref = this.get_focus()) != null ? ref.has_been_modified() : void 0) {
      if (this.get_focus().get() === this.process_id) {
        return setTimeout(((function(_this) {
          return function() {
            return _this.input.focus();
          };
        })(this)), 1);
      } else {
        return this.input.blur();
      }
    }
  };

  ModelEditorItem_Input.prototype.set_disabled = function(val) {
    return this.input.disabled = val;
  };

  return ModelEditorItem_Input;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_NewClass,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_NewClass = (function(superClass) {
  extend(ModelEditorItem_NewClass, superClass);

  function ModelEditorItem_NewClass(params) {
    var i, len, ref, type;
    ModelEditorItem_NewClass.__super__.constructor.call(this, params);
    this.name = "MyItem";
    this.nameTxt = new_dom_element({
      parentNode: this.ed,
      nodeName: "span",
      txt: "Class name:",
      style: {
        display: "inline-block",
        fontSize: 12,
        color: "#262626",
        width: 0.3 * this.ew + "%",
        paddingLeft: 0.5 * (100 - this.get_item_width()) + "%",
        paddingTop: "5px"
      }
    });
    this.nameInput = new_dom_element({
      parentNode: this.ed,
      nodeName: "input",
      value: this.name,
      style: {
        width: 0.7 * this.ew + "%"
      },
      onchange: (function(_this) {
        return function() {
          _this.snapshot();
          return _this.name = _this.nameInput.value;
        };
      })(this)
    });
    this.languageTxt = new_dom_element({
      parentNode: this.ed,
      nodeName: "span",
      txt: "Language:",
      style: {
        display: "inline-block",
        fontSize: 12,
        color: "#262626",
        width: 0.3 * this.ew + "%",
        paddingLeft: 0.5 * (100 - this.get_item_width()) + "%",
        paddingTop: "5px"
      }
    });
    this.languageSelect = new_dom_element({
      parentNode: this.ed,
      nodeName: "select",
      onchange: (function(_this) {
        return function() {
          _this.snapshot();
          return _this.language = _this.languageSelect.value;
        };
      })(this),
      style: {
        width: 0.7 * this.ew + "%"
      }
    });
    ref = ['JavaScript', 'CoffeeScript'];
    for (i = 0, len = ref.length; i < len; i++) {
      type = ref[i];
      new_dom_element({
        parentNode: this.languageSelect,
        nodeName: "option",
        txt: type,
        value: type
      });
    }
    this.language = this.languageSelect.value;
    this.confirmContainer = new_dom_element({
      parentNode: this.ed,
      nodeName: "span",
      style: {
        display: "inline-block",
        textAlign: "center",
        paddingTop: "5px",
        width: this.ew + "%"
      }
    });
    this.confirm = new_dom_element({
      parentNode: this.confirmContainer,
      type: "text",
      nodeName: "button",
      txt: "Create JS Class",
      onclick: (function(_this) {
        return function() {
          if (_this.name) {
            _this.model._class_export_name.set(_this.name);
            _this.model._class_export_language.set(_this.language);
            return _this.model._class_export_state.set(true);
          }
        };
      })(this)
    });
  }

  return ModelEditorItem_NewClass;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_TypedArray,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_TypedArray = (function(superClass) {
  extend(ModelEditorItem_TypedArray, superClass);

  function ModelEditorItem_TypedArray(params) {
    ModelEditorItem_TypedArray.__super__.constructor.call(this, params);
    this._ad = [];
    this._size = [];
    this._inputs = [];
  }

  ModelEditorItem_TypedArray.prototype.onchange = function() {
    var i, input, j, k, l, len, len1, len2, ref, ref1, ref2, results, w;
    if (!this._same_parms()) {
      this._size = this.model.size();
      ref = this._inputs;
      for (j = 0, len = ref.length; j < len; j++) {
        i = ref[j];
        this.ed.removeChild(i);
      }
      ref1 = this._ad;
      for (k = 0, len1 = ref1.length; k < len1; k++) {
        i = ref1[k];
        this.ed.removeChild(i);
      }
      this._ad = [];
      w = this.ew / this.model.size(0);
      if (this.model.dim() > 1) {
        w = 100 / this.model.size(0);
        this._ad.push(new_dom_element({
          parentNode: this.ed,
          nodeName: "span",
          style: {
            display: "inline-block",
            width: this.ew + "%"
          }
        }));
      }
      this._inputs = (function() {
        var l, ref2, results;
        results = [];
        for (i = l = 0, ref2 = this.model.nb_items(); 0 <= ref2 ? l < ref2 : l > ref2; i = 0 <= ref2 ? ++l : --l) {
          results.push((function(_this) {
            return function(i) {
              var input;
              return input = new_dom_element({
                parentNode: _this.ed,
                type: "text",
                nodeName: "input",
                style: {
                  width: w + "%"
                },
                onchange: function() {
                  _this.snapshot();
                  return _this.model.set_val(i, input.value);
                },
                onfocus: function() {
                  var ref3;
                  return (ref3 = _this.get_focus()) != null ? ref3.set(_this.process_id) : void 0;
                }
              });
            };
          })(this)(i));
        }
        return results;
      }).call(this);
    }
    ref2 = this._inputs;
    results = [];
    for (i = l = 0, len2 = ref2.length; l < len2; i = ++l) {
      input = ref2[i];
      results.push(input.value = this.model.get(i));
    }
    return results;
  };

  ModelEditorItem_TypedArray.prototype._same_parms = function() {
    var i, j, len, ref, v;
    if (this._size.length !== this.model.dim()) {
      return false;
    }
    ref = this._size;
    for (i = j = 0, len = ref.length; j < len; i = ++j) {
      v = ref[i];
      if (v !== this.model.size(i)) {
        return false;
      }
    }
    return true;
  };

  return ModelEditorItem_TypedArray;

})(ModelEditorItem);

ModelEditorItem.default_types.unshift(function(model) {
  if (model instanceof TypedArray) {
    return ModelEditorItem_TypedArray;
  }
});
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_ChoiceWithEditableItems,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_ChoiceWithEditableItems = (function(superClass) {
  extend(ModelEditorItem_ChoiceWithEditableItems, superClass);

  function ModelEditorItem_ChoiceWithEditableItems(params) {
    ModelEditorItem_ChoiceWithEditableItems.__super__.constructor.call(this, params);
    this.choice = new_model_editor({
      el: this.ed,
      model: this.model,
      parent: this,
      item_width: this.ew,
      item_type: ModelEditorItem_Choice
    });
    this.editdiv = new_dom_element({
      parentNode: this.ed,
      nodeName: "span"
    });
    this.editors = [];
  }

  ModelEditorItem_ChoiceWithEditableItems.prototype.onchange = function() {
    var e, i, j, k, l, len, len1, ref, ref1, results;
    if (this.model.lst.has_been_directly_modified()) {
      ref = this.editors;
      for (j = 0, len = ref.length; j < len; j++) {
        e = ref[j];
        e.destructor();
      }
      this.editors = (function() {
        var k, len1, ref1, results;
        ref1 = this.model.lst;
        results = [];
        for (k = 0, len1 = ref1.length; k < len1; k++) {
          l = ref1[k];
          results.push(new_model_editor({
            el: this.editdiv,
            model: l,
            parent: this
          }));
        }
        return results;
      }).call(this);
    }
    if (this.model.num.has_been_modified() || this.model.lst.has_been_directly_modified()) {
      ref1 = this.editors;
      results = [];
      for (i = k = 0, len1 = ref1.length; k < len1; i = ++k) {
        e = ref1[i];
        results.push(e.ed.style.display = (this.model.num.get() === i ? "block" : "none"));
      }
      return results;
    }
  };

  return ModelEditorItem_ChoiceWithEditableItems;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_ConstrainedVal,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_ConstrainedVal = (function(superClass) {
  extend(ModelEditorItem_ConstrainedVal, superClass);

  function ModelEditorItem_ConstrainedVal(params) {
    this._drag_end = bind(this._drag_end, this);
    this._drag_evt = bind(this._drag_evt, this);
    var base, ref;
    ModelEditorItem_ConstrainedVal.__super__.constructor.call(this, params);
    this.inp = new_model_editor({
      el: this.ed,
      model: this.model,
      parent: this,
      item_width: 0.3 * this.ew,
      item_type: ModelEditorItem_Input
    });
    if ((ref = this.ev) != null) {
      ref.onmousedown = (function(_this) {
        return function() {
          var ref1;
          return (ref1 = _this.get_focus()) != null ? ref1.set(_this.inp.process_id) : void 0;
        };
      })(this);
    }
    this.div = new_dom_element({
      parentNode: this.ed,
      nodeName: "span",
      className: "ModelEditorSlider",
      style: {
        display: "inline-block",
        width: 0.7 * this.ew - 0.5 + "%",
        marginLeft: 0.5 + "%",
        zIndex: 1
      },
      onmousedown: (function(_this) {
        return function(evt) {
          var offset, twidth;
          _this.snapshot();
          offset = evt.clientX - get_left(_this.div) - _this.cur.offsetWidth / 2;
          twidth = _this.div.offsetWidth - _this.cur.offsetWidth;
          _this.model.set(_this.model._min.get() + offset * _this.model.delta() / twidth);
          _this.off_x = 0;
          return _this._on_mouse_down(evt, false);
        };
      })(this),
      onmousewheel: (function(_this) {
        return function(evt) {
          var delta, m;
          _this.snapshot();
          if (evt.wheelDelta != null) {
            delta = evt.wheelDelta / 120.0;
            if (window.opera) {
              delta = -delta;
            }
          } else if (evt.detail) {
            delta = -evt.detail / 3.0;
          }
          m = 10 * (1 + 9 * evt.shiftKey) * (1 + 9 * evt.ctrlKey) * (1 + 9 * evt.altKey);
          if (_this.model._div.get() !== 0) {
            _this.model.set(_this.model.get() + delta * _this.model.delta() / _this.model._div.get());
          } else {
            _this.model.set(_this.model.get() + delta * _this.model.delta() / m);
          }
          if (typeof evt.stopPropagation === "function") {
            evt.stopPropagation();
          }
          if (typeof evt.preventDefault === "function") {
            evt.preventDefault();
          }
          return false;
        };
      })(this)
    });
    if (typeof (base = this.div).addEventListener === "function") {
      base.addEventListener("DOMMouseScroll", this.div.onmousewheel, false);
    }
    this.cur = new_dom_element({
      parentNode: this.div,
      className: "ModelEditorSliderItem",
      style: {
        position: "relative"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return _this._on_mouse_down(evt);
        };
      })(this)
    });
    this._drag_evt_func = (function(_this) {
      return function(evt) {
        return _this._drag_evt(evt);
      };
    })(this);
    this._drag_end_func = (function(_this) {
      return function(evt) {
        return _this._drag_end(evt);
      };
    })(this);
  }

  ModelEditorItem_ConstrainedVal.prototype.onchange = function() {
    if (this.div.offsetWidth && this.cur.offsetWidth) {
      return this.cur.style.left = 100.0 * (this.div.offsetWidth - this.cur.offsetWidth) * this.model.ratio() / this.div.offsetWidth + "%";
    } else {
      return this.cur.style.left = 100.0 * (200 - 11) * this.model.ratio() / 200 + "%";
    }
  };

  ModelEditorItem_ConstrainedVal.prototype._on_mouse_down = function(evt, make_off_x) {
    if (make_off_x == null) {
      make_off_x = true;
    }
    this.old_x = evt.clientX;
    if (make_off_x) {
      this.off_x = this.old_x - get_left(this.cur);
    }
    document.addEventListener("mousemove", this._drag_evt_func, true);
    document.addEventListener("mouseup", this._drag_end_func, true);
    if (typeof evt.stopPropagation === "function") {
      evt.stopPropagation();
    }
    return false;
  };

  ModelEditorItem_ConstrainedVal.prototype._drag_evt = function(evt) {
    var offset, twidth;
    this.snapshot();
    this.new_x = evt.clientX;
    if (this.new_x !== this.old_x) {
      offset = this.new_x - get_left(this.div) - this.off_x;
      twidth = this.div.offsetWidth - this.cur.offsetWidth;
      this.model.set(this.model._min.get() + offset * this.model.delta() / twidth);
      this.old_x = this.new_x;
    }
    return typeof evt.preventDefault === "function" ? evt.preventDefault() : void 0;
  };

  ModelEditorItem_ConstrainedVal.prototype._drag_end = function(evt) {
    if (typeof document.detachEvent === "function") {
      document.detachEvent("onmousemove", this._drag_evt_func);
    }
    if (typeof document.detachEvent === "function") {
      document.detachEvent("onmouseup", this._drag_end_func);
    }
    if (typeof document.removeEventListener === "function") {
      document.removeEventListener("mousemove", this._drag_evt_func, true);
    }
    return typeof document.removeEventListener === "function" ? document.removeEventListener("mouseup", this._drag_end_func, true) : void 0;
  };

  return ModelEditorItem_ConstrainedVal;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Button,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Button = (function(superClass) {
  extend(ModelEditorItem_Button, superClass);

  function ModelEditorItem_Button(params) {
    ModelEditorItem_Button.__super__.constructor.call(this, params);
    this.select = new_dom_element({
      parentNode: this.ed,
      nodeName: "input",
      type: "button",
      value: this.model.txt(),
      onclick: (function(_this) {
        return function() {
          return _this.model.toggle();
        };
      })(this),
      style: {
        width: this.ew + "%"
      }
    });
    if (this.model.disabled.equals(true)) {
      this.select.disabled = "true";
    }
  }

  ModelEditorItem_Button.prototype.onchange = function() {
    this.select.value = this.model.txt();
    if (this.model.disabled.has_been_modified()) {
      return this.select.disabled = this.model.disabled.get();
    }
  };

  return ModelEditorItem_Button;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_TextArea,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_TextArea = (function(superClass) {
  extend(ModelEditorItem_TextArea, superClass);

  function ModelEditorItem_TextArea(params) {
    var ref;
    ModelEditorItem_TextArea.__super__.constructor.call(this, params);
    this.input = new_dom_element({
      parentNode: this.ed,
      type: "text",
      nodeName: "textarea",
      style: {
        width: this.ew + "%"
      },
      onchange: (function(_this) {
        return function() {
          _this.snapshot();
          return _this.model.set(_this.input.value);
        };
      })(this),
      onfocus: (function(_this) {
        return function() {
          var ref;
          return (ref = _this.get_focus()) != null ? ref.set(_this.process_id) : void 0;
        };
      })(this)
    });
    if ((ref = this.ev) != null) {
      ref.onmousedown = (function(_this) {
        return function() {
          var ref1;
          return (ref1 = _this.get_focus()) != null ? ref1.set(_this.process_id) : void 0;
        };
      })(this);
    }
  }

  ModelEditorItem_TextArea.prototype.onchange = function() {
    var ref;
    if (this.model.has_been_modified()) {
      this.input.value = this.model.get();
    }
    if ((ref = this.get_focus()) != null ? ref.has_been_modified() : void 0) {
      if (this.get_focus().get() === this.process_id) {
        return setTimeout(((function(_this) {
          return function() {
            return _this.input.focus();
          };
        })(this)), 1);
      } else {
        return this.input.blur();
      }
    }
  };

  ModelEditorItem_TextArea.prototype.set_disabled = function(val) {
    return this.input.disabled = val;
  };

  return ModelEditorItem_TextArea;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_CheckBox,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_CheckBox = (function(superClass) {
  extend(ModelEditorItem_CheckBox, superClass);

  function ModelEditorItem_CheckBox(params) {
    var ref, span;
    ModelEditorItem_CheckBox.__super__.constructor.call(this, params);
    this.legend_focus = params.parent.legend_focus;
    span = new_dom_element({
      parentNode: this.ed,
      nodeName: "span",
      style: {
        width: this.ew + "%",
        display: "inline-block"
      }
    });
    this.input = new_dom_element({
      parentNode: span,
      type: "checkbox",
      nodeName: "input",
      onchange: (function(_this) {
        return function() {
          _this.snapshot();
          return _this.model.set(_this.input.checked);
        };
      })(this)
    });
    if (this.legend_focus !== false) {
      if ((ref = this.ev) != null) {
        ref.onmousedown = (function(_this) {
          return function() {
            var ref1;
            if ((ref1 = _this.get_focus()) != null) {
              ref1.set(_this.process_id);
            }
            return _this.model.toggle();
          };
        })(this);
      }
    }
  }

  ModelEditorItem_CheckBox.prototype.onchange = function() {
    var ref;
    if (this.model.has_been_modified()) {
      this.input.checked = this.model.toBoolean();
      if (this.label != null) {
        if (this.model.toBoolean()) {
          add_class(this.label, "modelEditor_checked");
        } else {
          rem_class(this.label, "modelEditor_checked");
        }
      }
    }
    if (this.legend_focus !== false) {
      if ((ref = this.get_focus()) != null ? ref.has_been_modified() : void 0) {
        if (this.get_focus().get() === this.process_id) {
          return this.input.focus();
        } else {
          return this.input.blur();
        }
      }
    }
  };

  return ModelEditorItem_CheckBox;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Directory,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Directory = (function(superClass) {
  var sort_dir, sort_numerically;

  extend(ModelEditorItem_Directory, superClass);

  ModelEditorItem_Directory._action_list = {
    "Directory": [
      function(file, path, browser) {
        return browser.load_folder(file);
      }
    ]
  };

  ModelEditorItem_Directory._action_list_2 = [];

  function ModelEditorItem_Directory(params) {
    this.onPopupClose = bind(this.onPopupClose, this);
    var key_map, title;
    ModelEditorItem_Directory.__super__.constructor.call(this, params);
    this.use_breadcrumb = params.use_breadcrumb != null ? params.use_breadcrumb : true;
    this.use_icons = params.use_icons != null ? params.use_icons : true;
    this.initial_path = params.initial_path != null ? params.initial_path : "Root";
    this.use_use = params.use_use != null ? params.use_use : true;
    this.use_upload = params.use_upload != null ? params.use_upload : true;
    this.use_manage = params.use_manage != null ? params.use_manage : true;
    this.use_share = params.use_share != null ? params.use_share : true;
    this.use_download = params.use_download != null ? params.use_download : true;
    this.display = params.display != null ? params.display : "all";
    this.breadcrumb = new Lst;
    this.breadcrumb.push(this.model);
    this.breadcrumb.bind(this);
    this.initial_path = this.make_initial_path_as_dom(this.initial_path);
    this.index_sorted = new Lst;
    this.selected_file = new Lst;
    this.clipboard = new Lst;
    this.selected_file.bind(this);
    this.clipboard.bind(this);
    this.allow_shortkey = false;
    this.line_height = 30;
    this.ed.ondrop = (function(_this) {
      return function(evt) {
        return _this.cancel_natural_hotkeys(evt);
      };
    })(this);
    this.container = new_dom_element({
      parentNode: this.ed,
      nodeName: "div",
      className: "directory_container",
      ondragover: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragout: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragleave: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondrop: (function(_this) {
        return function(evt) {
          evt.stopPropagation();
          evt.preventDefault();
          _this.handle_files(evt.dataTransfer.files);
          _this.cancel_natural_hotkeys(evt);
          return false;
        };
      })(this)
    });
    if (this.use_icons || this.use_upload) {
      this.icon_scene = new_dom_element({
        parentNode: this.container,
        nodeName: "div",
        className: "icon_scene"
      });
      title = new_dom_element({
        parentNode: this.icon_scene,
        nodeName: "div",
        txt: "Files",
        style: {
          cssFloat: "left",
          padding: "6px 40px 0 30px"
        }
      });
    }
    if (this.use_icons) {
      this.icon_up = new_dom_element({
        parentNode: this.icon_scene,
        nodeName: "img",
        src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB94FGw8oBY1zlQkAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABoElEQVQ4y6WUP3ITMRTGv2c2csKY3ewCKdPTcgK4Bwdg6DZ1inCBpCMX4DwcgI5JAwOWVnKGsZ7NfinsxFl75bGJKs378+n3/oyAPc73nw5POo1XAID18X0z0XcA0Ez0aWIuaO2C0vpIF2INAP529n+i92IuaOtCbJf3ej+ycE8WL+yDmNIFpQ3aLkj1c6p8SZB9JHAtANdjCBCkiMinMjfX67mDjZ55vViK9T4ogIgISH5Zkc66hI1XHBcGLsSaxKWIMEXfQ3pW5ubK385QjA5WSc7HGiKXWAZCZHuzSWD18FmZm6sHQhviqUB+dOMJSYkuxNatp2VubsR5RVmYjudm/FdGB5kH8CJR7uTXdF68OXnOx3YbFIOyMPhtp52EkcmOCMqWcuXkMDt6bPrTRFS5WUz5dXW4/9azA4dXx8Pu2myux5ahbBnYIL0W3JluB0FuXDpOSW9pvyCzqUBapvFbmSPuLFjmz1qS5wIK+9oLOa+q4b/+3vcc6xVVYTD2+nYg+AAiAwAK5iC/VsXw2zgoXuZm962wIf2Jjptp0ncHS8XpIDn7KIUAAAAASUVORK5CYII=",
        alt: "Parent",
        title: "Parent",
        style: {
          cssFloat: "left",
          height: 20
        },
        onclick: (function(_this) {
          return function(evt) {
            return _this.load_model_from_breadcrumb(_this.breadcrumb.length - 2);
          };
        })(this)
      });
      this.icon_new_folder = new_dom_element({
        parentNode: this.icon_scene,
        nodeName: "img",
        src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB94FGw8qM3D/YhIAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAACvklEQVRIx72Wu2tUaxTFf+vkOKMYz5mJryLgVa42FpaCzoj4qAURba5ol4uN4P9gdQWNhVbio7CRgCYoiKCNxsZG8FVZSBQfmDmZgwZPLjnrFnNmzI2POElwV4fvg7X2Xnt/ax8l6dQK8EmjvwVl/h+2eYU4Lnxz3PLGuES3oSSdOgscb4MCmsWDLYS3VOPyk27AG82MvriMkjT7Aip/n6DNgiwuyv4HqTw3vP+tRuUXbSI1mpkl/Yhghm4YbEm/Wsgzm/19cemlknTKRRWvgM8sPAwsM/5TMGRzOCwu3tg+BDwTWjCJ8UrEU9Au5OVhQZ0I3lbj8uQiVEKjmb3GJIjVGIVFMzRXT7oaWRHMhAv4DRHgDv+ig9st8KAzkVpM8FmV+Ec3C+tJkbaCWXJ1HzvyCtvz6JvzyrtSbvuc5DcSCr8+4O70quUR94MJAOqO12N2IiLguaS7wKnx5pdhoYnwq5/8ekk1R4wqpZ7Hq43PGR+UBG4ZXc3xhMzRlcHSEYCwW4lqeYug5mgVcFNoa8dN1FJEdsXScD2PBoAL8x9hcx6ztS2B0aDRIeExJMvG0mlL64JuJ3c0SKk5+gM4iFroRaKPgCFg0nbb1nsFR0PENLDMcrWRZslPDdLOC3/b3bJ8YzQIPJK5b2zQCYkq5oztNYg9IeYG8gGhy8D7OTx8DBgAemccPwSG2vsTuG3cA5wsds9yNZpZv6QrwJ45t4RoVCaX9G9f27stcM89JGSPISZBJ4xvC13HbERsAkrGVzvajE9klWLOf/aWp/u85J0qmq47TmxXJNm2JP1lfE3WY8ubhVQktlcfkylWVbv/A6nl0T5Jw3bHRj4Um7XfuFRId8v2gWA+BHXHjAbpiM2A5E9ujdcazAagJAvbtzDHRoM0C+fnsnn76wJwR9YRYK/lXswL4JKkBw/UzAD+A9XaQDGhzUlDAAAAAElFTkSuQmCC",
        alt: "New folder",
        title: "New folder",
        style: {
          cssFloat: "left",
          height: 20
        },
        onclick: (function(_this) {
          return function(evt) {
            var t;
            t = new Directory;
            return _this.model.add_file("New folder", t);
          };
        })(this)
      });
      this.icon_cut = new_dom_element({
        parentNode: this.icon_scene,
        nodeName: "img",
        src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB94FGw8vEdjo17MAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAEGElEQVQ4y42VT4hlxRXGf99reLdntN/td3uh4jgz+eOfSETUUUxQiC5cmEUSDEiMwYkQN8oEFy5UUBQFdRAxZDHMRlCjCxFUDLgPhJAgEZLIBI1OIGKidFVX9fTMVPV0fy7ufT2dmSg5myrqnPPVOd85p4pjaycACKleH3M5yCCrxzf4Komp9Guu3wqpPHiWQUj1UMzVMZdbAZZXypeD5V4Xct0ZUjkSc/1DzLUFGA0GF0i+xgbQoZjr3qXFZstxu6R0kumkAUD2YUmX2uwxXLIFiNkN2i2B7YuAp0IqczPH7dK287OUf2pxG4Dk87F3nwaUdmDv6LfC9g8k/Xg7VwAx1lmqe4wekpnHM60WTgPiFaTcp4wlzdt+OqZy4bRtWF7pC+c5E1MZAQ8JLkfCGBDg9S3A6aR5z+a30un7kPYgHQYYj+cJqdBNGkDfx9yDBrJ6+UjwLsAopDr4c8Dmbz3XuKfTt8Zc71vYKbq2IeSyaPmlAWcITSdsH5y2zRGAUdeOibkynYyL5Vts3pfcxyoZeCrmcsUQ9utYrSSbIUZ8sGubQ33rlVnKY0KuLE2aT7Fvw/rIsmSwfcroeMz1Adnf0+wqwPbjXds8OgPr2mZWFOgmY2Jap1tsjhjvF/rcWEj3A2PgwMD5wJ6fQ3pyO9j/lGN1fZicsj+k8vLQOq+FXB1S2ezX+puYS8P/I2GlnjFm9UBMxf1YVsdUXo+pLAy6s/xHZx50iz2fw0jus/2sZ4zZIJVp26x+FteYTsZnASqtrXOqnGKp2/Hfka5tjNnY+Cv2xeqrjfvOL8BPurZ546w5X62z0kM6Vs/Z3OTbQAus2d4P3C1pZPv3wMeS7sDI+D1JDw69eAL8j+mk+YRZxWKuVwFPgG+0WRgUm/RgfwJu79rm45jqY4hHTufPCNiQ9D7419NJc1gx1wts/xHYJelT228jfVNwEz1nL04n47uGyl+NeFcI2x8C70i6BvMdYyT9nJDKczEXx1xf+Wx5batIy6n8KKSaQyrHQyrXDq/Mn2OumyHXF9Lq+pZtyPVnMdeTIddIyGU55PLvmOqV/Ut9cvsz/2bMZTOk+nBIdVdMZTWkshxTOW+7bUhlLqTydszVI6FumIoEsLQ4v9VfhiMDzx2wSD9269O2+c/MFqBrmw1JwTYj4KjtvZK+Pots1l+SbrJ1SvI/gX/1e+1cyXXfGX/Mku1vSGIE/ErSubafCancEHLdFXP5Wsz1aZt9gs8xb3TteAV4B1gwfj7mel1I9cKY66WgR4DvGv6ikOoEOCz5dqMi+++GRcFupFXbd3Zt81bPWe0kvybpZpsscdT2FOki4BPsH2ogdQdwl6RfApcBa4bfYR/o2uaD2be6tNiwnEor8Quhe4G9wLLtVwXPzs3p6BceOpI2Xx8WxAAAAABJRU5ErkJggg==",
        alt: "cut",
        title: "Cut",
        style: {
          cssFloat: "left",
          height: 20
        },
        onclick: (function(_this) {
          return function(evt) {
            return _this.cut();
          };
        })(this)
      });
      this.icon_copy = new_dom_element({
        parentNode: this.icon_scene,
        nodeName: "img",
        src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB94FGw80LCm2UDgAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAC5UlEQVRIx62WP4hcVRTGf9/srsTBOXdERESxMYVobxBJ0ICILtqIlcRGEGJEGwu1ESvRQgQLQcTCQhFhmwSsZCGwEUUMggREYZFoP/fuZnbdN/M+i30PdseZ2cnigcf7d9/5zvm+c8954oBtbW3R6/UopdwPfAg8Y1ssYNL+Mtu/SnotItYBtre3+Y+DUsq9tjck3Wf7W0m7CwJZ0hJw2vbtkp6NiIs558Mgw+GQqqr6kp6y/ZekjYiop3nMOQtYaTNogWw/KmkdWI+Is8A+SCkF26SUyDmfknTKtg9QMEnNEvBDRHw/I4ARcBU4k1LaWS6lEBHknG8tpXwDrM7ieyJkSimfAK9HRNX6mfbNcvtC0nu2V4E14EtJnsF9ZftJSRdsn5dUA69ubm7OFGu5oWsFeEQSdV2/0O/3d+cpnHO+o43W9oVSSkTEi7PWd5rUl5rr+iiAxm4coMXAuVLKF3NBjmEXgV+aANWcz+Wc35pJ15S9csL205K6Plxa46asr+ecV4FVSXfbHkl60/YTOzs77+/t7R0NArws6QNgaUpQn5VSXomIv3POnwJKKbmUch7ojkajlYUyAa7Y/hGIiee17Y2UUgWQUgLwUdxOBYmIn4Az/E82KxOGw+FKXde3zPu40+n80+12R0eBdGYI/1xVVTfG4/H2vKOqqr2mAI6ViYHfJZ2Y7FsT7aa2PT4WiKQ121dtz6XL9q6k68cC6fV6AJvH1NmLbsaHbL8D3DatA7ddWNKW7XdTStda+uq6vktSx3YNjOZp8rCk5xcZt03XvtYMrDuBz5s5daXdT7NAvrb987wSb2wk6Y8DNJ2UdNL2JeBtgMFgsO9kkpKIGLYN8CasI+lP4KWU0nelFAaDAf1+fx8kInZzzltAp5TyWPMjsbjS9gPAPcCa7cs550NTcvnA2PxI0uPAmqTLQL2A85aF0839V60Oh/TLObeNjpzzWeBjSQ/eRBYAvwFvpJQuTVvzL1ehmJFssZ5TAAAAAElFTkSuQmCC",
        alt: "copy",
        title: "Copy",
        style: {
          cssFloat: "left",
          height: 20
        },
        onclick: (function(_this) {
          return function(evt) {
            return _this.copy();
          };
        })(this)
      });
      this.icon_paste = new_dom_element({
        parentNode: this.icon_scene,
        nodeName: "img",
        src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB94FGw8zCFr0Ii4AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAADK0lEQVRIx52VT4gcRRTGf1/v4O5O7OoVo8GsuJCgByGeDOLFICJKhBg2KCqIXkRCEMFDjnowIMaT4CkgguJFMTksHrxFPCmehJxEjOD6BwIzVZNd1zjTn5futaedmc3uBwVd9frVV+9771VBC5ubm/T7/e15SulwjPFyjHEQY1yLMd5Z2waDATeDrP6IMQLQ7XZZWloipTSXUsqBt4A/gCeBeUlvxhgXAfI852YIlVLCNkVR1Ce/D+gA79u+DTgi6fkQwsUY4+uS3rV9RVLP9gtAtyiKq5UvIYT/kzRkWbX9EfA1cEHSZ8CibSQNgG+qaDIA2zckPWX7DUkP2j5eFMX3k4iySqrHbH8iKUg6ICkCQwBJADlwvEGApAy4BiwBdwCXU0oPTIokSyndArwsqWvbwO22r9n+FtgArreHpL9srwFJ0kp1mH3Aq3Vum+gAC5Lub5z6EHBG0qptVWtjsE2WZZRl+SFwsOF7T0W20SYB6FQSCLCkM7ZfkvR7M291HiWVZVkelpRVfjV5DnSBjWZuOpMqDjBwq+17Gxsg6VfbP1X5+K2St7bNSzoGfJBSeiWEkGqizrTSbsskacv2I5L+tJ217bbvlnTF9rPA/pTSiRDCRkppWyYmad/CL0VR/DzNmFK6DoyqKB8FvowxngghpKwpxw6Y+YPtnu0vgC3gb+CYpLdTSp0Ou0RK6RngaINUQAohnIsxngY+r5L/BPA40N2NXDWeA1ZbayPgXFEUfeBi1eC5pIdtsxu5AFhfXz9VluViWZbdauwLIXRa0dY3gqeV8EwsLy/vBw60NlXVuLKdQghXY4zb6uyaBDgPnATKVokDZJKG/X5/uSn/XnKyZrvUZIc54MfRaPRPlmX/kbQ6ekeGEMIl4NIOFTi2315K+CTw0JS+yYB+WZbnxyLZg1wvTijhNt4bu4UluerQuqtnsvV6vVN5ns9Nsw+Hw9HCwsK4XLa3gO8kHZ1FUL33rKys1M03EzHGg8ANwKoWjkj6yvZdknDrtarntj+V9ENVRdMOY0mF7dckXQDOqsF8CHgHeFrS/ARHANkeNfpiGtFI0sfA2RBC718AbrkqtNBKYwAAAABJRU5ErkJggg==",
        alt: "paste",
        title: "Paste",
        style: {
          cssFloat: "left",
          height: 20
        },
        onclick: (function(_this) {
          return function(evt) {
            return _this.paste();
          };
        })(this)
      });
      this.icon_del_folder = new_dom_element({
        parentNode: this.icon_scene,
        nodeName: "img",
        src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB94FGw84NeFot/QAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAB3ElEQVRIx62WMYsUQRCFv7d3CCfak4gIpyYmirG5cGCi0f4AvVR/iD/DxFQwFAQRLjg480sMRDhEA2XpxnVP72afgT2wjjszvetVNNPVVdX16nV1wYDEGIkxdupTSkMuEIWSUroH3ATm2e5zCOFFie3mspOFEP7ZaHsX2AaclyYppdchhNTOvKqq4Uym0+lGXde7tm8DlgQwsv23sTRf8PMReBZC+D4IV0rpvO3nwDg7LxbbB5LuhxC+9cJle1vSLdvvM/6lIknXbd8A+oMAH4AxcNf2uRWCnEraBw6L2BVjvAO8kXTRNouwNXVpr0k6BsYhhFdtf6MueCWdADVwYPtLXj8G9oCmuBNgT9IpcNIF76gD3OaEPyU9kfTWf+SrpIeSjvLWQ+ARMOvDcdTDlObzRz4l+Y7MgHnW17ZnbnO7JEi7Dn3ZZlaxViYr3o/V2kpzyiHDRf1amZTCVdoRzgSutYKs0bNWr0mJ4ZD+zGvyvxR2q100/00ac+DXuhRWNtwEdoCruZlu5f8LWX9J0k7eV3c1XHW859eAd7avlJAgwzux/aCqqv3SN/4oxvhU0mPbGwW1se2XywJ0Pb8AhBBIKV22vbVQgy661yGET32DyNJZqmSeWjajLZPf5lf2OD9SK7MAAAAASUVORK5CYII=",
        alt: "Delete",
        title: "Delete",
        style: {
          cssFloat: "left",
          height: 22
        },
        onclick: (function(_this) {
          return function(evt) {
            return _this.delete_file();
          };
        })(this),
        ondragover: (function(_this) {
          return function(evt) {
            return false;
          };
        })(this),
        ondrop: (function(_this) {
          return function(evt) {
            _this.delete_file();
            evt.stopPropagation();
            return false;
          };
        })(this)
      });
    }
    if (this.use_upload) {
      this.upload_form = new_dom_element({
        parentNode: this.icon_scene,
        nodeName: "form",
        style: {
          cssFloat: "left",
          padding: "0px 0px 0 30px"
        }
      });
      this.upload = new_dom_element({
        parentNode: this.icon_scene,
        nodeName: "input",
        type: "file",
        multiple: "true",
        style: {
          cssFloat: "left",
          fontWeight: "normal",
          fontSize: 14,
          padding: "0px 0px 0 0px",
          border: "none",
          background: "#4dbce9"
        },
        onchange: (function(_this) {
          return function(evt) {
            return _this.handle_files(_this.upload.files);
          };
        })(this)
      });
    }
    if (this.use_breadcrumb) {
      this.breadcrumb_line = new_dom_element({
        parentNode: this.container,
        nodeName: "div",
        style: {
          width: "100%",
          borderBottom: "1px solid #262626"
        }
      });
      this.breadcrumb_dom = new_dom_element({
        parentNode: this.breadcrumb_line,
        nodeName: "div",
        style: {
          fontWeight: "normal",
          fontSize: 14,
          padding: "5px 0px 0 20px",
          border: "none"
        }
      });
    }
    this.all_file_container = new_dom_element({
      parentNode: this.container,
      nodeName: "div"
    });
    key_map = {
      8: (function(_this) {
        return function(evt) {
          return _this.load_model_from_breadcrumb(_this.breadcrumb.length - 2);
        };
      })(this),
      13: (function(_this) {
        return function(evt) {
          var ind_sel_file, index, k, len, ref, results;
          if (_this.selected_file.length > 0) {
            ref = _this.selected_file.get();
            results = [];
            for (k = 0, len = ref.length; k < len; k++) {
              ind_sel_file = ref[k];
              index = _this.search_ord_index_from_id(ind_sel_file);
              results.push(_this.open(_this.model[index], _this.path()));
            }
            return results;
          }
        };
      })(this),
      37: (function(_this) {
        return function(evt) {
          var ind, index_last_file_selected;
          if (_this.selected_file.length > 0) {
            if (evt.shiftKey) {
              index_last_file_selected = _this.selected_file[_this.selected_file.length - 1].get();
              if (_this.reference_file == null) {
                _this.selected_file.clear();
                _this.selected_file.push(index_last_file_selected);
                _this.reference_file = index_last_file_selected;
              }
              if (index_last_file_selected > 0) {
                if (index_last_file_selected <= _this.reference_file) {
                  return _this.selected_file.push(index_last_file_selected - 1);
                } else {
                  return _this.selected_file.pop();
                }
              }
            } else {
              ind = _this.selected_file[_this.selected_file.length - 1].get();
              if (ind !== 0) {
                _this.selected_file.clear();
                _this.selected_file.push(ind - 1);
              } else {
                _this.selected_file.clear();
                _this.selected_file.push(0);
              }
              return _this.reference_file = void 0;
            }
          } else {
            _this.selected_file.push(0);
            return _this.reference_file = void 0;
          }
        };
      })(this),
      38: (function(_this) {
        return function(evt) {
          if (evt.altKey) {
            return _this.load_model_from_breadcrumb(_this.breadcrumb.length - 2);
          }
        };
      })(this),
      39: (function(_this) {
        return function(evt) {
          var ind, index_last_file_selected;
          if (_this.selected_file.length > 0) {
            if (evt.shiftKey) {
              index_last_file_selected = _this.selected_file[_this.selected_file.length - 1].get();
              if (_this.reference_file == null) {
                _this.selected_file.clear();
                _this.selected_file.push(index_last_file_selected);
                _this.reference_file = index_last_file_selected;
              }
              if (index_last_file_selected < _this.model.length - 1) {
                if (index_last_file_selected >= _this.reference_file) {
                  return _this.selected_file.push(index_last_file_selected + 1);
                } else {
                  return _this.selected_file.pop();
                }
              }
            } else {
              ind = _this.selected_file[_this.selected_file.length - 1].get();
              if (ind < _this.model.length - 1) {
                _this.selected_file.clear();
                _this.selected_file.push(ind + 1);
              } else {
                _this.selected_file.clear();
                _this.selected_file.push(_this.model.length - 1);
              }
              return _this.reference_file = void 0;
            }
          } else {
            return _this.selected_file.push(0);
          }
        };
      })(this),
      40: (function(_this) {
        return function(evt) {
          var ind_sel_file, index, k, len, ref, results;
          if (evt.altKey) {
            if (_this.selected_file.length > 0) {
              ref = _this.selected_file.get();
              results = [];
              for (k = 0, len = ref.length; k < len; k++) {
                ind_sel_file = ref[k];
                index = _this.search_ord_index_from_id(ind_sel_file);
                results.push(_this.open(_this.model[index], _this.path()));
              }
              return results;
            }
          }
        };
      })(this),
      65: (function(_this) {
        return function(evt) {
          var child, i, k, len, ref, results;
          if (evt.ctrlKey) {
            _this.selected_file.clear();
            ref = _this.model;
            results = [];
            for (i = k = 0, len = ref.length; k < len; i = ++k) {
              child = ref[i];
              results.push(_this.selected_file.push(i));
            }
            return results;
          }
        };
      })(this),
      88: (function(_this) {
        return function(evt) {
          if (evt.ctrlKey) {
            return _this.cut();
          }
        };
      })(this),
      67: (function(_this) {
        return function(evt) {
          if (evt.ctrlKey) {
            return _this.copy();
          }
        };
      })(this),
      86: (function(_this) {
        return function(evt) {
          if (evt.ctrlKey) {
            return _this.paste();
          }
        };
      })(this),
      46: (function(_this) {
        return function(evt) {
          return _this.delete_file();
        };
      })(this),
      113: (function(_this) {
        return function(evt) {
          var file_contain, ref;
          file_contain = (ref = document.getElementsByClassName('selected_file')[0]) != null ? ref.getElementsByClassName('linkDirectory') : void 0;
          if ((file_contain != null) && file_contain.length > 0) {
            return _this.rename_file(file_contain[0], _this.model[_this.search_ord_index_from_id(_this.selected_file[0].get())]);
          }
        };
      })(this)
    };
    document.onkeydown = (function(_this) {
      return function(evt) {
        if (_this.allow_shortkey === true) {
          if (key_map[evt.keyCode] != null) {
            evt.stopPropagation();
            evt.preventDefault();
            key_map[evt.keyCode](evt);
            return true;
          }
        }
      };
    })(this);
  }

  ModelEditorItem_Directory.prototype.cut = function() {
    var ind_children, k, len, real_ind, ref;
    if (this.use_manage) {
      if (this.selected_file.length > 0) {
        this.clipboard.clear();
        ref = this.selected_file.get();
        for (k = 0, len = ref.length; k < len; k++) {
          ind_children = ref[k];
          real_ind = this.search_ord_index_from_id(ind_children);
          this.clipboard.push(this.model[real_ind]);
        }
        return this.cutroot = this.model;
      }
    }
  };

  ModelEditorItem_Directory.prototype.copy = function() {
    var ind_children, k, len, real_ind, ref;
    if (this.use_manage) {
      if (this.selected_file.length > 0) {
        this.clipboard.clear();
        ref = this.selected_file.get();
        for (k = 0, len = ref.length; k < len; k++) {
          ind_children = ref[k];
          real_ind = this.search_ord_index_from_id(ind_children);
          this.clipboard.push(this.model[real_ind]);
        }
        return this.cutroot = void 0;
      }
    }
  };

  ModelEditorItem_Directory.prototype.paste = function() {
    var file, k, len, len1, mod, n, new_file, pos, ref, ref1, results;
    if (this.use_manage) {
      if (this.cutroot != null) {
        ref = this.clipboard.get();
        for (k = 0, len = ref.length; k < len; k++) {
          mod = ref[k];
          pos = this.cutroot.indexOf(mod);
          if (pos !== -1) {
            this.cutroot.splice(pos, 1);
          }
        }
      }
      ref1 = this.clipboard;
      results = [];
      for (n = 0, len1 = ref1.length; n < len1; n++) {
        file = ref1[n];
        new_file = file.deep_copy();
        results.push(this.model.push(new_file));
      }
      return results;
    }
  };

  ModelEditorItem_Directory.prototype.rename_file = function(file, child_index) {
    if (this.use_manage) {
      this.allow_shortkey = false;
      file.contentEditable = "true";
      file.focus();
      return file.onblur = (function(_this) {
        return function(evt) {
          var title;
          _this.allow_shortkey = true;
          title = file.innerHTML;
          child_index.name.set(title);
          file.contentEditable = "false";
          return _this.selected_file.clear();
        };
      })(this);
    }
  };

  ModelEditorItem_Directory.prototype.onchange = function() {
    if (this.selected_file.has_been_directly_modified()) {
      this.draw_selected_file();
    }
    if (this.model.has_been_modified() || this.breadcrumb.has_been_modified()) {
      return this.refresh();
    }
  };

  ModelEditorItem_Directory.prototype.refresh = function() {
    this.empty_window();
    this.init();
    return this.draw_selected_file();
  };

  ModelEditorItem_Directory.prototype.empty_window = function() {
    return this.all_file_container.innerHTML = "";
  };

  ModelEditorItem_Directory.prototype.load_folder = function(file) {
    this.model.unbind(this);
    return file._ptr.load((function(_this) {
      return function(m, err) {
        _this.model = m;
        _this.model.bind(_this);
        _this.breadcrumb.push(file);
        return _this.selected_file.clear();
      };
    })(this));
  };

  ModelEditorItem_Directory.prototype.open = function(file, path) {
    var l;
    if (file._info.model_type != null) {
      l = ModelEditorItem_Directory._action_list[file._info.model_type];
      if ((l != null) && l.length) {
        return l[0](file, path, this);
      }
    }
  };

  ModelEditorItem_Directory.prototype.open_2 = function(file, path) {
    var l;
    if (file._info.model_type != null) {
      l = ModelEditorItem_Directory._action_list_2[file._info.model_type];
      if ((l != null) && l.length) {
        return l[0](file, path, this);
      }
    }
  };

  ModelEditorItem_Directory.prototype.ends_with = function(name, str) {
    var l;
    l = name.match(str + "$");
    return (l != null ? l.length : void 0) && l[0] === str;
  };

  ModelEditorItem_Directory.prototype.handle_files = function(files) {
    var file, fs, k, len, results;
    if (files.length > 0) {
      if (typeof FileSystem !== "undefined" && FileSystem !== null) {
        fs = FileSystem.get_inst();
        results = [];
        for (k = 0, len = files.length; k < len; k++) {
          file = files[k];
          if (this.ends_with(file.name, ".tiff") || this.ends_with(file.name, ".tif")) {
            results.push(this.model.add_tiff_file(file.name, new Path, new Path(file)));
          } else {
            results.push(this.model.add_file(file.name, new Path(file)));
          }
        }
        return results;
      }
    }
  };

  ModelEditorItem_Directory.prototype.make_initial_path_as_dom = function(initial_path) {
    var path, reg;
    reg = new RegExp("[\/]+", "g");
    path = initial_path.split(reg);
    return path;
  };

  ModelEditorItem_Directory.prototype.draw_breadcrumb = function() {
    var folder, i, k, len, ref, results;
    this.breadcrumb_dom.innerHTML = "";
    ref = this.breadcrumb;
    results = [];
    for (i = k = 0, len = ref.length; k < len; i = ++k) {
      folder = ref[i];
      results.push((function(_this) {
        return function(i) {
          var f, l;
          if (i === 0) {
            return f = new_dom_element({
              parentNode: _this.breadcrumb_dom,
              nodeName: "span",
              className: "breadcrumb",
              txt: "Root",
              onclick: function(evt) {
                return _this.load_model_from_breadcrumb(0);
              }
            });
          } else {
            l = new_dom_element({
              parentNode: _this.breadcrumb_dom,
              nodeName: "span",
              txt: " > "
            });
            return f = new_dom_element({
              parentNode: _this.breadcrumb_dom,
              nodeName: "span",
              className: "breadcrumb",
              txt: folder.name,
              onclick: function(evt) {
                return _this.load_model_from_breadcrumb(i);
              }
            });
          }
        };
      })(this)(i));
    }
    return results;
  };

  ModelEditorItem_Directory.prototype.load_model_from_breadcrumb = function(ind) {
    if (ind !== -1) {
      this.delete_breadcrumb_from_index(ind);
      if (ind === 0) {
        return this.model = this.breadcrumb[0];
      } else {
        return this.breadcrumb[ind]._ptr.load((function(_this) {
          return function(m, err) {
            return _this.model = m;
          };
        })(this));
      }
    }
  };

  ModelEditorItem_Directory.prototype.delete_breadcrumb_from_index = function(index) {
    var i, k, ref, ref1, results;
    results = [];
    for (i = k = ref = this.breadcrumb.length - 1, ref1 = index; ref <= ref1 ? k < ref1 : k > ref1; i = ref <= ref1 ? ++k : --k) {
      results.push(this.breadcrumb.pop());
    }
    return results;
  };

  ModelEditorItem_Directory.prototype.search_ord_index_from_id = function(id) {
    var i, id_, k, len, pos, ref, sorted;
    sorted = this.model.sorted(sort_dir);
    id_ = this.index_sorted[id];
    ref = this.model;
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      pos = this.model.indexOf(sorted[id_]);
      if (pos !== -1) {
        return pos;
      }
    }
  };

  sort_numerically = function(a, b) {
    return a - b;
  };

  ModelEditorItem_Directory.prototype.delete_file = function() {
    var i, index, index_array, k, len, n, ref, ref1;
    if (this.use_manage) {
      if (this.selected_file.length) {
        index_array = [];
        ref = this.selected_file.get();
        for (k = 0, len = ref.length; k < len; k++) {
          i = ref[k];
          index = this.search_ord_index_from_id(i);
          index_array.push(index);
        }
        index_array.sort(this.sort_numerically);
        for (i = n = ref1 = index_array.length - 1; ref1 <= 0 ? n <= 0 : n >= 0; i = ref1 <= 0 ? ++n : --n) {
          this.model.splice(index_array[i], 1);
        }
        return this.selected_file.clear();
      }
    }
  };

  ModelEditorItem_Directory.prototype.draw_selected_file = function() {
    var file, file_contain, j, k, len, results;
    file_contain = document.getElementsByClassName('file_container');
    results = [];
    for (j = k = 0, len = file_contain.length; k < len; j = ++k) {
      file = file_contain[j];
      if (parseInt(this.selected_file.indexOf(j)) !== -1) {
        results.push(add_class(file, 'selected_file'));
      } else {
        results.push(rem_class(file, 'selected_file'));
      }
    }
    return results;
  };

  ModelEditorItem_Directory.prototype.cancel_natural_hotkeys = function(evt) {
    if (!evt) {
      evt = window.event;
    }
    evt.cancelBubble = true;
    if (typeof evt.stopPropagation === "function") {
      evt.stopPropagation();
    }
    if (typeof evt.preventDefault === "function") {
      evt.preventDefault();
    }
    if (typeof evt.stopImmediatePropagation === "function") {
      evt.stopImmediatePropagation();
    }
    return false;
  };

  sort_dir = function(a, b) {
    if (a.name.get().toLowerCase() > b.name.get().toLowerCase()) {
      return 1;
    } else {
      return -1;
    }
  };

  ModelEditorItem_Directory.prototype.init = function() {
    var _sorted, bottom, elem, i, k, len, len1, len2, n, o, sorted;
    _sorted = this.model.sorted(sort_dir);
    this.index_sorted.clear();
    sorted = new Array;
    if (this.display === "all") {
      for (i = k = 0, len = _sorted.length; k < len; i = ++k) {
        elem = _sorted[i];
        if (elem._info.model_type.get() !== "Session") {
          sorted.push(elem);
          this.index_sorted.push(i);
        }
      }
    } else if (this.display === "Session") {
      for (i = n = 0, len1 = _sorted.length; n < len1; i = ++n) {
        elem = _sorted[i];
        if (elem._info.model_type.get() === "Session" || elem._info.model_type.get() === "Directory") {
          sorted.push(elem);
          this.index_sorted.push(i);
        }
      }
    }
    this.allow_shortkey = true;
    for (i = o = 0, len2 = sorted.length; o < len2; i = ++o) {
      elem = sorted[i];
      if (!(elem.name.get().match(/^__/) && elem.name.get().match(/__$/))) {
        (function(_this) {
          return (function(elem, i) {
            var button_line, download_button, file_container, picture_container, r, ref, ref1, share_button, stext, text, u, use;
            file_container = new_dom_element({
              parentNode: _this.all_file_container,
              nodeName: "div",
              className: "file_container",
              ondragstart: function(evt) {
                if (document.getElementById('popup_closer') != null) {
                  _this.popup_closer_zindex = document.getElementById('popup_closer').style.zIndex;
                  document.getElementById('popup_closer').style.zIndex = -1;
                }
                _this.drag_source = [];
                _this.drag_source = _this.selected_file.slice(0);
                if (parseInt(_this.selected_file.indexOf(i)) === -1) {
                  _this.drag_source.push(i);
                }
                evt.dataTransfer.effectAllowed = evt.ctrlKey ? "copy" : "move";
                return evt.dataTransfer.setData('text/plain', _this.selected_file.get());
              },
              ondragover: function(evt) {
                return false;
              },
              ondragend: function(evt) {
                if (document.getElementById('popup_closer') != null) {
                  return document.getElementById('popup_closer').style.zIndex = _this.popup_closer_zindex;
                }
              },
              ondrop: function(evt) {
                var ind, index, len3, len4, q, ref, ref1, s, sorted_ind;
                if (sorted[i]._info.model_type.get() === "Directory") {
                  ref = _this.drag_source.get();
                  for (q = 0, len3 = ref.length; q < len3; q++) {
                    ind = ref[q];
                    if (sorted[ind] === sorted[i]) {
                      return false;
                    }
                    sorted[i]._ptr.load(function(m, err) {
                      return m.push(sorted[ind]);
                    });
                  }
                  ref1 = _this.drag_source.get();
                  for (s = 0, len4 = ref1.length; s < len4; s++) {
                    sorted_ind = ref1[s];
                    index = _this.search_ord_index_from_id(sorted_ind);
                    _this.model.splice(index, 1);
                  }
                  _this.selected_file.clear();
                } else {
                  evt.stopPropagation();
                  evt.preventDefault();
                  _this.handle_files(evt.dataTransfer.files);
                }
                return _this.cancel_natural_hotkeys(evt);
              },
              onmousedown: function(evt) {
                var ind, index_last_file_selected, j, q, ref, ref1, results;
                if (evt.ctrlKey) {
                  ind = parseInt(_this.selected_file.indexOf(i));
                  if (ind !== -1) {
                    return _this.selected_file.splice(ind, 1);
                  } else {
                    return _this.selected_file.push(i);
                  }
                } else if (evt.shiftKey) {
                  if (_this.selected_file.length === 0) {
                    return _this.selected_file.push(i);
                  } else {
                    index_last_file_selected = _this.selected_file[_this.selected_file.length - 1].get();
                    _this.selected_file.clear();
                    results = [];
                    for (j = q = ref = index_last_file_selected, ref1 = i; ref <= ref1 ? q <= ref1 : q >= ref1; j = ref <= ref1 ? ++q : --q) {
                      results.push(_this.selected_file.push(j));
                    }
                    return results;
                  }
                } else {
                  _this.selected_file.clear();
                  return _this.selected_file.push(i);
                }
              }
            });
            if (elem._info.img != null) {
              picture_container = new_dom_element({
                parentNode: file_container,
                nodeName: "span",
                ondblclick: function(evt) {
                  _this.open(sorted[i], _this.path());
                  return _this.cancel_natural_hotkeys(evt);
                },
                style: {
                  maxWidth: 100,
                  height: 100,
                  display: "inline-block"
                }
              });
              _this.picture = new_dom_element({
                parentNode: picture_container,
                className: "picture",
                nodeName: "img",
                src: elem._info.img.get(),
                alt: elem.name.get(),
                title: elem.name.get(),
                style: {
                  maxWidth: 100,
                  maxHeight: 100
                }
              });
            } else if (elem._info.icon != null) {
              _this.picture = new_dom_element({
                parentNode: file_container,
                className: "picture" + " " + "icon_" + elem._info.icon.get() + "_128",
                title: elem.name.get(),
                ondblclick: function(evt) {
                  _this.open(sorted[i], _this.path());
                  return _this.cancel_natural_hotkeys(evt);
                },
                width: 100,
                height: 100
              });
            } else {
              _this.picture = new_dom_element({
                parentNode: file_container,
                nodeName: "img",
                src: "data:image/png;base64,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",
                alt: "",
                title: "",
                ondblclick: function(evt) {
                  _this.open(sorted[i], _this.path());
                  return _this.cancel_natural_hotkeys(evt);
                }
              });
            }
            stext = "";
            if ((ref = elem._info) != null ? (ref1 = ref.remaining) != null ? ref1.get() : void 0 : void 0) {
              r = elem._info.remaining.get();
              u = elem._info.to_upload.get();
              stext += " (" + ((100 * (u - r) / u).toFixed(0)) + "%)";
            }
            text = new_dom_element({
              parentNode: file_container,
              className: "linkDirectory",
              nodeName: "div",
              txt: elem.name.get() + stext,
              onclick: function(evt) {
                return _this.rename_file(text, sorted[i]);
              }
            });
            button_line = new_dom_element({
              parentNode: file_container,
              className: "line_button",
              nodeName: "div"
            });
            if (_this.use_use) {
              use = new_dom_element({
                parentNode: button_line,
                nodeName: "div",
                className: "use_button",
                txt: "use",
                style: {
                  color: "#4dbce9"
                },
                onclick: function(evt) {
                  _this.open_2(sorted[i], _this.path());
                  return _this.cancel_natural_hotkeys(evt);
                }
              });
            }
            if (_this.use_share) {
              share_button = new_dom_element({
                parentNode: button_line,
                className: "share_button",
                nodeName: "div",
                alt: "Share",
                title: "Share",
                onclick: function(evt) {
                  return _this.share_popup(evt, elem, elem.name.get());
                }
              });
            }
            if (_this.use_download) {
              if (elem._info.model_type.get() === "Session" || elem._info.model_type.get() === "Directory") {

              } else {
                return download_button = new_dom_element({
                  parentNode: button_line,
                  className: "download_button",
                  nodeName: "div",
                  alt: "Download",
                  title: "Download",
                  onclick: function(evt) {
                    if (elem instanceof TiffFile) {
                      return elem.load_tiff(function(model, err) {
                        if ((typeof Path !== "undefined" && Path !== null) && (model instanceof Path)) {
                          evt.preventDefault();
                          return window.open("/sceen/_?u=" + model._server_id, "_blank");
                        }
                      });
                    } else {
                      return elem.load(function(model, err) {
                        if ((typeof Path !== "undefined" && Path !== null) && (model instanceof Path)) {
                          evt.preventDefault();
                          return window.open("/sceen/_?u=" + model._server_id, "_blank");
                        } else {
                          return alert("TODO: download models");
                        }
                      });
                    }
                  }
                });
              }
            }
          });
        })(this)(elem, i);
      }
    }
    if (this.use_breadcrumb) {
      this.draw_breadcrumb();
    }
    return bottom = new_dom_element({
      parentNode: this.all_file_container,
      nodeName: "div",
      style: {
        clear: "both"
      }
    });
  };

  ModelEditorItem_Directory.prototype.path = function() {
    return "test_need_to_be_complete";
  };

  ModelEditorItem_Directory.prototype.share_popup = function(evt, elem, name_folder) {
    var Pheight, Pleft, Ptop, Pwidth, email, fs, ia, line_div, link_modifie_informations, login, name_div, p, value_div;
    email = prompt("share '" + name_folder + "' with (is'sim login) ?");
    ia = email.indexOf("@");
    if (ia < 0) {
      return alert("Please enter a valid login (email adress)");
    }
    login = email;
    console.log(email, ia, login);
    fs = FileSystem.get_inst();
    fs.load("__users__/" + login, function(home, err) {
      if (err) {
        return alert("Please enter a valid login (email adress --)");
      }
      return fs.load_or_make_dir("__users__/" + login + "/inbox", function(inbox, err) {
        var ip, nn;
        if (err) {
          return alert("??");
        }
        nn = name_folder;
        while (inbox.has(nn)) {
          ip = nn.indexOf(".");
          if (ip < 0) {
            ip = nn.length;
          }
          nn = nn.slice(0, ip) + "_" + nn.slice(ip, nn.length);
        }
        return inbox.push(elem);
      });
    });
    return;
    this.popup_share_div = new_dom_element({
      id: "popup_share_div"
    });
    Ptop = 100;
    Pleft = 100;
    Pwidth = 800;
    Pheight = 260;
    this.container_share_div = new_dom_element({
      parentNode: this.popup_share_div,
      className: "container_share_div",
      nodeName: "div",
      style: {
        height: 200,
        width: 200,
        margin: "0px 0 0 10px"
      }
    });
    this.share_user_information_div = new_dom_element({
      parentNode: this.popup_share_div,
      className: "share_user_information_div",
      nodeName: "div",
      style: {
        cssFloat: "left",
        height: 200,
        width: 560,
        margin: "0px 0 0 0px"
      }
    });
    line_div = new_dom_element({
      parentNode: this.share_user_information_div,
      nodeName: "div",
      style: {
        cssFloat: "left",
        height: 40,
        width: "100%",
        fontSize: "18px",
        background: "#262626",
        margin: "60px 0 0 0px"
      }
    });
    name_div = new_dom_element({
      parentNode: line_div,
      nodeName: "div",
      txt: " email : ",
      style: {
        cssFloat: "left",
        height: 30,
        width: 100,
        margin: "10px 0 0 10px"
      }
    });
    value_div = new_dom_element({
      parentNode: line_div,
      nodeName: "input",
      id: "share_email_input",
      style: {
        cssFloat: "left",
        height: 30,
        width: 400,
        margin: "5px 0 0 0px",
        fontWeight: "bold"
      }
    });
    link_modifie_informations = new_dom_element({
      parentNode: this.share_user_information_div,
      nodeName: "button",
      txt: "Share",
      className: "user_line",
      style: {
        height: 40,
        width: 100,
        border: "none",
        margin: "15px 60px 0 0",
        cssFloat: "right",
        fontSize: "18px",
        color: "#262626",
        cursor: "pointer",
        background: "#4dbce9",
        onmousedown: (function(_this) {
          return function(evt) {};
        })(this)
      }
    });
    return p = new_popup("Share: " + name_folder, {
      event: evt,
      child: this.popup_share_div,
      top_x: Pleft,
      top_y: Ptop,
      width: Pwidth,
      height: Pheight,
      background: "#262626",
      onclose: (function(_this) {
        return function() {
          return _this.onPopupClose();
        };
      })(this)
    });
  };

  ModelEditorItem_Directory.prototype.onPopupClose = function() {
    document.onkeydown = void 0;
    return this.clear_page(this.popup_share_div);
  };

  ModelEditorItem_Directory.prototype.clear_page = function(div_to_clear) {
    var results;
    results = [];
    while (div_to_clear.firstChild != null) {
      results.push(div_to_clear.removeChild(div_to_clear.firstChild));
    }
    return results;
  };

  ModelEditorItem_Directory.add_action = function(model_type, fun) {
    if (ModelEditorItem_Directory._action_list[model_type] == null) {
      ModelEditorItem_Directory._action_list[model_type] = [];
    }
    return ModelEditorItem_Directory._action_list[model_type].push(fun);
  };

  ModelEditorItem_Directory.add_action_2 = function(model_type, fun) {
    if (ModelEditorItem_Directory._action_list_2[model_type] == null) {
      ModelEditorItem_Directory._action_list_2[model_type] = [];
    }
    return ModelEditorItem_Directory._action_list_2[model_type].push(fun);
  };

  return ModelEditorItem_Directory;

})(ModelEditorItem);

ModelEditorItem.default_types.unshift(function(model) {
  if (model instanceof Directory) {
    return ModelEditorItem_Directory;
  }
});
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Choice,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Choice = (function(superClass) {
  extend(ModelEditorItem_Choice, superClass);

  function ModelEditorItem_Choice(params) {
    var ref;
    ModelEditorItem_Choice.__super__.constructor.call(this, params);
    this.select = new_dom_element({
      parentNode: this.ed,
      nodeName: "select",
      onchange: (function(_this) {
        return function() {
          _this.snapshot();
          return _this.model.set(_this.select.value);
        };
      })(this),
      style: {
        width: this.ew + "%"
      }
    });
    if ((ref = this.ev) != null) {
      ref.onmousedown = (function(_this) {
        return function() {
          var ref1;
          return (ref1 = _this.get_focus()) != null ? ref1.set(_this.process_id) : void 0;
        };
      })(this);
    }
  }

  ModelEditorItem_Choice.prototype.onchange = function() {
    var cpt, i, j, len, ref, ref1, selected;
    if (this.model.lst.has_been_modified()) {
      while (this.select.firstChild != null) {
        this.select.removeChild(this.select.firstChild);
      }
      cpt = 0;
      ref = this.model._nlst();
      for (j = 0, len = ref.length; j < len; j++) {
        i = ref[j];
        selected = "";
        if (i.toString() === this.model.item().toString()) {
          selected = "selected";
        }
        new_dom_element({
          parentNode: this.select,
          nodeName: "option",
          selected: selected,
          txt: i.toString(),
          value: cpt
        });
        cpt += 1;
      }
    }
    if (this.model.num.has_been_modified()) {
      this.select.value = this.model.num.get();
    }
    if ((ref1 = this.get_focus()) != null ? ref1.has_been_modified() : void 0) {
      if (this.get_focus().get() === this.process_id) {
        return setTimeout(((function(_this) {
          return function() {
            return _this.select.focus();
          };
        })(this)), 1);
      } else {
        return this.select.blur();
      }
    }
  };

  return ModelEditorItem_Choice;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Choice_Roll,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Choice_Roll = (function(superClass) {
  extend(ModelEditorItem_Choice_Roll, superClass);

  function ModelEditorItem_Choice_Roll(params) {
    ModelEditorItem_Choice_Roll.__super__.constructor.call(this, params);
    this.line_height = 30;
    this.container = new_dom_element({
      parentNode: this.ed,
      nodeName: "span",
      className: "ModelEditorChoiceRoll",
      onclick: (function(_this) {
        return function(evt) {
          _this.snapshot();
          _this.model.set((_this.model.num.get() + 1) % _this.model._nlst().length);
          return typeof evt.stopPropagation === "function" ? evt.stopPropagation() : void 0;
        };
      })(this),
      style: {
        color: "rgba(0,0,0,0)",
        display: "inline-block",
        width: this.ew + "%"
      }
    });
    this.window = new_dom_element({
      parentNode: this.container,
      className: "ModelEditorChoiceRollWindow",
      txt: "."
    });
    this._cl = [];
  }

  ModelEditorItem_Choice_Roll.prototype.onchange = function() {
    var cpt, i, j, k, len, len1, ref, ref1;
    if (this.model.lst.has_been_modified() || this._cl.length === 0) {
      ref = this._cl;
      for (j = 0, len = ref.length; j < len; j++) {
        i = ref[j];
        i.parentNode.removeChild(i);
      }
      this._cl = [];
      cpt = 0;
      ref1 = this.model._nlst();
      for (k = 0, len1 = ref1.length; k < len1; k++) {
        i = ref1[k];
        this._cl.push(new_dom_element({
          parentNode: this.window,
          txt: i.get(),
          value: cpt,
          style: {
            position: "absolute",
            left: 0,
            right: 0,
            top: this.line_height * cpt + "px"
          }
        }));
        cpt += 1;
      }
    }
    return this.window.style.top = -this.line_height * this.model.num.get() + "px";
  };

  return ModelEditorItem_Choice_Roll;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_MoveButtons,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_MoveButtons = (function(superClass) {
  extend(ModelEditorItem_MoveButtons, superClass);

  function ModelEditorItem_MoveButtons(params) {
    ModelEditorItem_MoveButtons.__super__.constructor.call(this, params);
    this.downdown = new_dom_element({
      parentNode: this.ed,
      nodeName: "button",
      txt: "<<",
      style: {
        width: 0.2 * this.ew + "%"
      },
      onmousedown: (function(_this) {
        return function() {
          return _this.model._down.set(true);
        };
      })(this),
      onmouseup: (function(_this) {
        return function() {
          return _this.model._down.set(false);
        };
      })(this)
    });
    this.down = new_dom_element({
      parentNode: this.ed,
      nodeName: "button",
      txt: "<",
      style: {
        width: 0.2 * this.ew + "%"
      },
      onclick: (function(_this) {
        return function() {
          _this.model._down._signal_change();
          return _this.model.val.set(_this.model.val.get() - _this.model.step.get());
        };
      })(this)
    });
    this.input = new_dom_element({
      parentNode: this.ed,
      type: "text",
      nodeName: "input",
      style: {
        width: 0.2 * this.ew + "%",
        textAlign: "center"
      },
      onchange: (function(_this) {
        return function() {
          _this.snapshot();
          return _this.model.step.set(_this.input.value);
        };
      })(this),
      onfocus: (function(_this) {
        return function() {
          var ref;
          return (ref = _this.get_focus()) != null ? ref.set(_this.process_id) : void 0;
        };
      })(this)
    });
    this.up = new_dom_element({
      parentNode: this.ed,
      nodeName: "button",
      txt: ">",
      style: {
        width: 0.2 * this.ew + "%"
      },
      onclick: (function(_this) {
        return function() {
          _this.model._up._signal_change();
          return _this.model.val.set(_this.model.val.get() + _this.model.step.get());
        };
      })(this)
    });
    this.upup = new_dom_element({
      parentNode: this.ed,
      nodeName: "button",
      txt: ">>",
      style: {
        width: 0.2 * this.ew + "%"
      },
      onmousedown: (function(_this) {
        return function() {
          return _this.model._up.set(true);
        };
      })(this),
      onmouseup: (function(_this) {
        return function() {
          return _this.model._up.set(false);
        };
      })(this)
    });
  }

  ModelEditorItem_MoveButtons.prototype.onchange = function() {
    var ref;
    if (this.model._down.get() === true) {
      this.model._down._signal_change();
      this.model.val.set(this.model.val.get() - this.model.step.get());
    }
    if (this.model._up.get() === true) {
      this.model._up._signal_change();
      this.model.val.set(this.model.val.get() + this.model.step.get());
    }
    if (this.model.has_been_modified()) {
      this.input.value = this.model.step.get();
    }
    if ((ref = this.get_focus()) != null ? ref.has_been_modified() : void 0) {
      if (this.get_focus().get() === this.process_id) {
        return setTimeout(((function(_this) {
          return function() {
            return _this.input.focus();
          };
        })(this)), 1);
      } else {
        return this.input.blur();
      }
    }
  };

  return ModelEditorItem_MoveButtons;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ColorPickerImg,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ColorPickerImg = (function(superClass) {
  extend(ColorPickerImg, superClass);

  function ColorPickerImg(params) {
    var _height, _margin_left, _margin_top, _src, _width;
    ColorPickerImg.__super__.constructor.call(this, params);
    this.container = new_dom_element({
      parentNode: this.ed,
      className: "ModelEditorColorSelector",
      style: {
        display: "inline-block",
        width: this.ew + "%"
      },
      onclick: (function(_this) {
        return function(evt) {};
      })(this)
    });
    _src = "";
    if (this.picker_pos === 'bottom') {
      _src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAARCAYAAAAL4VbbAAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKCgwrM1Ga25IAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABm0lEQVQoz42QTWsTURSGn3Mn7QyjRiwEYgQR1I3ipgbMRwtZzULEX2BdCs2+7jpJf0LdhQaZ0t/g5m5t+sHshChq8xvuqkOinVw3M6MlFvrCuzjvOec9HxhjxBhDxgda6wFgtdadTPPyPMYYJw+01oN6vW63t0ObNfSNMa/yvAJS4F4cx4MgCN5tbLzF9Tx2dz8QBEEvjuM6cBcAY8x9rfWgWq3+CsOejfYP7LfvE6L9AxuGPVur1fIJSKfT+Tgej99sbnaXHj56zItGW8hwejKyk7OfDId7RFG0I0qp+dbWe3ny9BmN5t/CHCfHIzs5+8FwuId0u13baK7RbK0tFOY4Pjq0X8dfUK7r0mqvi4hwFVvtdSmXy5QqlQoiiuugBKDU/zdI0xTHcYpYAYgo0jTFdT1EVEGg0Apna+c4jsNsNl1w/1dTAI7jXMtZAdy64bK8VCJJzrm4+F18ASBJzrnpL18+8HbZL8bN5zY72ru0kmit+0BvdfW53FlZWfjCdDrjaPTZWmtfC4DW+lOSJC9937/qxTtBEPT/APAHvhsShFl7AAAAAElFTkSuQmCC";
    }
    if (this.picker_pos === 'top') {
      _src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAARCAYAAAAL4VbbAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKCwkPLn0D82MAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABh0lEQVQoz42QwWoaURSGv3sdmzCS0GZlLJQ+Q+qipSBduSilL+IzZDTQujcgKE3DxDxDN2ebGH2DUNEncHHBJNZxMp4umhm0bSA/nMX9///855xrAETkx3w+/+j7Po/gqFqtNoyINID6wcEb82JvD4AkScjlcgAsFhFX/QtV1c+m2WxqrVYz6zGrlWLtBkW73VYvFW9uf7GM7wHI558BEMdLAJ7vFgCwADd3Ecv4Ht8v4Hl5VBVVBcD3C9zO/zR56ztG0eKfy9Y5C2CMJUkStra2McZmBWRclqy6elJyduD/YIzd0LzpdIrqiqfARlH26TxWV/0Lnc1meJ1OR3d2do2q6tt3783facNBXyfjEb1eD1upVMLT0+/xZDxiOLjcmDAcXOpkPOLk5BthGB7hnHslIt1isbgMgrqGZ+d6/XNCeHauQVDXUqmkItJwzoFzDufcSxHpAtpqHeuXr01ttY4VSI37qTn30ICIdMvlsh4eBuvGT6mOc86kD+fc63SCiHx44LZT/TfFMxnQNUaP0gAAAABJRU5ErkJggg==";
    }
    if (this.picker_pos === 'left') {
      _src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAALCAYAAACZIGYHAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKCwkQJ8mFRVkAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABoUlEQVQoz42Sz2oTURjFf3cmEZk0RfsEgrpR3FSGpq0E3Aw04BtIwM1IDdh9FE1cZF9XKU1LyAsERDd3JdSklZkn0MSF4Cq7JMbMnzvXjRNipdLf5izO4XD4+ASAlLLm+/5rLmA0GhEEAc1mUxeLxXa3260B3wETSDJSyg9AqVKpiCTRTH4GKKUQwkDrhCTRaJ3Q753ofH5VHB8fPfY8L7Jt+w3wA8CYzWal9fX7AmAy/UUYhgDEcfTXms2tB+LO3Xvs7j7LlsvlJ57nvUo9w7Isrq+tARBGMZaVA1joMoXNbXHz1m1c92nWcRzX87wD4EbmfDBdkup5NgrbQmut9/ffUq1W3UajgQGglCJJNNnsFS7DRmFLTKZTdnZKOI7jZgBM08QwBJfl81lf51dWePmiipTyobFsRlFIHEcopRb6b0FPfxsO2Nt7jpSybtv2RwNgPg8WIcvKYZrmQpc5O+3p4eArrdZhWuADVw2g3u+daIBrq7kLD3va/6SHgy+0Woe02+26bdsHwHtgLv587CPf99/97w7j8ZhOp5MW1Ja93+hxwv/F38EpAAAAAElFTkSuQmCC";
    }
    if (this.picker_pos === 'right') {
      _src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAALCAYAAACZIGYHAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKCwkQFQFSFNkAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABpUlEQVQoz42SQWsTQRiGn5npJrJJU1vIQQQRbPWgeNqlscWDl4F6EHIOLNtatznZsznYpP0F9VbsvxA87Eli1STjP7D1L+zBHmo2k/UQExKr0ufyDh98DzPDK5IkEYAELHCrWq022+12WK/XRT6fp1wu8y88z2tprZsiSZLx7KYx5nWtVtvc2nru3H/wkLX1x0IIiZQCISRZNkQpxXwhj5SCbrebAe8nEmPMURAEm1G049xZvvtbMFqWUmCtRSmFtZacM8dCySVNB5ycfMwkcNsYc6S1jkaCFSqP1sWfV3fdwiT76QCAxaUlXNdlzhjzqtFoRIeHb1i4vshq5bIAoN/vz+Q0UmsdbWw85cf5OauVNcEVcJwcw2GGtXYkieP4ycHBPvPFIt3O54wrIqVAKTU6+77/IY7j1u7uS76fndLtfLokstYyGKSTTNPZJ0ngmu/7X+M4bh0fv+Xs9BudL7MipRSuW5jkmIuLnwBM9+SGMWYnDMO97e0XLK/c+2tPhJAU3RyOo+j1elmWZa1pybgvzTAM94IgoFQq/fdfPM97prV+9wvs56UsZC2ExAAAAABJRU5ErkJggg==";
    }
    this.picture = new_dom_element({
      parentNode: this.container,
      nodeName: "img",
      src: _src,
      style: {
        position: "relative",
        zIndex: "4",
        color: "rgba(0,0,0,0)"
      }
    });
    if (this.picker_pos === 'bottom') {
      _margin_top = "-12px";
      _width = "10px";
      _height = "11px";
    }
    if (this.picker_pos === 'top') {
      _margin_top = "-16px";
      _width = "10px";
      _height = "11px";
    }
    if (this.picker_pos === 'left') {
      _margin_top = "-10px";
      _margin_left = "1px";
      _width = "13px";
      _height = "9px";
    }
    if (this.picker_pos === 'right') {
      _margin_top = "-10px";
      _margin_left = "4px";
      _width = "13px";
      _height = "9px";
    }
    this.color = new_dom_element({
      parentNode: this.container,
      style: {
        position: "relative",
        zIndex: "3",
        marginTop: _margin_top,
        marginLeft: _margin_left,
        width: _width,
        height: _height
      }
    });
  }

  ColorPickerImg.prototype.onchange = function() {
    return this.color.style.background = this.model.to_hex();
  };

  return ColorPickerImg;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_ColorPicker,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_ColorPicker = (function(superClass) {
  extend(ModelEditorItem_ColorPicker, superClass);

  function ModelEditorItem_ColorPicker(params) {
    var base, baseLeft;
    ModelEditorItem_ColorPicker.__super__.constructor.call(this, params);
    this.sat_size = 200;
    base = new_dom_element({
      parentNode: this.ed,
      style: {
        position: "relative"
      }
    });
    baseLeft = new_dom_element({
      parentNode: base,
      style: {
        position: "relative",
        display: "inline-block"
      }
    });
    this._init_sat(baseLeft);
    this._init_val(baseLeft);
    this._init_edt(base);
    this._old_h = -1;
    this._old_s = -1;
  }

  ModelEditorItem_ColorPicker.prototype.onchange = function() {
    var bb, be, ctx, gb, ge, h, lineargradient, rb, re, ref, ref1, ref2, s, v;
    this.new_color_block.style.background = this.model.to_hex();
    ref = this.model.to_hsv(), h = ref[0], s = ref[1], v = ref[2];
    this.value_cur.style.top = (1 - v) * this.sat_size - 5;
    if (this._old_h !== h || this._old_s !== s) {
      this._old_h = h;
      this._old_s = s;
      this.sat_lum_cur.style.left = (this.sat_lum.width - 1) * h - 5;
      this.sat_lum_cur.style.top = (this.sat_lum.height - 1) * (1 - s) - 5;
      ctx = this.val_can.getContext('2d');
      ref1 = Color.hsv_to_rgb(h, s, 1), rb = ref1[0], gb = ref1[1], bb = ref1[2];
      ref2 = Color.hsv_to_rgb(h, s, 0), re = ref2[0], ge = ref2[1], be = ref2[2];
      lineargradient = ctx.createLinearGradient(0, 0, 0, this.sat_lum.height);
      lineargradient.addColorStop(0, "rgb(" + rb + "," + gb + "," + bb + ")");
      lineargradient.addColorStop(1, "rgb(" + re + "," + ge + "," + be + ")");
      ctx.fillStyle = lineargradient;
      return ctx.fillRect(0, 0, this.sat_lum.width, this.sat_lum.height);
    }
  };

  ModelEditorItem_ColorPicker.prototype._init_sat = function(base) {
    var _sat_end_func, _sat_evt_func, bb, be, ctx, gb, ge, h, i, lineargradient, rb, re, ref, ref1, ref2, results, x;
    _sat_evt_func = (function(_this) {
      return function(evt) {
        var b, g, h, r, ref, ref1, s, v, x, y;
        x = evt.clientX - get_left(_this.sat_lum);
        y = evt.clientY - get_top(_this.sat_lum);
        ref = _this.model.to_hsv(), h = ref[0], s = ref[1], v = ref[2];
        h = x / (_this.sat_lum.width - 1.0);
        s = 1 - y / (_this.sat_lum.height - 1.0);
        h = Math.max(0.0, Math.min(1.0, h));
        s = Math.max(0.0, Math.min(1.0, s));
        ref1 = Color.hsv_to_rgb(h, s, v), r = ref1[0], g = ref1[1], b = ref1[2];
        _this.model.r.set(r);
        _this.model.g.set(g);
        _this.model.b.set(b);
        return typeof evt.preventDefault === "function" ? evt.preventDefault() : void 0;
      };
    })(this);
    _sat_end_func = function(evt) {
      if (typeof document.detachEvent === "function") {
        document.detachEvent("onmousemove", _sat_evt_func);
      }
      if (typeof document.detachEvent === "function") {
        document.detachEvent("onmouseup", _sat_end_func);
      }
      if (typeof document.removeEventListener === "function") {
        document.removeEventListener("mousemove", _sat_evt_func, true);
      }
      return typeof document.removeEventListener === "function" ? document.removeEventListener("mouseup", _sat_end_func, true) : void 0;
    };
    this.sat_lum = new_dom_element({
      parentNode: base,
      nodeName: "canvas",
      width: this.sat_size,
      height: this.sat_size,
      onmousedown: (function(_this) {
        return function(evt) {
          document.addEventListener("mousemove", _sat_evt_func, true);
          document.addEventListener("mouseup", _sat_end_func, true);
          return _sat_evt_func(evt);
        };
      })(this)
    });
    this.sat_lum_cur = new_dom_element({
      parentNode: base,
      className: "ColorPickerSatLumSelect",
      style: {
        position: "absolute"
      }
    });
    ctx = this.sat_lum.getContext('2d');
    results = [];
    for (x = i = 0, ref = this.sat_lum.width; 0 <= ref ? i < ref : i > ref; x = 0 <= ref ? ++i : --i) {
      h = x / (this.sat_lum.width - 1.0);
      ref1 = Color.hsv_to_rgb(h, 1, 1), rb = ref1[0], gb = ref1[1], bb = ref1[2];
      ref2 = Color.hsv_to_rgb(h, 0, 1), re = ref2[0], ge = ref2[1], be = ref2[2];
      lineargradient = ctx.createLinearGradient(0, 0, 0, this.sat_lum.height);
      lineargradient.addColorStop(0, "rgb(" + rb + "," + gb + "," + bb + ")");
      lineargradient.addColorStop(1, "rgb(" + re + "," + ge + "," + be + ")");
      ctx.fillStyle = lineargradient;
      results.push(ctx.fillRect(x, 0, x, this.sat_lum.height));
    }
    return results;
  };

  ModelEditorItem_ColorPicker.prototype._init_val = function(base) {
    var _val_end_func, _val_evt_func;
    _val_evt_func = (function(_this) {
      return function(evt) {
        var b, g, h, r, ref, ref1, s, v, y;
        y = evt.clientY - get_top(_this.sat_lum);
        ref = _this.model.to_hsv(), h = ref[0], s = ref[1], v = ref[2];
        v = 1 - y / (_this.sat_lum.height - 1.0);
        v = Math.max(0.0, Math.min(1.0, v));
        ref1 = Color.hsv_to_rgb(h, s, v), r = ref1[0], g = ref1[1], b = ref1[2];
        _this.model.r.set(r);
        _this.model.g.set(g);
        _this.model.b.set(b);
        return typeof evt.preventDefault === "function" ? evt.preventDefault() : void 0;
      };
    })(this);
    _val_end_func = function(evt) {
      if (typeof document.detachEvent === "function") {
        document.detachEvent("onmousemove", _val_evt_func);
      }
      if (typeof document.detachEvent === "function") {
        document.detachEvent("onmouseup", _val_end_func);
      }
      if (typeof document.removeEventListener === "function") {
        document.removeEventListener("mousemove", _val_evt_func, true);
      }
      return typeof document.removeEventListener === "function" ? document.removeEventListener("mouseup", _val_end_func, true) : void 0;
    };
    this.val_can = new_dom_element({
      parentNode: base,
      nodeName: "canvas",
      width: 23,
      height: this.sat_size,
      onmousedown: (function(_this) {
        return function(evt) {
          document.addEventListener("mousemove", _val_evt_func, true);
          document.addEventListener("mouseup", _val_end_func, true);
          return _val_evt_func(evt);
        };
      })(this),
      style: {
        marginLeft: 10
      }
    });
    return this.value_cur = new_dom_element({
      parentNode: base,
      className: "ColorPickerChromiSelect",
      style: {
        position: "absolute",
        left: 204
      }
    });
  };

  ModelEditorItem_ColorPicker.prototype._init_edt = function(base) {
    var ed;
    ed = new_dom_element({
      parentNode: base,
      nodeName: "span",
      style: {
        marginLeft: 10,
        display: "inline-block",
        width: 200
      }
    });
    this.old_color_block = new_dom_element({
      parentNode: ed,
      nodeName: "span",
      style: {
        display: "inline-block",
        marginBottom: 15,
        width: "49%",
        height: 100,
        background: this.model.to_hex()
      }
    });
    this.new_color_block = new_dom_element({
      parentNode: ed,
      nodeName: "span",
      style: {
        display: "inline-block",
        marginLeft: "2%",
        marginBottom: 15,
        width: "49%",
        height: 100
      }
    });
    new_model_editor({
      el: ed,
      model: this.model.r,
      label: "R",
      label_ratio: 0.1
    });
    new_model_editor({
      el: ed,
      model: this.model.g,
      label: "G",
      label_ratio: 0.1
    });
    new_model_editor({
      el: ed,
      model: this.model.b,
      label: "B",
      label_ratio: 0.1
    });
    new_model_editor({
      el: ed,
      model: this.model.a,
      label: "A",
      label_ratio: 0.1
    });
    return new_dom_element({
      parentNode: ed,
      style: {
        display: "inline-block",
        width: 1,
        height: 1
      }
    });
  };

  return ModelEditorItem_ColorPicker;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Gradient,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Gradient = (function(superClass) {
  extend(ModelEditorItem_Gradient, superClass);

  function ModelEditorItem_Gradient(params) {
    ModelEditorItem_Gradient.__super__.constructor.call(this, params);
    this.canvas = new_dom_element({
      parentNode: this.ed,
      nodeName: "canvas",
      className: "ModelEditorGradientSelector",
      style: {
        width: this.ew + "%",
        height: 20
      },
      onclick: (function(_this) {
        return function(evt) {
          var p;
          if (_this.spec_click != null) {
            return _this.spec_click(evt);
          } else if (!_this.forbid_picker) {
            p = new_popup(_this.label || "Gradient picker", {
              event: evt
            });
            p.appendChild(_this.d);
            return _this.gp.build_color_picker();
          }
        };
      })(this)
    });
    if (!this.forbid_picker) {
      this.d = new_dom_element();
      this.gp = new ModelEditorItem_GradientPicker({
        el: this.d,
        model: this.model,
        parent: this
      });
    }
    if (this.forbid_picker) {
      add_class(this.canvas, "predefinedGradient");
    }
  }

  ModelEditorItem_Gradient.prototype.onchange = function() {
    var c, ctx, i, left_to_right, len, lineargradient, ref;
    ctx = this.canvas.getContext('2d');
    lineargradient = ctx.createLinearGradient(0, 0, this.canvas.width, 0);
    left_to_right = 1;
    ref = this.model.color_stop;
    for (i = 0, len = ref.length; i < len; i++) {
      c = ref[i];
      lineargradient.addColorStop(left_to_right - c.position.get(), 'rgba(' + c.color.r.get() + ',' + c.color.g.get() + ',' + c.color.b.get() + ',' + c.color.a.get() + ')');
    }
    ctx.fillStyle = lineargradient;
    return ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
  };

  return ModelEditorItem_Gradient;

})(ModelEditorItem);

ModelEditorItem.default_types.push(function(model) {
  if (model instanceof Gradient) {
    return ModelEditorItem_Gradient;
  }
});
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_GradientPicker,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_GradientPicker = (function(superClass) {
  extend(ModelEditorItem_GradientPicker, superClass);

  function ModelEditorItem_GradientPicker(params) {
    this.add_color_picker = bind(this.add_color_picker, this);
    this._focus_color = bind(this._focus_color, this);
    this.remove_color_picker = bind(this.remove_color_picker, this);
    this.create_color_picker = bind(this.create_color_picker, this);
    this.build_color_picker = bind(this.build_color_picker, this);
    this.save_current_gradient = bind(this.save_current_gradient, this);
    this.apply_predefined_gradient = bind(this.apply_predefined_gradient, this);
    ModelEditorItem_GradientPicker.__super__.constructor.call(this, params);
    this.predef_grad = new Lst;
    this.popupWidth = 535;
    this.picker_pos = "right";
    if (this.picker_pos === 'right' || this.picker_pos === 'left') {
      this.way = 'vertical';
      this.canvasContainerWidth = "5%";
      this.canvasWidth = 100;
      this.canvasHeight = 350;
    } else {
      this.way = 'horizontal';
      this.canvasWidth = 80;
      this.canvasHeight = 20;
      this.canvasContainerWidth = this.ew - 1.5 + "%";
    }
    this.container = new_dom_element({
      parentNode: this.ed,
      nodeName: "div",
      className: "containerGradientPicker",
      style: {
        width: this.popupWidth,
        minHeight: this.canvasHeight + 3,
        display: "inline-block"
      }
    });
    this.rightContainer = new_dom_element({
      parentNode: this.container,
      nodeName: "div",
      className: "rightContainer"
    });
    this.colorPicker = new_dom_element({
      parentNode: this.rightContainer,
      className: "inlineColorPicker"
    });
    new ModelEditorItem_ColorPicker({
      el: this.colorPicker,
      model: this.model.color_stop[0].color
    });
    new_dom_element({
      parentNode: this.rightContainer,
      nodeName: "hr",
      style: {
        marginRight: "12px"
      }
    });
    this.containerPreDefinedGradient = new_dom_element({
      parentNode: this.rightContainer,
      nodeName: "div",
      className: "containerPreDefinedGradient",
      txt: "Predefined gradient"
    });
    new_dom_element({
      parentNode: this.containerPreDefinedGradient,
      nodeName: "br"
    });
    this.build_predefined_gradient();
    this.savePreDefinedGradient = new_dom_element({
      parentNode: this.rightContainer,
      nodeName: "a",
      href: "javascript:void(0)",
      onclick: (function(_this) {
        return function(e) {
          return _this.save_current_gradient(e);
        };
      })(this),
      className: "savePredefinedGradient"
    });
    this.savePreDefinedGradientImg = new_dom_element({
      parentNode: this.savePreDefinedGradient,
      nodeName: "img",
      src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAAUCAIAAACS+POVAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKFA4BHCZi3iEAAACKSURBVEjHY/z//z8DEvj79++vX79+/fr18+fPX8QBZJW/f/+mRDsTw2ACo67BDVjoY82dyVuQuWz+eqMxNZpusIB9pdPwyP7aeImBgYGNgYGNgYGHgeG5Af9oTI2mGwYGBgan7izkyuha7zq08ga5nmJg+DUaU6PpBgtQyfVBadTAEspoTA1R1wAAX6ixHh6n9uUAAAAASUVORK5CYII=",
      alt: "Save Current Gradient",
      title: "Save Current Gradient"
    });
    this.canvasContainer = new_dom_element({
      parentNode: this.container,
      className: "canvasContainer",
      style: {
        width: this.canvasContainerWidth,
        position: "absolute"
      }
    });
    this.canvas = new_dom_element({
      parentNode: this.canvasContainer,
      nodeName: "canvas",
      className: "gradientPicker",
      style: {
        display: "inline-block",
        width: this.canvasWidth + "%",
        height: this.canvasHeight
      },
      onclick: (function(_this) {
        return function(e) {
          return _this.add_color_picker(e);
        };
      })(this)
    });
    this.build_color_picker();
  }

  ModelEditorItem_GradientPicker.prototype.onchange = function() {
    var c, ctx, k, len, lineargradient, ref;
    ctx = this.canvas.getContext('2d');
    if (this.way === 'vertical') {
      lineargradient = ctx.createLinearGradient(0, 0, 0, this.canvas.height);
    } else {
      lineargradient = ctx.createLinearGradient(0, 0, this.canvas.width, 0);
    }
    ref = this.model.color_stop;
    for (k = 0, len = ref.length; k < len; k++) {
      c = ref[k];
      lineargradient.addColorStop(c.position.get(), c.color.to_rgba());
    }
    ctx.fillStyle = lineargradient;
    return ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
  };

  ModelEditorItem_GradientPicker.prototype.apply_predefined_gradient = function(index) {
    var col, k, l, len, len1, ref, ref1;
    ref = this.model.color_stop;
    for (k = 0, len = ref.length; k < len; k++) {
      col = ref[k];
      this.model.remove_color(col);
    }
    ref1 = this.predef_grad[index].color_stop.get();
    for (l = 0, len1 = ref1.length; l < len1; l++) {
      col = ref1[l];
      this.model.add_color([col.color.r, col.color.g, col.color.b, col.color.a], col.position);
    }
    return this.build_color_picker();
  };

  ModelEditorItem_GradientPicker.prototype.build_predefined_gradient = function() {
    var fn, i, j, k, len, m, ref, results;
    m = new Gradient;
    m.add_color([255, 255, 255, 255], 0);
    m.add_color([0, 0, 0, 255], 1);
    this.predef_grad.push(m);
    m = new Gradient;
    m.add_color([255, 0, 0, 255], 0);
    m.add_color([255, 255, 255, 255], 0.5);
    m.add_color([0, 0, 255, 255], 1);
    this.predef_grad.push(m);
    m = new Gradient;
    m.add_color([255, 255, 255, 255], 0);
    m.add_color([255, 255, 0, 255], 0.33);
    m.add_color([255, 0, 0, 255], 0.67);
    m.add_color([0, 0, 0, 255], 1);
    this.predef_grad.push(m);
    m = new Gradient;
    m.add_color([255, 0, 0, 255], 0);
    m.add_color([255, 255, 0, 255], 0.25);
    m.add_color([0, 255, 0, 255], 0.5);
    m.add_color([0, 255, 255, 255], 0.75);
    m.add_color([0, 0, 255, 255], 1);
    this.predef_grad.push(m);
    j = 0;
    ref = this.predef_grad;
    fn = (function(_this) {
      return function(j) {
        return new ModelEditorItem_Gradient({
          el: _this.containerPreDefinedGradient,
          model: i,
          forbid_picker: true,
          item_width: 48,
          spec_click: function(evt) {
            return _this.apply_predefined_gradient(j);
          }
        });
      };
    })(this);
    results = [];
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      fn(j);
      results.push(j++);
    }
    return results;
  };

  ModelEditorItem_GradientPicker.prototype.save_current_gradient = function(e) {
    var col, index, k, len, m, ref;
    m = new Gradient;
    ref = this.model.color_stop;
    for (k = 0, len = ref.length; k < len; k++) {
      col = ref[k];
      m.add_color([col.color.r, col.color.g, col.color.b, col.color.a], col.position);
    }
    index = this.predef_grad.length;
    new ModelEditorItem_Gradient({
      el: this.containerPreDefinedGradient,
      model: m,
      forbid_picker: true,
      item_width: 48,
      spec_click: (function(_this) {
        return function(evt) {
          return _this.apply_predefined_gradient(index);
        };
      })(this)
    });
    this.predef_grad.push(m);
    return this.build_color_picker();
  };

  ModelEditorItem_GradientPicker.prototype.build_color_picker = function() {
    var elem, i, k, ref;
    while (this.canvasContainer.children.length > 1) {
      elem = this.canvasContainer.children[1];
      this.canvasContainer.removeChild(elem);
    }
    for (i = k = 0, ref = this.model.color_stop.length; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
      this.create_color_picker(i);
    }
    return this._focus_color(0);
  };

  ModelEditorItem_GradientPicker.prototype.create_color_picker = function(index) {
    var _drag_end_func, _drag_evt_func, cPHeight, cPWidth, color_picker_height, color_picker_width, del_picker, dragging, old_x, old_y, pos, pos_left, pos_top;
    old_y = 0;
    old_x = 0;
    pos = 0;
    del_picker = false;
    dragging = false;
    color_picker_width = 2;
    color_picker_height = 10;
    cPHeight = parseInt(getComputedStyle(this.canvas).height);
    cPWidth = parseInt(getComputedStyle(this.canvas).width);
    if (this.way === 'horizontal') {
      pos_left = this.model.color_stop[index].position.get() * this.canvasWidth - color_picker_width / 2 + "%";
      if (this.picker_pos === 'top') {
        pos_top = "-9px";
      }
      if (this.picker_pos === 'bottom') {
        pos_top = (parseInt(getComputedStyle(this.canvas).height)) - 5 + "px";
      }
    }
    if (this.way === 'vertical') {
      pos_top = this.model.color_stop[index].position.get() * this.canvasHeight - color_picker_height / 2 + "px";
      if (this.picker_pos === 'left') {
        pos_left = '-10px';
      }
      if (this.picker_pos === 'right') {
        pos_left = (parseInt(getComputedStyle(this.canvas).width)) - 4 + "px";
      }
    }
    this.cp = new_dom_element({
      parentNode: this.canvasContainer,
      nodeName: "div",
      id: "cp" + index,
      style: {
        position: "absolute",
        top: pos_top,
        left: pos_left,
        width: color_picker_width + "%",
        height: color_picker_height + "px",
        cursor: "pointer"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          old_x = evt.clientX;
          old_y = evt.clientY;
          if (_this.way === 'vertical') {
            pos = _this.model.color_stop[index].position.get() * cPHeight;
          } else {
            pos = _this.model.color_stop[index].position.get() * cPWidth;
          }
          document.addEventListener("mousemove", _drag_evt_func, true);
          document.addEventListener("mouseup", _drag_end_func, true);
          if (typeof evt.preventDefault === "function") {
            evt.preventDefault();
          }
          _this.cp.style.border;
          return _this._focus_color(index);
        };
      })(this)
    });
    new ColorPickerImg({
      el: this.cp,
      model: this.model.color_stop[index].color,
      picker_pos: this.picker_pos
    });
    _drag_evt_func = (function(_this) {
      return function(evt) {
        var ccWidth, currentControler, decal, newPos;
        currentControler = document.getElementById('cp' + index);
        if (_this.way === 'vertical') {
          decal = Math.abs(evt.clientX - old_x);
        } else {
          decal = Math.abs(evt.clientY - old_y);
        }
        if (decal > 50) {
          currentControler.style.opacity = 0.2;
          currentControler.style.border = "medium solid red";
          del_picker = true;
        } else {
          currentControler.style.opacity = 1;
          currentControler.style.border = "none";
          del_picker = false;
        }
        if (_this.way === 'vertical') {
          pos += evt.clientY - old_y;
          newPos = pos / cPHeight;
        } else {
          pos += evt.clientX - old_x;
          newPos = pos / cPWidth;
        }
        if (newPos > 1) {
          newPos = 1;
          if (_this.way === 'vertical') {
            pos = cPHeight;
          } else {
            pos = cPWidth;
          }
        }
        if (newPos < 0) {
          newPos = 0;
          pos = 0;
        }
        _this.model.color_stop[index].position.set(newPos);
        if (_this.way === 'vertical') {
          currentControler.style.top = pos - color_picker_height / 2;
          old_y = evt.clientY;
        } else {
          ccWidth = parseInt(getComputedStyle(currentControler).width);
          currentControler.style.left = pos - ccWidth / 2;
          old_x = evt.clientX;
        }
        return typeof evt.preventDefault === "function" ? evt.preventDefault() : void 0;
      };
    })(this);
    return _drag_end_func = (function(_this) {
      return function(evt) {
        var currentControler, i, k, l, ref, ref1, ref2, ref3, results;
        currentControler = document.getElementById('cp' + index);
        if (typeof document.detachEvent === "function") {
          document.detachEvent("onmousemove", _drag_evt_func);
        }
        if (typeof document.detachEvent === "function") {
          document.detachEvent("onmouseup", _drag_end_func);
        }
        if (typeof document.removeEventListener === "function") {
          document.removeEventListener("mousemove", _drag_evt_func, true);
        }
        if (typeof document.removeEventListener === "function") {
          document.removeEventListener("mouseup", _drag_end_func, true);
        }
        if (del_picker === true) {
          _this.remove_color_picker(index);
          _this.model.remove_color(index);
          if (index !== _this.model.color_stop.length) {
            for (i = k = ref = index + 1, ref1 = _this.model.color_stop.length; ref <= ref1 ? k <= ref1 : k >= ref1; i = ref <= ref1 ? ++k : --k) {
              _this.remove_color_picker(i);
            }
            results = [];
            for (i = l = ref2 = index, ref3 = _this.model.color_stop.length; ref2 <= ref3 ? l <= ref3 : l >= ref3; i = ref2 <= ref3 ? ++l : --l) {
              results.push(_this.create_color_picker(i));
            }
            return results;
          }
        }
      };
    })(this);
  };

  ModelEditorItem_GradientPicker.prototype.remove_color_picker = function(index) {
    var currentControler;
    currentControler = document.getElementById('cp' + index);
    this.canvasContainer.removeChild(currentControler);
    if (document.getElementById('cp0') !== "undefined") {
      return this._focus_color(0);
    }
  };

  ModelEditorItem_GradientPicker.prototype._focus_color = function(index) {
    this.colorPicker.removeChild(this.colorPicker.firstChild);
    return new ModelEditorItem_ColorPicker({
      el: this.colorPicker,
      model: this.model.color_stop[index].color
    });
  };

  ModelEditorItem_GradientPicker.prototype.add_color_picker = function(e) {
    var indexColorStop, pos, ref, rgba;
    ref = this.find_color_by_event(e), rgba = ref[0], pos = ref[1];
    indexColorStop = this.model.color_stop.length;
    this.model.add_color([rgba[0], rgba[1], rgba[2], rgba[3]], pos);
    this.create_color_picker(indexColorStop);
    return this._focus_color(indexColorStop);
  };

  ModelEditorItem_GradientPicker.prototype.find_color_by_event = function(e) {
    var a, b, cPHeight, cPWidth, canvasDataPicked, coord, ctxPicked, g, idxPicked, pos, r;
    ctxPicked = this.canvas.getContext('2d');
    cPWidth = parseInt(getComputedStyle(this.canvas).width);
    cPHeight = parseInt(getComputedStyle(this.canvas).height);
    canvasDataPicked = ctxPicked.getImageData(0, 0, this.canvas.width, this.canvas.height);
    coord = this.get_cursor_position(e);
    if (this.way === 'vertical') {
      idxPicked = Math.round(coord[1] * 45000 / cPHeight) * 4;
    } else {
      idxPicked = Math.round(300 * coord[0] / cPWidth) * 4;
    }
    r = canvasDataPicked.data[idxPicked + 0];
    g = canvasDataPicked.data[idxPicked + 1];
    b = canvasDataPicked.data[idxPicked + 2];
    a = canvasDataPicked.data[idxPicked + 3];
    if (this.way === 'vertical') {
      pos = coord[1] / cPHeight;
    } else {
      pos = coord[0] / cPWidth;
    }
    return [[r, g, b, a], pos];
  };

  ModelEditorItem_GradientPicker.prototype.get_cursor_position = function(event) {
    var canOffset, x, y;
    canOffset = [get_left(this.canvas), get_top(this.canvas)];
    x = event.clientX + document.body.scrollLeft + document.documentElement.scrollLeft - Math.floor(canOffset[0]);
    y = event.clientY + document.body.scrollTop + document.documentElement.scrollTop - Math.floor(canOffset[1]) - 1;
    return [x, y];
  };

  return ModelEditorItem_GradientPicker;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Color,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Color = (function(superClass) {
  extend(ModelEditorItem_Color, superClass);

  function ModelEditorItem_Color(params) {
    ModelEditorItem_Color.__super__.constructor.call(this, params);
    this.container = new_dom_element({
      parentNode: this.ed,
      nodeName: "span",
      className: "ModelEditorColorSelectorBackground"
    });
    this.color_selector = new_dom_element({
      parentNode: this.container,
      nodeName: "span",
      className: "ModelEditorColorSelector",
      txt: ".",
      style: {
        display: "inline-block",
        color: "rgba(0,0,0,0)",
        width: this.ew + "%"
      },
      onclick: (function(_this) {
        return function(evt) {
          var p;
          if (_this.d == null) {
            _this.d = new_dom_element();
            _this.item_cp = new ModelEditorItem_ColorPicker({
              el: _this.d,
              model: _this.model,
              parent: _this
            });
          }
          p = new_popup(_this.label || "Color picker", {
            event: evt
          });
          return p.appendChild(_this.d);
        };
      })(this)
    });
  }

  ModelEditorItem_Color.prototype.onchange = function() {
    return this.color_selector.style.background = this.model.to_hex();
  };

  return ModelEditorItem_Color;

})(ModelEditorItem);

ModelEditorItem.default_types.push(function(model) {
  if (model instanceof Color) {
    return ModelEditorItem_Color;
  }
});
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_TextAreaLanguage,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_TextAreaLanguage = (function(superClass) {
  extend(ModelEditorItem_TextAreaLanguage, superClass);

  function ModelEditorItem_TextAreaLanguage(params) {
    var ref;
    ModelEditorItem_TextAreaLanguage.__super__.constructor.call(this, params);
    this.current_path = "/scripts";
    this.button = new_dom_element({
      parentNode: this.ed,
      nodeName: "input",
      type: "button",
      value: "FullScreen",
      onclick: (function(_this) {
        return function(evt) {
          var p;
          p = new_popup(_this.label || "Code Editor", {
            event: evt,
            width: "50",
            onclose: function() {
              return _this.onPopupClose();
            }
          });
          p.appendChild(_this.textarea);
          _this.code_mirror.save();
          _this.model.set(_this.code_mirror.getValue());
          _this.fullscreen_code_mirror = CodeMirror.fromTextArea(_this.textarea, {
            lineNumbers: true,
            mode: _this.model.get_language(),
            lineWrapping: true,
            onChange: function() {
              var base, changed_string, ref;
              changed_string = _this.fullscreen_code_mirror.getValue();
              _this.model.set(changed_string);
              if (typeof (base = _this.model).callback === "function") {
                base.callback();
              }
              return (ref = _this.get_focus()) != null ? ref.set(_this.process_id) : void 0;
            },
            onCursorActivity: function() {
              _this.fullscreen_code_mirror.setLineClass(_this.hlLine, null);
              _this.hlLine = _this.fullscreen_code_mirror.setLineClass(_this.fullscreen_code_mirror.getCursor().line, "activeline");
              return _this.fullscreen_code_mirror.matchHighlight("CodeMirror-matchhighlight");
            }
          });
          return _this.hlLine = _this.fullscreen_code_mirror.setLineClass(0, "activeline");
        };
      })(this)
    });
    this.textarea = new_dom_element({
      parentNode: this.ed,
      nodeName: "textarea",
      className: "code_editor",
      txt: this.model.get()
    });
    if ((ref = this.ev) != null) {
      ref.onmousedown = (function(_this) {
        return function() {
          var ref1;
          return (ref1 = _this.get_focus()) != null ? ref1.set(_this.process_id) : void 0;
        };
      })(this);
    }
    this.code_mirror = CodeMirror.fromTextArea(this.textarea, {
      lineNumbers: true,
      mode: this.model.get_language(),
      lineWrapping: true,
      onChange: (function(_this) {
        return function() {
          var base;
          _this.model.set(_this.code_mirror.getValue());
          if (typeof (base = _this.model).callback === "function") {
            base.callback();
          }
          return setTimeout((function() {
            return _this.code_mirror.focus();
          }), 1);
        };
      })(this),
      onCursorActivity: (function(_this) {
        return function() {
          _this.code_mirror.setLineClass(_this.hlLine2, null);
          _this.hlLine2 = _this.code_mirror.setLineClass(_this.code_mirror.getCursor().line, "activeline");
          return _this.code_mirror.matchHighlight("CodeMirror-matchhighlight");
        };
      })(this)
    });
    this.code_mirror.getWrapperElement().onmousedown = (function(_this) {
      return function() {
        var ref1;
        return (ref1 = _this.get_focus()) != null ? ref1.set(_this.process_id) : void 0;
      };
    })(this);
    this.hlLine2 = this.code_mirror.setLineClass(0, "activeline");
  }

  ModelEditorItem_TextAreaLanguage.prototype.onchange = function() {
    var ref;
    if ((ref = this.get_focus()) != null ? ref.has_been_modified() : void 0) {
      if (this.get_focus().get() === this.process_id) {
        return setTimeout(((function(_this) {
          return function() {
            return _this.code_mirror.focus();
          };
        })(this)), 1);
      }
    }
  };

  ModelEditorItem_TextAreaLanguage.prototype.onPopupClose = function() {
    var changed_string;
    changed_string = this.fullscreen_code_mirror.getValue();
    this.model.set(changed_string);
    return this.code_mirror.setValue(changed_string);
  };

  return ModelEditorItem_TextAreaLanguage;

})(ModelEditorItem);

ModelEditorItem.default_types.push(function(model) {
  if (model instanceof StrLanguage) {
    return ModelEditorItem_TextAreaLanguage;
  }
});
// Generated by CoffeeScript 1.11.1
var CanvasManager,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

CanvasManager = (function(superClass) {
  extend(CanvasManager, superClass);

  CanvasManager.ctx_id = -1;

  function CanvasManager(params) {
    var base, dv, key, val;
    for (key in params) {
      val = params[key];
      this[key] = val;
    }
    dv = (function(_this) {
      return function(field, fun) {
        if (_this[field] == null) {
          return _this[field] = fun();
        }
      };
    })(this);
    dv("items", function() {
      return new Lst;
    });
    dv("cam", (function(_this) {
      return function() {
        return new Cam(_this.want_aspect_ratio);
      };
    })(this));
    dv("allow_gl", function() {
      return false;
    });
    dv("theme", function() {
      return new Theme;
    });
    dv("time", function() {
      return new ConstrainedVal(0, {
        min: 0,
        max: -1,
        div: 0
      });
    });
    dv("padding_ratio", function() {
      return 1.5;
    });
    dv("constrain_zoom", function() {
      return false;
    });
    dv("width", function() {
      return 100;
    });
    dv("auto_fit", function() {
      return false;
    });
    dv("class_name", function() {
      return '';
    });
    CanvasManager.__super__.constructor.call(this, [this.items, this.cam, this.time]);
    this.canvas = new_dom_element({
      style: {
        width: this.width + "%"
      },
      nodeName: "canvas",
      className: this.class_name != null ? this.class_name || '' : void 0,
      parentNode: this.el
    });
    this.canvas.onmousewheel = (function(_this) {
      return function(evt) {
        return _this._mouse_wheel(evt);
      };
    })(this);
    this.canvas.onmousedown = (function(_this) {
      return function(evt) {
        return _this._mouse_down(evt);
      };
    })(this);
    this.canvas.onmousemove = (function(_this) {
      return function(evt) {
        return _this._mouse_move(evt);
      };
    })(this);
    this.canvas.onmouseout = (function(_this) {
      return function(evt) {
        return _this._mouse_out(evt);
      };
    })(this);
    this.canvas.ondblclick = (function(_this) {
      return function(evt) {
        return _this._dbl_click(evt);
      };
    })(this);
    this.canvas.onmouseup = (function(_this) {
      return function(evt) {
        return _this._mouse_up(evt);
      };
    })(this);
    if (typeof (base = this.canvas).addEventListener === "function") {
      base.addEventListener("DOMMouseScroll", this.canvas.onmousewheel, false);
    }
    this._init_ctx();
    this.x_min = [0, 0, 0];
    this.x_max = [1, 1, 1];
    this.click_fun = [];
    this.dblclick_fun = [];
    this.select_canvas_fun = [];
    this._buf_list = {
      vert: {
        buf: {},
        del: (function(_this) {
          return function(val) {
            return _this.ctx.deleteShader(val);
          };
        })(this)
      },
      frag: {
        buf: {},
        del: (function(_this) {
          return function(val) {
            return _this.ctx.deleteShader(val);
          };
        })(this)
      },
      prog: {
        buf: {},
        del: (function(_this) {
          return function(val) {
            return _this.ctx.deleteProgram(val);
          };
        })(this)
      }
    };
    this.fit();
  }

  CanvasManager.prototype.active_items = function() {
    return this.items;
  };

  CanvasManager.prototype.selected_items = function() {
    return [];
  };

  CanvasManager.prototype.onchange = function() {
    if (this.need_to_redraw()) {
      return this.draw();
    }
  };

  CanvasManager.prototype.need_to_redraw = function() {
    var base, base1, base2, base3, f, flat, item, j, k, len, len1, len2, len3, o, p, ref, ref1, ref2, s, str_act, str_sel;
    if (typeof (base = this.items).has_been_directly_modified === "function" ? base.has_been_directly_modified() : void 0) {
      return true;
    }
    if (typeof (base1 = this.cam).has_been_modified === "function" ? base1.has_been_modified() : void 0) {
      return true;
    }
    if (typeof (base2 = this.theme).has_been_modified === "function" ? base2.has_been_modified() : void 0) {
      return true;
    }
    if (typeof (base3 = this.time).has_been_modified === "function" ? base3.has_been_modified() : void 0) {
      return true;
    }
    str_act = "";
    ref = this.active_items();
    for (j = 0, len = ref.length; j < len; j++) {
      s = ref[j];
      if (!(typeof s.has_nothing_to_draw === "function" ? s.has_nothing_to_draw() : void 0)) {
        str_act += " " + s.model_id;
      }
    }
    if (this._old_str_act !== str_act) {
      this._old_str_act = str_act;
      return true;
    }
    str_sel = "";
    ref1 = this.selected_items();
    for (k = 0, len1 = ref1.length; k < len1; k++) {
      s = ref1[k];
      if (!(typeof s.has_nothing_to_draw === "function" ? s.has_nothing_to_draw() : void 0)) {
        str_sel += " " + s.model_id;
      }
    }
    if (this._old_str_sel !== str_sel) {
      this._old_str_sel = str_sel;
      return true;
    }
    flat = [];
    ref2 = this.active_items();
    for (o = 0, len2 = ref2.length; o < len2; o++) {
      item = ref2[o];
      CanvasManager._get_flat_list(flat, item);
    }
    for (p = 0, len3 = flat.length; p < len3; p++) {
      f = flat[p];
      if (typeof f.has_been_modified === "function" ? f.has_been_modified() : void 0) {
        return true;
      }
    }
    return false;
  };

  CanvasManager.prototype.bounding_box = function() {
    var get_min_max, item, j, len, ref, x_max, x_min;
    if (this._bounding_box != null) {
      return this._bounding_box;
    }
    get_min_max = function(item, x_min, x_max) {
      var j, len, ref, results, sub_item;
      if (typeof item.update_min_max === "function") {
        item.update_min_max(x_min, x_max);
      }
      if (item.sub_canvas_items != null) {
        ref = item.sub_canvas_items();
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          sub_item = ref[j];
          results.push(get_min_max(sub_item, x_min, x_max));
        }
        return results;
      }
    };
    x_min = [+1e40, +1e40, +1e40];
    x_max = [-1e40, -1e40, -1e40];
    ref = this.active_items();
    for (j = 0, len = ref.length; j < len; j++) {
      item = ref[j];
      get_min_max(item, x_min, x_max);
    }
    if (x_min[0] === +1e40) {
      return [[-1, -1, -1], [1, 1, 1]];
    }
    this._bounding_box = [x_min, x_max];
    return this._bounding_box;
  };

  CanvasManager.prototype.fit = function(anim) {
    var O, b, d, dx, dy, h, ip, res, rx, ry, w;
    if (anim == null) {
      anim = 1;
    }
    b = this.bounding_box();
    O = [0.5 * (b[1][0] + b[0][0]), 0.5 * (b[1][1] + b[0][1]), 0.5 * (b[1][2] + b[0][2])];
    d = this.padding_ratio * Math.max(b[1][0] - b[0][0], b[1][1] - b[0][1], b[1][2] - b[0][2]);
    if (d === 0) {
      d = 1;
    }
    if (this.cam.r != null) {
      w = this.canvas.width;
      h = this.canvas.height;
      dx = b[1][0] - b[0][0];
      dy = b[1][1] - b[0][1];
      if (dy === 0) {
        dy = 1;
      }
      ip = 1 / this.padding_ratio;
      if (w > h) {
        rx = (ip * w) / (w - h * (1 - ip));
        this.aset(this.cam.r, rx * (h * dx) / (w * dy), anim);
        d = dy * this.padding_ratio;
      } else {
        ry = (h - w * (1 - ip)) / (ip * h);
        res = ry * (h * dx) / (w * dy);
        this.aset(this.cam.r, res, anim);
        d = dx / res * this.padding_ratio;
      }
    }
    this.aset(this.cam.O, O, anim);
    this.aset(this.cam.d, d, anim);
    return this.aset(this.cam.C, this.cam.O, anim);
  };

  CanvasManager.prototype.aset = function(model, value, anim) {
    if (anim == null) {
      anim = 1;
    }
    return Animation.set(model, value, anim * this.theme.anim_delay.get());
  };

  CanvasManager.prototype.top = function() {
    this.aset(this.cam.X, [1, 0, 0]);
    return this.aset(this.cam.Y, [0, 0, -1]);
  };

  CanvasManager.prototype.bottom = function() {
    this.aset(this.cam.X, [1, 0, 0]);
    return this.aset(this.cam.Y, [0, 0, 1]);
  };

  CanvasManager.prototype.right = function() {
    this.aset(this.cam.X, [0, 0, -1]);
    return this.aset(this.cam.Y, [0, 1, 0]);
  };

  CanvasManager.prototype.left = function() {
    this.aset(this.cam.X, [0, 0, 1]);
    return this.aset(this.cam.Y, [0, 1, 0]);
  };

  CanvasManager.prototype.origin = function() {
    this.aset(this.cam.X, [1, 0, 0]);
    return this.aset(this.cam.Y, [0, 1, 0]);
  };

  CanvasManager.prototype.draw = function() {
    var b, bb, f, has_a_background, has_a_changed_drawable, item, j, k, len, len1, len2, n, o, ref, ref1, ref2, ref3, ref4, ref5, results, s, t;
    this._flat = [];
    ref = this.active_items();
    for (j = 0, len = ref.length; j < len; j++) {
      item = ref[j];
      CanvasManager._get_flat_list(this._flat, item);
    }
    has_a_background = false;
    has_a_changed_drawable = false;
    ref1 = this._flat;
    for (k = 0, len1 = ref1.length; k < len1; k++) {
      f = ref1[k];
      has_a_background |= typeof f.draws_a_background === "function" ? f.draws_a_background() : void 0;
      has_a_changed_drawable |= typeof f.has_been_modified === "function" ? f.has_been_modified() : void 0;
    }
    if (has_a_changed_drawable) {
      delete this._bounding_box;
      bb = this.bounding_box();
      this.cam._O.set(Vec_3.mus(0.5, Vec_3.add(bb[1], bb[0])));
      this.cam._d.set(Vec_3.len(Vec_3.sub(bb[1], bb[0])));
    }
    if (this.ctx_type === "gl") {
      this.ctx.clear(this.ctx.GL_DEPTH_BUFFER_BIT);
    } else if (!has_a_background) {
      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
    if (this.sup_canvas_ctx != null) {
      this.sup_canvas_ctx.clearRect(0, 0, this.sup_canvas.width, this.sup_canvas.height);
    }
    if (this.auto_fit && has_a_changed_drawable) {
      if (this.first_fit != null) {
        this.fit(1);
      } else {
        this.first_fit = true;
        this.fit(0);
      }
    }
    ref2 = this._buf_list;
    for (t in ref2) {
      b = ref2[t];
      ref3 = b.buf;
      for (n in ref3) {
        s = ref3[n];
        s.used = false;
      }
    }
    this._mk_cam_info();
    this._flat.sort(function(a, b) {
      if ((a.z_index == null) || (b.z_index == null)) {
        console.log(a, b);
      }
      return a.z_index() - b.z_index();
    });
    ref4 = this._flat;
    for (o = 0, len2 = ref4.length; o < len2; o++) {
      item = ref4[o];
      item.draw(this.cam_info);
    }
    this.ctx.finish();
    ref5 = this._buf_list;
    results = [];
    for (t in ref5) {
      b = ref5[t];
      results.push((function() {
        var ref6, results1;
        ref6 = b.buf;
        results1 = [];
        for (n in ref6) {
          s = ref6[n];
          if (!s.used) {
            b.del(s.val);
            results1.push(delete b.buf[n]);
          } else {
            results1.push(void 0);
          }
        }
        return results1;
      })());
    }
    return results;
  };

  CanvasManager.prototype.resize = function(w, h) {
    this.canvas.width = w;
    this.canvas.height = h;
    if (this.sup_canvas) {
      this.sup_canvas.width = w;
      this.sup_canvas.height = h;
    }
    if (this.ctx_type === "gl") {
      return this.ctx.viewport(0, 0, this.canvas.width, this.canvas.height);
    }
  };

  CanvasManager.prototype.make_sub_canvas = function() {
    if (this.sup_canvas == null) {
      this.sup_canvas = new_dom_element({
        style: {
          pointerEvents: "none",
          position: "absolute",
          zIndex: 1,
          left: 0,
          top: 0
        },
        nodeName: "canvas",
        className: this.class_name != null ? this.class_name || '' : void 0,
        parentNode: this.el
      });
      this.sup_canvas_ctx = this.sup_canvas.getContext('2d');
      this.sup_canvas.width = this.canvas.width;
      return this.sup_canvas.height = this.canvas.height;
    }
  };

  CanvasManager.prototype.fillText = function(t, x, y, f, a, c) {
    var m;
    if (f == null) {
      f = "16pt Arial";
    }
    if (a == null) {
      a = "center";
    }
    if (c == null) {
      c = "White";
    }
    if (this.ctx_type === "2d") {
      this.ctx.font = f;
      this.ctx.textAlign = a;
      this.ctx.textBaseline = "middle";
      return this.ctx.fillText(t, x, y);
    } else {
      this.make_sub_canvas();
      this.sup_canvas_ctx.font = f;
      this.sup_canvas_ctx.fillStyle = c;
      if (a === "center-limited") {
        m = this.sup_canvas_ctx.measureText(t);
        if (x + m.width / 2 + 10 >= this.sup_canvas.width) {
          x = this.sup_canvas.width - 10 - m.width / 2;
        }
        this.sup_canvas_ctx.textAlign = "center";
      } else {
        this.sup_canvas_ctx.textAlign = a;
      }
      this.sup_canvas_ctx.textBaseline = "middle";
      return this.sup_canvas_ctx.fillText(t, x, y);
    }
  };

  CanvasManager.prototype.active_items_rec = function(l) {
    var item, j, k, len, len1, ref, res, sub_item;
    if (l == null) {
      l = this.active_items();
    }
    res = [];
    for (j = 0, len = l.length; j < len; j++) {
      item = l[j];
      res.push(item);
      if (item.sub_canvas_items != null) {
        ref = this.active_items_rec(item.sub_canvas_items());
        for (k = 0, len1 = ref.length; k < len1; k++) {
          sub_item = ref[k];
          res.push(sub_item);
        }
      }
    }
    return res;
  };

  CanvasManager.prototype.selected_and_always_active_rec = function() {
    var act, j, len, ref, res;
    res = this.selected_items_rec();
    ref = this.active_items_rec();
    for (j = 0, len = ref.length; j < len; j++) {
      act = ref[j];
      if (typeof act.always_active === "function" ? act.always_active() : void 0) {
        res.push(act);
      }
    }
    return res;
  };

  CanvasManager.prototype.selected_items_rec = function(l) {
    var item, j, k, len, len1, ref, res, sub_item;
    if (l == null) {
      l = this.selected_items();
    }
    res = [];
    for (j = 0, len = l.length; j < len; j++) {
      item = l[j];
      res.push(item);
      if (item.sub_canvas_items != null) {
        ref = this.selected_items_rec(item.sub_canvas_items());
        for (k = 0, len1 = ref.length; k < len1; k++) {
          sub_item = ref[k];
          res.push(sub_item);
        }
      }
    }
    return res;
  };

  CanvasManager.prototype.gl_vert = function(src) {
    return this._get_buf_obj("vert", src, (function(_this) {
      return function() {
        return _this._make_gl_shader(src, _this.ctx.VERTEX_SHADER);
      };
    })(this));
  };

  CanvasManager.prototype.gl_frag = function(src) {
    return this._get_buf_obj("frag", src, (function(_this) {
      return function() {
        return _this._make_gl_shader(src, _this.ctx.FRAGMENT_SHADER);
      };
    })(this));
  };

  CanvasManager.prototype.gl_prog = function(vert_src, frag_src) {
    var frag, src, vert;
    vert = this.gl_vert(vert_src);
    frag = this.gl_frag(frag_src);
    src = vert_src + "**" + frag_src;
    return this._get_buf_obj("prog", src, (function(_this) {
      return function() {
        return _this._make_gl_program(vert, frag);
      };
    })(this));
  };

  CanvasManager.prototype._get_buf_obj = function(list_name, key, fun) {
    var obj;
    obj = this._buf_list[list_name].buf;
    if (obj[key] != null) {
      obj[key].used = true;
    } else {
      obj[key] = {
        used: true,
        val: fun()
      };
    }
    return obj[key].val;
  };

  CanvasManager.prototype._make_gl_shader = function(src, type) {
    var shader;
    shader = this.ctx.createShader(type);
    this.ctx.shaderSource(shader, src);
    this.ctx.compileShader(shader);
    if (this.ctx.getShaderParameter(shader, this.ctx.COMPILE_STATUS)) {
      return shader;
    }
    return alert("An error occurred compiling the shader: " + src + this.ctx.getShaderInfoLog(shader));
  };

  CanvasManager.prototype._make_gl_program = function(vert, frag) {
    var prog;
    prog = this.ctx.createProgram();
    this.ctx.attachShader(prog, vert);
    this.ctx.attachShader(prog, frag);
    this.ctx.linkProgram(prog);
    if (this.ctx.getProgramParameter(prog, this.ctx.LINK_STATUS)) {
      return prog;
    }
    return alert("Unable to initialize the shader program.");
  };

  CanvasManager.prototype._catch_evt = function(evt) {
    if (typeof evt.preventDefault === "function") {
      evt.preventDefault();
    }
    evt.returnValue = false;
    return false;
  };

  CanvasManager.prototype._dbl_click = function(evt) {
    var fun, item, j, k, len, len1, len2, o, ref, ref1, ref2;
    ref = this.select_canvas_fun;
    for (j = 0, len = ref.length; j < len; j++) {
      fun = ref[j];
      fun(this, evt);
    }
    if (evt == null) {
      evt = window.event;
    }
    this.mouse_x = evt.clientX - get_left(this.canvas);
    this.mouse_y = evt.clientY - get_top(this.canvas);
    ref1 = this.selected_and_always_active_rec();
    for (k = 0, len1 = ref1.length; k < len1; k++) {
      item = ref1[k];
      if (typeof item.on_dbl_click === "function" ? item.on_dbl_click(this, evt, [this.mouse_x, this.mouse_y], this.mouse_b) : void 0) {
        return this._catch_evt(evt);
      }
    }
    ref2 = this.dblclick_fun;
    for (o = 0, len2 = ref2.length; o < len2; o++) {
      fun = ref2[o];
      if (fun(this, evt, [this.mouse_x, this.mouse_y], this.mouse_b)) {
        return this._catch_evt(evt);
      }
    }
    return this._catch_evt(evt);
  };

  CanvasManager.prototype._mouse_down = function(evt) {
    var fun, item, j, k, len, len1, len2, o, ref, ref1, ref2;
    this.mouse_has_moved_since_mouse_down = false;
    ref = this.select_canvas_fun;
    for (j = 0, len = ref.length; j < len; j++) {
      fun = ref[j];
      fun(this, evt);
    }
    if (evt == null) {
      evt = window.event;
    }
    this.mouse_b = evt.which != null ? evt.which < 2 ? "LEFT" : evt.which === 2 ? "MIDDLE" : "RIGHT" : evt.button < 2 ? "LEFT" : evt.button === 4 ? "MIDDLE" : "RIGHT";
    this.mouse_x = evt.clientX - get_left(this.canvas);
    this.mouse_y = evt.clientY - get_top(this.canvas);
    ref1 = this.selected_and_always_active_rec();
    for (k = 0, len1 = ref1.length; k < len1; k++) {
      item = ref1[k];
      if (typeof item.on_mouse_down === "function" ? item.on_mouse_down(this, evt, [this.mouse_x, this.mouse_y], this.mouse_b) : void 0) {
        return this._catch_evt(evt);
      }
    }
    ref2 = this.click_fun;
    for (o = 0, len2 = ref2.length; o < len2; o++) {
      fun = ref2[o];
      if (fun(this, evt, [this.mouse_x, this.mouse_y], this.mouse_b)) {
        return this._catch_evt(evt);
      }
    }
    if (this.mouse_b === "RIGHT") {
      this.canvas.oncontextmenu = (function(_this) {
        return function() {
          return false;
        };
      })(this);
      evt.stopPropagation();
      evt.cancelBubble = true;
      document.oncontextmenu = (function(_this) {
        return function() {
          return false;
        };
      })(this);
    }
    return this._catch_evt(evt);
  };

  CanvasManager.prototype._mouse_up = function(evt) {
    var item, j, len, ref;
    if (!this.mouse_has_moved_since_mouse_down) {
      ref = this.selected_and_always_active_rec();
      for (j = 0, len = ref.length; j < len; j++) {
        item = ref[j];
        if (typeof item.on_mouse_up_wo_move === "function" ? item.on_mouse_up_wo_move(this, evt, [this.mouse_x, this.mouse_y], this.mouse_b) : void 0) {
          delete this.mouse_b;
          delete this.clk_x;
          delete this.clk_y;
          return this._catch_evt(evt);
        }
      }
    }
    delete this.mouse_b;
    delete this.clk_x;
    return delete this.clk_y;
  };

  CanvasManager.prototype._mouse_out = function(evt) {
    delete this.mouse_b;
    delete this.clk_x;
    return delete this.clk_y;
  };

  CanvasManager.prototype._mouse_wheel = function(evt) {
    var c, cx, cy, delta, item, j, len, ref;
    if (evt == null) {
      evt = window.event;
    }
    this.mouse_x = evt.clientX - get_left(this.canvas);
    this.mouse_y = evt.clientY - get_top(this.canvas);
    delta = 0;
    if (evt.wheelDelta != null) {
      delta = evt.wheelDelta / 120.0;
      if (window.opera) {
        delta = -delta;
      }
    } else if (evt.detail) {
      delta = -evt.detail / 3.0;
    }
    ref = this.selected_and_always_active_rec();
    for (j = 0, len = ref.length; j < len; j++) {
      item = ref[j];
      if (typeof item.on_mouse_wheel === "function" ? item.on_mouse_wheel(this, evt, [this.mouse_x, this.mouse_y], this.mouse_b, delta) : void 0) {
        return this._catch_evt(evt);
      }
    }
    c = Math.pow(1.2, delta);
    cx = evt.shiftKey || this.constrain_zoom === "y" ? 1 : c;
    cy = evt.altKey || this.constrain_zoom === "x" ? 1 : c;
    this.cam.zoom(this.mouse_x, this.mouse_y, [cx, cy], this.canvas.width, this.canvas.height);
    return this._catch_evt(evt);
  };

  CanvasManager.prototype._mouse_move = function(evt) {
    var a, h, item, j, len, mwh, old_x, old_y, ref, w, x, y;
    old_x = this.mouse_x;
    old_y = this.mouse_y;
    if (evt == null) {
      evt = window.event;
    }
    this.mouse_has_moved_since_mouse_down = true;
    this.rea_x = evt.clientX - get_left(this.canvas);
    this.rea_y = evt.clientY - get_top(this.canvas);
    if (evt.ctrlKey && this.mouse_b) {
      if (this.clk_x == null) {
        this.clk_x = this.rea_x;
        this.clk_y = this.rea_y;
      }
      this.mouse_x = this.clk_x + (this.rea_x - this.clk_x) / 10;
      this.mouse_y = this.clk_y + (this.rea_y - this.clk_y) / 10;
    } else {
      this.mouse_x = this.rea_x;
      this.mouse_y = this.rea_y;
    }
    ref = this.selected_and_always_active_rec();
    for (j = 0, len = ref.length; j < len; j++) {
      item = ref[j];
      if (typeof item.on_mouse_move === "function" ? item.on_mouse_move(this, evt, [this.mouse_x, this.mouse_y], this.mouse_b, [old_x, old_y]) : void 0) {
        return this._catch_evt(evt);
      }
    }
    w = this.canvas.width;
    h = this.canvas.height;
    mwh = Math.min(w, h);
    if (this.mouse_b === "LEFT" && evt.shiftKey) {
      a = Math.atan2(this.mouse_y - 0.5 * h, this.mouse_x - 0.5 * w) - Math.atan2(old_y - 0.5 * h, old_x - 0.5 * w);
      this.cam.rotate(0.0, 0.0, a);
      return this._catch_evt(evt);
    }
    if (this.mouse_b === "MIDDLE" || this.mouse_b === "RIGHT" || this.mouse_b === "LEFT" && evt.ctrlKey) {
      x = this.constrain_zoom !== "y";
      y = this.constrain_zoom !== "x";
      this.cam.pan((this.mouse_x - old_x) * x, (this.mouse_y - old_y) * y, w, h);
      return this._catch_evt(evt);
    }
    if (this.mouse_b === "LEFT") {
      x = 2.0 * (this.mouse_x - old_x) / mwh;
      y = 2.0 * (this.mouse_y - old_y) / mwh;
      this.cam.rotate(y, x, 0.0);
      return this._catch_evt(evt);
    }
    return this._catch_evt(evt);
  };

  CanvasManager.prototype._init_ctx = function(opt_attribs) {
    var error, j, len, ref, t;
    if (this.allow_gl) {
      ref = ["experimental-webgl", "webgl", "webkit-3d", "moz-webgl"];
      for (j = 0, len = ref.length; j < len; j++) {
        t = ref[j];
        try {
          if (this.ctx = this.canvas.getContext(t, opt_attribs)) {
            this.ctx_type = "gl";
            this.ctx.enable(this.ctx.DEPTH_TEST);
            this.ctx.depthFunc(this.ctx.LESS);
            this.ctx.blendFunc(this.ctx.SRC_ALPHA, this.ctx.ONE_MINUS_SRC_ALPHA);
            this.ctx.enable(this.ctx.BLEND);
            this.ctx.ctx_id = (CanvasManager.ctx_id += 1);
            return true;
          }
        } catch (error1) {
          error = error1;
          continue;
        }
      }
    }
    this.ctx_type = "2d";
    return this.ctx = this.canvas.getContext('2d');
  };

  CanvasManager.prototype._get_x_min = function() {
    return this.bounding_box()[0];
  };

  CanvasManager.prototype._get_x_max = function() {
    return this.bounding_box()[1];
  };

  CanvasManager.prototype._mk_cam_info = function() {
    var h, i, item, j, len, ref, w;
    w = this.canvas.width;
    h = this.canvas.height;
    i = {};
    ref = typeof this.selected_items === "function" ? this.selected_items() : void 0;
    for (j = 0, len = ref.length; j < len; j++) {
      item = ref[j];
      CanvasManager._get_items_in_an_hash_table_rec(i, item);
    }
    return this.cam_info = {
      w: w,
      h: h,
      cm: this,
      mwh: Math.min(w, h),
      ctx: this.ctx,
      cam: this.cam,
      ctx_type: this.ctx_type,
      get_x_min: (function(_this) {
        return function() {
          return _this._get_x_min();
        };
      })(this),
      get_x_max: (function(_this) {
        return function() {
          return _this._get_x_max();
        };
      })(this),
      re_2_sc: this.cam.re_2_sc(w, h),
      sc_2_rw: this.cam.sc_2_rw(w, h),
      sel_item: i,
      time: this.time.get(),
      time_ref: this.time,
      theme: this.theme,
      padding: (1 - 1 / this.padding_ratio) * Math.min(w, h),
      ctx_2d: (function(_this) {
        return function() {
          if (_this.ctx_type === "gl") {
            _this.make_sub_canvas();
            return _this.sup_canvas_ctx;
          } else {
            return _this.ctx;
          }
        };
      })(this)
    };
  };

  CanvasManager._get_flat_list = function(flat, item) {
    var j, len, ref, sub_item;
    if (item.sub_canvas_items != null) {
      ref = item.sub_canvas_items();
      for (j = 0, len = ref.length; j < len; j++) {
        sub_item = ref[j];
        CanvasManager._get_flat_list(flat, sub_item);
      }
    }
    if (!(typeof item.has_nothing_to_draw === "function" ? item.has_nothing_to_draw() : void 0)) {
      return flat.push(item);
    }
  };

  CanvasManager._get_items_in_an_hash_table_rec = function(i, item) {
    var j, len, n, ref, results;
    i[item.model_id] = true;
    if (item.sub_canvas_items != null) {
      ref = item.sub_canvas_items();
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        n = ref[j];
        results.push(CanvasManager._get_items_in_an_hash_table_rec(i, n));
      }
      return results;
    }
  };

  return CanvasManager;

})(View);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Log_List,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Log_List = (function(superClass) {
  var sort_dir;

  extend(ModelEditorItem_Log_List, superClass);

  function ModelEditorItem_Log_List(params) {
    ModelEditorItem_Log_List.__super__.constructor.call(this, params);
    this.index_sorted = new Lst;
    this.selected_file = new Lst;
    this.selected_file.bind(this);
    this.line_height = 30;
    this.ed.ondrop = (function(_this) {
      return function(evt) {
        return _this.cancel_natural_hotkeys(evt);
      };
    })(this);
    this.container = new_dom_element({
      parentNode: this.ed,
      nodeName: "div",
      className: "directory_container",
      ondragover: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragout: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragleave: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondrop: (function(_this) {
        return function(evt) {
          evt.stopPropagation();
          evt.preventDefault();
          _this.cancel_natural_hotkeys(evt);
          return false;
        };
      })(this)
    });
    this.all_file_container = new_dom_element({
      parentNode: this.container,
      nodeName: "div"
    });
  }

  ModelEditorItem_Log_List.prototype.onchange = function() {
    if (this.selected_file.has_been_directly_modified()) {
      this.draw_selected_file();
    }
    if (this.model.has_been_modified()) {
      return this.refresh();
    }
  };

  ModelEditorItem_Log_List.prototype.refresh = function() {
    this.empty_window();
    this.init();
    return this.draw_selected_file();
  };

  ModelEditorItem_Log_List.prototype.empty_window = function() {
    return this.all_file_container.innerHTML = "";
  };

  ModelEditorItem_Log_List.prototype.draw_selected_file = function() {
    var file, file_contain, j, k, len, results;
    file_contain = document.getElementsByClassName('line_container');
    results = [];
    for (j = k = 0, len = file_contain.length; k < len; j = ++k) {
      file = file_contain[j];
      if (parseInt(this.selected_file.indexOf(j)) !== -1) {
        results.push(add_class(file, 'selected_file'));
      } else {
        results.push(rem_class(file, 'selected_file'));
      }
    }
    return results;
  };

  ModelEditorItem_Log_List.prototype.cancel_natural_hotkeys = function(evt) {
    if (!evt) {
      evt = window.event;
    }
    evt.cancelBubble = true;
    if (typeof evt.stopPropagation === "function") {
      evt.stopPropagation();
    }
    if (typeof evt.preventDefault === "function") {
      evt.preventDefault();
    }
    if (typeof evt.stopImmediatePropagation === "function") {
      evt.stopImmediatePropagation();
    }
    return false;
  };

  sort_dir = function(a, b) {
    if (a.name.get().toLowerCase() > b.name.get().toLowerCase()) {
      return 1;
    } else {
      return -1;
    }
  };

  ModelEditorItem_Log_List.prototype.init = function() {
    var _sorted, elem, i, k, l, len, len1, results, sorted;
    _sorted = this.model;
    this.index_sorted.clear();
    sorted = new Array;
    for (i = k = 0, len = _sorted.length; k < len; i = ++k) {
      elem = _sorted[i];
      sorted.push(elem);
      this.index_sorted.push(i);
    }
    results = [];
    for (i = l = 0, len1 = sorted.length; l < len1; i = ++l) {
      elem = sorted[i];
      results.push((function(_this) {
        return function(elem, i) {
          var log_line, log_name;
          log_line = new_dom_element({
            parentNode: _this.all_file_container,
            nodeName: "div",
            className: "line_container",
            style: {
              width: "100%",
              height: 30,
              cursor: "pointer",
              borderBottom: "1px solid grey"
            },
            onclick: function(evt) {
              return elem.load((function(_this) {
                return function(object, err) {
                  var mv;
                  return mv = new MessageView(object, evt);
                };
              })(this));
            }
          });
          return log_name = new_dom_element({
            parentNode: user_line,
            nodeName: "div",
            className: "line_message_container",
            txt: elem.application.name,
            style: {
              margin: "5px 0px 0px 10px",
              padding: "0px 0px 0px 30px",
              textAlign: "left",
              cssFloat: "left",
              fontSize: "18px"
            }
          });
        };
      })(this)(elem, i));
    }
    return results;
  };

  ModelEditorItem_Log_List.prototype.path = function() {
    return "test_need_to_be_complete";
  };

  ModelEditorItem_Log_List.add_action = function(model_type, fun) {
    if (ModelEditorItem_Directory._action_list[model_type] == null) {
      ModelEditorItem_Directory._action_list[model_type] = [];
    }
    return ModelEditorItem_Directory._action_list[model_type].push(fun);
  };

  return ModelEditorItem_Log_List;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Application,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Application = (function(superClass) {
  var sort_dir;

  extend(ModelEditorItem_Application, superClass);

  function ModelEditorItem_Application(params) {
    this.onPopupClose = bind(this.onPopupClose, this);
    this.new_application = bind(this.new_application, this);
    ModelEditorItem_Application.__super__.constructor.call(this, params);
    this.use_icons = params.use_icons != null ? params.use_icons : true;
    this.index_sorted = new Lst;
    this.selected_file = new Lst;
    this.selected_file.bind(this);
    this.line_height = 30;
    this.ed.ondrop = (function(_this) {
      return function(evt) {
        return _this.cancel_natural_hotkeys(evt);
      };
    })(this);
    this.container = new_dom_element({
      parentNode: this.ed,
      nodeName: "div",
      className: "directory_container",
      ondragover: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragout: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragleave: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondrop: (function(_this) {
        return function(evt) {
          evt.stopPropagation();
          evt.preventDefault();
          _this.cancel_natural_hotkeys(evt);
          return false;
        };
      })(this)
    });
    if (this.use_icons) {
      ModelEditorItem_Application.new_application_button(this);
    }
    this.all_file_container = new_dom_element({
      parentNode: this.container,
      nodeName: "div"
    });
  }

  ModelEditorItem_Application.new_application_button = function(this_instance) {
    var div_top;
    div_top = new_dom_element({
      parentNode: this_instance.container,
      className: "desk_panel_title"
    });
    new_dom_element({
      parentNode: div_top,
      nodeName: "div",
      txt: "Application",
      style: {
        margin: "5px 20px 0px 0px",
        height: "30px",
        cssFloat: "left"
      }
    });
    return new_dom_element({
      parentNode: div_top,
      nodeName: "button",
      className: "desk_panel_button",
      txt: "New application",
      style: {
        margin: "3px 0px 0px 0px",
        padding: "0px 10px 0px 10px",
        height: "20px",
        cssFloat: "left"
      },
      onclick: function(evt) {
        return this_instance.new_application(evt);
      }
    });
  };

  ModelEditorItem_Application.prototype.new_application = function(evt) {
    var Pheight, Pleft, Ptop, Pwidth, application_list, p;
    this.d = new_dom_element({
      className: "apps_container",
      id: "id_apps_container"
    });
    application_list = new ModelEditorItem_Application({
      el: this.d,
      model: APPS,
      use_icons: false,
      add_app: true,
      config: this.config
    });
    Ptop = 100;
    Pleft = 100;
    Pwidth = 800;
    Pheight = 500;
    return p = new_popup("Apps store", {
      event: evt,
      child: this.d,
      top_x: Pleft,
      top_y: Ptop,
      width: Pwidth,
      height: Pheight,
      onclose: (function(_this) {
        return function() {
          return _this.onPopupClose(_this.d);
        };
      })(this)
    });
  };

  ModelEditorItem_Application.prototype.onPopupClose = function(div_to_clear) {
    document.onkeydown = void 0;
    return this.clear_page(div_to_clear);
  };

  ModelEditorItem_Application.prototype.clear_page = function(div_to_clear) {
    var results;
    results = [];
    while (div_to_clear.firstChild != null) {
      results.push(div_to_clear.removeChild(div_to_clear.firstChild));
    }
    return results;
  };

  ModelEditorItem_Application.prototype.onchange = function() {
    if (this.selected_file.has_been_directly_modified()) {
      this.draw_selected_file();
    }
    if (this.model.has_been_modified()) {
      return this.refresh();
    }
  };

  ModelEditorItem_Application.prototype.refresh = function() {
    this.empty_window();
    this.init();
    return this.draw_selected_file();
  };

  ModelEditorItem_Application.prototype.empty_window = function() {
    return this.all_file_container.innerHTML = "";
  };

  ModelEditorItem_Application.prototype.draw_selected_file = function() {
    var file, file_contain, j, k, len, results;
    file_contain = document.getElementsByClassName('line_container');
    results = [];
    for (j = k = 0, len = file_contain.length; k < len; j = ++k) {
      file = file_contain[j];
      if (parseInt(this.selected_file.indexOf(j)) !== -1) {
        results.push(add_class(file, 'selected_file'));
      } else {
        results.push(rem_class(file, 'selected_file'));
      }
    }
    return results;
  };

  ModelEditorItem_Application.prototype.cancel_natural_hotkeys = function(evt) {
    if (!evt) {
      evt = window.event;
    }
    evt.cancelBubble = true;
    if (typeof evt.stopPropagation === "function") {
      evt.stopPropagation();
    }
    if (typeof evt.preventDefault === "function") {
      evt.preventDefault();
    }
    if (typeof evt.stopImmediatePropagation === "function") {
      evt.stopImmediatePropagation();
    }
    return false;
  };

  sort_dir = function(a, b) {
    if (a.name.get().toLowerCase() > b.name.get().toLowerCase()) {
      return 1;
    } else {
      return -1;
    }
  };

  ModelEditorItem_Application.prototype.init = function() {
    var _sorted, application, elem, i, k, l, len, len1, results, sorted;
    _sorted = this.model;
    this.index_sorted.clear();
    sorted = new Array;
    for (i = k = 0, len = _sorted.length; k < len; i = ++k) {
      elem = _sorted[i];
      sorted.push(elem);
      this.index_sorted.push(i);
    }
    results = [];
    for (i = l = 0, len1 = sorted.length; l < len1; i = ++l) {
      application = sorted[i];
      results.push((function(_this) {
        return function(application, i) {
          var act, app, config, editor_app, group_app, ico_app, len2, link_app, m, name_app, picture, powered_app, publication_link_app, ref, results1, text_app, tutorial_link_app;
          if (application.actions != null) {
            group_app = new_dom_element({
              parentNode: _this.all_file_container,
              className: "app_group",
              nodeName: "div"
            });
            ref = application.actions;
            results1 = [];
            for (m = 0, len2 = ref.length; m < len2; m++) {
              act = ref[m];
              ico_app = new_dom_element({
                parentNode: group_app,
                className: "app_icon",
                nodeName: "div"
              });
              if ((_this.app != null) && (_this.use_in_lab != null)) {
                app = _this.app;
                ico_app.onmousedown = function(evt) {
                  return act.fun(evt, app);
                };
              } else if ((_this.config != null) && (_this.add_app != null)) {
                config = _this.config;
                ico_app.onmousedown = function(evt) {
                  var a, ac, exist, len3, len4, n, o, ref1, ref2;
                  exist = false;
                  ref1 = config.selected_organisation[0].list_applications;
                  for (n = 0, len3 = ref1.length; n < len3; n++) {
                    a = ref1[n];
                    ref2 = a.actions;
                    for (o = 0, len4 = ref2.length; o < len4; o++) {
                      ac = ref2[o];
                      if (ac.ico === act.ico) {
                        exist = true;
                      }
                    }
                  }
                  if (!exist) {
                    return config.selected_organisation[0].list_applications.push(application);
                  }
                };
              }
              picture = new_dom_element({
                parentNode: ico_app,
                className: "app_picture",
                nodeName: "img",
                src: act.ico,
                alt: act.txt,
                title: act.txt,
                style: {
                  maxWidth: 150,
                  maxHeight: 75
                }
              });
              text_app = new_dom_element({
                parentNode: group_app,
                className: "app_group_text",
                nodeName: "div"
              });
              name_app = new_dom_element({
                parentNode: text_app,
                className: "app_group_title",
                nodeName: "div",
                txt: application.name
              });
              editor_app = new_dom_element({
                parentNode: text_app,
                className: "app_group_name",
                nodeName: "div",
                style: {
                  fontWidth: 0.8
                },
                txt: "powered by"
              });
              powered_app = new_dom_element({
                parentNode: text_app,
                className: "app_group_name",
                nodeName: "div",
                txt: application.powered_with
              });
              link_app = new_dom_element({
                parentNode: group_app,
                className: "app_group_link",
                nodeName: "div"
              });
              publication_link_app = new_dom_element({
                parentNode: link_app,
                className: "app_group_publication_link",
                nodeName: "div",
                src: act.ico,
                alt: "Related publications",
                title: "Related publications",
                onmousedown: function(evt) {
                  var myWindow;
                  myWindow = window.open('', '');
                  myWindow.document.location.href = application.publication_link;
                  return myWindow.focus();
                }
              });
              results1.push(tutorial_link_app = new_dom_element({
                parentNode: link_app,
                className: "app_group_tutorial_link",
                nodeName: "div",
                src: act.ico,
                alt: application.tutorial_link,
                title: "Video tutorial",
                onmousedown: function(evt) {
                  var myWindow;
                  myWindow = window.open('', '');
                  myWindow.document.location.href = application.tutorial_link;
                  return myWindow.focus();
                }
              }));
            }
            return results1;
          }
        };
      })(this)(application, i));
    }
    return results;
  };

  ModelEditorItem_Application.prototype.path = function() {
    return "test_need_to_be_complete";
  };

  return ModelEditorItem_Application;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_ApplicationLite,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_ApplicationLite = (function(superClass) {
  var sort_dir;

  extend(ModelEditorItem_ApplicationLite, superClass);

  function ModelEditorItem_ApplicationLite(params) {
    this.onPopupClose = bind(this.onPopupClose, this);
    ModelEditorItem_ApplicationLite.__super__.constructor.call(this, params);
    this.use_icons = params.use_icons != null ? params.use_icons : true;
    this.index_sorted = new Lst;
    this.selected_file = new Lst;
    this.selected_file.bind(this);
    this.line_height = 30;
    this.ed.ondrop = (function(_this) {
      return function(evt) {
        return _this.cancel_natural_hotkeys(evt);
      };
    })(this);
    this.container = new_dom_element({
      parentNode: this.ed,
      nodeName: "div",
      className: "directory_container",
      ondragover: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragout: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragleave: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondrop: (function(_this) {
        return function(evt) {
          evt.stopPropagation();
          evt.preventDefault();
          _this.cancel_natural_hotkeys(evt);
          return false;
        };
      })(this)
    });
    if (this.use_icons) {
      ModelEditorItem_Application.new_application_button(this);
    }
    this.all_file_container = new_dom_element({
      parentNode: this.container,
      nodeName: "div"
    });
  }

  ModelEditorItem_ApplicationLite.prototype.onPopupClose = function(div_to_clear) {
    document.onkeydown = void 0;
    return this.clear_page(div_to_clear);
  };

  ModelEditorItem_ApplicationLite.prototype.clear_page = function(div_to_clear) {
    var results;
    results = [];
    while (div_to_clear.firstChild != null) {
      results.push(div_to_clear.removeChild(div_to_clear.firstChild));
    }
    return results;
  };

  ModelEditorItem_ApplicationLite.prototype.onchange = function() {
    if (this.selected_file.has_been_directly_modified()) {
      this.draw_selected_file();
    }
    if (this.model.has_been_modified()) {
      return this.refresh();
    }
  };

  ModelEditorItem_ApplicationLite.prototype.refresh = function() {
    this.empty_window();
    this.init();
    return this.draw_selected_file();
  };

  ModelEditorItem_ApplicationLite.prototype.empty_window = function() {
    return this.all_file_container.innerHTML = "";
  };

  ModelEditorItem_ApplicationLite.prototype.draw_selected_file = function() {
    var file, file_contain, j, k, len, results;
    file_contain = document.getElementsByClassName('line_container');
    results = [];
    for (j = k = 0, len = file_contain.length; k < len; j = ++k) {
      file = file_contain[j];
      if (parseInt(this.selected_file.indexOf(j)) !== -1) {
        results.push(add_class(file, 'selected_file'));
      } else {
        results.push(rem_class(file, 'selected_file'));
      }
    }
    return results;
  };

  ModelEditorItem_ApplicationLite.prototype.cancel_natural_hotkeys = function(evt) {
    if (!evt) {
      evt = window.event;
    }
    evt.cancelBubble = true;
    if (typeof evt.stopPropagation === "function") {
      evt.stopPropagation();
    }
    if (typeof evt.preventDefault === "function") {
      evt.preventDefault();
    }
    if (typeof evt.stopImmediatePropagation === "function") {
      evt.stopImmediatePropagation();
    }
    return false;
  };

  sort_dir = function(a, b) {
    if (a.name.get().toLowerCase() > b.name.get().toLowerCase()) {
      return 1;
    } else {
      return -1;
    }
  };

  ModelEditorItem_ApplicationLite.prototype.init = function() {
    var _sorted, application, elem, i, k, l, len, len1, results, sorted;
    _sorted = this.model;
    this.index_sorted.clear();
    sorted = new Array;
    for (i = k = 0, len = _sorted.length; k < len; i = ++k) {
      elem = _sorted[i];
      sorted.push(elem);
      this.index_sorted.push(i);
    }
    results = [];
    for (i = l = 0, len1 = sorted.length; l < len1; i = ++l) {
      application = sorted[i];
      results.push((function(_this) {
        return function(application, i) {
          var act, app, config, description_app, editor_app, group_app, ico_app, len2, m, name_app, picture, powered_app, ref, results1, text_app;
          if (application.actions != null) {
            group_app = new_dom_element({
              parentNode: _this.all_file_container,
              className: "app_group",
              nodeName: "div"
            });
            ref = application.actions;
            results1 = [];
            for (m = 0, len2 = ref.length; m < len2; m++) {
              act = ref[m];
              ico_app = new_dom_element({
                parentNode: group_app,
                className: "app_icon",
                nodeName: "div"
              });
              if ((_this.app != null) && (_this.use_in_lab != null)) {
                app = _this.app;
                ico_app.onmousedown = function(evt) {
                  return act.fun(evt, app);
                };
              } else if ((_this.config != null) && (_this.add_app != null)) {
                config = _this.config;
                ico_app.onmousedown = function(evt) {
                  var a, ac, exist, len3, len4, n, o, ref1, ref2;
                  exist = false;
                  ref1 = config.selected_organisation[0].list_applications;
                  for (n = 0, len3 = ref1.length; n < len3; n++) {
                    a = ref1[n];
                    ref2 = a.actions;
                    for (o = 0, len4 = ref2.length; o < len4; o++) {
                      ac = ref2[o];
                      if (ac.ico === act.ico) {
                        exist = true;
                      }
                    }
                  }
                  if (!exist) {
                    return config.selected_organisation[0].list_applications.push(application);
                  }
                };
              }
              picture = new_dom_element({
                parentNode: ico_app,
                className: "app_picture",
                nodeName: "img",
                src: "data:image/png;base64,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",
                alt: act.txt,
                title: act.txt,
                style: {
                  position: "absolute",
                  zIndex: 1,
                  maxWidth: 150,
                  maxHeight: 75
                }
              });
              name_app = new_dom_element({
                parentNode: ico_app,
                className: "app_group_title",
                nodeName: "div",
                txt: application.name,
                style: {
                  position: "absolute",
                  zIndex: 2
                }
              });
              text_app = new_dom_element({
                parentNode: group_app,
                className: "app_group_text",
                nodeName: "div"
              });
              editor_app = new_dom_element({
                parentNode: text_app,
                className: "app_group_name",
                nodeName: "div",
                style: {
                  fontWidth: 0.8
                },
                txt: "powered by"
              });
              powered_app = new_dom_element({
                parentNode: text_app,
                className: "app_group_name",
                nodeName: "div",
                txt: application.powered_with
              });
              results1.push(description_app = new_dom_element({
                parentNode: group_app,
                className: "app_group_text",
                nodeName: "div",
                txt: application.description
              }));
            }
            return results1;
          }
        };
      })(this)(application, i));
    }
    return results;
  };

  ModelEditorItem_ApplicationLite.prototype.path = function() {
    return "test_need_to_be_complete";
  };

  return ModelEditorItem_ApplicationLite;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var LoginBar,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

LoginBar = (function(superClass) {
  extend(LoginBar, superClass);

  function LoginBar(el, config) {
    this.el = el;
    this.config = config;
    LoginBar.__super__.constructor.call(this, this.config);
    this.edit_view = new UserEditView;
    this.he = new_dom_element({
      parentNode: this.el,
      nodeName: "div",
      style: {
        position: "absolute",
        left: 0,
        right: 0,
        top: "0px",
        height: "30px",
        withd: "100%",
        borderBottom: "1px solid grey"
      }
    });
  }

  LoginBar.prototype.onchange = function() {
    var logo_div;
    if (this.config.has_been_modified) {
      while (this.he.firstChild != null) {
        this.he.removeChild(this.he.firstChild);
      }
      return logo_div = new_dom_element({
        parentNode: this.he,
        nodeName: "div",
        className: "logo"
      });
    }
  };

  return LoginBar;

})(View);
// Generated by CoffeeScript 1.11.1
var UserEditView,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

UserEditView = (function(superClass) {
  extend(UserEditView, superClass);

  function UserEditView() {
    this.onPopupClose = bind(this.onPopupClose, this);
    this.modifie_information = bind(this.modifie_information, this);
    this.affich_information = bind(this.affich_information, this);
    this.affich_pwscomment = bind(this.affich_pwscomment, this);
    this.change_password = bind(this.change_password, this);
    this.change_information = bind(this.change_information, this);
    this.edit_user_information = bind(this.edit_user_information, this);
    this.edit_user = bind(this.edit_user, this);
    this.user_email = Cookies.set("email");
  }

  UserEditView.prototype.edit_user = function(evt) {
    var Pheight, Pleft, Ptop, Pwidth, p;
    this.edit_user_div = new_dom_element({
      id: "edit_user_container"
    });
    Ptop = 100;
    Pleft = 100;
    Pwidth = 800;
    Pheight = 320;
    this.container_list_action_div = new_dom_element({
      parentNode: this.edit_user_div,
      className: "edit_user_container",
      nodeName: "div",
      style: {
        cssFloat: "left",
        height: 220,
        width: 200,
        margin: "8px 0 0 10px"
      }
    });
    this.edit_user_information_div = new_dom_element({
      parentNode: this.edit_user_div,
      nodeName: "div",
      style: {
        cssFloat: "left",
        height: 220,
        width: 560,
        margin: "0px 0 0 0px"
      }
    });
    UserEditView.get_user_information(this);
    return p = new_popup("Account information", {
      event: evt,
      child: this.edit_user_div,
      top_x: Pleft,
      top_y: Ptop,
      width: Pwidth,
      height: Pheight,
      background: "#262626",
      onclose: (function(_this) {
        return function() {
          return _this.onPopupClose();
        };
      })(this)
    });
  };

  UserEditView.prototype.edit_user_information = function() {
    var i, j, len, link_change_password, list, list_value, name;
    this.clear_page(this.edit_user_information_div);
    list = ["email"];
    list_value = [this.user_email];
    for (j = i = 0, len = list.length; i < len; j = ++i) {
      name = list[j];
      this.affich_information(name, list_value[j], this.edit_user_information_div);
    }
    link_change_password = new_dom_element({
      parentNode: this.edit_user_information_div,
      nodeName: "div",
      txt: "Change password",
      style: {
        height: 20,
        width: 150,
        margin: "15px 0 0 30px",
        cssFloat: "right",
        fontSize: "15px",
        color: "#4dbce9",
        cursor: "pointer"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return _this.change_password();
        };
      })(this)
    });
    return this.affich_pwscomment(this.edit_user_information_div);
  };

  UserEditView.prototype.change_information = function() {
    var i, j, len, link_change_password, link_modifie_informations, list, list_id, list_value, name;
    this.clear_page(this.edit_user_information_div);
    list = ["email"];
    list_id = ["email"];
    list_value = [this.user_email];
    for (j = i = 0, len = list.length; i < len; j = ++i) {
      name = list[j];
      this.modifie_information(name, list_id[j], list_value[j], this.edit_user_information_div);
    }
    link_modifie_informations = new_dom_element({
      parentNode: this.edit_user_information_div,
      nodeName: "button",
      txt: "Valid",
      className: "user_line",
      style: {
        height: 40,
        width: 100,
        border: "none",
        margin: "15px 0 0 10px",
        cssFloat: "right",
        fontSize: "18px",
        color: "#262626",
        cursor: "pointer",
        background: "#4dbce9"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return UserEditView.get_change_user_information(_this);
        };
      })(this)
    });
    link_change_password = new_dom_element({
      parentNode: this.edit_user_information_div,
      nodeName: "button",
      txt: "Cancel",
      className: "user_line",
      style: {
        height: 40,
        width: 100,
        border: "none",
        margin: "15px 0 0 10px",
        cssFloat: "right",
        fontSize: "18px",
        color: "#262626",
        cursor: "pointer",
        background: "#4dbce9"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return _this.edit_user_information();
        };
      })(this)
    });
    return this.affich_pwscomment(this.edit_user_information_div);
  };

  UserEditView.prototype.change_password = function() {
    var i, j, len, link_change_password, link_modifie_informations, list, list_id, name;
    this.clear_page(this.edit_user_information_div);
    list = ["Current password", "New password", "Confirme password"];
    list_id = ["password", "new_password", "confirme_password"];
    for (j = i = 0, len = list.length; i < len; j = ++i) {
      name = list[j];
      this.modifie_information(name, list_id[j], "", this.edit_user_information_div, "password");
    }
    link_modifie_informations = new_dom_element({
      parentNode: this.edit_user_information_div,
      nodeName: "button",
      txt: "Valid",
      className: "user_line",
      style: {
        height: 40,
        width: 100,
        border: "none",
        margin: "15px 0 0 10px",
        cssFloat: "right",
        fontSize: "18px",
        color: "#262626",
        cursor: "pointer",
        background: "#4dbce9"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return UserEditView.get_change_user_password(_this);
        };
      })(this)
    });
    link_change_password = new_dom_element({
      parentNode: this.edit_user_information_div,
      nodeName: "button",
      txt: "Cancel",
      className: "user_line",
      style: {
        height: 40,
        width: 100,
        border: "none",
        margin: "15px 0 0 10px",
        cssFloat: "right",
        fontSize: "18px",
        color: "#262626",
        cursor: "pointer",
        background: "#4dbce9"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return _this.edit_user_information();
        };
      })(this)
    });
    return this.affich_pwscomment(this.edit_user_information_div);
  };

  UserEditView.prototype.affich_pwscomment = function(parent_div) {
    var container_comment;
    return container_comment = new_dom_element({
      parentNode: parent_div,
      nodeName: "div",
      id: 'pwscomment',
      style: {
        width: "100%",
        height: 30,
        border: "none",
        fontSize: "20px",
        cssFloat: "left",
        margin: "10px 0 0 0px",
        textAlign: "center",
        color: "red"
      }
    });
  };

  UserEditView.prototype.affich_information = function(name, txt_value, parent_div) {
    var line_div, name_div, value_div;
    line_div = new_dom_element({
      parentNode: parent_div,
      nodeName: "div",
      className: "user_line",
      style: {
        cssFloat: "left",
        height: 40,
        width: "100%",
        fontSize: "18px",
        background: "#262626",
        margin: "10px 0 0 0px"
      }
    });
    name_div = new_dom_element({
      parentNode: line_div,
      nodeName: "div",
      txt: name + " : ",
      style: {
        cssFloat: "left",
        height: 30,
        width: 200,
        margin: "10px 0 0 10px"
      }
    });
    return value_div = new_dom_element({
      parentNode: line_div,
      nodeName: "div",
      txt: txt_value,
      style: {
        cssFloat: "left",
        height: 30,
        margin: "10px 0 0 0px",
        fontWeight: "bold"
      }
    });
  };

  UserEditView.prototype.modifie_information = function(name, input_id, txt_value, parent_div, input_type) {
    var line_div, name_div, value_div;
    if (txt_value == null) {
      txt_value = "";
    }
    if (input_type == null) {
      input_type = "text";
    }
    line_div = new_dom_element({
      parentNode: parent_div,
      nodeName: "div",
      className: "user_line",
      style: {
        cssFloat: "left",
        height: 40,
        width: "100%",
        fontSize: "18px",
        background: "#262626",
        margin: "10px 0 0 0px"
      }
    });
    name_div = new_dom_element({
      parentNode: line_div,
      nodeName: "div",
      txt: name + " : ",
      style: {
        cssFloat: "left",
        height: 30,
        width: 200,
        margin: "10px 0 0 10px"
      }
    });
    return value_div = new_dom_element({
      parentNode: line_div,
      nodeName: "input",
      type: input_type,
      id: input_id,
      value: txt_value,
      style: {
        cssFloat: "left",
        height: 30,
        width: 300,
        margin: "5px 0 0 0px",
        fontWeight: "bold"
      }
    });
  };

  UserEditView.prototype.onPopupClose = function() {
    document.onkeydown = void 0;
    return this.clear_page(this.edit_user_div);
  };

  UserEditView.prototype.clear_page = function(div_to_clear) {
    var results;
    results = [];
    while (div_to_clear.firstChild != null) {
      results.push(div_to_clear.removeChild(div_to_clear.firstChild));
    }
    return results;
  };

  UserEditView.get_user_information = function(user) {
    var email, password, xhr_object;
    email = Cookies.set("email");
    password = Cookies.set("password");
    xhr_object = FileSystem._my_xml_http_request();
    xhr_object.open('GET', "get_user_id?u=" + (encodeURI(email)) + "&p=" + (encodeURI(password)), true);
    xhr_object.onreadystatechange = function() {
      var lst, user_id;
      if (this.readyState === 4 && this.status === 200) {
        lst = this.responseText.split(" ");
        user_id = parseInt(lst[0]);
        if (user_id > 0) {
          return user.edit_user_information();
        } else {
          if (document.getElementById('pwscomment')) {
            return document.getElementById('pwscomment').innerHTML = "You need to log in";
          }
        }
      }
    };
    return xhr_object.send();
  };

  UserEditView.get_change_user_information = function(user) {
    var email, password, xhr_object;
    email = Cookies.set("email");
    password = Cookies.set("password");
    xhr_object = FileSystem._my_xml_http_request();
    xhr_object.open('GET', "get_user_id?u=" + (encodeURI(email)) + "&p=" + (encodeURI(password)), true);
    xhr_object.onreadystatechange = function() {
      var lst, user_id;
      if (this.readyState === 4 && this.status === 200) {
        lst = this.responseText.split(" ");
        user_id = parseInt(lst[0]);
        alert(user_id);
        if (user_id > 0) {
          user.user_email = "modified email";
          user.edit_user_information();
          if (document.getElementById('pwscomment')) {
            document.getElementById('pwscomment').innerHTML = "Your informations have been modified";
          }
          if (document.getElementById('pwscomment')) {
            return document.getElementById('pwscomment').style.color = "green";
          }
        } else {
          if (document.getElementById('pwscomment')) {
            return document.getElementById('pwscomment').innerHTML = "You need to log in";
          }
        }
      }
    };
    return xhr_object.send();
  };

  UserEditView.get_change_user_password = function(user) {
    var confirmed_password, email, new_password, old_password, xhr_object;
    email = Cookies.set("email");
    old_password = document.getElementById('password').value;
    new_password = document.getElementById('new_password').value;
    confirmed_password = document.getElementById('confirme_password').value;
    if (old_password === Cookies.set("password") && new_password === confirmed_password) {
      xhr_object = FileSystem._my_xml_http_request();
      xhr_object.open('GET', "get_change_user_password?e=" + (encodeURI(email)) + "&op=" + (encodeURI(old_password)) + "&np=" + (encodeURI(new_password)) + "&cp=" + (encodeURI(confirmed_password)), true);
      xhr_object.onreadystatechange = function() {
        var lst, user_id;
        if (this.readyState === 4 && this.status === 200) {
          lst = this.responseText.split(" ");
          user_id = parseInt(lst[0]);
          if (user_id > 0) {
            Cookies.set("password", new_password, {
              expires: 7
            });
            user.edit_user_information();
            if (document.getElementById('pwscomment')) {
              document.getElementById('pwscomment').innerHTML = "Your password have been modified";
            }
            if (document.getElementById('pwscomment')) {
              return document.getElementById('pwscomment').style.color = "green";
            }
          } else {
            user.edit_user_information();
            if (document.getElementById('pwscomment')) {
              return document.getElementById('pwscomment').innerHTML = "You need to log in";
            }
          }
        }
      };
      return xhr_object.send();
    } else {
      if (document.getElementById('pwscomment')) {
        return document.getElementById('pwscomment').innerHTML = "confirmed password do not match !";
      }
    }
  };

  return UserEditView;

})(View);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_User,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_User = (function(superClass) {
  var sort_dir;

  extend(ModelEditorItem_User, superClass);

  function ModelEditorItem_User(params) {
    ModelEditorItem_User.__super__.constructor.call(this, params);
    this.index_sorted = new Lst;
    this.selected_file = new Lst;
    this.selected_file.bind(this);
    this.line_height = 30;
    this.ed.ondrop = (function(_this) {
      return function(evt) {
        return _this.cancel_natural_hotkeys(evt);
      };
    })(this);
    this.container = new_dom_element({
      parentNode: this.ed,
      nodeName: "div",
      className: "directory_container",
      ondragover: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragout: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragleave: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondrop: (function(_this) {
        return function(evt) {
          evt.stopPropagation();
          evt.preventDefault();
          _this.cancel_natural_hotkeys(evt);
          return false;
        };
      })(this)
    });
    this.all_file_container = new_dom_element({
      parentNode: this.container,
      nodeName: "div"
    });
  }

  ModelEditorItem_User.prototype.onchange = function() {
    if (this.selected_file.has_been_directly_modified()) {
      this.draw_selected_file();
    }
    if (this.model.has_been_modified()) {
      return this.refresh();
    }
  };

  ModelEditorItem_User.prototype.refresh = function() {
    this.empty_window();
    this.init();
    return this.draw_selected_file();
  };

  ModelEditorItem_User.prototype.empty_window = function() {
    return this.all_file_container.innerHTML = "";
  };

  ModelEditorItem_User.prototype.draw_selected_file = function() {
    var file, file_contain, j, k, len, results;
    file_contain = document.getElementsByClassName('line_container');
    results = [];
    for (j = k = 0, len = file_contain.length; k < len; j = ++k) {
      file = file_contain[j];
      if (parseInt(this.selected_file.indexOf(j)) !== -1) {
        results.push(add_class(file, 'selected_file'));
      } else {
        results.push(rem_class(file, 'selected_file'));
      }
    }
    return results;
  };

  ModelEditorItem_User.prototype.cancel_natural_hotkeys = function(evt) {
    if (!evt) {
      evt = window.event;
    }
    evt.cancelBubble = true;
    if (typeof evt.stopPropagation === "function") {
      evt.stopPropagation();
    }
    if (typeof evt.preventDefault === "function") {
      evt.preventDefault();
    }
    if (typeof evt.stopImmediatePropagation === "function") {
      evt.stopImmediatePropagation();
    }
    return false;
  };

  sort_dir = function(a, b) {
    if (a.name.get().toLowerCase() > b.name.get().toLowerCase()) {
      return 1;
    } else {
      return -1;
    }
  };

  ModelEditorItem_User.prototype.init = function() {
    var _sorted, elem, i, k, l, len, len1, results, sorted;
    _sorted = this.model;
    this.index_sorted.clear();
    sorted = new Array;
    for (i = k = 0, len = _sorted.length; k < len; i = ++k) {
      elem = _sorted[i];
      sorted.push(elem);
      this.index_sorted.push(i);
    }
    results = [];
    for (i = l = 0, len1 = sorted.length; l < len1; i = ++l) {
      elem = sorted[i];
      results.push((function(_this) {
        return function(elem, i) {
          var user_line, user_name;
          user_line = new_dom_element({
            parentNode: _this.all_file_container,
            nodeName: "div",
            className: "line_container",
            style: {
              width: "100%",
              height: 30,
              cursor: "pointer",
              borderBottom: "1px solid grey"
            },
            onclick: function(evt) {
              return elem.load((function(_this) {
                return function(object, err) {
                  var mv;
                  return mv = new MessageView(object, evt);
                };
              })(this));
            }
          });
          return user_name = new_dom_element({
            parentNode: user_line,
            nodeName: "div",
            className: "line_user_container",
            txt: elem.email,
            style: {
              margin: "5px 0px 0px 10px",
              padding: "0px 0px 0px 30px",
              textAlign: "left",
              cssFloat: "left",
              fontSize: "18px"
            }
          });
        };
      })(this)(elem, i));
    }
    return results;
  };

  ModelEditorItem_User.prototype.path = function() {
    return "test_need_to_be_complete";
  };

  ModelEditorItem_User.add_action = function(model_type, fun) {
    if (ModelEditorItem_Directory._action_list[model_type] == null) {
      ModelEditorItem_Directory._action_list[model_type] = [];
    }
    return ModelEditorItem_Directory._action_list[model_type].push(fun);
  };

  return ModelEditorItem_User;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var LoginView,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

LoginView = (function(superClass) {
  extend(LoginView, superClass);

  function LoginView(el) {
    this.el = el;
    this.page_container = new_dom_element({
      nodeName: "div",
      parentNode: this.el
    });
    this.container_bakground = new_dom_element({
      parentNode: this.page_container,
      nodeName: "div",
      className: "LoginBackground"
    });
    this.create_login_div();
  }

  LoginView.prototype.clear_page = function() {
    var results;
    results = [];
    while (this.container_bakground.firstChild != null) {
      results.push(this.container_bakground.removeChild(this.container_bakground.firstChild));
    }
    return results;
  };

  LoginView.prototype.create_login_div = function() {
    var container_comment, container_div, container_login, container_title, input_email, input_password, link_forgot_password, link_new_user, link_resend_confirmation, login_button, name_email, name_password;
    this.clear_page();
    container_title = new_dom_element({
      parentNode: this.container_bakground,
      nodeName: "div",
      txt: "Connect to access your Desk and Lab",
      style: {
        height: 30,
        width: "100%",
        fontWeight: "bold",
        fontSize: "20px",
        textAlign: "center",
        margin: "20px 0 0 0px",
        cssFloat: "left"
      }
    });
    container_login = new_dom_element({
      parentNode: this.container_bakground,
      nodeName: "div",
      style: {
        height: 470,
        width: 600,
        margin: "0px 0 0 100px",
        cssFloat: "left"
      }
    });
    container_div = new_dom_element({
      parentNode: container_login,
      nodeName: "div",
      style: {
        height: 250,
        width: 600,
        margin: "210px 0 0 0px",
        border: "1px solid grey",
        cssFloat: "left"
      }
    });
    name_email = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      txt: "email",
      style: {
        width: "100%",
        height: 25,
        fontSize: "20px",
        textAlign: "center",
        margin: "10px 0 0 0px",
        cssFloat: "left"
      }
    });
    input_email = new_dom_element({
      parentNode: container_div,
      nodeName: "input",
      type: "text",
      id: "email",
      name: "email",
      style: {
        width: 300,
        height: 25,
        fontSize: "15px",
        margin: "10px 0 0 150px",
        textAlign: "center",
        cssFloat: "left"
      },
      onkeypress: (function(_this) {
        return function(evt) {
          return _this.keypresslogin(evt);
        };
      })(this)
    });
    name_password = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      txt: "password",
      style: {
        width: "100%",
        height: 25,
        fontSize: "20px",
        textAlign: "center",
        margin: "10px 0 0 0px",
        cssFloat: "left"
      }
    });
    input_password = new_dom_element({
      parentNode: container_div,
      nodeName: "input",
      id: "password",
      type: "password",
      name: "password",
      style: {
        width: 300,
        height: 25,
        fontSize: "15px",
        margin: "10px 0 0 150px",
        textAlign: "center",
        cssFloat: "left"
      },
      onkeypress: (function(_this) {
        return function(evt) {
          return _this.keypresslogin(evt);
        };
      })(this)
    });
    login_button = new_dom_element({
      parentNode: container_div,
      nodeName: "button",
      txt: "Log in",
      style: {
        width: 300,
        height: 30,
        border: "none",
        fontSize: "20px",
        margin: "10px 0 0 150px",
        textAlign: "center",
        background: "#4dbce9",
        cssFloat: "left"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return _this.try_username();
        };
      })(this)
    });
    container_comment = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      id: 'pwscomment',
      style: {
        width: "100%",
        height: 30,
        border: "none",
        fontSize: "15px",
        margin: "10px 0 0 0px",
        textAlign: "center",
        cssFloat: "left",
        color: "red"
      }
    });
    link_new_user = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      txt: "New account",
      style: {
        height: 20,
        margin: "10px 0 0 60px",
        cssFloat: "left",
        fontSize: "15px",
        color: "#4dbce9",
        cursor: "pointer"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return _this.create_new_account_div();
        };
      })(this)
    });
    link_forgot_password = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      txt: "Forgot your password ?",
      style: {
        height: 20,
        margin: "10px 0 0 20px",
        cssFloat: "left",
        fontSize: "15px",
        color: "#4dbce9",
        cursor: "pointer"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return _this.create_lost_password_div();
        };
      })(this)
    });
    return link_resend_confirmation = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      txt: "Resend confirmation instructions",
      style: {
        height: 20,
        margin: "10px 0 0 20px",
        cssFloat: "left",
        fontSize: "15px",
        color: "#4dbce9",
        cursor: "pointer"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return _this.create_confirmation_istructions_div();
        };
      })(this)
    });
  };

  LoginView.prototype.create_new_account_div = function() {
    var container_comment, container_div, container_login, container_title, input_confirmed_password, input_new_email, input_new_password, link_login, name_confirmed_password, name_new_email, name_new_password, new_account_button, wait_new_account;
    this.clear_page();
    container_title = new_dom_element({
      parentNode: this.container_bakground,
      nodeName: "div",
      txt: "Create your account to access your online lab",
      style: {
        height: 30,
        width: "100%",
        fontWeight: "bold",
        fontSize: "20px",
        textAlign: "center",
        margin: "20px 0 0 0px",
        cssFloat: "left"
      }
    });
    container_login = new_dom_element({
      parentNode: this.container_bakground,
      nodeName: "div",
      style: {
        height: 470,
        width: 600,
        margin: "0px 0 0 100px",
        cssFloat: "left",
        background: "#262626"
      }
    });
    container_div = new_dom_element({
      parentNode: container_login,
      nodeName: "div",
      style: {
        height: 320,
        width: 600,
        margin: "140px 0 0 0px",
        border: "1px solid grey",
        cssFloat: "left"
      }
    });
    name_new_email = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      txt: "email",
      style: {
        width: "100%",
        height: 25,
        fontSize: "20px",
        textAlign: "center",
        margin: "10px 0 0 0px"
      }
    });
    input_new_email = new_dom_element({
      parentNode: container_div,
      nodeName: "input",
      type: "text",
      id: "new_email",
      name: "new_email",
      style: {
        width: 300,
        height: 25,
        fontSize: "15px",
        margin: "10px 0 0 150px",
        textAlign: "center"
      },
      onkeypress: (function(_this) {
        return function(evt) {
          return _this.keypress_new_account(evt);
        };
      })(this)
    });
    name_new_password = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      txt: "new password",
      style: {
        width: "100%",
        height: 25,
        fontSize: "20px",
        textAlign: "center",
        margin: "10px 0 0 0px"
      }
    });
    input_new_password = new_dom_element({
      parentNode: container_div,
      nodeName: "input",
      type: "password",
      id: "new_password",
      name: "new_password",
      style: {
        width: 300,
        height: 25,
        fontSize: "15px",
        margin: "10px 0 0 150px",
        textAlign: "center"
      },
      onkeypress: (function(_this) {
        return function(evt) {
          return _this.keypress_new_account(evt);
        };
      })(this)
    });
    name_confirmed_password = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      txt: "confirmed password",
      style: {
        width: "100%",
        height: 25,
        fontSize: "20px",
        textAlign: "center",
        margin: "10px 0 0 0px"
      }
    });
    input_confirmed_password = new_dom_element({
      parentNode: container_div,
      nodeName: "input",
      type: "password",
      id: "confirmed_password",
      name: "confirmed_password",
      style: {
        width: 300,
        height: 25,
        fontSize: "15px",
        margin: "10px 0 0 150px",
        textAlign: "center"
      },
      onkeypress: (function(_this) {
        return function(evt) {
          return _this.keypress_new_account(evt);
        };
      })(this)
    });
    new_account_button = new_dom_element({
      parentNode: container_div,
      nodeName: "button",
      id: "new_account_button",
      txt: "Create account",
      style: {
        width: 300,
        height: 30,
        border: "none",
        fontSize: "20px",
        margin: "10px 0 0 150px",
        textAlign: "center",
        cssFloat: "left",
        background: "#4dbce9"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return _this.try_new_account();
        };
      })(this)
    });
    wait_new_account = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      id: "wait_new_account",
      style: {
        width: 300,
        height: 40,
        border: "none",
        margin: "10px 0 0 150px",
        cssFloat: "left",
        textAlign: "center"
      }
    });
    new_dom_element({
      parentNode: wait_new_account,
      nodeName: "div",
      className: "Loading"
    });
    $("#wait_new_account").hide();
    container_comment = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      id: 'pwscomment',
      style: {
        width: "100%",
        height: 30,
        border: "none",
        fontSize: "15px",
        margin: "10px 0 0 0px",
        textAlign: "center",
        cssFloat: "left",
        color: "red"
      }
    });
    return link_login = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      txt: "Login page",
      style: {
        height: 20,
        width: "100%",
        margin: "10px 0 0 0px",
        cssFloat: "left",
        fontSize: "15px",
        color: "#4dbce9",
        cursor: "pointer",
        textAlign: "center"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return _this.create_login_div();
        };
      })(this)
    });
  };

  LoginView.prototype.create_lost_password_div = function() {
    var container_comment, container_div, container_login, container_title, input_email, link_login, name_email, new_password_button, wait_new_password;
    this.clear_page();
    container_title = new_dom_element({
      parentNode: this.container_bakground,
      nodeName: "div",
      txt: "Ask for a new password",
      style: {
        height: 30,
        width: "100%",
        fontWeight: "bold",
        fontSize: "20px",
        textAlign: "center",
        margin: "20px 0 0 0px",
        cssFloat: "left"
      }
    });
    container_login = new_dom_element({
      parentNode: this.container_bakground,
      nodeName: "div",
      style: {
        height: 470,
        width: 600,
        margin: "0px 0 0 100px",
        cssFloat: "left"
      }
    });
    container_div = new_dom_element({
      parentNode: container_login,
      nodeName: "div",
      style: {
        height: 180,
        width: 600,
        margin: "280px 0 0 0px",
        border: "1px solid grey",
        cssFloat: "left"
      }
    });
    name_email = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      txt: "email",
      style: {
        width: "100%",
        height: 25,
        fontSize: "20px",
        textAlign: "center",
        margin: "10px 0 0 0px"
      }
    });
    input_email = new_dom_element({
      parentNode: container_div,
      nodeName: "input",
      type: "text",
      id: "email",
      name: "email",
      style: {
        width: 300,
        height: 25,
        fontSize: "15px",
        margin: "10px 0 0 150px",
        textAlign: "center"
      },
      onkeypress: (function(_this) {
        return function(evt) {
          return _this.keypress_new_password(evt);
        };
      })(this)
    });
    new_password_button = new_dom_element({
      parentNode: container_div,
      nodeName: "button",
      txt: "Get your new password",
      id: "new_password_button",
      style: {
        width: 300,
        height: 30,
        border: "none",
        fontSize: "20px",
        margin: "10px 0 0 150px",
        textAlign: "center",
        background: "#4dbce9",
        cssFloat: "left"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return _this.try_new_password();
        };
      })(this)
    });
    wait_new_password = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      id: "wait_new_password",
      style: {
        width: 300,
        height: 40,
        border: "none",
        margin: "10px 0 0 150px",
        cssFloat: "left",
        textAlign: "center"
      }
    });
    new_dom_element({
      parentNode: wait_new_password,
      nodeName: "div",
      className: "Loading"
    });
    $("#wait_new_password").hide();
    container_comment = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      id: 'pwscomment',
      style: {
        width: "100%",
        height: 30,
        border: "none",
        fontSize: "15px",
        margin: "10px 0 0 0px",
        textAlign: "center",
        cssFloat: "left",
        color: "red"
      }
    });
    return link_login = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      txt: "Login page",
      style: {
        height: 20,
        width: "100%",
        margin: "10px 0 0 0px",
        cssFloat: "left",
        fontSize: "15px",
        color: "#4dbce9",
        cursor: "pointer",
        textAlign: "center"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return _this.create_login_div();
        };
      })(this)
    });
  };

  LoginView.prototype.create_confirmation_istructions_div = function() {
    var confirmation_button, container_comment, container_div, container_login, container_title, input_email, link_login, name_email, wait_confirmation;
    this.clear_page();
    container_title = new_dom_element({
      parentNode: this.container_bakground,
      nodeName: "div",
      txt: "Resend confirmation instructions",
      style: {
        height: 30,
        width: "100%",
        fontWeight: "bold",
        fontSize: "20px",
        textAlign: "center",
        margin: "20px 0 0 0px",
        cssFloat: "left"
      }
    });
    container_login = new_dom_element({
      parentNode: this.container_bakground,
      nodeName: "div",
      style: {
        height: 470,
        width: 600,
        margin: "0px 0 0 100px",
        cssFloat: "left"
      }
    });
    container_div = new_dom_element({
      parentNode: container_login,
      nodeName: "div",
      style: {
        height: 180,
        width: 600,
        margin: "280px 0 0 0px",
        border: "1px solid grey",
        cssFloat: "left"
      }
    });
    name_email = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      txt: "email",
      style: {
        width: "100%",
        height: 25,
        fontSize: "20px",
        textAlign: "center",
        margin: "10px 0 0 0px"
      }
    });
    input_email = new_dom_element({
      parentNode: container_div,
      nodeName: "input",
      type: "text",
      id: "email",
      name: "email",
      style: {
        width: 300,
        height: 25,
        fontSize: "15px",
        margin: "10px 0 0 150px",
        textAlign: "center"
      },
      onkeypress: (function(_this) {
        return function(evt) {
          return _this.keypress_confirmation_instructions(evt);
        };
      })(this)
    });
    confirmation_button = new_dom_element({
      parentNode: container_div,
      nodeName: "button",
      id: "confirmation_button",
      txt: "Get your new password",
      style: {
        width: 300,
        height: 30,
        border: "none",
        fontSize: "20px",
        margin: "10px 0 0 150px",
        textAlign: "center",
        background: "#4dbce9",
        cssFloat: "left"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return _this.try_confirmation_instructions();
        };
      })(this)
    });
    wait_confirmation = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      id: "wait_confirmation",
      style: {
        width: 300,
        height: 40,
        border: "none",
        margin: "10px 0 0 150px",
        cssFloat: "left",
        textAlign: "center"
      }
    });
    new_dom_element({
      parentNode: wait_confirmation,
      nodeName: "div",
      className: "Loading"
    });
    $("#wait_confirmation").hide();
    container_comment = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      id: 'pwscomment',
      style: {
        width: "100%",
        height: 30,
        border: "none",
        fontSize: "15px",
        margin: "10px 0 0 0px",
        textAlign: "center",
        cssFloat: "left",
        color: "red"
      }
    });
    return link_login = new_dom_element({
      parentNode: container_div,
      nodeName: "div",
      txt: "Login page",
      style: {
        height: 20,
        width: "100%",
        margin: "10px 0 0 0px",
        cssFloat: "left",
        fontSize: "15px",
        color: "#4dbce9",
        cursor: "pointer",
        textAlign: "center"
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return _this.create_login_div();
        };
      })(this)
    });
  };

  LoginView.prototype.try_username = function() {
    var email, password, xhr_object;
    email = document.getElementById('email').value;
    password = document.getElementById('password').value;
    xhr_object = FileSystem._my_xml_http_request();
    xhr_object.open('GET', "get_user_id?u=" + (encodeURI(email)) + "&p=" + (encodeURI(password)), true);
    xhr_object.onreadystatechange = function() {
      var lst, user_id;
      if (this.readyState === 4 && this.status === 200) {
        lst = this.responseText.split(" ");
        user_id = parseInt(lst[0]);
        if (user_id > 0) {
          Cookies.set("email", email, {
            expires: 7
          });
          Cookies.set("password", password, {
            expires: 7
          });
          return window.location = "desk.html";
        } else {
          if (document.getElementById('pwscomment')) {
            return document.getElementById('pwscomment').innerHTML = "Wrong email/password";
          }
        }
      }
    };
    return xhr_object.send();
  };

  LoginView.prototype.keypresslogin = function(e) {
    if (e.which === 13) {
      return this.try_username();
    } else {
      if (document.getElementById('pwscomment')) {
        return document.getElementById('pwscomment').innerHTML = "";
      }
    }
  };

  LoginView.prototype.try_new_account = function() {
    var confirmed_password, new_email, new_password, xhr_object;
    new_email = document.getElementById('new_email').value;
    new_password = document.getElementById('new_password').value;
    confirmed_password = document.getElementById('confirmed_password').value;
    if (new_password !== confirmed_password) {
      if (document.getElementById('pwscomment')) {
        return document.getElementById('pwscomment').innerHTML = "confirmed password do not match !";
      }
    }
    if (new_email.indexOf("@") <= 0) {
      if (document.getElementById('pwscomment')) {
        return document.getElementById('pwscomment').innerHTML = "Invalid email !";
      }
    }
    xhr_object = FileSystem._my_xml_http_request();
    xhr_object.open('GET', "get_new_account?e=" + (encodeURI(new_email)) + "&p=" + (encodeURI(new_password)) + "&cp=" + (encodeURI(confirmed_password)), true);
    xhr_object.onreadystatechange = function() {
      var lst, user_id;
      if (this.readyState === 4 && this.status === 200) {
        lst = this.responseText.split(" ");
        user_id = parseInt(lst[0]);
        if (user_id > 0) {
          return window.location = "desk.html";
        } else {
          if (document.getElementById('pwscomment')) {
            return document.getElementById('pwscomment').innerHTML = "Existing user";
          }
        }
      }
    };
    return xhr_object.send();
  };

  LoginView.prototype.keypress_new_account = function(e) {
    if (e.which === 13) {
      return this.try_new_account();
    } else {
      if (document.getElementById('pwscomment')) {
        return document.getElementById('pwscomment').innerHTML = "";
      }
    }
  };

  LoginView.prototype.try_new_password = function() {
    var email, xhr_object;
    email = document.getElementById('email').value;
    $("#new_password_button").slideUp(500);
    $("#wait_new_password").slideDown(500);
    xhr_object = FileSystem._my_xml_http_request();
    xhr_object.open('GET', "get_new_password?e=" + (encodeURI(email)), true);
    xhr_object.onreadystatechange = function() {
      var lst, user_id;
      if (this.readyState === 4 && this.status === 200) {
        lst = this.responseText.split(" ");
        user_id = parseInt(lst[0]);
        $("#new_password_button").slideDown(500);
        $("#wait_new_password").slideUp(500);
        if (user_id > 0) {
          if (document.getElementById('pwscomment')) {
            return document.getElementById('pwscomment').innerHTML = "We have sent you a mail with your new password";
          }
        } else {
          if (document.getElementById('pwscomment')) {
            return document.getElementById('pwscomment').innerHTML = "Wrong email";
          }
        }
      }
    };
    return xhr_object.send();
  };

  LoginView.prototype.keypress_new_password = function(e) {
    if (e.which === 13) {
      return this.try_new_password();
    } else {
      if (document.getElementById('pwscomment')) {
        return document.getElementById('pwscomment').innerHTML = "";
      }
    }
  };

  LoginView.prototype.try_confirmation_instructions = function() {
    var email, xhr_object;
    email = document.getElementById('email').value;
    $("#confirmation_button").slideUp(500);
    $("#wait_confirmation").slideDown(500);
    xhr_object = FileSystem._my_xml_http_request();
    xhr_object.open('GET', "get_resend_confirmation?e=" + (encodeURI(email)), true);
    xhr_object.onreadystatechange = function() {
      var lst, user_id;
      if (this.readyState === 4 && this.status === 200) {
        lst = this.responseText.split(" ");
        user_id = parseInt(lst[0]);
        $("#confirmation_button").slideDown(500);
        $("#wait_confirmation").slideUp(500);
        if (user_id > 0) {
          if (document.getElementById('pwscomment')) {
            return document.getElementById('pwscomment').innerHTML = "We have sent you a mail with your instructions";
          }
        } else {
          if (document.getElementById('pwscomment')) {
            return document.getElementById('pwscomment').innerHTML = "Wrong email";
          }
        }
      }
    };
    return xhr_object.send();
  };

  LoginView.prototype.keypress_confirmation_instructions = function(e) {
    if (e.which === 13) {
      return this.try_confirmation_instructions();
    } else {
      if (document.getElementById('pwscomment')) {
        return document.getElementById('pwscomment').innerHTML = "";
      }
    }
  };

  return LoginView;

})(View);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Message,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Message = (function(superClass) {
  var sort_dir, sort_numerically;

  extend(ModelEditorItem_Message, superClass);

  ModelEditorItem_Message._action_list = {
    "Directory": [
      function(file, path, browser) {
        return browser.load_folder(file);
      }
    ]
  };

  function ModelEditorItem_Message(params) {
    this.onPopupClose = bind(this.onPopupClose, this);
    ModelEditorItem_Message.__super__.constructor.call(this, params);
    this.initial_path = params.initial_path != null ? params.initial_path : "Root";
    this.initial_path = this.make_initial_path_as_dom(this.initial_path);
    this.index_sorted = new Lst;
    this.selected_file = new Lst;
    this.selected_file.bind(this);
    this.line_height = 30;
    this.ed.ondrop = (function(_this) {
      return function(evt) {
        return _this.cancel_natural_hotkeys(evt);
      };
    })(this);
    this.container = new_dom_element({
      parentNode: this.ed,
      nodeName: "div",
      className: "directory_container",
      ondragover: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragout: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragleave: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondrop: (function(_this) {
        return function(evt) {
          evt.stopPropagation();
          evt.preventDefault();
          _this.handle_files(evt.dataTransfer.files);
          _this.cancel_natural_hotkeys(evt);
          return false;
        };
      })(this)
    });
    this.all_file_container = new_dom_element({
      parentNode: this.container,
      nodeName: "div"
    });
  }

  ModelEditorItem_Message.prototype.onchange = function() {
    if (this.selected_file.has_been_directly_modified()) {
      this.draw_selected_file();
    }
    if (this.model.has_been_modified()) {
      return this.refresh();
    }
  };

  ModelEditorItem_Message.prototype.refresh = function() {
    this.empty_window();
    this.init();
    return this.draw_selected_file();
  };

  ModelEditorItem_Message.prototype.empty_window = function() {
    return this.all_file_container.innerHTML = "";
  };

  ModelEditorItem_Message.prototype.load_folder = function(file) {
    this.model.unbind(this);
    return file._ptr.load((function(_this) {
      return function(m, err) {
        _this.model = m;
        _this.model.bind(_this);
        return _this.selected_file.clear();
      };
    })(this));
  };

  ModelEditorItem_Message.prototype.open = function(file, path) {
    var l;
    if (file._info.model_type != null) {
      l = ModelEditorItem_Directory._action_list[file._info.model_type];
      if ((l != null) && l.length) {
        return l[0](file, path, this);
      }
    }
  };

  ModelEditorItem_Message.prototype.handle_files = function(files) {
    var file, fs, k, len, results;
    if (files.length > 0) {
      if (typeof FileSystem !== "undefined" && FileSystem !== null) {
        fs = FileSystem.get_inst();
        results = [];
        for (k = 0, len = files.length; k < len; k++) {
          file = files[k];
          results.push(this.model.add_file(file.name, new Path(file)));
        }
        return results;
      }
    }
  };

  ModelEditorItem_Message.prototype.make_initial_path_as_dom = function(initial_path) {
    var path, reg;
    reg = new RegExp("[\/]+", "g");
    path = initial_path.split(reg);
    return path;
  };

  ModelEditorItem_Message.prototype.search_ord_index_from_id = function(id) {
    var i, id_, k, len, pos, ref, sorted;
    sorted = this.model.sorted(sort_dir);
    id_ = this.index_sorted[id];
    ref = this.model;
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      pos = this.model.indexOf(sorted[id_]);
      if (pos !== -1) {
        return pos;
      }
    }
  };

  sort_numerically = function(a, b) {
    return a - b;
  };

  ModelEditorItem_Message.prototype.delete_file = function(file) {
    var i, k, ref;
    for (i = k = 0, ref = this.model.length; 0 <= ref ? k <= ref : k >= ref; i = 0 <= ref ? ++k : --k) {
      if (this.model[i] === file) {
        this.model.splice(i, 1);
        return;
      }
    }
  };

  ModelEditorItem_Message.prototype.draw_selected_file = function() {
    var file, file_contain, j, k, len, results;
    file_contain = document.getElementsByClassName('line_container');
    results = [];
    for (j = k = 0, len = file_contain.length; k < len; j = ++k) {
      file = file_contain[j];
      if (parseInt(this.selected_file.indexOf(j)) !== -1) {
        results.push(add_class(file, 'selected_file'));
      } else {
        results.push(rem_class(file, 'selected_file'));
      }
    }
    return results;
  };

  ModelEditorItem_Message.prototype.cancel_natural_hotkeys = function(evt) {
    if (!evt) {
      evt = window.event;
    }
    evt.cancelBubble = true;
    if (typeof evt.stopPropagation === "function") {
      evt.stopPropagation();
    }
    if (typeof evt.preventDefault === "function") {
      evt.preventDefault();
    }
    if (typeof evt.stopImmediatePropagation === "function") {
      evt.stopImmediatePropagation();
    }
    return false;
  };

  sort_dir = function(a, b) {
    if (a.name.get().toLowerCase() > b.name.get().toLowerCase()) {
      return 1;
    } else {
      return -1;
    }
  };

  ModelEditorItem_Message.prototype.init = function() {
    var _sorted, elem, i, k, len, len1, n, results, sorted;
    _sorted = this.model.sorted(sort_dir);
    this.index_sorted.clear();
    sorted = new Array;
    for (i = k = 0, len = _sorted.length; k < len; i = ++k) {
      elem = _sorted[i];
      sorted.push(elem);
      this.index_sorted.push(i);
    }
    results = [];
    for (i = n = 0, len1 = sorted.length; n < len1; i = ++n) {
      elem = sorted[i];
      if (!(elem.name.get().match(/^__/) && elem.name.get().match(/__$/))) {
        results.push((function(_this) {
          return function(elem, i) {
            var delete_button, message_line, message_name, share_button;
            message_line = new_dom_element({
              parentNode: _this.all_file_container,
              nodeName: "div",
              className: "line_container",
              style: {
                width: "100%",
                height: 30,
                cursor: "pointer",
                borderBottom: "1px solid grey"
              },
              ondblclick: function(evt) {
                return elem.load((function(_this) {
                  return function(object, err) {
                    var mv;
                    return mv = new MessageView(object, evt);
                  };
                })(this));
              }
            });
            message_name = new_dom_element({
              parentNode: message_line,
              nodeName: "div",
              className: "line_message_container",
              txt: elem.name,
              style: {
                margin: "5px 0px 0px 10px",
                padding: "0px 0px 0px 30px",
                textAlign: "left",
                cssFloat: "left",
                fontSize: "18px"
              }
            });
            delete_button = new_dom_element({
              parentNode: message_line,
              className: "delete_button",
              nodeName: "div",
              alt: "Delete message",
              title: "Delete message",
              style: {
                cssFloat: "right",
                margin: "0px 10px 0px 0px"
              },
              onclick: function(evt) {
                return _this.delete_file(elem);
              }
            });
            return share_button = new_dom_element({
              parentNode: message_line,
              className: "share_message_button",
              nodeName: "div",
              alt: "Share",
              title: "Share",
              style: {
                cssFloat: "right",
                margin: "0px 10px 0px 0px"
              },
              onclick: function(evt) {
                return _this.share_popup(evt, elem, elem.name.get());
              }
            });
          };
        })(this)(elem, i));
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  ModelEditorItem_Message.prototype.path = function() {
    return "test_need_to_be_complete";
  };

  ModelEditorItem_Message.prototype.share_popup = function(evt, elem, name_folder) {
    var Pheight, Pleft, Ptop, Pwidth, email, fs, ia, line_div, link_modifie_informations, login, name_div, p, value_div;
    email = prompt("share '" + name_folder + "' with (is'sim login) ?");
    ia = email.indexOf("@");
    if (ia < 0) {
      return alert("Please enter a valid login (email adress)");
    }
    login = email;
    console.log(email, ia, login);
    fs = FileSystem.get_inst();
    fs.load("__users__/" + login, function(home, err) {
      if (err) {
        return alert("Please enter a valid login (email adress --)");
      }
      return fs.load_or_make_dir("__users__/" + login + "/__messages__", function(inbox, err) {
        var ip, nn;
        if (err) {
          return alert("??");
        }
        nn = name_folder;
        while (inbox.has(nn)) {
          ip = nn.indexOf(".");
          if (ip < 0) {
            ip = nn.length;
          }
          nn = nn.slice(0, ip) + "_" + nn.slice(ip, nn.length);
        }
        return inbox.push(elem);
      });
    });
    return;
    this.popup_share_div = new_dom_element({
      id: "popup_share_div"
    });
    Ptop = 100;
    Pleft = 100;
    Pwidth = 800;
    Pheight = 260;
    this.container_share_div = new_dom_element({
      parentNode: this.popup_share_div,
      className: "container_share_div",
      nodeName: "div",
      style: {
        height: 200,
        width: 200,
        margin: "0px 0 0 10px"
      }
    });
    this.share_user_information_div = new_dom_element({
      parentNode: this.popup_share_div,
      className: "share_user_information_div",
      nodeName: "div",
      style: {
        cssFloat: "left",
        height: 200,
        width: 560,
        margin: "0px 0 0 0px"
      }
    });
    line_div = new_dom_element({
      parentNode: this.share_user_information_div,
      nodeName: "div",
      style: {
        cssFloat: "left",
        height: 40,
        width: "100%",
        fontSize: "18px",
        background: "#262626",
        margin: "60px 0 0 0px"
      }
    });
    name_div = new_dom_element({
      parentNode: line_div,
      nodeName: "div",
      txt: " email : ",
      style: {
        cssFloat: "left",
        height: 30,
        width: 100,
        margin: "10px 0 0 10px"
      }
    });
    value_div = new_dom_element({
      parentNode: line_div,
      nodeName: "input",
      id: "share_email_input",
      style: {
        cssFloat: "left",
        height: 30,
        width: 400,
        margin: "5px 0 0 0px",
        fontWeight: "bold"
      }
    });
    link_modifie_informations = new_dom_element({
      parentNode: this.share_user_information_div,
      nodeName: "button",
      txt: "Share",
      className: "user_line",
      style: {
        height: 40,
        width: 100,
        border: "none",
        margin: "15px 60px 0 0",
        cssFloat: "right",
        fontSize: "18px",
        color: "#262626",
        cursor: "pointer",
        background: "#4dbce9",
        onmousedown: (function(_this) {
          return function(evt) {};
        })(this)
      }
    });
    return p = new_popup("Share: " + name_folder, {
      event: evt,
      child: this.popup_share_div,
      top_x: Pleft,
      top_y: Ptop,
      width: Pwidth,
      height: Pheight,
      background: "#262626",
      onclose: (function(_this) {
        return function() {
          return _this.onPopupClose();
        };
      })(this)
    });
  };

  ModelEditorItem_Message.prototype.onPopupClose = function() {
    document.onkeydown = void 0;
    return this.clear_page(this.popup_share_div);
  };

  ModelEditorItem_Message.prototype.clear_page = function(div_to_clear) {
    var results;
    results = [];
    while (div_to_clear.firstChild != null) {
      results.push(div_to_clear.removeChild(div_to_clear.firstChild));
    }
    return results;
  };

  ModelEditorItem_Message.add_action = function(model_type, fun) {
    if (ModelEditorItem_Directory._action_list[model_type] == null) {
      ModelEditorItem_Directory._action_list[model_type] = [];
    }
    return ModelEditorItem_Directory._action_list[model_type].push(fun);
  };

  return ModelEditorItem_Message;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var MessageView,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

MessageView = (function(superClass) {
  extend(MessageView, superClass);

  function MessageView(model, evt) {
    this.onPopupClose = bind(this.onPopupClose, this);
    var Pheight, Pleft, Ptop, Pwidth, p;
    this.user_email = Cookies.set("email");
    MessageView.__super__.constructor.call(this, model);
    this.model = model;
    this.container_global = new_dom_element({
      id: "list_message_container",
      nodeName: "div",
      style: {
        overflowY: "hidden",
        overflowX: "hidden"
      }
    });
    Ptop = 100;
    Pleft = 100;
    Pwidth = 400;
    Pheight = 500;
    p = new_popup("Message", {
      event: evt,
      child: this.container_global,
      top_x: Pleft,
      top_y: Ptop,
      width: Pwidth,
      height: Pheight,
      background: "#262626",
      onclose: (function(_this) {
        return function() {
          return _this.onPopupClose();
        };
      })(this)
    });
  }

  MessageView.prototype.onchange = function() {
    var input_message_container, list_message_container, message_input;
    this.clear_page(this.container_global);
    list_message_container = new_dom_element({
      parentNode: this.container_global,
      nodeName: "div",
      style: {
        cssFloat: "left",
        width: "96%",
        margin: "0px 0 0 0px",
        position: "absolute",
        bottom: "120px",
        top: "40px",
        border: "1px solid grey",
        overflowY: "auto"
      }
    });
    this.view_model_messages(list_message_container);
    list_message_container.scrollTop = list_message_container.scrollHeight;
    input_message_container = new_dom_element({
      parentNode: this.container_global,
      nodeName: "div",
      style: {
        cssFloat: "left",
        width: "96%",
        height: "70px",
        margin: "0px 0 0 0px",
        position: "absolute",
        bottom: "40px"
      }
    });
    message_input = new_dom_element({
      parentNode: input_message_container,
      id: "message_input",
      nodeName: "input",
      type: "textarea",
      value: this.model.text,
      style: {
        cssFloat: "left",
        width: "100%",
        height: "60px",
        margin: "5px 0 0 0px",
        border: "1px solid grey",
        backgroundColor: "#ffffff"
      }
    });
    return input_message_container = new_dom_element({
      parentNode: this.container_global,
      nodeName: "button",
      txt: "Post",
      style: {
        width: "96%",
        height: "30px",
        margin: "0px 0 0 0px",
        position: "absolute",
        bottom: "5px",
        textAlign: "center",
        color: "#262626",
        cursor: "pointer",
        background: "#4dbce9"
      },
      onclick: (function(_this) {
        return function(evt) {
          _this.model.text = message_input.value;
          _this.model.add_message();
          return message_input.value = "";
        };
      })(this)
    });
  };

  MessageView.prototype.onPopupClose = function() {
    document.onkeydown = void 0;
    return this.clear_page(this.container_global);
  };

  MessageView.prototype.clear_page = function(div_to_clear) {
    var results;
    results = [];
    while (div_to_clear.firstChild != null) {
      results.push(div_to_clear.removeChild(div_to_clear.firstChild));
    }
    return results;
  };

  MessageView.prototype.view_model_messages = function(parent) {
    var i, len, mes, message_container, ref, results, text_container, text_line, user_container, user_line;
    ref = this.model.list_messages;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      mes = ref[i];
      message_container = new_dom_element({
        parentNode: parent,
        nodeName: "div",
        style: {
          cssFloat: "left",
          width: "97%",
          margin: "5px 0 0 0px",
          color: "black"
        }
      });
      user_line = new_dom_element({
        parentNode: message_container,
        nodeName: "div",
        style: {
          cssFloat: "left",
          width: "100%",
          margin: "0px 0 0 px"
        }
      });
      user_container = new_dom_element({
        parentNode: user_line,
        nodeName: "div",
        txt: mes.user,
        style: {
          cssFloat: "left",
          margin: "0px 0 0 5px",
          color: "#4dbce9"
        }
      });
      user_container = new_dom_element({
        parentNode: user_line,
        nodeName: "div",
        txt: mes.date,
        style: {
          cssFloat: "right",
          margin: "0px 0 0 5px",
          color: "#4dbce9"
        }
      });
      text_line = new_dom_element({
        parentNode: message_container,
        nodeName: "div",
        style: {
          cssFloat: "left",
          width: "100%",
          margin: "5px 0 0 0px",
          color: "black"
        }
      });
      results.push(text_container = new_dom_element({
        parentNode: text_line,
        nodeName: "div",
        txt: mes.text,
        style: {
          cssFloat: "left",
          margin: "0px 0 0 5px",
          color: "black"
        }
      }));
    }
    return results;
  };

  return MessageView;

})(View);
// Generated by CoffeeScript 1.11.1
var OrganisationView,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

OrganisationView = (function(superClass) {
  extend(OrganisationView, superClass);

  function OrganisationView(bel, data1) {
    this.bel = bel;
    this.data = data1;
    this.user_email = Cookies.set("email");
    this.layout = this.data.layout;
    this.el = new_dom_element({
      parentNode: this.bel,
      id: "organisation_container",
      style: {
        position: "absolute",
        left: 0,
        right: 0,
        top: "32px",
        bottom: 0
      }
    });
    this.lm = new LayoutManager(this.el, this.layout);
    this.lm.new_panel_instance = (function(_this) {
      return function(data) {
        return _this._new_panel_instance(data);
      };
    })(this);
    this.lm.show();
  }

  OrganisationView.prototype._new_panel_instance = function(data) {
    var res;
    if (data.panel_id === "DeskListView") {
      res = new LayoutManagerPanelInstance(this.el, data, this.data.config.selected_organisation[0].name);
      res.div.className = "PanelInstanceTreeView";
      new DeskListView(res.div, this);
      return res;
    }
    if (data.panel_id === "DeskNavigatorView") {
      res = new LayoutManagerPanelInstance(this.el, data);
      res.div.className = "PanelInstanceContextBar";
      new DeskNavigatorView(res.div, this);
      return res;
    }
    if (data.panel_id === "MessageListView") {
      res = new LayoutManagerPanelInstance(this.el, data);
      res.div.className = "PanelInstanceContextBar";
      new MessageListView(res.div, this);
      return res;
    }
    res = new LayoutManagerPanelInstance(this.el, data);
    res.div.className = "PanelInstanceContextBar";
    return res;
  };

  return OrganisationView;

})(View);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Organisation,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Organisation = (function(superClass) {
  var sort_dir, sort_numerically;

  extend(ModelEditorItem_Organisation, superClass);

  ModelEditorItem_Organisation._action_list = {
    "Directory": [
      function(file, path, browser) {
        return browser.load_folder(file);
      }
    ]
  };

  function ModelEditorItem_Organisation(params) {
    this.onPopupClose = bind(this.onPopupClose, this);
    this.get_fs_instance = bind(this.get_fs_instance, this);
    this.new_organisation = bind(this.new_organisation, this);
    var key_map;
    ModelEditorItem_Organisation.__super__.constructor.call(this, params);
    this.use_icons = params.use_icons != null ? params.use_icons : true;
    this.initial_path = params.initial_path != null ? params.initial_path : "Root";
    this.initial_path = this.make_initial_path_as_dom(this.initial_path);
    this.index_sorted = new Lst;
    this.selected_file = new Lst;
    this.selected_file.bind(this);
    this.allow_shortkey = false;
    this.line_height = 30;
    this.ed.ondrop = (function(_this) {
      return function(evt) {
        return _this.cancel_natural_hotkeys(evt);
      };
    })(this);
    this.container = new_dom_element({
      parentNode: this.ed,
      nodeName: "div",
      className: "directory_container",
      ondragover: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragout: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragleave: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondrop: (function(_this) {
        return function(evt) {
          evt.stopPropagation();
          evt.preventDefault();
          _this.handle_files(evt.dataTransfer.files);
          _this.cancel_natural_hotkeys(evt);
          return false;
        };
      })(this)
    });
    if (this.use_icons) {
      ModelEditorItem_Organisation.new_organisation_button(this);
    }
    this.all_file_container = new_dom_element({
      parentNode: this.container,
      nodeName: "div"
    });
    key_map = {
      13: (function(_this) {
        return function(evt) {
          var ind_sel_file, index, k, len, ref, results;
          if (_this.selected_file.length > 0) {
            ref = _this.selected_file.get();
            results = [];
            for (k = 0, len = ref.length; k < len; k++) {
              ind_sel_file = ref[k];
              index = _this.search_ord_index_from_id(ind_sel_file);
              results.push(_this.open(_this.model[index], _this.path()));
            }
            return results;
          }
        };
      })(this),
      37: (function(_this) {
        return function(evt) {
          var ind, index_last_file_selected;
          if (_this.selected_file.length > 0) {
            if (evt.shiftKey) {
              index_last_file_selected = _this.selected_file[_this.selected_file.length - 1].get();
              if (_this.reference_file == null) {
                _this.selected_file.clear();
                _this.selected_file.push(index_last_file_selected);
                _this.reference_file = index_last_file_selected;
              }
              if (index_last_file_selected > 0) {
                if (index_last_file_selected <= _this.reference_file) {
                  return _this.selected_file.push(index_last_file_selected - 1);
                } else {
                  return _this.selected_file.pop();
                }
              }
            } else {
              ind = _this.selected_file[_this.selected_file.length - 1].get();
              if (ind !== 0) {
                _this.selected_file.clear();
                _this.selected_file.push(ind - 1);
              } else {
                _this.selected_file.clear();
                _this.selected_file.push(0);
              }
              return _this.reference_file = void 0;
            }
          } else {
            _this.selected_file.push(0);
            return _this.reference_file = void 0;
          }
        };
      })(this),
      39: (function(_this) {
        return function(evt) {
          var ind, index_last_file_selected;
          if (_this.selected_file.length > 0) {
            if (evt.shiftKey) {
              index_last_file_selected = _this.selected_file[_this.selected_file.length - 1].get();
              if (_this.reference_file == null) {
                _this.selected_file.clear();
                _this.selected_file.push(index_last_file_selected);
                _this.reference_file = index_last_file_selected;
              }
              if (index_last_file_selected < _this.model.length - 1) {
                if (index_last_file_selected >= _this.reference_file) {
                  return _this.selected_file.push(index_last_file_selected + 1);
                } else {
                  return _this.selected_file.pop();
                }
              }
            } else {
              ind = _this.selected_file[_this.selected_file.length - 1].get();
              if (ind < _this.model.length - 1) {
                _this.selected_file.clear();
                _this.selected_file.push(ind + 1);
              } else {
                _this.selected_file.clear();
                _this.selected_file.push(_this.model.length - 1);
              }
              return _this.reference_file = void 0;
            }
          } else {
            return _this.selected_file.push(0);
          }
        };
      })(this),
      40: (function(_this) {
        return function(evt) {
          var ind_sel_file, index, k, len, ref, results;
          if (evt.altKey) {
            if (_this.selected_file.length > 0) {
              ref = _this.selected_file.get();
              results = [];
              for (k = 0, len = ref.length; k < len; k++) {
                ind_sel_file = ref[k];
                index = _this.search_ord_index_from_id(ind_sel_file);
                results.push(_this.open(_this.model[index], _this.path()));
              }
              return results;
            }
          }
        };
      })(this),
      65: (function(_this) {
        return function(evt) {
          var child, i, k, len, ref, results;
          if (evt.ctrlKey) {
            _this.selected_file.clear();
            ref = _this.model;
            results = [];
            for (i = k = 0, len = ref.length; k < len; i = ++k) {
              child = ref[i];
              results.push(_this.selected_file.push(i));
            }
            return results;
          }
        };
      })(this),
      46: (function(_this) {
        return function(evt) {
          return _this.delete_file();
        };
      })(this),
      113: (function(_this) {
        return function(evt) {
          var file_contain, ref;
          file_contain = (ref = document.getElementsByClassName('selected_file')[0]) != null ? ref.getElementsByClassName('linkDirectory') : void 0;
          if ((file_contain != null) && file_contain.length > 0) {
            return _this.rename_file(file_contain[0], _this.model[_this.search_ord_index_from_id(_this.selected_file[0].get())]);
          }
        };
      })(this)
    };
    document.onkeydown = (function(_this) {
      return function(evt) {
        if (_this.allow_shortkey === true) {
          if (key_map[evt.keyCode] != null) {
            evt.stopPropagation();
            evt.preventDefault();
            key_map[evt.keyCode](evt);
            return true;
          }
        }
      };
    })(this);
  }

  ModelEditorItem_Organisation.prototype.rename_file = function(file, child_index) {
    this.allow_shortkey = false;
    file.contentEditable = "true";
    file.focus();
    return file.onblur = (function(_this) {
      return function(evt) {
        var title;
        _this.allow_shortkey = true;
        title = file.innerHTML;
        child_index.name.set(title);
        child_index.load(function(organisation, err) {
          return organisation.name.set(title);
        });
        file.contentEditable = "false";
        return _this.selected_file.clear();
      };
    })(this);
  };

  ModelEditorItem_Organisation.new_organisation_button = function(this_instance) {
    var div_top;
    div_top = new_dom_element({
      parentNode: this_instance.container,
      className: "desk_panel_title"
    });
    new_dom_element({
      parentNode: div_top,
      nodeName: "div",
      txt: "Organisation",
      style: {
        margin: "5px 20px 0px 0px",
        height: "30px",
        cssFloat: "left"
      }
    });
    return new_dom_element({
      parentNode: div_top,
      nodeName: "button",
      className: "desk_panel_button",
      txt: "New organisation",
      style: {
        margin: "3px 0px 0px 0px",
        padding: "0px 10px 0px 10px",
        height: "20px",
        cssFloat: "left"
      },
      onclick: function(evt) {
        return this_instance.new_organisation();
      }
    });
  };

  ModelEditorItem_Organisation.prototype.new_organisation = function() {
    var Organisation_dir, config, fs, name, organisation;
    fs = this.get_fs_instance();
    Organisation_dir = FileSystem._home_dir + "/__organisations__";
    config = this.config;
    name = prompt("Orgnaisation name", "");
    if (name !== "") {
      organisation = new Organisation(name, config);
      fs.load_or_make_dir(Organisation_dir, function(current_dir, err) {
        return current_dir.add_file(name, organisation, {
          model_type: "Organisation"
        });
      });
      return fs.load_or_make_dir("/__organisations__", function(current_dir, err) {
        return current_dir.force_add_file(name, organisation, {
          model_type: "Organisation"
        });
      });
    } else {
      return alert("you must type a name !");
    }
  };

  ModelEditorItem_Organisation.prototype.onchange = function() {
    if (this.selected_file.has_been_directly_modified()) {
      this.draw_selected_file();
    }
    if (this.model.has_been_modified()) {
      return this.refresh();
    }
  };

  ModelEditorItem_Organisation.prototype.refresh = function() {
    this.empty_window();
    this.init();
    return this.draw_selected_file();
  };

  ModelEditorItem_Organisation.prototype.empty_window = function() {
    return this.all_file_container.innerHTML = "";
  };

  ModelEditorItem_Organisation.prototype.load_folder = function(file) {
    this.model.unbind(this);
    return file._ptr.load((function(_this) {
      return function(m, err) {
        _this.model = m;
        _this.model.bind(_this);
        return _this.selected_file.clear();
      };
    })(this));
  };

  ModelEditorItem_Organisation.prototype.open = function(file, path) {
    var l;
    if (file._info.model_type != null) {
      l = ModelEditorItem_Organisation._action_list[file._info.model_type];
      if ((l != null) && l.length) {
        return l[0](file, path, this);
      }
    }
  };

  ModelEditorItem_Organisation.prototype.handle_files = function(files) {
    var file, fs, k, len, results;
    if (files.length > 0) {
      if (typeof FileSystem !== "undefined" && FileSystem !== null) {
        fs = FileSystem.get_inst();
        results = [];
        for (k = 0, len = files.length; k < len; k++) {
          file = files[k];
          results.push(this.model.add_file(file.name, new Path(file)));
        }
        return results;
      }
    }
  };

  ModelEditorItem_Organisation.prototype.make_initial_path_as_dom = function(initial_path) {
    var path, reg;
    reg = new RegExp("[\/]+", "g");
    path = initial_path.split(reg);
    return path;
  };

  ModelEditorItem_Organisation.prototype.search_ord_index_from_id = function(id) {
    var i, id_, k, len, pos, ref, sorted;
    sorted = this.model.sorted(sort_dir);
    id_ = this.index_sorted[id];
    ref = this.model;
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      pos = this.model.indexOf(sorted[id_]);
      if (pos !== -1) {
        return pos;
      }
    }
  };

  sort_numerically = function(a, b) {
    return a - b;
  };

  ModelEditorItem_Organisation.prototype.delete_file = function() {
    var i, index, index_array, k, len, n, ref, ref1;
    if (this.selected_file.length) {
      index_array = [];
      ref = this.selected_file.get();
      for (k = 0, len = ref.length; k < len; k++) {
        i = ref[k];
        index = this.search_ord_index_from_id(i);
        index_array.push(index);
      }
      index_array.sort(this.sort_numerically);
      for (i = n = ref1 = index_array.length - 1; ref1 <= 0 ? n <= 0 : n >= 0; i = ref1 <= 0 ? ++n : --n) {
        this.model.splice(index_array[i], 1);
      }
      return this.selected_file.clear();
    }
  };

  ModelEditorItem_Organisation.prototype.draw_selected_file = function() {
    var file, file_contain, j, k, len, results;
    file_contain = document.getElementsByClassName('file_container');
    results = [];
    for (j = k = 0, len = file_contain.length; k < len; j = ++k) {
      file = file_contain[j];
      if (parseInt(this.selected_file.indexOf(j)) !== -1) {
        results.push(add_class(file, 'selected_file'));
      } else {
        results.push(rem_class(file, 'selected_file'));
      }
    }
    return results;
  };

  ModelEditorItem_Organisation.prototype.cancel_natural_hotkeys = function(evt) {
    if (!evt) {
      evt = window.event;
    }
    evt.cancelBubble = true;
    if (typeof evt.stopPropagation === "function") {
      evt.stopPropagation();
    }
    if (typeof evt.preventDefault === "function") {
      evt.preventDefault();
    }
    if (typeof evt.stopImmediatePropagation === "function") {
      evt.stopImmediatePropagation();
    }
    return false;
  };

  sort_dir = function(a, b) {
    if (a.name.get().toLowerCase() > b.name.get().toLowerCase()) {
      return 1;
    } else {
      return -1;
    }
  };

  ModelEditorItem_Organisation.prototype.init = function() {
    var _sorted, elem, i, k, len, len1, n, results, sorted;
    _sorted = this.model.sorted(sort_dir);
    this.index_sorted.clear();
    sorted = new Array;
    for (i = k = 0, len = _sorted.length; k < len; i = ++k) {
      elem = _sorted[i];
      if (elem._info.model_type.get() === "Organisation") {
        sorted.push(elem);
        this.index_sorted.push(i);
      }
    }
    this.allow_shortkey = true;
    results = [];
    for (i = n = 0, len1 = sorted.length; n < len1; i = ++n) {
      elem = sorted[i];
      results.push((function(_this) {
        return function(elem, i) {
          var button_line, file_container, select_button, share_button, text;
          file_container = new_dom_element({
            parentNode: _this.all_file_container,
            nodeName: "div",
            className: "file_container",
            onmousedown: function(evt) {
              var ind, index_last_file_selected, j, o, ref, ref1, results1;
              if (evt.ctrlKey) {
                ind = parseInt(_this.selected_file.indexOf(i));
                if (ind !== -1) {
                  return _this.selected_file.splice(ind, 1);
                } else {
                  return _this.selected_file.push(i);
                }
              } else if (evt.shiftKey) {
                if (_this.selected_file.length === 0) {
                  return _this.selected_file.push(i);
                } else {
                  index_last_file_selected = _this.selected_file[_this.selected_file.length - 1].get();
                  _this.selected_file.clear();
                  results1 = [];
                  for (j = o = ref = index_last_file_selected, ref1 = i; ref <= ref1 ? o <= ref1 : o >= ref1; j = ref <= ref1 ? ++o : --o) {
                    results1.push(_this.selected_file.push(j));
                  }
                  return results1;
                }
              } else {
                _this.selected_file.clear();
                return _this.selected_file.push(i);
              }
            }
          });
          _this.picture = new_dom_element({
            parentNode: file_container,
            nodeName: "img",
            src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAABuCAYAAADGWyb7AAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB94FGw4TOZ9sbIEAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAATI0lEQVR42u1de3BcV33+vnPvriTbcvyILFuWHSV+KLZjWXs3aQOTQMJjOiSkaaAdHoHSJB0Kw5Bmpi3TUmDakraZgYHwCKU0D9opybTMQAlQEh4JkIIdEq3WNorwEzvBMY4Tx29J+zhf/9iz8tVqV1qt3tL9zeix9577Ot/5fff3+85jgcgiiyyyyCKLLLLIIossssgiiyyyyCKLLLLIIptv1tHRMa+fnzPlRhKJxCaSHyD5LgBd58+fv6G3t1cAEATBAgDfJ7nBWvtFa+1DO3fu/E0E3PR5TYPneW8yxrxF0tUkWyU1kbSSbkylUo854P4MwL+QJIAXJb0AYLukR7u7u5+cj8D50wBWve/7r5f0IZKvI3kRABQwGfxrSL4dwGNu2w2hRtZCsgXA75K8K5lMHpP0A0lfkvRMOp3ORcDVYEEQIJVKDX5OJpON1tpLACQB3ETyOgDLjTEAAEliEbWQSQoDcFYSyhdTM8n3kHyPpMPJZPKnkr5DMp3P5w+n0+mBYuHNmzfjueeei4ALW2dnJ9Lp9CBoiUTiapLvAPAmks0AmkIVr6IHVQANJG3ocyVKHzzcHXOJpPeSfA+AY8aYF4Mg+F9r7X+l0+lfFkHr6OjArl275h9wq1evxpEjR8KgeST9RCKxmeRtJN8NYHmoQsf0bnXlGf4sCVUcEz52JYCVJAPP8z4WBMEhSf9prX3Y87wDnZ2duXQ6bWcrcGYshZPJJAAMgpZMJi9PJpPvNcZ8leQvSaZIfljScudV5UCbusjrgjeKZJsx5mO+7z8H4BljzJeCIPjDRCJxaSlzzCmP27hxI7q6upBMJpustXeRfDOA9QAWk/TCLx3HXxOG2GjeVgWADFM0yQ4AHZJuJ3kmCIKdAB7v7+//QjqdPj+nPK6/vx/btm27WtJhY8xHAVwFYAkAr0IlTbjnTHT6QzJGcinJ60neU19fvy+RSLTMhgS/auCWLVv2Ns/zHiXZ4LxqRiXw4wXTPVMLyZ8CmPHBS9XAGWP+hGRTpfB9Mm28VFktnbpnW5dIJK6cM1RJsn8yqFAOFY2AzlS1k+KzSfLmVFQ5QS1fZVr6RIKjCQBQMx24KZe8XDL9W0nPkkxba39C8rUk/76Gc52W9EmSSyVdSfJKkssiyWsUiiulTUlnABwF8ArJqyT5oVxqu6S/BdDT3d39Uvi4YiRXg2UAfCeVSv0qdK5VAN5C8nMkFxWDYklZAI3FZD70V7MxyPLHQSeU9CKAbwE4AOBZSccBvNrb23t08+bNJ4sCsrPnw0p+e3s79uzZUzzXwhop2gCoD2/o7u4+GgTBzx2oRXB+aK39MIArSHYaYzZI2kpymyQznSLBdFHlN1Kp1IeLH7Zs2YKenh40NTWRpBd+d0kacq0iaNW8l6qRvEosVmQDd+xAOp0+BOAQgO8UCwVB8KQTvee25FXGGsMfenp6AACnTp2akblamQaRn4pUYyYCNyWKx2RV7mwI+6cFuJIK5yQ0AEsyX2Z7XlWgPRvfbZOaDqxdu7ZcJWVHOORsjZdaDOCvgyA4COCYpFMk+wAsKHm2/goNy85W8MYLXKbcxv379ysIAlvSybmgo6Njo+/7K621S0muJrnMjTG5thaqJBmX9C4XgFgX2guASMZCRTs7Ozt/X1KW5HEAr6TT6V8DsPPO4xwYKzs7O99gjGmWtJBkq/OClSQXFKNKJwPeFIvFbgIAz/OGRYwj5VMjRZWh6NEbQUnZ7Hnet8L3HgRBvhiczKt0wD3sDcaYmxw4laSjUSWtSe5pGCavus+eC07mVwLuzCvqshUevuK4kpkQVc7mrqlxS17OmyoN+Cl6nELKe5bkgKQBAP0kz0laRbJxAhPwOW/jokoHzllJ/QBOAzgO4BSAUyRvKWqVDuDvAfispFMAzjkAM+64LwB491R73LwEzlHMIwBuTaVSw2o2CIIhWqWknd3d3T8od6IgCOqqaSTlwnkAAyGqJgqDaemebbB3G8OH8g1hjvn2jjvb1dUlYOhg05aWlmFa5ShCcq0udV7SO/P5fI8xZrExZhHJRklrAXya5GJXbh+AxyW1kFxEsl5SA4CtJBvmYx4XL/4THiH88ssvY9WqVVMheRHAq7t27ToU3phIJJpI/oNLTQCgO5VK3dnR0RHzfd8naVxS/l0AvxcpJ+UDlAmJ/kYBb6gOZm3c87ywnBcDgF27dmUBDCo4yWSybrbmcQZz1+Z0RDMrgIuiyomnyrLCcSaTKSfOjyQy58ZBldWcL1+hQeRGo8krvvx1NtS1eJIBtcw+c0f7MH1z3ef24sCfb5w1CThIXp5IJO5AaDSz0yVzJEvPvTWRSNxeck25XO6yGm/DkhzSs9Dc3OxJuij87pO0MgiC10vabIxZKWkZgCZJwYjAbW2EF1vzxgGLt4Mw4MkfBw9uf8xAVgJisXq744+DM6Wgrfv8Phy4c8PMTcABXGOMuabCvtJtb3bzDSbSGiTdHQTBWUmtJFeQXCWpMXwPxphrAfy4ZEbPqEFJ4q4fvS4Hex+B9QAh4ZYs+BJpIIiZbPa32766/aMmz1MgDECbzTUc+eX7N5yZ1VHlZBtJn+Rby4AwPuHY5nXFdi3IPff0pwhshAgJINEEsAmFfB6ENtm8ecxyMBDK0T//cMcDO3YVBQHSHIX4ZJzZnAT4fhw73ndlZl4AN9bgZCKUkPq+syZDLJQIwumuKjYGgoXWQRJLJA1uEfghcfCdSskeB/CLAZg8AGby+fPbvrrjU35eRwpeCgCLz3XdvqVv/Xf3Yf+NG+YOcNMjMlMAxdDk2VIfLm4o/hUoCj4UqldyNYhbpCIFyNo8r8uSGRXf8zrz6Javpe5e0nvw1cMfF7Kf5NymyhnXwMqAC9cnPzhBTzQk1rgZEwXCBT5g+jMLzyxZ8kQLn/jG4VGi7CiPqzqH17jQDP+QEBTy5wLNLgDwfhC3N6oxPmcS8OmTpFhJVRvfSYcASUeXoBV8UyUJzmXJazapZ8QYG2dEldMLWPghpxS4wXmJ4Q8RVdb0kFMDXLhXubiATHEMivtRKbqjoT+PqXJKJS9Keiafz9/m+/6i0K4Ba+3Fnuf9oKTs/5D8hbXWhIYNZAFsNMbcMeMD/bkCnLNjO3fu7Cm3o7iYTfEdJemhVCr1aGm5zs7OrQDGDJy19usoTJlqMcY0hK7lA7jDLUNVLDtA8vEy/JcHsBpA4HrFq3oXCbQAsiidcSwYAD7IQk5X2GYFPCtoN0MHCDAGuF7EpXR62lQCV3aQTyKRWFZG+WiucI4VtQQnJHekUqn/KNMQPGPMWwE0h8qeTKVSN7e3t5tcLjdYQ8YYNTY23gLgYYSGYZTP4xwOBWWrR9beQ5qBktfUG0H8KaRYEQhBFuK3Mgdin/EXxvKwhRN5F+XiaMz+O4BLp8PjxvJSUK0vkAqSV7xC2ViZdzcBYM+ePXYkZihPkUP1agqwwLH8843f7L37ir5w6Y77n14i6naG14wr/JsbePmizN571g9e/6oHf44BGFsoO3YqjvK42qI/xpZmhte2GaFTQhMb7kR53Fglr+K9jMApqhYWTUMe53rA8xUCh0yZire1N/IZlMdVcS+slvpYex433iHoyzs7O1/veV6DA+tVAMjny+KZr3Ce09Mdo48+RG/iJ/TEZG2GRrWee7zBSdIY83gxVSt6le/7LAPQpxOJxJ0kz5E8aq09B2AvgHU1UuWw4QFbtmwZdPqJ8WhVkKZYqSnJdaaWltCRB9bpiq98vyHuL2qWyD7DOCwXiQCl4uqeUwOcy33qRqMzB+rFJC8uAlFck7monIzUa10hqrw6kUjsdQAaABmSZ9z91Jd4k5LJpJfNZut838+/8MILmePHj8vRerbS/L5yUSUIUKC9qL++88HtV0tcChYlPyYJmPAxFClo6+b7t78NakxkxdtA+rAioMW0AIqTOjV1HlcTrZWZaDhWrhCAW40xt7oRZZSUB3DeXWtRybWWSXra9/0+ktk1a9a80traegLAAMnlo7/rQ3lc4Xc7aO7NC9eDbAqFJR4EH6QGE3DIgHyn6P0RJI9AbIh3sTaunK1jTgan2xWHAbqpxPEK5WMAkqHRXaXLDrNqqgQFqoXkrRQIe2HkQnn9g6QUA+gXOHTYlGmOSsETDZykNMlPSLrU0VmTo6q1bgX0cMWfdJMYF7oycbgZrTVSZcUKrzA8sAYnL5OAF31EzqkYjgs5/I4Y+jXSDFgSU0KV7t3xYldX17dL97W2tvrNzc3vKCn/VwB+CKDOWht3U6CWAriO5F+M0ePKYh1aXG2C5rypfFRZ26klqNywlKmlSldBsXL7mpqaFpdp7SaVSh0qo2seGQ24Uo9zuPRYaw8AWE5yBQrrdy201nrGmCVh7Fy3kXXvsrITHKv1uMIGXRAuL0yBV5jxGB4f5CZUQzxB2UOWzAM0BC4DsWw6ROaqtUo3e7ScNy2vsdH8a3d39xfC2zs7O+tRGN38M5KbQtc4S/IjAFZLanFUvdh5fQsKq7mzSr+hwDyATCGOHxQyXoa0j+S1kPxBIAoyylMQnoG1vX3HDz5aH18zwIUL46jL3S/iD2rRv2ZCcGKroeUy2xaUbkun0/2JRAIoGd5G8nwqlfoyAKxfv54NDQ3GTXD0JN0M4CGSddVQpQjAYidkP0Ga/lBmdM7KJkS8lqF6db0Dj5/vWfCZWP3C7L57XmMB4MqvbI9nwByLEeZUBidTp+sOD044OseV/bx//345FScPAMlkMjNSRj28d4CwxIn8wYt+1PvPm4csNbXtwR2bLTjIpKEr53PnFmQP3LvODjK2785bLDvG4GS8IvP5Ch6SmU2C9ugitkqBYOziflNWVBmVVyamGsbrce2JROKDAI5KOkLy6L59+17s6+szixYtKq2YF8MHjuWbpSa7d6AmyUsjwazqhGZVKaVNcDogkpeT/NIQJNvbAeB4yYoLAPCRIAheK+mIpF+T/E0QBKddXjdmqpw6wadMKqDRjhodAFOcQjIYhk5RHlfmHRN+wqbwomoO5GsBXBsCMuOScltjw3llIqmy1t6BdZ//Lg7ceWMRMVuhrA4/sN5u+revmUV+W6NEZGnisIiJdMHp9KUDFQOCMMihf+OoYrxJJaokeWMymTws6QSAY4cOHTp64sSJnBOMcyUrndsJp0pnB+68EU13P2LWtq5py+bZWtCgQ1QpEtDKjq/83xbA+51+a+4k4cvCQGplMQeUOOejSufBNwO4ubitra0t29bWdsLRdFsJGIuDIPgbAL8h+YKk89bakyRftdb6JFVt74AIGKlFSwbe1/HAjowr0pDJ40OALqEQC7MNKSPwg/Jjt8HaOkILCrN3ijhRgx9mYO/AhEZ9oQXdwtJWDIWRXc3hfW5O+gKS/+S2DwAYMMacA3DOeX6saslLhIh2kPfqQq8ACcQK/TMa4jfuDhsgNYAG0jDlsyb9rGrgrLUm3Ic23XncaLlcaN+QYi7RrsOFVYfGJjIXAgoDIT5kaAPL025pB8REjcLwx1B52Yrq7nyzGfD4Zgwe93FJT4VparIZcqryuNFvYQquPxmjvNw3Du+XdL219nPW2h4UvtjouFt/st/1QJcGETVXfOl3AkyPk0/RbB2NvWVURZXpdBoA0N3dnQdwV3NzM1esWNHo+/4SSSs8z1vhVjRfR3I1gFWSlpFc6b6ne2Gl3KkM9RZfKuGViOqnOTyaTPAkqtAJKw1kzWlNGHBh27ZtG3bu3Kljx46dRmF11+dD++j7vpFknDebTCZTH4vFVqAwK+dySZskXWqMuRTAmjKTLQgA2Wz2vhDIO0jegilf+FqTS46FbywlC5FqLzO5f+zdtrevlqR5Qm39+vXYv39/xf0bN25c2NDQ0GyM2YhCn9hGknEAj6RSqZ9s3boVy5cvR29vr2ltbX0SwDWjfPvUhABrc9mrvM/+vDdzqGcHpCswttzYsUko8cNgji0AuQuTdjgA4SkQJ5m19+36wGt+BgBtDz2BQ7e9YfryuJFAA4C9e/eeA3DQ/Qyz3bt3D9Zla2vrTZKus9a2GmPaAKwC0OrktVUAlmHo+l1h5WSsrlAHP1ZVe7gAEkvSF2QAnA/NrCKIXRAehphzsWl/fiD2vdjJ+On9T7+UBYC2Bw/i0G2XTTxVTpd1dXWd3rBhw6N1dXWIx+PI5XKIx+N49tlnAcB0dnY2WWtX+b7fLqndGLNF0mqSa1GYA2eq5EbabPZ5nHwpND5SFZ27kODzKKiTITAtiW+bPB8RjC1GjR5jp3/13+1H+n7YEDqhUWEt8UIsduj26tajmxf52NatWxfHYrEVklYCWE1yC4DLHLCrASwludBNwPxId3f3Fzc8tLO+Id93j8A7wNKxNbQQ0gB6UOiQ/abp854eUqkDi/vSf7lxYLICn3mZSG/atMn4vh/zPK+e5AIAi4wxdZLy2Wx2z+7duy0AbL73qWWxRbFrrBgbHsB7v8ofi++npfpeWpk7eF/TGKbozG/9YlKt7e+eiCph9prGuT+yyCKLLLLIIossssgiiyyyyCKLLLLIIotsbtv/A0MNBkNu70e1AAAAAElFTkSuQmCC",
            alt: "",
            title: "",
            ondblclick: function(evt) {
              var conf;
              conf = _this.config;
              return elem.load(function(organisation, err) {
                var myWindow;
                conf.selected_organisation.clear();
                conf.selected_organisation.push(organisation);
                myWindow = window.open('', '');
                myWindow.document.location = "organisation.html";
                return myWindow.focus();
              });
            }
          });
          button_line = new_dom_element({
            parentNode: file_container,
            className: "line_button",
            nodeName: "div"
          });
          share_button = new_dom_element({
            parentNode: button_line,
            className: "share_button",
            nodeName: "div",
            alt: "Share",
            title: "Share",
            onclick: function(evt) {
              return _this.share_popup(evt, elem, elem.name.get());
            }
          });
          select_button = new_dom_element({
            parentNode: button_line,
            className: (_this.config.selected_organisation[0] != null) && _this.config.selected_organisation[0].name.get() === elem.name.get() ? "select_organisation_button" : "unselect_organisation_button",
            nodeName: "div",
            alt: "Select organisation",
            title: "Select organisation",
            onclick: function(evt) {
              var conf;
              conf = _this.config;
              return elem.load(function(organisation, err) {
                conf.selected_organisation.clear();
                return conf.selected_organisation.push(organisation);
              });
            }
          });
          return text = new_dom_element({
            parentNode: file_container,
            className: "linkDirectory",
            nodeName: "div",
            txt: elem.name.get(),
            onclick: function(evt) {
              return _this.rename_file(text, sorted[i]);
            }
          });
        };
      })(this)(elem, i));
    }
    return results;
  };

  ModelEditorItem_Organisation.prototype.get_fs_instance = function() {
    var fs;
    if ((typeof FileSystem !== "undefined" && FileSystem !== null) && (FileSystem.get_inst() != null)) {
      fs = FileSystem.get_inst();
      return fs;
    } else {
      fs = new FileSystem;
      FileSystem._disp = false;
      return fs;
    }
  };

  ModelEditorItem_Organisation.prototype.path = function() {
    return "test_need_to_be_complete";
  };

  ModelEditorItem_Organisation.prototype.share_popup = function(evt, elem, name_folder) {
    var Pheight, Pleft, Ptop, Pwidth, email, fs, ia, line_div, link_modifie_informations, login, name_div, p, value_div;
    email = prompt("share '" + name_folder + "' with (is'sim login) ?");
    ia = email.indexOf("@");
    if (ia < 0) {
      return alert("Please enter a valid login (email adress)");
    }
    login = email;
    console.log(email, ia, login);
    fs = FileSystem.get_inst();
    fs.load("__users__/" + login, function(home, err) {
      if (err) {
        return alert("Please enter a valid login (email adress --)");
      }
      return fs.load_or_make_dir("__users__/" + login + "/__organisations__", function(inbox, err) {
        var ip, nn;
        if (err) {
          return alert("??");
        }
        nn = name_folder;
        while (inbox.has(nn)) {
          ip = nn.indexOf(".");
          if (ip < 0) {
            ip = nn.length;
          }
          nn = nn.slice(0, ip) + "_" + nn.slice(ip, nn.length);
        }
        return inbox.push(elem);
      });
    });
    return;
    this.popup_share_div = new_dom_element({
      id: "popup_share_div"
    });
    Ptop = 100;
    Pleft = 100;
    Pwidth = 800;
    Pheight = 260;
    this.container_share_div = new_dom_element({
      parentNode: this.popup_share_div,
      className: "container_share_div",
      nodeName: "div",
      style: {
        height: 200,
        width: 200,
        margin: "0px 0 0 10px"
      }
    });
    this.share_user_information_div = new_dom_element({
      parentNode: this.popup_share_div,
      className: "share_user_information_div",
      nodeName: "div",
      style: {
        cssFloat: "left",
        height: 200,
        width: 560,
        margin: "0px 0 0 0px"
      }
    });
    line_div = new_dom_element({
      parentNode: this.share_user_information_div,
      nodeName: "div",
      style: {
        cssFloat: "left",
        height: 40,
        width: "100%",
        fontSize: "18px",
        background: "#262626",
        margin: "60px 0 0 0px"
      }
    });
    name_div = new_dom_element({
      parentNode: line_div,
      nodeName: "div",
      txt: " email : ",
      style: {
        cssFloat: "left",
        height: 30,
        width: 100,
        margin: "10px 0 0 10px"
      }
    });
    value_div = new_dom_element({
      parentNode: line_div,
      nodeName: "input",
      id: "share_email_input",
      style: {
        cssFloat: "left",
        height: 30,
        width: 400,
        margin: "5px 0 0 0px",
        fontWeight: "bold"
      }
    });
    link_modifie_informations = new_dom_element({
      parentNode: this.share_user_information_div,
      nodeName: "button",
      txt: "Share",
      className: "user_line",
      style: {
        height: 40,
        width: 100,
        border: "none",
        margin: "15px 60px 0 0",
        cssFloat: "right",
        fontSize: "18px",
        color: "#262626",
        cursor: "pointer",
        background: "#4dbce9",
        onmousedown: (function(_this) {
          return function(evt) {};
        })(this)
      }
    });
    return p = new_popup("Share: " + name_folder, {
      event: evt,
      child: this.popup_share_div,
      top_x: Pleft,
      top_y: Ptop,
      width: Pwidth,
      height: Pheight,
      background: "#262626",
      onclose: (function(_this) {
        return function() {
          return _this.onPopupClose();
        };
      })(this)
    });
  };

  ModelEditorItem_Organisation.prototype.onPopupClose = function() {
    document.onkeydown = void 0;
    return this.clear_page(this.popup_share_div);
  };

  ModelEditorItem_Organisation.prototype.clear_page = function(div_to_clear) {
    var results;
    results = [];
    while (div_to_clear.firstChild != null) {
      results.push(div_to_clear.removeChild(div_to_clear.firstChild));
    }
    return results;
  };

  ModelEditorItem_Organisation.add_action = function(model_type, fun) {
    if (ModelEditorItem_Organisation._action_list[model_type] == null) {
      ModelEditorItem_Organisation._action_list[model_type] = [];
    }
    return ModelEditorItem_Organisation._action_list[model_type].push(fun);
  };

  return ModelEditorItem_Organisation;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var ModelEditorItem_Project,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ModelEditorItem_Project = (function(superClass) {
  var sort_dir, sort_numerically;

  extend(ModelEditorItem_Project, superClass);

  function ModelEditorItem_Project(params) {
    this.onPopupClose = bind(this.onPopupClose, this);
    this.get_fs_instance = bind(this.get_fs_instance, this);
    var key_map;
    ModelEditorItem_Project.__super__.constructor.call(this, params);
    this.use_icons = params.use_icons != null ? params.use_icons : true;
    this.initial_path = params.initial_path != null ? params.initial_path : "Root";
    this.initial_path = this.make_initial_path_as_dom(this.initial_path);
    this.index_sorted = new Lst;
    this.selected_file = new Lst;
    this.selected_file.bind(this);
    this.allow_shortkey = false;
    this.line_height = 30;
    this.ed.ondrop = (function(_this) {
      return function(evt) {
        return _this.cancel_natural_hotkeys(evt);
      };
    })(this);
    this.container = new_dom_element({
      parentNode: this.ed,
      nodeName: "div",
      className: "directory_container",
      ondragover: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragout: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondragleave: (function(_this) {
        return function(evt) {
          return false;
        };
      })(this),
      ondrop: (function(_this) {
        return function(evt) {
          evt.stopPropagation();
          evt.preventDefault();
          _this.handle_files(evt.dataTransfer.files);
          _this.cancel_natural_hotkeys(evt);
          return false;
        };
      })(this)
    });
    if (this.use_icons) {
      ModelEditorItem_Project.new_project_button(this);
    }
    this.all_file_container = new_dom_element({
      parentNode: this.container,
      nodeName: "div"
    });
    key_map = {
      13: (function(_this) {
        return function(evt) {
          var ind_sel_file, index, k, len, ref, results;
          if (_this.selected_file.length > 0) {
            ref = _this.selected_file.get();
            results = [];
            for (k = 0, len = ref.length; k < len; k++) {
              ind_sel_file = ref[k];
              index = _this.search_ord_index_from_id(ind_sel_file);
              results.push(_this.open(_this.model[index], _this.path()));
            }
            return results;
          }
        };
      })(this),
      37: (function(_this) {
        return function(evt) {
          var ind, index_last_file_selected;
          if (_this.selected_file.length > 0) {
            if (evt.shiftKey) {
              index_last_file_selected = _this.selected_file[_this.selected_file.length - 1].get();
              if (_this.reference_file == null) {
                _this.selected_file.clear();
                _this.selected_file.push(index_last_file_selected);
                _this.reference_file = index_last_file_selected;
              }
              if (index_last_file_selected > 0) {
                if (index_last_file_selected <= _this.reference_file) {
                  return _this.selected_file.push(index_last_file_selected - 1);
                } else {
                  return _this.selected_file.pop();
                }
              }
            } else {
              ind = _this.selected_file[_this.selected_file.length - 1].get();
              if (ind !== 0) {
                _this.selected_file.clear();
                _this.selected_file.push(ind - 1);
              } else {
                _this.selected_file.clear();
                _this.selected_file.push(0);
              }
              return _this.reference_file = void 0;
            }
          } else {
            _this.selected_file.push(0);
            return _this.reference_file = void 0;
          }
        };
      })(this),
      39: (function(_this) {
        return function(evt) {
          var ind, index_last_file_selected;
          if (_this.selected_file.length > 0) {
            if (evt.shiftKey) {
              index_last_file_selected = _this.selected_file[_this.selected_file.length - 1].get();
              if (_this.reference_file == null) {
                _this.selected_file.clear();
                _this.selected_file.push(index_last_file_selected);
                _this.reference_file = index_last_file_selected;
              }
              if (index_last_file_selected < _this.model.length - 1) {
                if (index_last_file_selected >= _this.reference_file) {
                  return _this.selected_file.push(index_last_file_selected + 1);
                } else {
                  return _this.selected_file.pop();
                }
              }
            } else {
              ind = _this.selected_file[_this.selected_file.length - 1].get();
              if (ind < _this.model.length - 1) {
                _this.selected_file.clear();
                _this.selected_file.push(ind + 1);
              } else {
                _this.selected_file.clear();
                _this.selected_file.push(_this.model.length - 1);
              }
              return _this.reference_file = void 0;
            }
          } else {
            return _this.selected_file.push(0);
          }
        };
      })(this),
      40: (function(_this) {
        return function(evt) {
          var ind_sel_file, index, k, len, ref, results;
          if (evt.altKey) {
            if (_this.selected_file.length > 0) {
              ref = _this.selected_file.get();
              results = [];
              for (k = 0, len = ref.length; k < len; k++) {
                ind_sel_file = ref[k];
                index = _this.search_ord_index_from_id(ind_sel_file);
                results.push(_this.open(_this.model[index], _this.path()));
              }
              return results;
            }
          }
        };
      })(this),
      65: (function(_this) {
        return function(evt) {
          var child, i, k, len, ref, results;
          if (evt.ctrlKey) {
            _this.selected_file.clear();
            ref = _this.model;
            results = [];
            for (i = k = 0, len = ref.length; k < len; i = ++k) {
              child = ref[i];
              results.push(_this.selected_file.push(i));
            }
            return results;
          }
        };
      })(this),
      46: (function(_this) {
        return function(evt) {
          return _this.delete_file();
        };
      })(this),
      113: (function(_this) {
        return function(evt) {
          var file_contain, ref;
          file_contain = (ref = document.getElementsByClassName('selected_file')[0]) != null ? ref.getElementsByClassName('linkDirectory') : void 0;
          if ((file_contain != null) && file_contain.length > 0) {
            return _this.rename_file(file_contain[0], _this.model[_this.search_ord_index_from_id(_this.selected_file[0].get())]);
          }
        };
      })(this)
    };
    document.onkeydown = (function(_this) {
      return function(evt) {
        if (_this.allow_shortkey === true) {
          if (key_map[evt.keyCode] != null) {
            evt.stopPropagation();
            evt.preventDefault();
            key_map[evt.keyCode](evt);
            return true;
          }
        }
      };
    })(this);
  }

  ModelEditorItem_Project.prototype.rename_file = function(file, child_index) {
    this.allow_shortkey = false;
    file.contentEditable = "true";
    file.focus();
    return file.onblur = (function(_this) {
      return function(evt) {
        var title;
        _this.allow_shortkey = true;
        title = file.innerHTML;
        child_index.name.set(title);
        child_index.load(function(object, err) {
          return object.name.set(title);
        });
        file.contentEditable = "false";
        return _this.selected_file.clear();
      };
    })(this);
  };

  ModelEditorItem_Project.new_project_button = function(this_instance) {
    var div_top;
    div_top = new_dom_element({
      parentNode: this_instance.container,
      className: "desk_panel_title"
    });
    new_dom_element({
      parentNode: div_top,
      nodeName: "div",
      txt: "Projects",
      style: {
        margin: "5px 20px 0px 0px",
        height: "30px",
        cssFloat: "left"
      }
    });
    return new_dom_element({
      parentNode: div_top,
      nodeName: "button",
      className: "desk_panel_button",
      txt: "New project",
      style: {
        margin: "3px 0px 0px 0px",
        padding: "0px 10px 0px 10px",
        height: "20px",
        cssFloat: "left"
      },
      onclick: function(evt) {
        var date, fs, name, td;
        date = new Date();
        name = prompt("Project name", date.toString());
        td = new TreeAppData;
        td.new_session();
        td.modules.push(new TreeAppModule_UndoManager);
        td.modules.push(new TreeAppModule_PanelManager);
        td.modules.push(new TreeAppModule_File);
        td.modules.push(new TreeAppModule_Apps);
        td.modules.push(new TreeAppModule_Animation);
        td.modules.push(new TreeAppModule_TreeView);
        fs = this_instance.get_fs_instance();
        return fs.load_or_make_dir(FileSystem._home_dir + "/__projects__", function(current_dir, err) {
          return current_dir.add_file(name, td, {
            model_type: "Session",
            icon: "session"
          });
        });
      }
    });
  };

  ModelEditorItem_Project.prototype.onchange = function() {
    if (this.selected_file.has_been_directly_modified()) {
      this.draw_selected_file();
    }
    if (this.model.has_been_modified()) {
      return this.refresh();
    }
  };

  ModelEditorItem_Project.prototype.refresh = function() {
    this.empty_window();
    this.init();
    return this.draw_selected_file();
  };

  ModelEditorItem_Project.prototype.empty_window = function() {
    return this.all_file_container.innerHTML = "";
  };

  ModelEditorItem_Project.prototype.load_folder = function(file) {
    this.model.unbind(this);
    return file._ptr.load((function(_this) {
      return function(m, err) {
        _this.model = m;
        _this.model.bind(_this);
        return _this.selected_file.clear();
      };
    })(this));
  };

  ModelEditorItem_Project.prototype.open = function(file, path) {
    var l;
    if (file._info.model_type != null) {
      l = ModelEditorItem_Directory._action_list[file._info.model_type];
      if ((l != null) && l.length) {
        return l[0](file, path, this);
      }
    }
  };

  ModelEditorItem_Project.prototype.handle_files = function(files) {
    var file, fs, k, len, results;
    if (files.length > 0) {
      if (typeof FileSystem !== "undefined" && FileSystem !== null) {
        fs = FileSystem.get_inst();
        results = [];
        for (k = 0, len = files.length; k < len; k++) {
          file = files[k];
          results.push(this.model.add_file(file.name, new Path(file)));
        }
        return results;
      }
    }
  };

  ModelEditorItem_Project.prototype.make_initial_path_as_dom = function(initial_path) {
    var path, reg;
    reg = new RegExp("[\/]+", "g");
    path = initial_path.split(reg);
    return path;
  };

  ModelEditorItem_Project.prototype.search_ord_index_from_id = function(id) {
    var i, id_, k, len, pos, ref, sorted;
    sorted = this.model.sorted(sort_dir);
    id_ = this.index_sorted[id];
    ref = this.model;
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      pos = this.model.indexOf(sorted[id_]);
      if (pos !== -1) {
        return pos;
      }
    }
  };

  sort_numerically = function(a, b) {
    return a - b;
  };

  ModelEditorItem_Project.prototype.delete_file = function() {
    var i, index, index_array, k, len, n, ref, ref1;
    if (this.selected_file.length) {
      index_array = [];
      ref = this.selected_file.get();
      for (k = 0, len = ref.length; k < len; k++) {
        i = ref[k];
        index = this.search_ord_index_from_id(i);
        index_array.push(index);
      }
      index_array.sort(this.sort_numerically);
      for (i = n = ref1 = index_array.length - 1; ref1 <= 0 ? n <= 0 : n >= 0; i = ref1 <= 0 ? ++n : --n) {
        this.model.splice(index_array[i], 1);
      }
      return this.selected_file.clear();
    }
  };

  ModelEditorItem_Project.prototype.draw_selected_file = function() {
    var file, file_contain, j, k, len, results;
    file_contain = document.getElementsByClassName('file_container');
    results = [];
    for (j = k = 0, len = file_contain.length; k < len; j = ++k) {
      file = file_contain[j];
      if (parseInt(this.selected_file.indexOf(j)) !== -1) {
        results.push(add_class(file, 'selected_file'));
      } else {
        results.push(rem_class(file, 'selected_file'));
      }
    }
    return results;
  };

  ModelEditorItem_Project.prototype.cancel_natural_hotkeys = function(evt) {
    if (!evt) {
      evt = window.event;
    }
    evt.cancelBubble = true;
    if (typeof evt.stopPropagation === "function") {
      evt.stopPropagation();
    }
    if (typeof evt.preventDefault === "function") {
      evt.preventDefault();
    }
    if (typeof evt.stopImmediatePropagation === "function") {
      evt.stopImmediatePropagation();
    }
    return false;
  };

  sort_dir = function(a, b) {
    if (a.name.get().toLowerCase() > b.name.get().toLowerCase()) {
      return 1;
    } else {
      return -1;
    }
  };

  ModelEditorItem_Project.prototype.init = function() {
    var _sorted, elem, i, k, len, len1, n, results, sorted;
    _sorted = this.model.sorted(sort_dir);
    this.index_sorted.clear();
    sorted = new Array;
    for (i = k = 0, len = _sorted.length; k < len; i = ++k) {
      elem = _sorted[i];
      if (elem._info.model_type.get() === "Session") {
        sorted.push(elem);
        this.index_sorted.push(i);
      }
    }
    this.allow_shortkey = true;
    results = [];
    for (i = n = 0, len1 = sorted.length; n < len1; i = ++n) {
      elem = sorted[i];
      results.push((function(_this) {
        return function(elem, i) {
          var button_line, file_container, share_button, text;
          file_container = new_dom_element({
            parentNode: _this.all_file_container,
            nodeName: "div",
            className: "file_container",
            onmousedown: function(evt) {
              var ind, index_last_file_selected, j, o, ref, ref1, results1;
              if (evt.ctrlKey) {
                ind = parseInt(_this.selected_file.indexOf(i));
                if (ind !== -1) {
                  return _this.selected_file.splice(ind, 1);
                } else {
                  return _this.selected_file.push(i);
                }
              } else if (evt.shiftKey) {
                if (_this.selected_file.length === 0) {
                  return _this.selected_file.push(i);
                } else {
                  index_last_file_selected = _this.selected_file[_this.selected_file.length - 1].get();
                  _this.selected_file.clear();
                  results1 = [];
                  for (j = o = ref = index_last_file_selected, ref1 = i; ref <= ref1 ? o <= ref1 : o >= ref1; j = ref <= ref1 ? ++o : --o) {
                    results1.push(_this.selected_file.push(j));
                  }
                  return results1;
                }
              } else {
                _this.selected_file.clear();
                return _this.selected_file.push(i);
              }
            }
          });
          _this.picture = new_dom_element({
            parentNode: file_container,
            nodeName: "img",
            src: "data:image/png;base64,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",
            alt: "",
            title: "",
            ondblclick: function(evt) {
              var Projects_dir, myWindow;
              Projects_dir = FileSystem._home_dir + "/__projects__";
              myWindow = window.open('', '');
              myWindow.document.location = "lab.html#" + encodeURI(Projects_dir + "/" + (elem.name.get()));
              return myWindow.focus();
            }
          });
          button_line = new_dom_element({
            parentNode: file_container,
            className: "line_button",
            nodeName: "div"
          });
          share_button = new_dom_element({
            parentNode: button_line,
            className: "share_button",
            nodeName: "div",
            alt: "Share",
            title: "Share",
            onclick: function(evt) {
              return _this.share_popup(evt, elem, elem.name.get());
            }
          });
          return text = new_dom_element({
            parentNode: file_container,
            className: "linkDirectory",
            nodeName: "div",
            txt: elem.name.get(),
            onclick: function(evt) {
              return _this.rename_file(text, sorted[i]);
            }
          });
        };
      })(this)(elem, i));
    }
    return results;
  };

  ModelEditorItem_Project.prototype.get_fs_instance = function() {
    var fs;
    if ((typeof FileSystem !== "undefined" && FileSystem !== null) && (FileSystem.get_inst() != null)) {
      fs = FileSystem.get_inst();
      return fs;
    } else {
      fs = new FileSystem;
      FileSystem._disp = false;
      return fs;
    }
  };

  ModelEditorItem_Project.prototype.path = function() {
    return "test_need_to_be_complete";
  };

  ModelEditorItem_Project.prototype.share_popup = function(evt, elem, name_folder) {
    var Pheight, Pleft, Ptop, Pwidth, email, fs, ia, line_div, link_modifie_informations, login, name_div, p, value_div;
    email = prompt("share '" + name_folder + "' with (is'sim login) ?");
    ia = email.indexOf("@");
    if (ia < 0) {
      return alert("Please enter a valid login (email adress)");
    }
    login = email;
    console.log(email, ia, login);
    fs = FileSystem.get_inst();
    fs.load("__users__/" + login, function(home, err) {
      if (err) {
        return alert("Please enter a valid login (email adress --)");
      }
      return fs.load_or_make_dir("__users__/" + login + "/__projects__", function(inbox, err) {
        var ip, nn;
        if (err) {
          return alert("??");
        }
        nn = name_folder;
        while (inbox.has(nn)) {
          ip = nn.indexOf(".");
          if (ip < 0) {
            ip = nn.length;
          }
          nn = nn.slice(0, ip) + "_" + nn.slice(ip, nn.length);
        }
        return inbox.push(elem);
      });
    });
    return;
    this.popup_share_div = new_dom_element({
      id: "popup_share_div"
    });
    Ptop = 100;
    Pleft = 100;
    Pwidth = 800;
    Pheight = 260;
    this.container_share_div = new_dom_element({
      parentNode: this.popup_share_div,
      className: "container_share_div",
      nodeName: "div",
      style: {
        height: 200,
        width: 200,
        margin: "0px 0 0 10px"
      }
    });
    this.share_user_information_div = new_dom_element({
      parentNode: this.popup_share_div,
      className: "share_user_information_div",
      nodeName: "div",
      style: {
        cssFloat: "left",
        height: 200,
        width: 560,
        margin: "0px 0 0 0px"
      }
    });
    line_div = new_dom_element({
      parentNode: this.share_user_information_div,
      nodeName: "div",
      style: {
        cssFloat: "left",
        height: 40,
        width: "100%",
        fontSize: "18px",
        background: "#262626",
        margin: "60px 0 0 0px"
      }
    });
    name_div = new_dom_element({
      parentNode: line_div,
      nodeName: "div",
      txt: " email : ",
      style: {
        cssFloat: "left",
        height: 30,
        width: 100,
        margin: "10px 0 0 10px"
      }
    });
    value_div = new_dom_element({
      parentNode: line_div,
      nodeName: "input",
      id: "share_email_input",
      style: {
        cssFloat: "left",
        height: 30,
        width: 400,
        margin: "5px 0 0 0px",
        fontWeight: "bold"
      }
    });
    link_modifie_informations = new_dom_element({
      parentNode: this.share_user_information_div,
      nodeName: "button",
      txt: "Share",
      className: "user_line",
      style: {
        height: 40,
        width: 100,
        border: "none",
        margin: "15px 60px 0 0",
        cssFloat: "right",
        fontSize: "18px",
        color: "#262626",
        cursor: "pointer",
        background: "#4dbce9",
        onmousedown: (function(_this) {
          return function(evt) {};
        })(this)
      }
    });
    return p = new_popup("Share: " + name_folder, {
      event: evt,
      child: this.popup_share_div,
      top_x: Pleft,
      top_y: Ptop,
      width: Pwidth,
      height: Pheight,
      background: "#262626",
      onclose: (function(_this) {
        return function() {
          return _this.onPopupClose();
        };
      })(this)
    });
  };

  ModelEditorItem_Project.prototype.onPopupClose = function() {
    document.onkeydown = void 0;
    return this.clear_page(this.popup_share_div);
  };

  ModelEditorItem_Project.prototype.clear_page = function(div_to_clear) {
    var results;
    results = [];
    while (div_to_clear.firstChild != null) {
      results.push(div_to_clear.removeChild(div_to_clear.firstChild));
    }
    return results;
  };

  ModelEditorItem_Project.add_action = function(model_type, fun) {
    if (ModelEditorItem_Directory._action_list[model_type] == null) {
      ModelEditorItem_Directory._action_list[model_type] = [];
    }
    return ModelEditorItem_Directory._action_list[model_type].push(fun);
  };

  return ModelEditorItem_Project;

})(ModelEditorItem);
// Generated by CoffeeScript 1.11.1
var GraphView,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

GraphView = (function(superClass) {
  extend(GraphView, superClass);

  function GraphView(el, model, params) {
    this.el = el;
    this.model = model;
    this.params = params;
    GraphView.__super__.constructor.call(this, this.model);
  }

  GraphView.prototype.onchange = function() {
    var data, root;
    if (this.model.has_been_modified) {
      data = [];
      this.tojson(data, this.model);
      root = data[0];
      return this.update_tree(root);
    }
  };

  GraphView.prototype.tojson = function(d, m) {
    var child, i, len, ref, results;
    if (m._children.length !== 0) {
      d.push({
        "name": m._name.get(),
        "children": []
      });
      ref = m._children;
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        child = ref[i];
        results.push(this.tojson(d[d.length - 1]["children"], child));
      }
      return results;
    } else {
      return d.push({
        "name": m._name.get()
      });
    }
  };

  GraphView.prototype.update_tree = function(root) {
    var _this, diagonal, height, ico_rotate, ico_zoom_in, links, margin, popup_toolbar, rotateGraph, width, zoomGraph;
    _this = this;
    this.style = {
      button: {
        height: 15,
        marginRight: 10
      }
    };
    margin = {
      top: 20,
      right: 20,
      bottom: 20,
      left: 20
    };
    width = this.params.width - margin.right - margin.left;
    height = this.params.height - margin.top - margin.bottom;
    this.el.innerHTML = "";
    popup_toolbar = new_dom_element({
      className: "popup_toolbar",
      parentNode: this.el,
      style: {
        color: "#000"
      }
    });
    ico_zoom_in = new_dom_element({
      parentNode: popup_toolbar,
      nodeName: "img",
      alt: "Zoom In",
      title: "Zoom In",
      src: "data:image/png;base64,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",
      className: "graph_icons",
      style: {
        height: _this.style.button.height,
        marginRight: _this.style.button.marginRight
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return zoomGraph(0.05);
        };
      })(this)
    });
    ico_zoom_in = new_dom_element({
      parentNode: popup_toolbar,
      nodeName: "img",
      alt: "Zoom Out",
      title: "Zoom Out",
      src: "data:image/png;base64,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",
      className: "graph_icons",
      style: {
        height: _this.style.button.height,
        marginRight: _this.style.button.marginRight
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return zoomGraph(-0.05);
        };
      })(this)
    });
    ico_rotate = new_dom_element({
      parentNode: popup_toolbar,
      nodeName: "img",
      alt: "Rotate",
      title: "Rotate",
      src: "data:image/png;base64,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",
      className: "graph_icons",
      style: {
        height: _this.style.button.height,
        marginRight: _this.style.button.marginRight
      },
      onmousedown: (function(_this) {
        return function(evt) {
          return rotateGraph();
        };
      })(this)
    });
    this.scale = 0.8;
    this.orientation = -1;
    this.canvas = d3.select('svg').remove();
    this.canvas = d3.select(this.el).append('svg').attr('width', width + margin.right + margin.left).attr('height', height + margin.top + margin.bottom).append('g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');
    zoomGraph = function(val) {
      _this.scale += val;
      return _this.canvas.attr('transform', 'translate(' + margin.left + ',' + margin.top + ') scale(' + _this.scale + ')');
    };
    rotateGraph = function() {
      _this.orientation *= -1;
      _this.canvas.selectAll('.link').attr('d', d3.svg.diagonal().projection(function(d) {
        if (_this.orientation > 0) {
          return [d.x, d.y];
        } else {
          return [d.y, d.x];
        }
      }));
      return _this.node.attr('transform', function(d) {
        if (_this.orientation > 0) {
          return 'translate(' + d.x + ',' + d.y + ')';
        } else {
          return 'translate(' + d.y + ',' + d.x + ')';
        }
      });
    };
    this.tree = d3.layout.tree().size([height, width]);
    this.nodes = this.tree.nodes(root);
    links = this.tree.links(this.nodes);
    this.node = this.canvas.selectAll('node').data(this.nodes).enter().append('g').attr('class', 'node').attr('transform', function(d) {
      return 'translate(' + d.y + ',' + d.x + ')';
    });
    this.node.append('circle').attr('r', 5).attr('fill', 'steelblue');
    this.node.append('text').attr('dy', '20px').text(function(d) {
      return d.name;
    });
    diagonal = d3.svg.diagonal().projection(function(d) {
      return [d.y, d.x];
    });
    return this.canvas.selectAll('.link').data(links).enter().append('path').attr('class', 'link').attr('fill', 'none').attr('stroke', '#ADADAD').attr('d', diagonal);
  };

  return GraphView;

})(View);
// Generated by CoffeeScript 1.11.1
var ContextBar,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ContextBar = (function(superClass) {
  extend(ContextBar, superClass);

  function ContextBar(el, tree_app, params) {
    this.el = el;
    this.tree_app = tree_app;
    if (params == null) {
      params = {};
    }
    this.create_list_menu = bind(this.create_list_menu, this);
    this.app_data = this.tree_app.data;
    ContextBar.__super__.constructor.call(this, this.app_data);
    this.icon_container = new_dom_element({
      nodeName: "div",
      parentNode: this.el
    });
    this.run_compute_action = {
      txt: "run",
      fa: "fa-play",
      loc: true,
      fun: (function(_this) {
        return function(evt, app) {
          var item, items, l, len, path_item, results;
          items = app.data.selected_tree_items;
          results = [];
          for (l = 0, len = items.length; l < len; l++) {
            path_item = items[l];
            item = path_item[path_item.length - 1];
            if (!item._computation_mode.get() && !item._computation_state.get()) {
              results.push(item.do_it());
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    };
    this.stop_compute_action = {
      txt: "stop",
      fa: "fa-stop",
      loc: true,
      fun: (function(_this) {
        return function(evt, app) {
          var item, items, l, len, path_item, results;
          items = app.data.selected_tree_items;
          results = [];
          for (l = 0, len = items.length; l < len; l++) {
            path_item = items[l];
            item = path_item[path_item.length - 1];
            if (item._computation_state.get() || item._pending_state.get() || item._processing_state.get() || item._finish_state.get()) {
              results.push(item.stop_it());
            } else {
              results.push(void 0);
            }
          }
          return results;
        };
      })(this)
    };
  }

  ContextBar.prototype.onchange = function() {
    var act, block, container_icon, context_actions, item, j, l, len, len1, len2, len3, m, n, o, path, processing, ref, ref1, results, suppl_act;
    context_actions = new Lst;
    processing = false;
    if (this.app_data.selected_tree_items.has_been_directly_modified) {
      ref = this.app_data.selected_tree_items;
      for (l = 0, len = ref.length; l < len; l++) {
        path = ref[l];
        item = path[path.length - 1];
        if (item instanceof TreeItem_Computable) {
          if (!item._computation_mode.get() && !item._computation_state.get()) {
            context_actions.push(this.run_compute_action);
          } else if (item._computation_state.get() || item._pending_state.get() || item._processing_state.get() || item._finish_state.get()) {
            processing = true;
            context_actions.push(this.stop_compute_action);
          }
        }
        suppl_act = item.display_context_actions();
        for (m = 0, len1 = suppl_act.length; m < len1; m++) {
          act = suppl_act[m];
          if (act instanceof TreeAppModule) {
            (function(_this) {
              return (function(act) {
                var in_act, len2, n, ref1, results;
                ref1 = act.actions;
                results = [];
                for (n = 0, len2 = ref1.length; n < len2; n++) {
                  in_act = ref1[n];
                  results.push((function(in_act) {
                    if (!(context_actions.contains(in_act))) {
                      return context_actions.push(in_act);
                    }
                  })(in_act));
                }
                return results;
              });
            })(this)(act);
          } else {
            if (!(context_actions.contains(act))) {
              context_actions.push(act);
            }
          }
        }
        if (item._context_actions != null) {
          ref1 = item._context_actions;
          for (n = 0, len2 = ref1.length; n < len2; n++) {
            act = ref1[n];
            if (act instanceof TreeAppModule) {
              (function(_this) {
                return (function(act) {
                  var in_act, len3, o, ref2, results;
                  ref2 = act.actions;
                  results = [];
                  for (o = 0, len3 = ref2.length; o < len3; o++) {
                    in_act = ref2[o];
                    results.push((function(in_act) {
                      if (!(context_actions.contains(in_act))) {
                        return context_actions.push(in_act);
                      }
                    })(in_act));
                  }
                  return results;
                });
              })(this)(act);
            } else {
              if (!(context_actions.contains(act))) {
                context_actions.push(act);
              }
            }
          }
        }
      }
    }
    this.el.appendChild(this.icon_container);
    while (this.icon_container.firstChild != null) {
      this.icon_container.removeChild(this.icon_container.firstChild);
    }
    block = new_dom_element({
      parentNode: this.icon_container,
      nodeName: "span"
    });
    if (processing) {
      container_icon = new_dom_element({
        parentNode: block,
        nodeName: "span",
        className: "fa fa-cog fa-spin fa-3x fa-fw",
        style: {
          display: "inline-block",
          textAlign: "center",
          width: "100%",
          margin: "10px 0 0 0"
        }
      });
    }
    results = [];
    for (j = o = 0, len3 = context_actions.length; o < len3; j = ++o) {
      act = context_actions[j];
      if (act.vis !== false) {
        results.push(this._select_icon_type_rec(act, block, 1));
      }
    }
    return results;
  };

  ContextBar.prototype.draw_item = function(act, parent, key, size, prf) {
    return (function(_this) {
      return function(act) {
        var container_icon, de, faClass;
        if ((prf != null) && prf === "list") {
          container_icon = new_dom_element({
            parentNode: parent,
            nodeName: "img",
            alt: act.txt,
            title: act.txt + key,
            src: act.ico,
            style: {
              height: 30
            },
            onmousedown: function(evt) {
              act.fun(evt, _this.tree_app);
              return parent.classList.toggle("inline");
            }
          });
          new_dom_element({
            parentNode: parent,
            nodeName: "br"
          });
        } else if (act.txtico) {
          container_icon = new_dom_element({
            parentNode: parent,
            nodeName: "span",
            className: "ContextModule",
            alt: act.txt,
            title: act.txt + key,
            onclick: function(evt) {
              return act.fun(evt, _this.tree_app);
            }
          });
          de = new_dom_element({
            nodeName: "div",
            className: "text_icon",
            parentNode: container_icon,
            txt: act.txtico
          });
        } else if (act.fa) {
          faClass = "fa " + act.fa + " fa-2x";
          container_icon = new_dom_element({
            parentNode: parent,
            nodeName: "span",
            className: "ContextModule",
            alt: act.txt,
            title: act.txt + key,
            onclick: function(evt) {
              return act.fun(evt, _this.tree_app);
            }
          });
          de = new_dom_element({
            nodeName: "i",
            className: faClass,
            parentNode: container_icon
          });
        } else {
          container_icon = new_dom_element({
            parentNode: parent,
            nodeName: "span",
            className: "ContextModule"
          });
          de = new_dom_element({
            nodeName: "img",
            src: act.ico,
            parentNode: container_icon,
            alt: act.txt,
            title: act.txt,
            style: {
              height: 30
            },
            onclick: function(evt) {
              return act.fun(evt, _this.tree_app);
            }
          });
        }
        return container_icon;
      };
    })(this)(act);
  };

  ContextBar.prototype.display_child_menu_container = function(evt, val) {
    var containers, menu_container;
    if (val === 1) {
      containers = document.getElementsByClassName("menu_container");
      menu_container = containers[containers.length - 1];
      menu_container.classList.add("block");
    }
    if (val === 0) {
      containers = document.getElementsByClassName("menu_container");
      menu_container = containers[containers.length - 1];
      return menu_container.classList.remove("block");
    }
  };

  ContextBar.prototype.create_list_menu = function(act, parent, key, size) {
    var arrow, arrow_container, child_container, click_container, faClass;
    click_container = new_dom_element({
      parentNode: parent,
      nodeName: "span",
      className: "ContextModule"
    });
    if (act.fa) {
      faClass = "fa " + act.fa + " fa-2x";
      new_dom_element({
        parentNode: click_container,
        nodeName: "i",
        alt: act.txt,
        title: act.txt + key,
        className: faClass,
        onmousedown: (function(_this) {
          return function(evt) {
            var ref;
            return (ref = act.sub.act[0]) != null ? ref.fun(evt, _this.tree_app) : void 0;
          };
        })(this)
      });
    } else if ((act.ico != null) && act.ico.length > 0) {
      new_dom_element({
        parentNode: click_container,
        nodeName: "img",
        alt: act.txt,
        title: act.txt + key,
        src: act.ico,
        className: "parent_list_icon",
        style: {
          height: 30
        },
        onmousedown: (function(_this) {
          return function(evt) {
            var ref;
            return (ref = act.sub.act[0]) != null ? ref.fun(evt, _this.tree_app) : void 0;
          };
        })(this)
      });
    }
    arrow_container = new_dom_element({
      parentNode: click_container,
      nodeName: "span",
      className: "arrow_container",
      onmousedown: (function(_this) {
        return function(evt) {
          return child_container.classList.toggle("block");
        };
      })(this)
    });
    arrow = new_dom_element({
      parentNode: arrow_container,
      nodeName: "i",
      className: "fa fa-caret-down fa-lg",
      alt: ""
    });
    child_container = new_dom_element({
      parentNode: parent,
      nodeName: "span",
      className: "container_hidden_icon",
      id: "id_hidden_icon"
    });
    return child_container;
  };

  ContextBar.prototype._select_icon_type_rec = function(act, parent, size, prf) {
    var ac, container, i, key, l, len, must_draw_item, ref, ref1;
    if (prf == null) {
      prf = '';
    }
    key = this.key_as_string(act);
    if ((act.sub != null) && (act.sub.prf != null) && (act.sub.act != null)) {
      must_draw_item = false;
      act.fun = function(evt, app) {
        return act.sub.act[0].fun(evt, app);
      };
      container = this.create_list_menu(act, parent, key, size);
    } else {
      container = this.draw_item(act, parent, key, size, prf);
    }
    if (((ref = act.sub) != null ? ref.act : void 0) != null) {
      ref1 = act.sub.act;
      for (i = l = 0, len = ref1.length; l < len; i = ++l) {
        ac = ref1[i];
        this._select_icon_type_rec(ac, container, size, act.sub.prf);
      }
      return true;
    }
    return false;
  };

  ContextBar.prototype.key_as_string = function(act) {
    var i, k, key, l, len, ref;
    key = '';
    if (act.key != null) {
      key = ' (';
      ref = act.key;
      for (i = l = 0, len = ref.length; l < len; i = ++l) {
        k = ref[i];
        if (i >= 1) {
          key += ' or ';
        }
        key += k;
      }
      key += ')';
    }
    return key;
  };

  return ContextBar;

})(View);
// Generated by CoffeeScript 1.11.1
var TreeApp,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeApp = (function(superClass) {
  extend(TreeApp, superClass);

  function TreeApp(bel, data1, withLoginBar) {
    this.bel = bel;
    this.data = data1 != null ? data1 : new TreeAppData;
    if (withLoginBar == null) {
      withLoginBar = true;
    }
    TreeApp.__super__.constructor.call(this, this.data);
    this.layouts = {};
    this.cur_session_model_id = -1;
    this.active_key = new Bool(true);
    this.undo_manager = new UndoManager(this.data);
    this.he = new_dom_element({
      parentNode: this.bel,
      style: {
        position: "absolute",
        left: 0,
        right: 0,
        top: "31px",
        height: "30px"
      }
    });
    this.el = new_dom_element({
      parentNode: this.bel,
      id: "main_window",
      style: {
        position: "absolute",
        left: 0,
        right: 0,
        top: "61px",
        bottom: 0
      }
    });
    if (!withLoginBar) {
      this.he.style.top = '0px';
      this.el.style.top = '31px';
    }
    this.icobar = new IcoBar(this.he, this, {
      allow_sub: false
    });
    document.addEventListener("keydown", ((function(_this) {
      return function(evt) {
        return _this._on_key_down(evt);
      };
    })(this)), true);
    this.msg_container = new_dom_element({
      nodeName: "div",
      id: "msg_container",
      parentNode: this.el,
      txt: ""
    });
  }

  TreeApp.prototype.onchange = function() {
    var d, el, i, j, len, len1, message, ref, ref1, ref2, ref3, ref4, session;
    if (((ref = this.treeview) != null ? ref.flat : void 0) != null) {
      ref1 = this.treeview.flat;
      for (i = 0, len = ref1.length; i < len; i++) {
        el = ref1[i];
        if (((ref2 = el.item) != null ? ref2._messages : void 0) != null) {
          if (el.item._messages.has_been_modified()) {
            ref3 = el.item._messages;
            for (j = 0, len1 = ref3.length; j < len1; j++) {
              message = ref3[j];
              if (message.has_been_modified()) {
                (function(_this) {
                  return (function(message) {
                    var br, msg_box, msg_content;
                    msg_box = new_dom_element({
                      nodeName: "span",
                      id: "msg_box",
                      parentNode: _this.msg_container
                    });
                    msg_content = new_dom_element({
                      nodeName: "span",
                      parentNode: msg_box,
                      txt: message.provenance + " : " + message.title
                    });
                    br = new_dom_element({
                      nodeName: "br",
                      parentNode: msg_box
                    });
                    msg_content.classList.add(message.type);
                    return setTimeout((function() {
                      return _this.msg_container.removeChild(msg_box);
                    }), 5000);
                  });
                })(this)(message);
              }
            }
          }
        }
      }
    }
    if (this.data.selected_tree_items.has_been_modified()) {
      session = this.data.selected_session();
      if (session != null) {
        if (this.layouts[session.model_id] == null) {
          this.layouts[session.model_id] = this._new_LayoutManager(session);
        }
        if (this.cur_session_model_id !== session.model_id) {
          if ((ref4 = this.layouts[this.cur_session_model_id]) != null) {
            ref4.hide();
          }
          this.layouts[session.model_id].show();
          this.cur_session_model_id = session.model_id;
        }
      }
    }
    d = this.data.selected_display_settings();
    if (d._layout.has_been_modified()) {
      return this.data.update_associated_layout_data(d);
    }
  };

  TreeApp.prototype.selected_canvas_inst = function() {
    var i, layout, len, panel_id, ref, results, session;
    session = this.data.selected_session();
    layout = this.layouts[session.model_id];
    ref = this.data.selected_canvas_pan;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      panel_id = ref[i];
      if (layout._pan_vs_id[panel_id] != null) {
        results.push(layout._pan_vs_id[panel_id]);
      }
    }
    return results;
  };

  TreeApp.prototype.all_canvas_inst = function() {
    var ch, cmpi, key, layout, ref, session;
    session = this.data.selected_session();
    layout = this.layouts[session.model_id];
    cmpi = [];
    ref = layout._pan_vs_id;
    for (ch in ref) {
      key = ref[ch];
      if (key instanceof CanvasManagerPanelInstance) {
        cmpi.push(key);
      }
    }
    return cmpi;
  };

  TreeApp.prototype.fit = function(anim) {
    var i, inst, len, ref, results;
    if (anim == null) {
      anim = 1;
    }
    ref = this.selected_canvas_inst();
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      inst = ref[i];
      results.push(inst.cm.fit(anim));
    }
    return results;
  };

  TreeApp.prototype._new_LayoutManager = function(session) {
    var display_settings, res;
    display_settings = session._children.detect(function(x) {
      return x instanceof DisplaySettingsItem;
    });
    res = new LayoutManager(this.el, display_settings._layout);
    res.new_panel_instance = (function(_this) {
      return function(data) {
        return _this._new_panel_instance(display_settings, data);
      };
    })(this);
    return res;
  };

  TreeApp.prototype._new_panel_instance = function(display_settings, data) {
    var c, i, id, j, l, len, len1, len2, ref, ref1, ref2, res, tree_item, view_item;
    if (data.panel_id === "IcoBar") {
      res = new LayoutManagerPanelInstance(this.el, data);
      res.div.className = "PanelInstanceIcoBar";
      this.icobar = new IcoBar(res.div, this, {
        allow_sub: false
      });
      return res;
    }
    if (data.panel_id === "ContextBar") {
      res = new LayoutManagerPanelInstance(this.el, data);
      res.div.className = "PanelInstanceContextBar";
      new ContextBar(res.div, this);
      return res;
    }
    if (data.panel_id === "TreeView") {
      res = new LayoutManagerPanelInstance(this.el, data, "Scene");
      res.div.className = "PanelInstanceTreeView";
      this.treeview = new TreeView(res.div, this.data.tree_items, this.data.selected_tree_items, this.data.visible_tree_items, this.data.closed_tree_items, this.data.last_canvas_pan);
      res.treeview = this.treeview;
      res.div.onmousedown = (function(_this) {
        return function() {
          _this.data.focus.set(_this.treeview.process_id);
          return true;
        };
      })(this);
      return res;
    }
    if (data.panel_id === "EditView") {
      res = new LayoutManagerPanelInstance(this.el, data, "Inspector");
      res.div.className = "PanelInstanceEditView";
      new EditView(res.div, this.data, this.undo_manager);
      return res;
    }
    if (data.panel_id === "MapView") {
      res = new MapManagerPanelInstance(this.el, this.data, view_item, this.undo_manager);
      return res;
    }
    view_item = void 0;
    ref = display_settings._children;
    for (i = 0, len = ref.length; i < len; i++) {
      c = ref[i];
      if (c._panel_id.get() === data.panel_id) {
        view_item = c;
        break;
      }
    }
    if (view_item == null) {
      view_item = new ViewItem(this.data, data.panel_id, this._next_view_item_cam);
      if (this._next_view_item_child) {
        view_item.add_child(this._next_view_item_child);
      }
      display_settings._children.push(view_item);
      delete this._next_view_item_cam;
    }
    bind(this.data.selected_canvas_pan, (function(_this) {
      return function() {
        if (_this.data.selected_canvas_pan.contains(data.panel_id)) {
          return view_item._name_class.set("SelectedViewItem");
        } else {
          return view_item._name_class.set("UnselectedViewItem");
        }
      };
    })(this));
    if (this.data.visible_tree_items[data.panel_id] == null) {
      this.data.visible_tree_items.add_attr(data.panel_id, new Lst([view_item]));
      ref1 = this.data.panel_id_list();
      for (j = 0, len1 = ref1.length; j < len1; j++) {
        id = ref1[j];
        if (!(this.data.visible_tree_items[id].length >= 2)) {
          continue;
        }
        ref2 = this.data.visible_tree_items[id];
        for (l = 0, len2 = ref2.length; l < len2; l++) {
          tree_item = ref2[l];
          if (!(tree_item instanceof ViewItem)) {
            this.data.visible_tree_items[data.panel_id].push(tree_item);
          }
        }
        break;
      }
    } else {
      this.data.visible_tree_items[data.panel_id].push(view_item);
    }
    this.data.selected_canvas_pan.clear();
    this.data.selected_canvas_pan.push(data.panel_id);
    this.data.last_canvas_pan.set(data.panel_id);
    this.undo_manager.snapshot();
    return new CanvasManagerPanelInstance(this.el, this.data, view_item, this.undo_manager);
  };

  TreeApp.prototype._on_key_down = function(evt) {
    var cur_key, i, len, m, ref, ref1, results, special_keys;
    if (this.active_key.get()) {
      if ((16 <= (ref = evt.keyCode) && ref <= 18)) {
        return;
      }
      cur_key = "";
      if (evt.ctrlKey) {
        cur_key += "Ctrl+";
      }
      if (evt.shiftKey) {
        cur_key += "Shift+";
      }
      if (evt.altKey) {
        cur_key += "Alt+";
      }
      special_keys = {
        8: "BackSpace",
        9: "Tab",
        13: "Enter",
        19: "Pause",
        20: "CapsLock",
        27: "Esc",
        32: "Space",
        33: "PageUp",
        34: "PageDown",
        35: "End",
        36: "Home",
        37: "LeftArrow",
        38: "UpArrow",
        39: "RightArrow",
        40: "DownArrow",
        45: "Insert",
        46: "Del",
        112: "F1",
        113: "F2",
        114: "F3",
        115: "F4",
        116: "F5",
        117: "F6",
        118: "F7",
        119: "F8",
        120: "F9",
        121: "F10",
        122: "F11",
        123: "F12",
        144: "NumLock",
        145: "ScrollLock"
      };
      cur_key += special_keys[evt.keyCode] || String.fromCharCode(evt.keyCode).toUpperCase();
      ref1 = this.data.modules;
      results = [];
      for (i = 0, len = ref1.length; i < len; i++) {
        m = ref1[i];
        results.push(this._on_key_down_rec(m.actions, cur_key, evt));
      }
      return results;
    }
  };

  TreeApp.prototype._on_key_down_rec = function(actions, cur_key, evt) {
    var a, i, j, k, len, len1, ref, ref1;
    for (i = 0, len = actions.length; i < len; i++) {
      a = actions[i];
      if ((a.key != null) && ((a.ina == null) || !a.ina(this))) {
        ref = a.key;
        for (j = 0, len1 = ref.length; j < len1; j++) {
          k = ref[j];
          if (k === cur_key) {
            if (typeof a.fun === "function") {
              a.fun(evt, this);
            }
            this._cancel_natural_hotkeys(evt);
            return true;
          }
        }
      }
      if (((ref1 = a.sub) != null ? ref1.act : void 0) != null) {
        this._on_key_down_rec(a.sub.act, cur_key, evt);
      }
    }
    return false;
  };

  TreeApp.prototype._cancel_natural_hotkeys = function(evt) {
    if (!evt) {
      evt = window.event;
    }
    evt.cancelBubble = true;
    if (typeof evt.stopPropagation === "function") {
      evt.stopPropagation();
    }
    if (typeof evt.preventDefault === "function") {
      evt.preventDefault();
    }
    return false;
  };

  return TreeApp;

})(View);
// Generated by CoffeeScript 1.11.1
var TreeView_ModuleView,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

TreeView_ModuleView = (function(superClass) {
  extend(TreeView_ModuleView, superClass);

  function TreeView_ModuleView(el, roots, selected, visible, closed, visibility_context, tree_app) {
    this.el = el;
    this.roots = roots;
    this.selected = selected != null ? selected : new Lst;
    this.visible = visible != null ? visible : new Model;
    this.closed = closed != null ? closed : new Lst;
    this.visibility_context = visibility_context;
    this.tree_app = tree_app;
    TreeView_ModuleView.__super__.constructor.call(this, [this.roots, this.selected, this.visible, this.closed, this.visibility_context]);
    this.treeview = new TreeView(this.el, this.roots, this.selected, this.visible, this.closed, this.visibility_context);
  }

  return TreeView_ModuleView;

})(View);
// Generated by CoffeeScript 1.11.1
var IcoBar,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

IcoBar = (function(superClass) {
  extend(IcoBar, superClass);

  function IcoBar(el, tree_app, params) {
    var key, val;
    this.el = el;
    this.tree_app = tree_app;
    if (params == null) {
      params = {};
    }
    this.create_list_menu = bind(this.create_list_menu, this);
    this.modules = this.tree_app.data.modules;
    IcoBar.__super__.constructor.call(this, this.modules);
    this.app_data = this.tree_app.data;
    IcoBar.__super__.constructor.call(this, this.app_data);
    this.tree_app.data.focus.bind(this);
    this.loc = false;
    for (key in params) {
      val = params[key];
      this[key] = val;
    }
    if (this.loc === false) {
      this.disp_top = 0;
      this.disp_left = 0;
      this.height = 0;
      this.height_ico = 24;
      this.div = new_dom_element({
        className: "IcoBar",
        style: {
          position: "absolute",
          right: 0
        }
      });
    }
    this.icon_container = new_dom_element({
      nodeName: "div",
      className: "FooterTreeView",
      parentNode: this.el
    });
    this.init();
  }

  IcoBar.prototype.init = function() {
    var context_modules, item, l, len, len1, len2, m, module, n, o, path, ref, ref1, results;
    context_modules = new Lst;
    context_modules.set(this.app_data.modules);
    ref = this.app_data.selected_tree_items;
    for (l = 0, len = ref.length; l < len; l++) {
      path = ref[l];
      item = path[path.length - 1];
      if (item._context_modules != null) {
        ref1 = item._context_modules;
        for (n = 0, len1 = ref1.length; n < len1; n++) {
          module = ref1[n];
          if (!(context_modules.contains(module))) {
            context_modules.push(module);
          }
        }
      }
    }
    this._render_loc_actions(this.tree_app);
    if (this.loc === true) {
      return;
    }
    this.el.appendChild(this.div);
    this.div.style.top = this.disp_top;
    this.div.style.left = this.disp_left;
    this.hidden_ico = false;
    while (this.div.firstChild != null) {
      this.div.removeChild(this.div.firstChild);
    }
    results = [];
    for (o = 0, len2 = context_modules.length; o < len2; o++) {
      m = context_modules[o];
      if ((m.visible != null) && m.visible === false) {
        continue;
      }
      results.push((function(_this) {
        return function(m) {
          var act, big_icon, block, fn, icon_bot, icon_top, j, len3, module_title, p, parent, ref2, results1;
          block = new_dom_element({
            parentNode: _this.div,
            nodeName: "span",
            className: "module"
          });
          if (m.right != null) {
            block.style.cssFloat = "right";
          }
          parent = icon_top = icon_bot = big_icon = void 0;
          ref2 = m.actions;
          fn = function(act) {
            var container_icon, siz;
            siz = act.siz || 1;
            if (act.siz === 1) {
              if (parent === void 0 || parent === big_icon) {
                container_icon = new_dom_element({
                  parentNode: block,
                  nodeName: "span",
                  className: "container_icon"
                });
                icon_top = new_dom_element({
                  parentNode: container_icon,
                  nodeName: "span",
                  className: "icon_top_span"
                });
                new_dom_element({
                  parentNode: container_icon,
                  nodeName: "br"
                });
                icon_bot = new_dom_element({
                  parentNode: container_icon,
                  nodeName: "span",
                  className: "icon_bot_span"
                });
                parent = icon_top;
              }
            } else {
              if (parent === void 0) {
                parent = big_icon;
              }
              if (parent === icon_top || parent === icon_bot) {
                container_icon = new_dom_element({
                  parentNode: block,
                  nodeName: "span",
                  className: "container_icon"
                });
                big_icon = new_dom_element({
                  parentNode: container_icon,
                  nodeName: "span",
                  className: "big_icon_span"
                });
                parent = big_icon;
              }
            }
            _this._select_icon_type_rec(act, parent, siz);
            if (act.siz === 1 && parent !== big_icon && act.ord === void 0 || act.ord === true) {
              if (parent === icon_top) {
                return parent = icon_bot;
              } else {
                return parent = icon_top;
              }
            }
          };
          results1 = [];
          for (j = p = 0, len3 = ref2.length; p < len3; j = ++p) {
            act = ref2[j];
            if (!(act.vis !== false && act.loc !== true)) {
              continue;
            }
            fn(act);
            results1.push(module_title = new_dom_element({
              parentNode: block,
              nodeName: "div",
              className: "module_title",
              txt: m.name
            }));
          }
          return results1;
        };
      })(this)(m));
    }
    return results;
  };

  IcoBar.prototype.key_as_string = function(act) {
    var i, k, key, l, len, ref;
    key = '';
    if (act.key != null) {
      key = ' (';
      ref = act.key;
      for (i = l = 0, len = ref.length; l < len; i = ++l) {
        k = ref[i];
        if (i >= 1) {
          key += ' or ';
        }
        key += k;
      }
      key += ')';
    }
    return key;
  };

  IcoBar.prototype.display_child_menu_container = function(evt, val) {
    var containers, menu_container;
    if (val === 1) {
      containers = document.getElementsByClassName("menu_container");
      menu_container = containers[containers.length - 1];
      menu_container.classList.add("block");
    }
    if (val === 0) {
      containers = document.getElementsByClassName("menu_container");
      menu_container = containers[containers.length - 1];
      return menu_container.classList.remove("block");
    }
  };

  IcoBar.prototype.draw_item = function(act, parent, key, size, prf) {
    var arr, c, editor, hotkey, ref, s, t;
    if (act.vis !== false) {
      if ((prf != null) && prf === "menu") {
        if (act.mod != null) {
          editor = new_model_editor({
            el: parent,
            model: act.mod(this.tree_app),
            item_width: 85
          });
          s = parent;
        } else {
          if (((ref = act.sub) != null ? ref.act : void 0) != null) {
            c = new_dom_element({
              parentNode: parent,
              nodeName: "div",
              className: "elem_container_parent",
              txt: act.txt,
              title: act.txt + key,
              onmouseover: (function(_this) {
                return function(evt) {
                  return _this.display_child_menu_container(evt, 1);
                };
              })(this),
              onmouseout: (function(_this) {
                return function(evt) {
                  return _this.display_child_menu_container(evt, 0);
                };
              })(this)
            });
            arr = new_dom_element({
              parentNode: c,
              nodeName: "img",
              className: "menu_img_arrow",
              src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAJCAYAAADpeqZqAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90CGQ0RLrJyU6gAAABLSURBVBjTY/z//z8DqYCFgYGB4evnR0Tr5OaVY2SCMYjVwMDAwMCELkBIA4omfBrRxZkIKcBq0P///7HiL58e/sclx0hOkDMxkAEAsgUzZcOBlXMAAAAASUVORK5CYII=",
              alt: ""
            });
          } else {
            s = new_dom_element({
              parentNode: parent,
              nodeName: "div",
              className: "elem_container",
              title: act.txt + key,
              onmousedown: (function(_this) {
                return function(evt) {
                  act.fun(evt, _this.tree_app);
                  return parent.classList.toggle("block");
                };
              })(this)
            });
            t = new_dom_element({
              parentNode: s,
              nodeName: "span",
              txt: act.txt
            });
            hotkey = new_dom_element({
              parentNode: s,
              nodeName: "span",
              className: "elem_container_key",
              txt: key
            });
          }
        }
      } else if ((prf != null) && prf === "list") {
        s = new_dom_element({
          parentNode: parent,
          nodeName: "img",
          alt: act.txt,
          title: act.txt + key,
          src: act.ico,
          style: {
            height: this.height_ico * size
          },
          onmousedown: (function(_this) {
            return function(evt) {
              act.fun(evt, _this.tree_app);
              return parent.classList.toggle("inline");
            };
          })(this)
        });
        new_dom_element({
          parentNode: parent,
          nodeName: "br"
        });
      } else if ((act.ico != null) && act.ico.length > 0) {
        s = new_dom_element({
          parentNode: parent,
          nodeName: "img",
          alt: act.txt,
          title: act.txt + key,
          src: act.ico,
          style: {
            height: this.height_ico * size,
            cursor: "pointer"
          },
          onmousedown: (function(_this) {
            return function(evt) {
              return act.fun(evt, _this.tree_app);
            };
          })(this)
        });
      } else if (act.mod != null) {
        editor = new_model_editor({
          el: parent,
          model: act.mod(this.tree_app),
          item_width: 85
        });
        s = parent;
      } else if (act.txt != null) {
        s = new_dom_element({
          parentNode: parent,
          nodeName: "span",
          txt: act.txt,
          title: act.txt + key,
          style: {
            height: this.height_ico * size,
            cursor: "pointer"
          },
          onmousedown: (function(_this) {
            return function(evt) {
              return act.fun(evt, _this.tree_app);
            };
          })(this)
        });
      }
    }
    return s;
  };

  IcoBar.prototype.create_hierarchical_menu = function(sub, parent, key) {
    var menu_container;
    if (parent.className === "menu_container") {
      menu_container = new_dom_element({
        parentNode: parent,
        nodeName: "div",
        className: "menu_container",
        style: {
          left: "100%"
        },
        onmouseover: (function(_this) {
          return function(evt) {
            return _this.display_child_menu_container(evt, 1);
          };
        })(this),
        onmouseout: (function(_this) {
          return function(evt) {
            return _this.display_child_menu_container(evt, 0);
          };
        })(this)
      });
    } else {
      menu_container = new_dom_element({
        parentNode: parent,
        nodeName: "div",
        className: "menu_container",
        style: {
          top: "70%"
        }
      });
    }
    return menu_container;
  };

  IcoBar.prototype.create_list_menu = function(act, parent, key, size) {
    var arrow, arrow_container, child_container, click_container, editor;
    click_container = new_dom_element({
      parentNode: parent,
      nodeName: "span",
      className: "click_container"
    });
    if ((act.ico != null) && act.ico.length > 0) {
      new_dom_element({
        parentNode: click_container,
        nodeName: "img",
        alt: act.txt,
        title: act.txt + key,
        src: act.ico,
        className: "parent_list_icon",
        style: {
          height: this.height_ico * size
        },
        onmousedown: (function(_this) {
          return function(evt) {
            var ref;
            return (ref = act.sub.act[0]) != null ? ref.fun(evt, _this.tree_app) : void 0;
          };
        })(this)
      });
    } else if (act.mod != null) {
      editor = new_model_editor({
        el: click_container,
        model: act.mod(this.tree_app),
        item_width: 85
      });
    } else if (act.txt != null) {
      new_dom_element({
        parentNode: click_container,
        nodeName: "span",
        txt: act.txt,
        title: act.txt + key,
        style: {
          height: this.height_ico * size
        },
        onmousedown: (function(_this) {
          return function(evt) {
            return act.fun(evt, _this.tree_app);
          };
        })(this)
      });
    }
    arrow_container = new_dom_element({
      parentNode: click_container,
      nodeName: "span",
      className: "arrow_container",
      onmousedown: (function(_this) {
        return function(evt) {
          return child_container.classList.toggle("inline");
        };
      })(this)
    });
    arrow = new_dom_element({
      parentNode: arrow_container,
      nodeName: "img",
      src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAJCAYAAADpeqZqAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90CGQ0RLrJyU6gAAABLSURBVBjTY/z//z8DqYCFgYGB4evnR0Tr5OaVY2SCMYjVwMDAwMCELkBIA4omfBrRxZkIKcBq0P///7HiL58e/sclx0hOkDMxkAEAsgUzZcOBlXMAAAAASUVORK5CYII=",
      alt: "",
      className: "arrow"
    });
    child_container = new_dom_element({
      parentNode: parent,
      nodeName: "span",
      className: "container_hidden_icon",
      id: "id_hidden_icon"
    });
    return child_container;
  };

  IcoBar.prototype._select_icon_type_rec = function(act, parent, size, prf) {
    var ac, container, i, key, l, len, must_draw_item, ref, ref1;
    if (prf == null) {
      prf = '';
    }
    key = this.key_as_string(act);
    if ((act.sub != null) && (act.sub.prf != null) && (act.sub.act != null)) {
      if (act.sub.prf === "list") {
        must_draw_item = false;
        act.fun = function(evt, app) {
          return act.sub.act[0].fun(evt, app);
        };
        container = this.create_list_menu(act, parent, key, size);
      } else if (act.sub.prf === "menu") {
        container = this.create_hierarchical_menu(act.sub, parent, key);
        must_draw_item = false;
        this.draw_item(act, parent, key, size, prf);
        act.fun = function(evt, app) {
          return container.classList.toggle("block");
        };
      }
    } else if (act.vis !== false && must_draw_item !== false) {
      container = this.draw_item(act, parent, key, size, prf);
    }
    if (((ref = act.sub) != null ? ref.act : void 0) != null) {
      ref1 = act.sub.act;
      for (i = l = 0, len = ref1.length; l < len; i = ++l) {
        ac = ref1[i];
        this._select_icon_type_rec(ac, container, size, act.sub.prf);
      }
      return true;
    }
    return false;
  };

  IcoBar.prototype._render_loc_actions = function(tree_app) {
    var l, len, m, ref, results;
    this.tree_app = tree_app;
    while (this.icon_container.firstChild != null) {
      this.icon_container.removeChild(this.icon_container.firstChild);
    }
    ref = this.modules;
    results = [];
    for (l = 0, len = ref.length; l < len; l++) {
      m = ref[l];
      results.push((function(_this) {
        return function(m) {
          var act, j, len1, n, ref1, results1;
          ref1 = m.actions;
          results1 = [];
          for (j = n = 0, len1 = ref1.length; n < len1; j = ++n) {
            act = ref1[j];
            if (act.loc === true) {
              results1.push((function(act) {
                var de;
                de = new_dom_element({
                  nodeName: "img",
                  src: act.ico,
                  className: "FooterTreeViewIcon",
                  parentNode: _this.icon_container,
                  alt: act.txt,
                  title: act.txt,
                  style: {
                    cursor: "pointer"
                  },
                  onclick: function(evt) {
                    return act.fun(evt, _this.tree_app);
                  }
                });
                if (_this.bnd && (act.bnd != null) && (act.vis != null)) {
                  return act.bnd(_this.tree_app.data).bind(function() {
                    if (act.vis(_this.tree_app)) {
                      return de.style.display = "none";
                    } else {
                      return de.style.display = "inline-block";
                    }
                  });
                } else if (!_this.bnd && (act.bnd != null)) {
                  return de.style.display = "none";
                }
              })(act));
            }
          }
          return results1;
        };
      })(this)(m));
    }
    return results;
  };

  return IcoBar;

})(View);
// Generated by CoffeeScript 1.11.1
var MapTreeApp,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

MapTreeApp = (function(superClass) {
  extend(MapTreeApp, superClass);

  function MapTreeApp(bel, data1, withLoginBar) {
    this.bel = bel;
    this.data = data1 != null ? data1 : new TreeAppData;
    if (withLoginBar == null) {
      withLoginBar = true;
    }
    MapTreeApp.__super__.constructor.call(this, this.data);
    this.layouts = {};
    this.cur_session_model_id = -1;
    this.active_key = new Bool(true);
    this.undo_manager = new UndoManager(this.data);
    this.he = new_dom_element({
      parentNode: this.bel,
      style: {
        position: "absolute",
        left: 0,
        right: 0,
        top: "31px",
        height: "30px"
      }
    });
    this.el = new_dom_element({
      parentNode: this.bel,
      id: "main_window",
      style: {
        position: "absolute",
        left: 0,
        right: 0,
        top: "61px",
        bottom: 0
      }
    });
    if (!withLoginBar) {
      this.he.style.top = '0px';
      this.el.style.top = '31px';
    }
    this.icobar = new IcoBar(this.he, this, {
      allow_sub: false
    });
    document.addEventListener("keydown", ((function(_this) {
      return function(evt) {
        return _this._on_key_down(evt);
      };
    })(this)), true);
    this.msg_container = new_dom_element({
      nodeName: "div",
      id: "msg_container",
      parentNode: this.el,
      txt: ""
    });
  }

  MapTreeApp.prototype.onchange = function() {
    var d, el, i, j, len, len1, message, ref, ref1, ref2, ref3, ref4, session;
    if (((ref = this.treeview) != null ? ref.flat : void 0) != null) {
      ref1 = this.treeview.flat;
      for (i = 0, len = ref1.length; i < len; i++) {
        el = ref1[i];
        if (((ref2 = el.item) != null ? ref2._messages : void 0) != null) {
          if (el.item._messages.has_been_modified()) {
            ref3 = el.item._messages;
            for (j = 0, len1 = ref3.length; j < len1; j++) {
              message = ref3[j];
              if (message.has_been_modified()) {
                (function(_this) {
                  return (function(message) {
                    var br, msg_box, msg_content;
                    msg_box = new_dom_element({
                      nodeName: "span",
                      id: "msg_box",
                      parentNode: _this.msg_container
                    });
                    msg_content = new_dom_element({
                      nodeName: "span",
                      parentNode: msg_box,
                      txt: message.provenance + " : " + message.title
                    });
                    br = new_dom_element({
                      nodeName: "br",
                      parentNode: msg_box
                    });
                    msg_content.classList.add(message.type);
                    return setTimeout((function() {
                      return _this.msg_container.removeChild(msg_box);
                    }), 5000);
                  });
                })(this)(message);
              }
            }
          }
        }
      }
    }
    if (this.data.selected_tree_items.has_been_modified()) {
      session = this.data.selected_session();
      if (session != null) {
        if (this.layouts[session.model_id] == null) {
          this.layouts[session.model_id] = this._new_LayoutManager(session);
        }
        if (this.cur_session_model_id !== session.model_id) {
          if ((ref4 = this.layouts[this.cur_session_model_id]) != null) {
            ref4.hide();
          }
          this.layouts[session.model_id].show();
          this.cur_session_model_id = session.model_id;
        }
      }
    }
    d = this.data.selected_display_settings();
    if (d._layout.has_been_modified()) {
      return this.data.update_associated_layout_data(d);
    }
  };

  MapTreeApp.prototype.selected_canvas_inst = function() {
    var i, layout, len, panel_id, ref, results, session;
    session = this.data.selected_session();
    layout = this.layouts[session.model_id];
    ref = this.data.selected_canvas_pan;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      panel_id = ref[i];
      if (layout._pan_vs_id[panel_id] != null) {
        results.push(layout._pan_vs_id[panel_id]);
      }
    }
    return results;
  };

  MapTreeApp.prototype.all_canvas_inst = function() {
    var ch, cmpi, key, layout, ref, session;
    session = this.data.selected_session();
    layout = this.layouts[session.model_id];
    cmpi = [];
    ref = layout._pan_vs_id;
    for (ch in ref) {
      key = ref[ch];
      if (key instanceof CanvasManagerPanelInstance) {
        cmpi.push(key);
      }
    }
    return cmpi;
  };

  MapTreeApp.prototype.fit = function(anim) {
    var i, inst, len, ref, results;
    if (anim == null) {
      anim = 1;
    }
    ref = this.selected_canvas_inst();
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      inst = ref[i];
      results.push(inst.cm.fit(anim));
    }
    return results;
  };

  MapTreeApp.prototype._new_LayoutManager = function(session) {
    var display_settings, res;
    display_settings = session._children.detect(function(x) {
      return x instanceof DisplaySettingsItem;
    });
    res = new LayoutManager(this.el, display_settings._layout);
    res.new_panel_instance = (function(_this) {
      return function(data) {
        return _this._new_panel_instance(display_settings, data);
      };
    })(this);
    return res;
  };

  MapTreeApp.prototype._new_panel_instance = function(display_settings, data) {
    var c, i, id, j, l, len, len1, len2, ref, ref1, ref2, res, tree_item, view_item;
    if (data.panel_id === "IcoBar") {
      res = new LayoutManagerPanelInstance(this.el, data);
      res.div.className = "PanelInstanceIcoBar";
      this.icobar = new IcoBar(res.div, this, {
        allow_sub: false
      });
      return res;
    }
    if (data.panel_id === "ContextBar") {
      res = new LayoutManagerPanelInstance(this.el, data);
      res.div.className = "PanelInstanceContextBar";
      new ContextBar(res.div, this);
      return res;
    }
    if (data.panel_id === "TreeView") {
      res = new LayoutManagerPanelInstance(this.el, data, "Scene");
      res.div.className = "PanelInstanceTreeView";
      this.treeview = new TreeView(res.div, this.data.tree_items, this.data.selected_tree_items, this.data.visible_tree_items, this.data.closed_tree_items, this.data.last_canvas_pan);
      res.treeview = this.treeview;
      res.div.onmousedown = (function(_this) {
        return function() {
          _this.data.focus.set(_this.treeview.process_id);
          return true;
        };
      })(this);
      return res;
    }
    if (data.panel_id === "EditView") {
      res = new LayoutManagerPanelInstance(this.el, data, "Inspector");
      res.div.className = "PanelInstanceEditView";
      new EditView(res.div, this.data, this.undo_manager);
      return res;
    }
    if (data.panel_id === "MapView") {
      res = new MapManagerPanelInstance(this.el, this.data, view_item, this.undo_manager);
      return res;
    }
    view_item = void 0;
    ref = display_settings._children;
    for (i = 0, len = ref.length; i < len; i++) {
      c = ref[i];
      if (c._panel_id.get() === data.panel_id) {
        view_item = c;
        break;
      }
    }
    if (view_item == null) {
      view_item = new ViewItem(this.data, data.panel_id, this._next_view_item_cam);
      if (this._next_view_item_child) {
        view_item.add_child(this._next_view_item_child);
      }
      display_settings._children.push(view_item);
      delete this._next_view_item_cam;
    }
    bind(this.data.selected_canvas_pan, (function(_this) {
      return function() {
        if (_this.data.selected_canvas_pan.contains(data.panel_id)) {
          return view_item._name_class.set("SelectedViewItem");
        } else {
          return view_item._name_class.set("UnselectedViewItem");
        }
      };
    })(this));
    if (this.data.visible_tree_items[data.panel_id] == null) {
      this.data.visible_tree_items.add_attr(data.panel_id, new Lst([view_item]));
      ref1 = this.data.panel_id_list();
      for (j = 0, len1 = ref1.length; j < len1; j++) {
        id = ref1[j];
        if (!(this.data.visible_tree_items[id].length >= 2)) {
          continue;
        }
        ref2 = this.data.visible_tree_items[id];
        for (l = 0, len2 = ref2.length; l < len2; l++) {
          tree_item = ref2[l];
          if (!(tree_item instanceof ViewItem)) {
            this.data.visible_tree_items[data.panel_id].push(tree_item);
          }
        }
        break;
      }
    } else {
      this.data.visible_tree_items[data.panel_id].push(view_item);
    }
    this.data.selected_canvas_pan.clear();
    this.data.selected_canvas_pan.push(data.panel_id);
    this.data.last_canvas_pan.set(data.panel_id);
    this.undo_manager.snapshot();
    return new MapManagerPanelInstance(this.el, this.data, view_item, this.undo_manager);
  };

  MapTreeApp.prototype._on_key_down = function(evt) {
    var cur_key, i, len, m, ref, ref1, results, special_keys;
    if (this.active_key.get()) {
      if ((16 <= (ref = evt.keyCode) && ref <= 18)) {
        return;
      }
      cur_key = "";
      if (evt.ctrlKey) {
        cur_key += "Ctrl+";
      }
      if (evt.shiftKey) {
        cur_key += "Shift+";
      }
      if (evt.altKey) {
        cur_key += "Alt+";
      }
      special_keys = {
        8: "BackSpace",
        9: "Tab",
        13: "Enter",
        19: "Pause",
        20: "CapsLock",
        27: "Esc",
        32: "Space",
        33: "PageUp",
        34: "PageDown",
        35: "End",
        36: "Home",
        37: "LeftArrow",
        38: "UpArrow",
        39: "RightArrow",
        40: "DownArrow",
        45: "Insert",
        46: "Del",
        112: "F1",
        113: "F2",
        114: "F3",
        115: "F4",
        116: "F5",
        117: "F6",
        118: "F7",
        119: "F8",
        120: "F9",
        121: "F10",
        122: "F11",
        123: "F12",
        144: "NumLock",
        145: "ScrollLock"
      };
      cur_key += special_keys[evt.keyCode] || String.fromCharCode(evt.keyCode).toUpperCase();
      ref1 = this.data.modules;
      results = [];
      for (i = 0, len = ref1.length; i < len; i++) {
        m = ref1[i];
        results.push(this._on_key_down_rec(m.actions, cur_key, evt));
      }
      return results;
    }
  };

  MapTreeApp.prototype._on_key_down_rec = function(actions, cur_key, evt) {
    var a, i, j, k, len, len1, ref, ref1;
    for (i = 0, len = actions.length; i < len; i++) {
      a = actions[i];
      if ((a.key != null) && ((a.ina == null) || !a.ina(this))) {
        ref = a.key;
        for (j = 0, len1 = ref.length; j < len1; j++) {
          k = ref[j];
          if (k === cur_key) {
            if (typeof a.fun === "function") {
              a.fun(evt, this);
            }
            this._cancel_natural_hotkeys(evt);
            return true;
          }
        }
      }
      if (((ref1 = a.sub) != null ? ref1.act : void 0) != null) {
        this._on_key_down_rec(a.sub.act, cur_key, evt);
      }
    }
    return false;
  };

  MapTreeApp.prototype._cancel_natural_hotkeys = function(evt) {
    if (!evt) {
      evt = window.event;
    }
    evt.cancelBubble = true;
    if (typeof evt.stopPropagation === "function") {
      evt.stopPropagation();
    }
    if (typeof evt.preventDefault === "function") {
      evt.preventDefault();
    }
    return false;
  };

  return MapTreeApp;

})(View);
// Generated by CoffeeScript 1.11.1
var CanvasManagerPanelInstance,
  bind1 = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

CanvasManagerPanelInstance = (function(superClass) {
  extend(CanvasManagerPanelInstance, superClass);

  function CanvasManagerPanelInstance(el, app_data, view_item, undo_manager) {
    this.app_data = app_data;
    this.view_item = view_item;
    this._launch_context_menu = bind1(this._launch_context_menu, this);
    this._add_transform_node = bind1(this._add_transform_node, this);
    CanvasManagerPanelInstance.__super__.constructor.call(this, el);
    this.divCanvas = document.createElement("div");
    this.divCanvas.style.position = "absolute";
    this._manage_is_chown = false;
    this.cm = new CanvasManager({
      el: this.divCanvas,
      cam: this.view_item.cam,
      items: this.app_data.visible_tree_items[this.view_item._panel_id],
      time: this.app_data.time,
      context_menu: (function(_this) {
        return function(evt, show) {
          return _this._launch_context_menu(evt, show);
        };
      })(this),
      add_transform: (function(_this) {
        return function(evt, show) {
          return _this._add_transform_node(evt);
        };
      })(this),
      theme: this.app_data.selected_display_settings().theme,
      undo_manager: undo_manager,
      allow_gl: true
    });
    this.cm.active_items = (function(_this) {
      return function() {
        var i, ref, res;
        res = [];
        if (((ref = _this.cm) != null ? ref.items : void 0) != null) {
          res = (function() {
            var j, len, ref1, results;
            ref1 = this.cm.items;
            results = [];
            for (j = 0, len = ref1.length; j < len; j++) {
              i = ref1[j];
              results.push(i);
            }
            return results;
          }).call(_this);
        }
        return res;
      };
    })(this);
    this.cm.selected_items = (function(_this) {
      return function() {
        var j, len, ref, results, s;
        ref = _this.app_data.selected_tree_items;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          s = ref[j];
          results.push(s[s.length - 1]);
        }
        return results;
      };
    })(this);
    this.app_data.selected_tree_items.bind(this.cm);
    this.app_data.focus.set(this.cm.process_id);
    this.cm.select_canvas_fun.push((function(_this) {
      return function(cm, evt) {
        _this.app_data.focus.set(_this.cm.process_id);
        if (evt.ctrlKey) {
          _this.app_data.selected_canvas_pan.toggle(_this.view_item._panel_id);
        } else {
          _this.app_data.selected_canvas_pan.set([_this.view_item._panel_id]);
        }
        if (_this.app_data.selected_canvas_pan.contains(_this.view_item._panel_id)) {
          return _this.app_data.last_canvas_pan.set(_this.view_item._panel_id);
        }
      };
    })(this));
    this.cm.click_fun.push((function(_this) {
      return function(cm, evt) {};
    })(this));
    this.cm.dblclick_fun.push((function(_this) {
      return function(cm, evt) {
        return _this._add_transform_node(evt);
      };
    })(this));
    bind(this.app_data.selected_canvas_pan, (function(_this) {
      return function() {
        return _this._update_borders();
      };
    })(this));
  }

  CanvasManagerPanelInstance.prototype.destructor = function() {
    var base;
    CanvasManagerPanelInstance.__super__.destructor.call(this);
    if (typeof (base = this.cm).destructor === "function") {
      base.destructor();
    }
    delete this.cm;
    return delete this.divManager;
  };

  CanvasManagerPanelInstance.prototype.render = function(info) {
    var h, w;
    this.el.appendChild(this.div);
    this.div.appendChild(this.divCanvas);
    this.p_min = info.p_min;
    this.p_max = info.p_max;
    this._update_borders();
    w = info.p_max[0] - info.p_min[0];
    h = info.p_max[1] - info.p_min[1] - 30;
    this.cm.resize(w, h);
    return this.cm.draw();
  };

  CanvasManagerPanelInstance.prototype._update_borders = function() {
    var module_manage, s;
    s = 1 * this.app_data.selected_canvas_pan.contains(this.view_item._panel_id);
    this.div.style.left = this.p_min[0] - s;
    this.div.style.top = this.p_min[1] - s;
    this.div.style.width = this.p_max[0] - this.p_min[0];
    this.div.style.height = this.p_max[1] - this.p_min[1];
    if (s) {
      this.div.style.borderWidth = 1;
      add_class(this.div, "SelectedCanvas");
    } else {
      this.div.style.borderWidth = 0;
      rem_class(this.div, "SelectedCanvas");
    }
    this.divCanvas.style.left = 0;
    this.divCanvas.style.top = 30;
    this.divCanvas.style.width = this.p_max[0] - this.p_min[0];
    this.divCanvas.style.height = this.p_max[1] - this.p_min[1] - 30;
    module_manage = new TreeAppModule_PanelManagerTop;
    return this._show_actions_module_manage(module_manage.actions, module_manage);
  };

  CanvasManagerPanelInstance.prototype._add_transform_node = function(evt) {
    var j, len, m, ref, results;
    ref = this.app_data.modules;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      m = ref[j];
      if (m instanceof TreeAppModule_Transform) {
        results.push(m.actions[1].fun(evt, this.app_data._processes[0]));
      }
    }
    return results;
  };

  CanvasManagerPanelInstance.prototype._launch_context_menu = function(evt, show) {
    if (show === true) {
      return this._show_context_menu(evt);
    } else {
      return this._delete_context_menu(evt);
    }
  };

  CanvasManagerPanelInstance.prototype._delete_context_menu = function(evt) {
    var menu, parent;
    if (document.getElementById("contextMenu") !== null) {
      menu = document.getElementById("contextMenu");
      parent = document.getElementById("main_window");
      return parent.removeChild(menu);
    }
  };

  CanvasManagerPanelInstance.prototype._find_entity = function(evt) {
    var item, j, k, l, len, len1, mouse_x, mouse_y, movable_entities, p, phase, point, pos, proj, ref, ref1;
    movable_entities = [];
    ref = this.cm.active_items();
    for (j = 0, len = ref.length; j < len; j++) {
      item = ref[j];
      mouse_x = evt.clientX - get_left(this.cm.canvas);
      mouse_y = evt.clientY - get_top(this.cm.canvas);
      pos = [mouse_x, mouse_y];
      if (item._closest_point_closer_than != null) {
        proj = (function() {
          var k, len1, ref1, results;
          ref1 = item.mesh.points;
          results = [];
          for (k = 0, len1 = ref1.length; k < len1; k++) {
            p = ref1[k];
            results.push(this.cm.cam_info.re_2_sc.proj(p.pos.get()));
          }
          return results;
        }).call(this);
        point = item._closest_point_closer_than(proj, pos, 10);
        if (point >= 0) {
          point.type = "Mesh";
          return point;
        }
      }
    }
    for (phase = k = 0; k < 2; phase = ++k) {
      ref1 = this.cm.active_items();
      for (l = 0, len1 = ref1.length; l < len1; l++) {
        item = ref1[l];
        if (!(item.get_movable_entities != null)) {
          continue;
        }
        item.get_movable_entities(movable_entities, this.cm.cam_info, [this.cm.mouse_x, this.cm.mouse_y], phase);
        if (movable_entities.length) {
          return movable_entities;
        }
      }
    }
    return [];
  };

  CanvasManagerPanelInstance.prototype._show_context_menu = function(evt) {
    var movable_entities, parent, point_under;
    if (evt == null) {
      evt = window.event;
    }
    this._delete_context_menu();
    movable_entities = this._find_entity(evt);
    point_under = false;
    if (movable_entities.length > 0) {
      if (movable_entities[0].type === "Transform") {
        point_under = "Transform";
      } else {
        point_under = "Mesh";
      }
    }
    this.modules = this.app_data.modules;
    parent = document.getElementById("main_window");
    this.menu = new_dom_element({
      parentNode: parent,
      id: "contextMenu",
      style: {
        position: "absolute",
        left: evt.clientX - get_left(this.div),
        top: evt.clientY - get_top(this.div)
      }
    });
    if (point_under === "Transform") {
      this._show_actions(TreeAppModule_Transform);
    } else if (point_under === "Mesh") {
      this._show_actions(TreeAppModule_Sketch);
    } else {
      this._show_actions(TreeAppModule_PanelManager);
    }
    return this._show_actions(TreeAppModule_UndoManager);
  };

  CanvasManagerPanelInstance.prototype._show_actions = function(module) {
    var j, len, m, ref, results;
    ref = this.modules;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      m = ref[j];
      if (m instanceof module) {
        results.push(this._show_actions_module_rec(m.actions, module));
      }
    }
    return results;
  };

  CanvasManagerPanelInstance.prototype._show_actions_module_rec = function(actions, module) {
    var c, j, len, results;
    results = [];
    for (j = 0, len = actions.length; j < len; j++) {
      c = actions[j];
      if (c.ico != null) {
        results.push((function(_this) {
          return function(c) {
            var elem, ref;
            elem = new_dom_element({
              parentNode: _this.menu,
              className: "contextMenuElement",
              onclick: function(evt) {
                c.fun(evt, _this.app_data._processes[0]);
                return _this._delete_context_menu(evt);
              }
            });
            new_dom_element({
              parentNode: elem,
              nodeName: "img",
              src: c.ico,
              alt: "",
              title: c.txt,
              height: 24,
              style: {
                paddingRight: "2px"
              }
            });
            new_dom_element({
              parentNode: elem,
              nodeName: "span",
              txt: c.txt,
              style: {
                position: "relative",
                top: "-5px"
              }
            });
            if (((ref = c.sub) != null ? ref.act : void 0) != null) {
              _this._show_actions_module_rec(c.sub.act, module);
              return true;
            }
          };
        })(this)(c));
      }
    }
    return results;
  };

  CanvasManagerPanelInstance.prototype._show_actions_module_manage = function(actions, module) {
    var c, index_left, j, len;
    if (!this._manage_is_chown) {
      index_left = 0;
      for (j = 0, len = actions.length; j < len; j++) {
        c = actions[j];
        if (c.ico != null) {
          (function(_this) {
            return (function(c) {
              var elem, ref;
              elem = new_dom_element({
                parentNode: _this.div,
                style: {
                  paddingRight: "4px",
                  paddingTop: "2px",
                  background: "#262626",
                  width: 30,
                  height: 30,
                  cssFloat: "right"
                },
                onclick: function(evt) {
                  var fun, k, len1, ref;
                  ref = _this.cm.select_canvas_fun;
                  for (k = 0, len1 = ref.length; k < len1; k++) {
                    fun = ref[k];
                    fun(_this.cm, evt);
                  }
                  return c.fun(evt, _this.app_data._processes[0]);
                }
              });
              index_left += 1;
              new_dom_element({
                parentNode: elem,
                nodeName: "img",
                src: c.ico,
                alt: "",
                title: c.txt,
                height: 22,
                style: {
                  marginTop: "2px",
                  paddingRight: "4px",
                  float: "left"
                }
              });
              if (((ref = c.sub) != null ? ref.act : void 0) != null) {
                _this._show_actions_module_manage(c.sub.act, module);
                return true;
              }
            });
          })(this)(c);
        }
      }
    }
    return this._manage_is_chown = true;
  };

  return CanvasManagerPanelInstance;

})(LayoutManagerPanelInstance);
// Generated by CoffeeScript 1.11.1
var EditView,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

EditView = (function(superClass) {
  extend(EditView, superClass);

  function EditView(div, app_data, undo_manager) {
    this.div = div;
    this.app_data = app_data;
    this.undo_manager = undo_manager;
    EditView.__super__.constructor.call(this, this.app_data);
    this.model_editors = {};
    this.div_icobar = {};
    this.old_divs = [];
  }

  EditView.prototype.onchange = function() {
    var d, e, i, icobar, j, k, len, len1, len2, m, o, path, ref, ref1, ref2, results, s, v;
    if (this.app_data.selected_tree_items.has_been_modified) {
      ref = this.old_divs;
      for (i = 0, len = ref.length; i < len; i++) {
        d = ref[i];
        this.div.removeChild(d);
      }
      this.old_divs = [];
      ref1 = this.app_data.selected_tree_items;
      results = [];
      for (j = 0, len1 = ref1.length; j < len1; j++) {
        path = ref1[j];
        s = path[path.length - 1];
        o = this.model_editors[s.model_id];
        if (o == null) {
          o = new_dom_element();
          if (this.div_icobar[s.model_id] == null) {
            this.div_icobar[s.model_id] = new_dom_element({
              parentNode: o
            });
            ref2 = this.app_data._processes;
            for (k = 0, len2 = ref2.length; k < len2; k++) {
              v = ref2[k];
              if (!(v instanceof TreeApp)) {
                continue;
              }
              if (s instanceof TreeItem_Computable) {
                icobar = new IcoBar(this.div_icobar[s.model_id], v, {
                  bnd: true,
                  loc: true
                });
              } else {
                icobar = new IcoBar(this.div_icobar[s.model_id], v, {
                  bnd: false,
                  loc: true
                });
              }
              break;
            }
          }
          e = new_dom_element({
            parentNode: o
          });
          m = new_model_editor({
            el: e,
            model: s,
            undo_manager: this.undo_manager,
            focus: this.app_data.focus
          });
          this.model_editors[s.model_id] = o;
        }
        this.div.appendChild(o);
        results.push(this.old_divs.push(o));
      }
      return results;
    }
  };

  return EditView;

})(View);
// Generated by CoffeeScript 1.11.1
var MapManagerPanelInstance,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

MapManagerPanelInstance = (function(superClass) {
  extend(MapManagerPanelInstance, superClass);

  function MapManagerPanelInstance(el, app_data, view_item, undo_manager) {
    this.app_data = app_data;
    this.view_item = view_item;
    MapManagerPanelInstance.__super__.constructor.call(this, el);
    this.divMap = document.createElement("div");
    this.divMap.style.position = "absolute";
    this._manage_is_chown = false;
    this.mm = new MapManager({
      el: this.divMap,
      items: this.app_data.visible_tree_items[this.view_item._panel_id],
      time: this.app_data.time,
      undo_manager: undo_manager
    });
    this.mm.active_items = (function(_this) {
      return function() {
        var i, ref, res;
        res = [];
        if (((ref = _this.mm) != null ? ref.items : void 0) != null) {
          res = (function() {
            var j, len, ref1, results;
            ref1 = this.mm.items;
            results = [];
            for (j = 0, len = ref1.length; j < len; j++) {
              i = ref1[j];
              results.push(i);
            }
            return results;
          }).call(_this);
        }
        return res;
      };
    })(this);
    this.mm.selected_items = (function(_this) {
      return function() {
        var j, len, ref, results, s;
        ref = _this.app_data.selected_tree_items;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          s = ref[j];
          results.push(s[s.length - 1]);
        }
        return results;
      };
    })(this);
    this.app_data.selected_tree_items.bind(this.mm);
    this.app_data.focus.set(this.mm.process_id);
    this.mm.select_canvas_fun.push((function(_this) {
      return function(cm, evt) {
        _this.app_data.focus.set(_this.mm.process_id);
        if (evt.ctrlKey) {
          _this.app_data.selected_canvas_pan.toggle(_this.view_item._panel_id);
        } else {
          _this.app_data.selected_canvas_pan.set([_this.view_item._panel_id]);
        }
        if (_this.app_data.selected_canvas_pan.contains(_this.view_item._panel_id)) {
          return _this.app_data.last_canvas_pan.set(_this.view_item._panel_id);
        }
      };
    })(this));
    bind(this.app_data.selected_canvas_pan, (function(_this) {
      return function() {
        return _this._update_borders();
      };
    })(this));
  }

  MapManagerPanelInstance.prototype.destructor = function() {
    var base;
    MapManagerPanelInstance.__super__.destructor.call(this);
    if (typeof (base = this.mm).destructor === "function") {
      base.destructor();
    }
    delete this.mm;
    return delete this.divManager;
  };

  MapManagerPanelInstance.prototype.render = function(info) {
    var h, w;
    this.el.appendChild(this.div);
    this.div.appendChild(this.divMap);
    this.p_min = info.p_min;
    this.p_max = info.p_max;
    this._update_borders();
    w = info.p_max[0] - info.p_min[0];
    h = info.p_max[1] - info.p_min[1] - 30;
    this.mm.resize(w, h);
    return this.mm.draw();
  };

  MapManagerPanelInstance.prototype._update_borders = function() {
    var module_manage, s;
    s = 1 * this.app_data.selected_canvas_pan.contains(this.view_item._panel_id);
    this.div.style.left = this.p_min[0] - s;
    this.div.style.top = this.p_min[1] - s;
    this.div.style.width = this.p_max[0] - this.p_min[0];
    this.div.style.height = this.p_max[1] - this.p_min[1];
    this.div.onclick = (function(_this) {
      return function(evt) {
        var fun, j, len, ref, results;
        ref = _this.mm.select_canvas_fun;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          fun = ref[j];
          results.push(fun(_this.mm, evt));
        }
        return results;
      };
    })(this);
    if (s) {
      this.div.style.borderWidth = 1;
      add_class(this.div, "SelectedCanvas");
    } else {
      this.div.style.borderWidth = 0;
      rem_class(this.div, "SelectedCanvas");
    }
    this.divMap.style.left = 0;
    this.divMap.style.top = 30;
    this.divMap.style.width = this.p_max[0] - this.p_min[0];
    this.divMap.style.height = this.p_max[1] - this.p_min[1] - 30;
    module_manage = new TreeAppModule_MapManagerTop;
    return this._show_actions_module_manage(module_manage.actions, module_manage);
  };

  MapManagerPanelInstance.prototype._show_actions = function(module) {
    var j, len, m, ref, results;
    ref = this.modules;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      m = ref[j];
      if (m instanceof module) {
        results.push(this._show_actions_module_rec(m.actions, module));
      }
    }
    return results;
  };

  MapManagerPanelInstance.prototype._show_actions_module_rec = function(actions, module) {
    var c, j, len, results;
    results = [];
    for (j = 0, len = actions.length; j < len; j++) {
      c = actions[j];
      if (c.ico != null) {
        results.push((function(_this) {
          return function(c) {
            var elem, ref;
            elem = new_dom_element({
              parentNode: _this.menu,
              className: "contextMenuElement",
              onclick: function(evt) {
                c.fun(evt, _this.app_data._processes[0]);
                return _this._delete_context_menu(evt);
              }
            });
            new_dom_element({
              parentNode: elem,
              nodeName: "img",
              src: c.ico,
              alt: "",
              title: c.txt,
              height: 24,
              style: {
                paddingRight: "2px"
              }
            });
            new_dom_element({
              parentNode: elem,
              nodeName: "span",
              txt: c.txt,
              style: {
                position: "relative",
                top: "-5px"
              }
            });
            if (((ref = c.sub) != null ? ref.act : void 0) != null) {
              _this._show_actions_module_rec(c.sub.act, module);
              return true;
            }
          };
        })(this)(c));
      }
    }
    return results;
  };

  MapManagerPanelInstance.prototype._show_actions_module_manage = function(actions, module) {
    var c, index_left, j, len;
    if (!this._manage_is_chown) {
      index_left = 0;
      for (j = 0, len = actions.length; j < len; j++) {
        c = actions[j];
        if (c.ico != null) {
          (function(_this) {
            return (function(c) {
              var elem, ref;
              elem = new_dom_element({
                parentNode: _this.div,
                style: {
                  paddingRight: "4px",
                  paddingTop: "2px",
                  background: "#262626",
                  width: 30,
                  height: 30,
                  cssFloat: "right"
                },
                onclick: function(evt) {
                  var fun, k, len1, ref;
                  ref = _this.mm.select_canvas_fun;
                  for (k = 0, len1 = ref.length; k < len1; k++) {
                    fun = ref[k];
                    fun(_this.mm, evt);
                  }
                  return c.fun(evt, _this.app_data._processes[0]);
                }
              });
              index_left += 1;
              new_dom_element({
                parentNode: elem,
                nodeName: "img",
                src: c.ico,
                alt: "",
                title: c.txt,
                height: 22,
                style: {
                  marginTop: "2px",
                  paddingRight: "4px",
                  float: "left"
                }
              });
              if (((ref = c.sub) != null ? ref.act : void 0) != null) {
                _this._show_actions_module_manage(c.sub.act, module);
                return true;
              }
            });
          })(this)(c);
        }
      }
    }
    return this._manage_is_chown = true;
  };

  return MapManagerPanelInstance;

})(LayoutManagerPanelInstance);
// Generated by CoffeeScript 1.11.1
var DeskNavigatorView,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

DeskNavigatorView = (function(superClass) {
  extend(DeskNavigatorView, superClass);

  function DeskNavigatorView(el, tree_app, params) {
    this.el = el;
    this.tree_app = tree_app;
    if (params == null) {
      params = {};
    }
    this.get_fs_instance = bind(this.get_fs_instance, this);
    this.app_data = this.tree_app.data;
    DeskNavigatorView.__super__.constructor.call(this, this.app_data);
    this.icon_container = new_dom_element({
      nodeName: "div",
      parentNode: this.el,
      style: {
        padding: "0 0 0 0"
      }
    });
  }

  DeskNavigatorView.prototype.onchange = function() {
    var File_dir, Organisation_dir, Projects_dir, admin_list, application_list, block, config, fs, selected_list_desk_items, test, user_list;
    if (this.app_data.selected_list_desk_items.has_been_directly_modified) {
      while (this.icon_container.firstChild != null) {
        this.icon_container.removeChild(this.icon_container.firstChild);
      }
      block = new_dom_element({
        parentNode: this.icon_container,
        nodeName: "span"
      });
      selected_list_desk_items = this.app_data.selected_list_desk_items[0]._ref != null ? this.app_data.selected_list_desk_items[0]._ref.get() : this.app_data.selected_list_desk_items[0]._name.get();
      if (selected_list_desk_items === "Projects") {
        Projects_dir = FileSystem._home_dir + "/__projects__";
        fs = this.get_fs_instance();
        return fs.load_or_make_dir(Projects_dir, function(current_dir, err) {
          var test;
          return test = new ModelEditorItem_Project({
            el: block,
            model: current_dir
          });
        });
      } else if (selected_list_desk_items === "Files") {
        fs = this.get_fs_instance();
        File_dir = FileSystem._home_dir + "/__files__";
        return fs.load_or_make_dir(File_dir, function(session_dir, err) {
          var test;
          return test = new ModelEditorItem_Directory({
            el: block,
            model: session_dir,
            use_icons: true,
            use_upload: true,
            use_breadcrumb: true,
            use_use: false,
            display: "all"
          });
        });
      } else if (selected_list_desk_items === "OrganisationFiles") {
        fs = this.get_fs_instance();
        Organisation_dir = this.app_data.config.selected_organisation[0].directory;
        return test = new ModelEditorItem_Directory({
          el: block,
          model: Organisation_dir,
          use_icons: true,
          use_upload: true,
          use_breadcrumb: true,
          use_use: false,
          display: "all"
        });
      } else if (selected_list_desk_items === "Organisations") {
        Organisation_dir = FileSystem._home_dir + "/__organisations__";
        config = this.app_data.config;
        fs = this.get_fs_instance();
        return fs.load_or_make_dir(Organisation_dir, function(current_dir, err) {
          return test = new ModelEditorItem_Organisation({
            el: block,
            model: current_dir,
            config: config
          });
        });
      } else if (selected_list_desk_items === "Applications") {
        return application_list = new ModelEditorItem_Application({
          el: block,
          model: this.app_data.config.selected_organisation[0].list_applications,
          use_icons: true,
          config: this.app_data.config
        });
      } else if (this.selected_list_desk_items === "Admin") {
        DeskNavigatorView.new_admin_button(block, this);
        return admin_list = new ModelEditorItem_User({
          el: block,
          model: this.app_data.config.selected_organisation[0].admin_users
        });
      } else if (selected_list_desk_items === "Users") {
        DeskNavigatorView.new_users_button(block, this);
        return user_list = new ModelEditorItem_User({
          el: block,
          model: this.app_data.config.selected_organisation[0].list_users
        });
      }
    }
  };

  DeskNavigatorView.prototype.get_fs_instance = function() {
    var fs;
    if ((typeof FileSystem !== "undefined" && FileSystem !== null) && (FileSystem.get_inst() != null)) {
      fs = FileSystem.get_inst();
      return fs;
    } else {
      fs = new FileSystem;
      FileSystem._disp = false;
      return fs;
    }
  };

  DeskNavigatorView.new_users_button = function(block, dnv) {
    var div_top;
    div_top = new_dom_element({
      parentNode: block,
      className: "desk_panel_title"
    });
    return new_dom_element({
      parentNode: div_top,
      nodeName: "div",
      txt: "Users",
      style: {
        margin: "5px 20px 0px 0px",
        height: "30px",
        cssFloat: "left"
      }
    });
  };

  DeskNavigatorView.new_admin_button = function(block, dnv) {
    var div_top;
    div_top = new_dom_element({
      parentNode: block,
      className: "desk_panel_title"
    });
    return new_dom_element({
      parentNode: div_top,
      nodeName: "div",
      txt: "Admin users",
      style: {
        margin: "5px 20px 0px 0px",
        height: "30px",
        cssFloat: "left"
      }
    });
  };

  return DeskNavigatorView;

})(View);
// Generated by CoffeeScript 1.11.1
var DeskListView,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

DeskListView = (function(superClass) {
  extend(DeskListView, superClass);

  function DeskListView(el, tree_app, params) {
    this.el = el;
    this.tree_app = tree_app;
    if (params == null) {
      params = {};
    }
    this.app_data = this.tree_app.data;
    DeskListView.__super__.constructor.call(this, this.app_data);
    this.icon_container = new_dom_element({
      nodeName: "div",
      parentNode: this.el
    });
  }

  DeskListView.prototype.onchange = function() {
    var block, i, item, j, len, ref, results, selected;
    if (this.app_data.selected_list_desk_items.has_been_directly_modified) {
      this.el.appendChild(this.icon_container);
      while (this.icon_container.firstChild != null) {
        this.icon_container.removeChild(this.icon_container.firstChild);
      }
      block = new_dom_element({
        parentNode: this.icon_container,
        nodeName: "span"
      });
      ref = this.app_data.list_desk_items;
      results = [];
      for (j = i = 0, len = ref.length; i < len; j = ++i) {
        item = ref[j];
        selected = false;
        if (this.app_data.selected_list_desk_items.contains(item)) {
          selected = true;
        }
        results.push(this.draw_item(item, block, 1, selected));
      }
      return results;
    }
  };

  DeskListView.prototype.draw_item = function(item, parent, size, selected) {
    return (function(_this) {
      return function(item) {
        var container_div, container_txt;
        container_div = new_dom_element({
          parentNode: parent,
          nodeName: "div",
          onmousedown: function(evt) {
            _this.app_data.selected_list_desk_items.clear();
            return _this.app_data.selected_list_desk_items.push(item);
          },
          style: {
            height: 30,
            width: "100%",
            fontWeight: "bold",
            cursor: "pointer",
            background: selected ? "#b8dbe9" : void 0
          }
        });
        return container_txt = new_dom_element({
          parentNode: container_div,
          nodeName: "div",
          txt: item._name,
          style: {
            height: 25,
            fontWeight: "bold",
            fontSize: "18px",
            padding: "5px 0 0 50px",
            cursor: "pointer"
          }
        });
      };
    })(this)(item);
  };

  return DeskListView;

})(View);
// Generated by CoffeeScript 1.11.1
var MessageListView,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

MessageListView = (function(superClass) {
  extend(MessageListView, superClass);

  function MessageListView(el, tree_app, params) {
    this.el = el;
    this.tree_app = tree_app;
    if (params == null) {
      params = {};
    }
    this.app_data = this.tree_app.data;
    MessageListView.__super__.constructor.call(this, this.app_data);
    this.icon_container = new_dom_element({
      nodeName: "div"
    });
  }

  MessageListView.prototype.onchange = function() {
    var Message_dir, block, div_top, fs;
    if (this.app_data.list_desk_items.has_been_directly_modified) {
      this.el.appendChild(this.icon_container);
      while (this.icon_container.firstChild != null) {
        this.icon_container.removeChild(this.icon_container.firstChild);
      }
      div_top = new_dom_element({
        parentNode: this.icon_container,
        className: "desk_panel_title"
      });
      new_dom_element({
        parentNode: div_top,
        nodeName: "div",
        txt: "Messages",
        style: {
          margin: "5px 20px 0px 0px",
          height: "30px",
          cssFloat: "left"
        }
      });
      new_dom_element({
        parentNode: div_top,
        nodeName: "button",
        className: "desk_panel_button",
        txt: "New message",
        style: {
          margin: "3px 0px 0px 0px",
          padding: "0px 10px 0px 10px",
          height: "20px",
          cssFloat: "left"
        },
        onclick: function(evt) {
          var message, name;
          name = prompt("Message name", "");
          if (name !== "") {
            message = new MessageCollection(name);
            return fs.load_or_make_dir(Message_dir, function(current_dir, err) {
              return current_dir.add_file(name, message, {
                model_type: "Message"
              });
            });
          } else {
            return alert("you must type a name !");
          }
        }
      });
      block = new_dom_element({
        parentNode: this.icon_container,
        nodeName: "span"
      });
      if ((typeof FileSystem !== "undefined" && FileSystem !== null) && (FileSystem.get_inst() != null)) {
        fs = FileSystem.get_inst();
      } else {
        fs = new FileSystem;
        FileSystem._disp = false;
      }
      Message_dir = FileSystem._home_dir + "/__messages__";
      return fs.load_or_make_dir(Message_dir, function(current_dir, err) {
        var test;
        return test = new ModelEditorItem_Message({
          el: block,
          model: current_dir
        });
      });
    }
  };

  MessageListView.display_messages = function(current_dir, block) {
    var i, len, mes, message_line, message_name, results;
    results = [];
    for (i = 0, len = current_dir.length; i < len; i++) {
      mes = current_dir[i];
      message_line = new_dom_element({
        parentNode: block,
        nodeName: "div",
        style: {
          width: "100%"
        },
        onclick: function(evt) {
          return mes.load((function(_this) {
            return function(object, err) {
              var mv;
              return mv = new MessageView(object, evt);
            };
          })(this));
        }
      });
      results.push(message_name = new_dom_element({
        parentNode: message_line,
        nodeName: "div",
        txt: mes.name,
        style: {
          margin: "0px 0px 0px 10px"
        }
      }));
    }
    return results;
  };

  return MessageListView;

})(View);
// Generated by CoffeeScript 1.11.1
var DeskApp,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

DeskApp = (function(superClass) {
  extend(DeskApp, superClass);

  function DeskApp(bel, data1) {
    this.bel = bel;
    this.data = data1 != null ? data1 : new TreeAppData;
    this.user_email = Cookies.set("email");
    this.layout = this.data.layout;
    this.el = new_dom_element({
      parentNode: this.bel,
      id: "organisation_container",
      style: {
        position: "absolute",
        left: 0,
        right: 0,
        top: "32px",
        bottom: 0
      }
    });
    this.lm = new LayoutManager(this.el, this.layout);
    this.lm.new_panel_instance = (function(_this) {
      return function(data) {
        return _this._new_panel_instance(data);
      };
    })(this);
    this.lm.show();
  }

  DeskApp.prototype._new_panel_instance = function(data) {
    var res;
    if (data.panel_id === "DeskListView") {
      res = new LayoutManagerPanelInstance(this.el, data, "Desk");
      res.div.className = "PanelInstanceTreeView";
      new DeskListView(res.div, this);
      return res;
    }
    if (data.panel_id === "DeskNavigatorView") {
      res = new LayoutManagerPanelInstance(this.el, data);
      res.div.className = "PanelInstanceContextBar";
      new DeskNavigatorView(res.div, this);
      return res;
    }
    if (data.panel_id === "MessageListView") {
      res = new LayoutManagerPanelInstance(this.el, data);
      res.div.className = "PanelInstanceContextBar";
      new MessageListView(res.div, this);
      return res;
    }
    res = new LayoutManagerPanelInstance(this.el, data);
    res.div.className = "PanelInstanceContextBar";
    return res;
  };

  return DeskApp;

})(View);
// Generated by CoffeeScript 1.11.1
var Timeline,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

Timeline = (function(superClass) {
  extend(Timeline, superClass);

  function Timeline(el, tree_app, params) {
    var key, val;
    this.el = el;
    this.tree_app = tree_app;
    if (params == null) {
      params = {};
    }
    this.modules = this.tree_app.data.modules;
    Timeline.__super__.constructor.call(this, this.modules);
    this.tree_app.data.focus.bind(this);
    for (key in params) {
      val = params[key];
      this[key] = val;
    }
    this.div = new_dom_element({
      id: "timeline"
    });
  }

  Timeline.prototype.onchange = function() {
    var l, len, m, ref, results;
    this.el.appendChild(this.div);
    while (this.div.firstChild != null) {
      this.div.removeChild(this.div.firstChild);
    }
    ref = this.modules;
    results = [];
    for (l = 0, len = ref.length; l < len; l++) {
      m = ref[l];
      if (!((m.timeline != null) && m.timeline === true)) {
        continue;
      }
      if ((m.visible != null) && m.visible === false) {
        continue;
      }
      results.push((function(_this) {
        return function(m) {
          var act, current_picture_name, j, len1, n, player_button, ref1, results1, speed, speed_container, speed_txt;
          speed_container = new_dom_element({
            parentNode: _this.div,
            nodeName: "span",
            className: "timeline_speed"
          });
          speed = new_model_editor({
            el: speed_container,
            model: m.img_per_sec,
            item_type: ModelEditorItem_Input,
            item_width: ''
          });
          speed_txt = new_dom_element({
            parentNode: speed_container,
            nodeName: "span",
            className: "timeline_speed_txt",
            txt: "img/s"
          });
          current_picture_name = new_dom_element({
            parentNode: _this.div,
            nodeName: "span",
            className: "timeline_current_picture_name",
            txt: "Picture " + _this.tree_app.data.time.get()
          });
          player_button = new_dom_element({
            parentNode: _this.div,
            id: "timeline_player_button"
          });
          ref1 = m.actions;
          results1 = [];
          for (j = n = 0, len1 = ref1.length; n < len1; j = ++n) {
            act = ref1[j];
            if (act.vis !== false) {
              results1.push((function(act) {
                var editor, key, scroll_pane, span_container;
                if (act.mod != null) {
                  scroll_pane = new_dom_element({
                    parentNode: _this.div,
                    className: "timeline_scroll_pane"
                  });
                  return editor = new_model_editor({
                    el: scroll_pane,
                    model: act.mod(_this.tree_app)
                  });
                } else {
                  key = _this.key_as_string(act);
                  span_container = new_dom_element({
                    parentNode: player_button,
                    nodeName: "span"
                  });
                  return span_container = new_dom_element({
                    parentNode: span_container,
                    nodeName: "img",
                    src: act.ico,
                    alt: act.txt,
                    title: act.txt + key,
                    onmousedown: function(evt) {
                      return act.fun(evt, _this.tree_app);
                    }
                  });
                }
              })(act));
            }
          }
          return results1;
        };
      })(this)(m));
    }
    return results;
  };

  Timeline.prototype.key_as_string = function(act) {
    var i, k, key, l, len, ref;
    key = '';
    if (act.key != null) {
      key = ' (';
      ref = act.key;
      for (i = l = 0, len = ref.length; l < len; i = ++l) {
        k = ref[i];
        if (i >= 1) {
          key += ' or ';
        }
        key += k;
      }
      key += ')';
    }
    return key;
  };

  return Timeline;

})(View);
